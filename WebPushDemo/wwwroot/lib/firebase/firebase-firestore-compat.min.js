!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase,e.firebase.INTERNAL.modularAPIs)}(this,function(Id,_d){"use strict";try{!function(){var e,t=(e=Id)&&"object"==typeof e&&"default"in e?e:{default:e};function n(n){const r=[];let s=0;for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);e<128?r[s++]=e:(e<2048?r[s++]=e>>6|192:(55296==(64512&e)&&t+1<n.length&&56320==(64512&n.charCodeAt(t+1))?(e=65536+((1023&e)<<10)+(1023&n.charCodeAt(++t)),r[s++]=e>>18|240,r[s++]=e>>12&63|128):r[s++]=e>>12|224,r[s++]=e>>6&63|128),r[s++]=63&e|128)}return r}function o(e){return e=n(e),r.encodeByteArray(e,!0).replace(/\./g,"")}const r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();var s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let n=0;n<r.length;n+=3){var o=r[n],a=n+1<r.length,h=a?r[n+1]:0,u=n+2<r.length,c=u?r[n+2]:0;let e=(15&h)<<2|c>>6,t=63&c;u||(t=64,a||(e=64)),i.push(s[o>>2],s[(3&o)<<4|h>>4],s[e],s[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var s,i,o=e[n++];o<128?t[r++]=String.fromCharCode(o):191<o&&o<224?(s=e[n++],t[r++]=String.fromCharCode((31&o)<<6|63&s)):239<o&&o<365?(i=((7&o)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))):(s=e[n++],i=e[n++],t[r++]=String.fromCharCode((15&o)<<12|(63&s)<<6|63&i))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(t,e){this.init_();var n=e?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let e=0;e<t.length;){var s=n[t.charAt(e++)],i=e<t.length?n[t.charAt(e)]:0;++e;var o=e<t.length?n[t.charAt(e)]:64;++e;var a=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==i||null==o||null==a)throw Error();r.push(s<<2|i>>4),64!==o&&(r.push(i<<4&240|o>>2),64!==a&&r.push(o<<6&192|a))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function f(e){return e&&e._delegate?e._delegate:e}var l,s=(i.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},i.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},i.prototype.setServiceProps=function(e){return this.serviceProps=e,this},i.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},i);function i(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}(We=l=l||{})[We.DEBUG=0]="DEBUG",We[We.VERBOSE=1]="VERBOSE",We[We.INFO=2]="INFO",We[We.WARN=3]="WARN",We[We.ERROR=4]="ERROR",We[We.SILENT=5]="SILENT";const a={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},h=l.INFO,u={[l.DEBUG]:"log",[l.VERBOSE]:"log",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error"},c=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),s=u[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${r}]  ${e.name}:`,...n)}};var g="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},w=g||self;function m(){}function p(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function y(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var v="closure_uid_"+(1e9*Math.random()>>>0),b=0;function T(e,t,n){return e.call.apply(e.bind,arguments)}function E(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function I(e,t,n){return(I=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?T:E).apply(null,arguments)}function _(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function S(e,i){function t(){}t.prototype=i.prototype,e.Z=i.prototype,e.prototype=new t,(e.prototype.constructor=e).Vb=function(e,t,n){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return i.prototype[t].apply(e,r)}}function N(){this.s=this.s,this.o=this.o}var A={};N.prototype.s=!1,N.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,e=Object.prototype.hasOwnProperty.call(e,v)&&e[v]||(e[v]=++b),delete A[e])},N.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const D=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(t,n){if("string"==typeof t)return"string"!=typeof n||1!=n.length?-1:t.indexOf(n,0);for(let e=0;e<t.length;e++)if(e in t&&t[e]===n)return e;return-1},C=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(t,n,r){var s=t.length,i="string"==typeof t?t.split(""):t;for(let e=0;e<s;e++)e in i&&n.call(r,i[e],e,t)};function x(){return Array.prototype.concat.apply([],arguments)}function k(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function R(e){return/^[\s\xa0]*$/.test(e)}var L=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function O(e,t){return-1!=e.indexOf(t)}function M(e,t){return e<t?-1:t<e?1:0}var F=w.navigator;function P(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function V(e){const t={};for(const n in e)t[n]=e[n];return t}Y=(F=F&&F.userAgent)?F:"";var U="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function q(t){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e])t[n]=r[n];for(let e=0;e<U.length;e++)n=U[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function B(e){return B[" "](e),e}B[" "]=m;var j,K=O(Y,"Opera"),$=O(Y,"Trident")||O(Y,"MSIE"),G=O(Y,"Edge"),z=G||$,H=O(Y,"Gecko")&&!(O(Y.toLowerCase(),"webkit")&&!O(Y,"Edge"))&&!(O(Y,"Trident")||O(Y,"MSIE"))&&!O(Y,"Edge"),Q=O(Y.toLowerCase(),"webkit")&&!O(Y,"Edge");function W(){var e=w.document;return e?e.documentMode:void 0}var F="",Y=(Y=Y,H?/rv:([^\);]+)(\)|;)/.exec(Y):G?/Edge\/([\d\.]+)/.exec(Y):$?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Y):Q?/WebKit\/(\S+)/.exec(Y):K?/(?:Version)[ \/]?(\S+)/.exec(Y):void 0);Y&&(F=Y?Y[1]:""),j=$&&null!=(Y=W())&&Y>parseFloat(F)?String(Y):F;var J={};var X=w.document&&$&&(W()||parseInt(j,10))||void 0,Z=function(){if(!w.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{w.addEventListener("test",m,t),w.removeEventListener("test",m,t)}catch(e){}return e}();function ee(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function te(e,t){if(ee.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(H){e:{try{B(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:ne[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&te.Z.h.call(this)}}ee.prototype.h=function(){this.defaultPrevented=!0},S(te,ee);var ne={2:"touch",3:"pen",4:"mouse"};te.prototype.h=function(){te.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var re="closure_listenable_"+(1e6*Math.random()|0),se=0;function ie(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=s,this.key=++se,this.ca=this.fa=!1}function oe(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function ae(e){this.src=e,this.g={},this.h=0}function he(e,t){var n,r,s,i=t.type;i in e.g&&(n=e.g[i],(s=0<=(r=D(n,t)))&&Array.prototype.splice.call(n,r,1),s&&(oe(t),0==e.g[i].length&&(delete e.g[i],e.h--)))}function ue(e,t,n,r){for(var s=0;s<e.length;++s){var i=e[s];if(!i.ca&&i.listener==t&&i.capture==!!n&&i.ia==r)return s}return-1}ae.prototype.add=function(e,t,n,r,s){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=ue(e,t,r,s);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new ie(t,this.src,i,!!r,s)).fa=n,e.push(t)),t};var ce="closure_lm_"+(1e6*Math.random()|0),le={};function de(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");var o,a=y(s)?!!s.capture:!!s,h=pe(e);if(h||(e[ce]=h=new ae(e)),(n=h.add(t,n,r,a,i)).proxy)return n;if(o=me,r=function e(t){return o.call(e.src,e.listener,t)},(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(s=Z?s:a)&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(ge(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function fe(e){var t,n,r;"number"!=typeof e&&e&&!e.ca&&((t=e.src)&&t[re]?he(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ge(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=pe(t))?(he(n,e),0==n.h&&(n.src=null,t[ce]=null)):oe(e)))}function ge(e){return e in le?le[e]:le[e]="on"+e}function me(e,t){var n,r;return!!e.ca||(t=new te(t,this),n=e.listener,r=e.ia||e.src,e.fa&&fe(e),n.call(r,t))}function pe(e){return(e=e[ce])instanceof ae?e:null}var ye="__closure_events_fn_"+(1e9*Math.random()>>>0);function we(t){return"function"==typeof t?t:(t[ye]||(t[ye]=function(e){return t.handleEvent(e)}),t[ye])}function ve(){N.call(this),this.i=new ae(this),(this.P=this).I=null}function be(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new ee(t,e):t instanceof ee?t.target=t.target||e:(o=t,q(t=new ee(r,e),o)),o=!0,n)for(var s=n.length-1;0<=s;s--)var i=t.g=n[s],o=Te(i,r,!0,t)&&o;if(o=Te(i=t.g=e,r,!0,t)&&o,o=Te(i,r,!1,t)&&o,n)for(s=0;s<n.length;s++)o=Te(i=t.g=n[s],r,!1,t)&&o}function Te(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o,a,h=t[i];h&&!h.ca&&h.capture==n&&(o=h.listener,a=h.ia||h.src,h.fa&&he(e.i,h),s=!1!==o.call(a,r)&&s)}return s&&!r.defaultPrevented}S(ve,N),ve.prototype[re]=!0,ve.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,s,i){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,s,i);else s=y(s)?!!s.capture:!!s,r=we(r),t&&t[re]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=ue(o=t.g[n],r,s,i))&&(oe(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete t.g[n],t.h--))):(t=t&&pe(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?ue(n,r,s,i):t)?n[t]:null)&&fe(r))}(this,e,t,n,r)},ve.prototype.M=function(){if(ve.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)oe(n[r]);delete t.g[e],t.h--}}this.I=null},ve.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ve.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Ee,Ie=w.JSON.stringify,_e=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Se,e=>e.reset());class Se{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Ne(e,t){var n;Ee||(n=w.Promise.resolve(void 0),Ee=function(){n.then(Ce)}),Ae||(Ee(),Ae=!0),De.add(e,t)}var Ae=!1,De=new class{constructor(){this.h=this.g=null}add(e,t){const n=_e.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Ce(){for(var e;e=function(){var e=De;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){w.setTimeout(()=>{throw e},0)}(e)}var t=_e;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Ae=!1}function xe(e,t){ve.call(this),this.h=e||1,this.g=t||w,this.j=I(this.kb,this),this.l=Date.now()}function ke(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function Re(e,t,n){if("function"==typeof e)n&&(e=I(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=I(e.handleEvent,e)}return 2147483647<Number(t)?-1:w.setTimeout(e,t||0)}S(xe,ve),(Y=xe.prototype).da=!1,Y.S=null,Y.kb=function(){var e;this.da&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),be(this,"tick"),this.da&&(ke(this),this.start())))},Y.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Y.M=function(){xe.Z.M.call(this),ke(this),delete this.g};class Le extends N{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=Re(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(w.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Oe(e){N.call(this),this.h=e,this.g={}}S(Oe,N);var Me=[];function Fe(e,t,n,r){Array.isArray(n)||(n&&(Me[0]=n.toString()),n=Me);for(var s=0;s<n.length;s++){var i=function e(t,n,r,s,i){if(s&&s.once)return function e(t,n,r,s,i){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,s,i);return null}return r=we(r),t&&t[re]?t.O(n,r,y(s)?!!s.capture:!!s,i):de(t,n,r,!0,s,i)}(t,n,r,s,i);if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,s,i);return null}return r=we(r),t&&t[re]?t.N(n,r,y(s)?!!s.capture:!!s,i):de(t,n,r,!1,s,i)}(t,n[s],r||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}}function Pe(e){P(e.g,function(e,t){this.g.hasOwnProperty(t)&&fe(e)},e),e.g={}}function Ve(){this.g=!0}function Ue(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var s=r[1];if(Array.isArray(s)&&!(s.length<1)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Ie(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}Oe.prototype.M=function(){Oe.Z.M.call(this),Pe(this)},Oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ve.prototype.Aa=function(){this.g=!1},Ve.prototype.info=function(){};var qe={},Be=null;function je(){return Be=Be||new ve}function Ke(e){ee.call(this,qe.Ma,e)}function $e(){var e=je();be(e,new Ke(e))}function Ge(e,t){ee.call(this,qe.STAT_EVENT,e),this.stat=t}function ze(e){var t=je();be(t,new Ge(t,e))}function He(e,t){ee.call(this,qe.Na,e),this.size=t}function Qe(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return w.setTimeout(function(){e()},t)}qe.Ma="serverreachability",S(Ke,ee),qe.STAT_EVENT="statevent",S(Ge,ee),qe.Na="timingevent",S(He,ee);var F={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},We={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Ye(){}function Je(e){return e.h||(e.h=e.i())}function Xe(){}function Ze(){ee.call(this,"d")}function et(){ee.call(this,"c")}function tt(){}function nt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new Oe(this),this.P=it,this.W=new xe(e=z?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new rt}function rt(){this.i=null,this.g="",this.h=!1}Ye.prototype.h=null,g={OPEN:"a",pb:"b",Ka:"c",Bb:"d"},S(Ze,ee),S(et,ee),S(tt,Ye),tt.prototype.g=function(){return new XMLHttpRequest},tt.prototype.i=function(){return{}};var st=new tt,it=45e3,ot={},at={};function ht(e,t,n){e.K=1,e.v=xt(_t(t)),e.s=n,e.U=!0,ut(e,null)}function ut(e,t){e.F=Date.now(),dt(e),e.A=_t(e.v);var o,a,h,u,c,l,n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),Kt(n.h,"t",r),e.C=0,n=e.l.H,e.h=new rt,e.g=$n(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Le(I(e.Ia,e,e.g),e.O)),Fe(e.V,e.g,"readystatechange",e.gb),t=e.H?V(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),$e(),o=e.j,a=e.u,h=e.A,u=e.m,c=e.X,l=e.s,o.info(function(){if(o.g)if(l)for(var e="",t=l.split("&"),n=0;n<t.length;n++){var r,s,i=t[n].split("=");1<i.length&&(r=i[0],i=i[1],e=2<=(s=r.split("_")).length&&"type"==s[1]?e+(r+"=")+i+"&":e+(r+"=redacted&"))}else e=null;else e=l;return"XMLHTTP REQ ("+u+") [attempt "+c+"]: "+a+"\n"+h+"\n"+e})}function ct(e){return e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function lt(e,t,n){let r=!0,s;for(;!e.I&&e.C<n.length;){if(s=(h=void 0,a=(i=e).C,-1==(h=(o=n).indexOf("\n",a))?at:(a=Number(o.substring(a,h)),isNaN(a)?ot:(h+=1)+a>o.length?at:(o=o.substr(h,a),i.C=h+a,o))),s==at){4==t&&(e.o=4,ze(14),r=!1),Ue(e.j,e.m,null,"[Incomplete Response]");break}if(s==ot){e.o=4,ze(15),Ue(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}Ue(e.j,e.m,s,null),yt(e,s)}var i,o,a,h;ct(e)&&s!=at&&s!=ot&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,ze(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Fn(t),t.L=!0,ze(11))):(Ue(e.j,e.m,n,"[Invalid Chunked Response]"),pt(e),mt(e))}function dt(e){e.Y=Date.now()+e.P,ft(e,e.P)}function ft(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Qe(I(e.eb,e),t)}function gt(e){e.B&&(w.clearTimeout(e.B),e.B=null)}function mt(e){0==e.l.G||e.I||Un(e.l,e)}function pt(e){gt(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,ke(e.W),Pe(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function yt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||Yt(n.i,e)))if(n.I=e.N,!e.J&&Yt(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Vn(n),An(n)}Mn(n),ze(18)}}else n.ta=s[1],0<n.ta-n.U&&s[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=Qe(I(n.ab,n),6e3));if(Wt(n.i)<=1&&n.ka){try{n.ka()}catch(e){}n.ka=void 0}}else Bn(n,11)}else if(!e.J&&n.g!=e||Vn(n),!R(t))for(s=n.Ca.g.parse(t),t=0;t<s.length;t++){var i=s[t];if(n.U=i[0],i=i[1],2==n.G)if("c"==i[0]){n.J=i[1],n.la=i[2];var o=i[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var a=i[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var h,u,c,l=i[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const m=e.g;m&&(!(h=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(u=r.i).g&&(O(h,"spdy")||O(h,"quic")||O(h,"h2"))&&(u.j=u.l,u.g=new Set,u.h&&(Jt(u,u.h),u.h=null)),!r.D||(c=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=c,Ct(r.F,r.D,c))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d,f,g=e;(r=n).oa=Kn(r,r.H?r.la:null,r.W),g.J?(Xt(r.i,g),d=g,(f=r.K)&&d.setTimeout(f),d.B&&(gt(d),dt(d)),r.g=g):On(r),0<n.l.length&&xn(n)}else"stop"!=i[0]&&"close"!=i[0]||Bn(n,7);else 3==n.G&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?Bn(n,7):Nn(n):"noop"!=i[0]&&n.j&&n.j.wa(i),n.A=0)}$e()}catch(e){}}function wt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(p(e)||"string"==typeof e)C(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(p(e)||"string"==typeof e)for(var n=[],r=e.length,s=0;s<r;s++)n.push(s);else for(s in n=[],r=0,e)n[r++]=s;for(var s=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(p(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length,i=0;i<s;i++)t.call(void 0,r[i],n&&n[i],e)}}function vt(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof vt)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function bt(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];Tt(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){for(var s={},n=t=0;t<e.g.length;)Tt(s,r=e.g[t])||(s[e.g[n++]=r]=1),t++;e.g.length=n}}function Tt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(Y=nt.prototype).setTimeout=function(e){this.P=e},Y.gb=function(e){e=e.target;const t=this.L;t&&3==Tn(e)?t.l():this.Ia(e)},Y.Ia=function(e){try{if(e==this.g)e:{var t=Tn(this.g),n=this.g.Da();if(this.g.ba(),!(t<3)&&(3!=t||z||this.g&&(this.h.h||this.g.ga()||En(this.g)))){this.I||4!=t||7==n||$e(),gt(this);var r=this.g.ba();this.N=r;t:if(ct(this)){var s=En(this.g);e="";var i=s.length,o=4==Tn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){pt(this),mt(this);var a="";break t}this.h.i=new w.TextDecoder}for(n=0;n<i;n++)this.h.h=!0,e+=this.h.i.decode(s[n],{stream:o&&n==i-1});s.splice(0,i),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,l=this.j,d=this.u,f=this.A,g=this.m,m=this.X,p=t,y=r,l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+m+"]: "+d+"\n"+f+"\n"+p+" "+y}),this.i){if(this.$&&!this.J){t:{if(this.g){var h,u=this.g;if((h=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!R(h)){var c=h;break t}}c=null}if(!(r=c)){this.i=!1,this.o=3,ze(12),pt(this),mt(this);break e}Ue(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,yt(this,r)}this.U?(lt(this,t,a),z&&this.i&&3==t&&(Fe(this.V,this.W,"tick",this.fb),this.W.start())):(Ue(this.j,this.m,a,null),yt(this,a)),4==t&&pt(this),this.i&&!this.I&&(4==t?Un(this.l,this):(this.i=!1,dt(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,ze(12)):(this.o=0,ze(13)),pt(this),mt(this)}}}catch(e){}var l,d,f,g,m,p,y},Y.fb=function(){var e,t;this.g&&(e=Tn(this.g),t=this.g.ga(),this.C<t.length&&(gt(this),lt(this,e,t),this.i&&4!=e&&dt(this)))},Y.cancel=function(){this.I=!0,pt(this)},Y.eb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.Y?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&($e(),ze(17)),pt(this),this.o=2,mt(this)):ft(this,this.Y-n)},(Y=vt.prototype).R=function(){bt(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},Y.T=function(){return bt(this),this.g.concat()},Y.get=function(e,t){return Tt(this.h,e)?this.h[e]:t},Y.set=function(e,t){Tt(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},Y.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var s=n[r],i=this.get(s);e.call(t,i,s,this)}};var Et=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function It(e,t){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof It?(this.g=void 0!==t?t:e.g,St(this,e.j),this.s=e.s,Nt(this,e.i),At(this,e.m),this.l=e.l,t=e.h,(n=new Ut).i=t.i,t.g&&(n.g=new vt(t.g),n.h=t.h),Dt(this,n),this.o=e.o):e&&(n=String(e).match(Et))?(this.g=!!t,St(this,n[1]||"",!0),this.s=kt(n[2]||""),Nt(this,n[3]||"",!0),At(this,n[4]),this.l=kt(n[5]||"",!0),Dt(this,n[6]||"",!0),this.o=kt(n[7]||"")):(this.g=!!t,this.h=new Ut(null,this.g))}function _t(e){return new It(e)}function St(e,t,n){e.j=n?kt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Nt(e,t,n){e.i=n?kt(t,!0):t}function At(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Dt(e,t,n){var r,s;t instanceof Ut?(e.h=t,r=e.h,(s=e.g)&&!r.j&&(qt(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Bt(this,t),Kt(this,n,e))},r)),r.j=s):(n||(t=Rt(t,Pt)),e.h=new Ut(t,e.g))}function Ct(e,t,n){e.h.set(t,n)}function xt(e){return Ct(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function kt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Rt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Lt),n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function Lt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}It.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Rt(t,Ot,!0),":");var n=this.i;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(Rt(t,Ot,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(Rt(n,"/"==n.charAt(0)?Ft:Mt,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Rt(n,Vt)),e.join("")};var Ot=/[#\/\?@]/g,Mt=/[#\?:]/g,Ft=/[#\?]/g,Pt=/[#\?@]/g,Vt=/#/g;function Ut(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function qt(i){i.g||(i.g=new vt,i.h=0,i.i&&function(e){if(e){e=e.split("&");for(var t=0;t<e.length;t++){var n,r=e[t].indexOf("="),s=null;0<=r?(n=e[t].substring(0,r),s=e[t].substring(r+1)):n=e[t],r=n,s=s?decodeURIComponent(s.replace(/\+/g," ")):"",i.add(decodeURIComponent(r.replace(/\+/g," ")),s)}}}(i.i))}function Bt(e,t){qt(e),t=$t(e,t),Tt(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Tt((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&bt(e)))}function jt(e,t){return qt(e),t=$t(e,t),Tt(e.g.h,t)}function Kt(e,t,n){Bt(e,t),0<n.length&&(e.i=null,e.g.set($t(e,t),k(n)),e.h+=n.length)}function $t(e,t){return t=String(t),e.j?t.toLowerCase():t}(Y=Ut.prototype).add=function(e,t){qt(this),this.i=null,e=$t(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Y.forEach=function(n,r){qt(this),this.g.forEach(function(e,t){C(e,function(e){n.call(r,e,t,this)},this)},this)},Y.T=function(){qt(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var s=e[r],i=0;i<s.length;i++)n.push(t[r]);return n},Y.R=function(e){qt(this);var t=[];if("string"==typeof e)jt(this,e)&&(t=x(t,this.g.get($t(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=x(t,e[n])}return t},Y.set=function(e,t){return qt(this),this.i=null,jt(this,e=$t(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Y.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},Y.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++)for(var r=t[n],s=encodeURIComponent(String(r)),r=this.R(r),i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),e.push(o)}return this.i=e.join("&")};var Gt,zt=class{constructor(e,t){this.h=e,this.g=t}};function Ht(e){this.l=e||10,e=w.PerformanceNavigationTiming?0<(e=w.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(w.g&&w.g.Ea&&w.g.Ea()&&w.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Qt(e){return e.h||e.g&&e.g.size>=e.j}function Wt(e){return e.h?1:e.g?e.g.size:0}function Yt(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function Jt(e,t){e.g?e.g.add(t):e.h=t}function Xt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Zt(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return k(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function en(){}function tn(){this.g=new en}function nn(e,t,n,r,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(r)}catch(e){}}function rn(e){this.l=e.$b||null,this.j=e.ib||!1}function sn(e,t){ve.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=on,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ht.prototype.cancel=function(){if(this.i=Zt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},en.prototype.stringify=function(e){return w.JSON.stringify(e,void 0)},en.prototype.parse=function(e){return w.JSON.parse(e,void 0)},S(rn,Ye),rn.prototype.g=function(){return new sn(this.l,this.j)},rn.prototype.i=(Gt={},function(){return Gt}),S(sn,ve);var on=0;function an(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function hn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,un(e)}function un(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Y=sn.prototype).open=function(e,t){if(this.readyState!=on)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,un(this)},Y.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||w).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},Y.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,hn(this)),this.readyState=on},Y.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,un(this)),this.g&&(this.readyState=3,un(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==w.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;an(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},Y.Sa=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?hn:un)(this),3==this.readyState&&an(this))},Y.Ua=function(e){this.g&&(this.response=this.responseText=e,hn(this))},Y.Ta=function(e){this.g&&(this.response=e,hn(this))},Y.ha=function(){this.g&&hn(this)},Y.setRequestHeader=function(e,t){this.v.append(e,t)},Y.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Y.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(sn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var cn=w.JSON.parse;function ln(e){ve.call(this),this.headers=new vt,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=dn,this.K=this.L=!1}S(ln,ve);var dn="",fn=/^https?$/i,gn=["POST","PUT"];function mn(e){return"content-type"==e.toLowerCase()}function pn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,yn(e),vn(e)}function yn(e){e.D||(e.D=!0,be(e,"complete"),be(e,"error"))}function wn(e){if(e.h&&(!e.C[1]||4!=Tn(e)||2!=e.ba()))if(e.v&&4==Tn(e))Re(e.Fa,0,e);else if(be(e,"readystatechange"),4==Tn(e)){e.h=!1;try{var t,n,r,s,i=e.ba();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break e;default:o=!1}if((t=o)||((n=0===i)&&(!(s=String(e.H).match(Et)[1]||null)&&w.self&&w.self.location&&(s=(r=w.self.location.protocol).substr(0,r.length-1)),n=!fn.test(s?s.toLowerCase():"")),t=n),t)be(e,"complete"),be(e,"success");else{e.m=6;try{var a=2<Tn(e)?e.g.statusText:""}catch(e){a=""}e.j=a+" ["+e.ba()+"]",yn(e)}}finally{vn(e)}}}function vn(e,t){if(e.g){bn(e);const n=e.g,r=e.C[0]?m:null;e.g=null,e.C=null,t||be(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function bn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(w.clearTimeout(e.A),e.A=null)}function Tn(e){return e.g?e.g.readyState:0}function En(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case dn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function In(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=function(){let n="";return P(r,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}(),"string"==typeof e?null!=r&&encodeURIComponent(String(r)):Ct(e,t,r))}function _n(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Sn(e){this.za=0,this.l=[],this.h=new Ve,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=_n("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=_n("baseRetryDelayMs",5e3,e),this.$a=_n("retryDelaySeedMs",1e4,e),this.Ya=_n("forwardChannelMaxRetries",2,e),this.ra=_n("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new Ht(e&&e.concurrentRequestLimit),this.Ca=new tn,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function Nn(e){var t,n;Dn(e),3==e.G&&(t=e.V++,Ct(n=_t(e.F),"SID",e.J),Ct(n,"RID",t),Ct(n,"TYPE","terminate"),Rn(e,n),(t=new nt(e,e.h,t,void 0)).K=2,t.v=xt(_t(n)),n=!1,!(n=w.navigator&&w.navigator.sendBeacon?w.navigator.sendBeacon(t.v.toString(),""):n)&&w.Image&&((new Image).src=t.v,n=!0),n||(t.g=$n(t.l,null),t.g.ea(t.v)),t.F=Date.now(),dt(t)),jn(e)}function An(e){e.g&&(Fn(e),e.g.cancel(),e.g=null)}function Dn(e){An(e),e.u&&(w.clearTimeout(e.u),e.u=null),Vn(e),e.i.cancel(),e.m&&("number"==typeof e.m&&w.clearTimeout(e.m),e.m=null)}function Cn(e,t){e.l.push(new zt(e.Za++,t)),3==e.G&&xn(e)}function xn(e){Qt(e.i)||e.m||(e.m=!0,Ne(e.Ha,e),e.C=0)}function kn(e,t){var n=t?t.m:e.V++,r=_t(e.F);Ct(r,"SID",e.J),Ct(r,"RID",n),Ct(r,"AID",e.U),Rn(e,r),e.o&&e.s&&In(r,e.o,e.s),n=new nt(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=Ln(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),Jt(e.i,n),ht(n,r,t)}function Rn(e,n){e.j&&wt({},function(e,t){Ct(n,t,e)})}function Ln(r,e,s){s=Math.min(r.l.length,s);var i=r.j?I(r.j.Oa,r.j,r):null;e:{var o=r.l;let n=-1;for(;;){const u=["count="+s];-1==n?0<s?(n=o[0].h,u.push("ofs="+n)):n=0:u.push("ofs="+n);let t=!0;for(let e=0;e<s;e++){var a=o[e].h,h=o[e].g;if((a-=n)<0)n=Math.max(0,o[e].h-100),t=!1;else try{!function(e,r){const s="req"+a+"_"||"";try{wt(e,function(e,t){let n=e;y(e)&&(n=Ie(e)),r.push(s+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(s+"type="+encodeURIComponent("_badmap")),e}}(h,u)}catch(r){i&&i(h)}}if(t){i=u.join("&");break e}}}return r=r.l.splice(0,s),e.D=r,i}function On(e){e.g||e.u||(e.Y=1,Ne(e.Ga,e),e.A=0)}function Mn(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=Qe(I(e.Ga,e),qn(e,e.A)),e.A++,1)}function Fn(e){null!=e.B&&(w.clearTimeout(e.B),e.B=null)}function Pn(e){e.g=new nt(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=_t(e.oa);Ct(t,"RID","rpc"),Ct(t,"SID",e.J),Ct(t,"CI",e.N?"0":"1"),Ct(t,"AID",e.U),Rn(e,t),Ct(t,"TYPE","xmlhttp"),e.o&&e.s&&In(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=xt(_t(t)),n.s=null,n.U=!0,ut(n,e)}function Vn(e){null!=e.v&&(w.clearTimeout(e.v),e.v=null)}function Un(e,t){var n,r,s,i=null;if(e.g==t){Vn(e),Fn(e),e.g=null;var o=2}else{if(!Yt(e.i,t))return;i=t.D,Xt(e.i,t),o=1}if(e.I=t.N,0!=e.G)if(t.i)1==o?(i=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,be(o=je(),new He(o,i)),xn(e)):On(e);else if(3==(n=t.o)||0==n&&0<e.I||(1!=o||(s=t,Wt((r=e).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=s.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=Qe(I(r.Ha,r,s),qn(r,r.C)),r.C++,0))))&&(2!=o||!Mn(e)))switch(i&&0<i.length&&(t=e.i,t.i=t.i.concat(i)),n){case 1:Bn(e,5);break;case 4:Bn(e,10);break;case 3:Bn(e,6);break;default:Bn(e,2)}}function qn(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function Bn(e,t){var n,r;e.h.info("Error code "+t),2==t?(n=null,e.j&&(n=null),r=I(e.jb,e),n||(n=new It("//www.google.com/images/cleardot.gif"),w.location&&"http"==w.location.protocol||St(n,"https"),xt(n)),function(e,t){var n=new Ve;if(w.Image){const r=new Image;r.onload=_(nn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=_(nn,n,r,"TestLoadImage: error",!1,t),r.onabort=_(nn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=_(nn,n,r,"TestLoadImage: timeout",!1,t),w.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):ze(2),e.G=0,e.j&&e.j.va(t),jn(e),Dn(e)}function jn(e){e.G=0,e.I=-1,e.j&&(0==Zt(e.i).length&&0==e.l.length||(e.i.i.length=0,k(e.l),e.l.length=0),e.j.ua())}function Kn(e,t,n){let r=(a=n)instanceof It?_t(a):new It(a,void 0);var s,i,o,a,h;return""!=r.i?(t&&Nt(r,t+"."+r.i),At(r,r.m)):(h=w.location,r=(s=h.protocol,i=t?t+"."+h.hostname:h.hostname,o=+h.port,a=n,h=new It(null,void 0),s&&St(h,s),i&&Nt(h,i),o&&At(h,o),a&&(h.l=a),h)),e.aa&&P(e.aa,function(e,t){Ct(r,t,e)}),t=e.D,n=e.sa,t&&n&&Ct(r,t,n),Ct(r,"VER",e.ma),Rn(e,r),r}function $n(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new ln(new rn({ib:!0})):new ln(e.qa)).L=e.H,t}function Gn(){}function zn(){if($&&!(10<=Number(X)))throw Error("Environmental error: no available transport.")}function Hn(e,t){ve.call(this),this.g=new Sn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!R(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!R(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Yn(this)}function Qn(e){Ze.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Wn(){et.call(this),this.status=1}function Yn(e){this.g=e}(Y=ln.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||st).g(),this.C=this.u?Je(this.u):Je(st),this.g.onreadystatechange=I(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void pn(this,e)}e=n||"";const s=new vt(this.headers);r&&wt(r,function(e,t){s.set(t,e)}),r=function(t){e:{var n=mn,r=t.length,s="string"==typeof t?t.split(""):t;for(let e=0;e<r;e++)if(e in s&&n.call(void 0,s[e],e,t)){n=e;break e}n=-1}return n<0?null:"string"==typeof t?t.charAt(n):t[n]}(s.T()),n=w.FormData&&e instanceof w.FormData,0<=D(gn,t)&&!r&&!n&&s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{bn(this),0<this.B&&((this.K=(a=this.g,$&&(i=function(){let t=0;var n=L(String(j)).split("."),r=L("9").split("."),s=Math.max(n.length,r.length);for(let e=0;0==t&&e<s;e++)for(var i=n[e]||"",o=r[e]||"";i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],(0!=i[0].length||0!=o[0].length)&&(t=M(0==i[1].length?0:parseInt(i[1],10),0==o[1].length?0:parseInt(o[1],10))||M(0==i[2].length,0==o[2].length)||M(i[2],o[2]),i=i[3],o=o[3],0==t););return 0<=t},o=J,Object.prototype.hasOwnProperty.call(o,9)?o[9]:o[9]=i())&&"number"==typeof a.timeout&&void 0!==a.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=I(this.pa,this)):this.A=Re(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){pn(this,e)}var i,o,a},Y.pa=function(){this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,be(this,"timeout"),this.abort(8))},Y.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,be(this,"complete"),be(this,"abort"),vn(this))},Y.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),vn(this,!0)),ln.Z.M.call(this)},Y.Fa=function(){this.s||(this.F||this.v||this.l?wn(this):this.cb())},Y.cb=function(){wn(this)},Y.ba=function(){try{return 2<Tn(this)?this.g.status:-1}catch(e){return-1}},Y.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Y.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),cn(t)}},Y.Da=function(){return this.m},Y.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(Y=Sn.prototype).ma=8,Y.G=1,Y.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},Y.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const i=new nt(this,this.h,t,void 0);let e=this.s;if(this.P&&(e?(e=V(e),q(e,this.P)):e=this.P),null===this.o&&(i.H=e),this.ja)e:{for(var n=0,r=0;r<this.l.length;r++){var s=this.l[r];if(void 0===(s="__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s.length:void 0))break;if(4096<(n+=s)){n=r;break e}if(4096===n||r===this.l.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=Ln(this,i,n),Ct(r=_t(this.F),"RID",t),Ct(r,"CVER",22),this.D&&Ct(r,"X-HTTP-Session-Id",this.D),Rn(this,r),this.o&&e&&In(r,this.o,e),Jt(this.i,i),this.Ra&&Ct(r,"TYPE","init"),this.ja?(Ct(r,"$req",n),Ct(r,"SID","null"),i.$=!0,ht(i,r,null)):ht(i,r,n),this.G=2}}else 3==this.G&&(t?kn(this,t):0==this.l.length||Qt(this.i)||kn(this))},Y.Ga=function(){var e;this.u=null,Pn(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(e=2*this.O,this.h.info("BP detection timer enabled: "+e),this.B=Qe(I(this.bb,this),e))},Y.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ze(10),An(this),Pn(this))},Y.ab=function(){null!=this.v&&(this.v=null,An(this),Mn(this),ze(19))},Y.jb=function(e){e?(this.h.info("Successfully pinged google.com"),ze(2)):(this.h.info("Failed to ping google.com"),ze(1))},(Y=Gn.prototype).xa=function(){},Y.wa=function(){},Y.va=function(){},Y.ua=function(){},Y.Oa=function(){},zn.prototype.g=function(e,t){return new Hn(e,t)},S(Hn,ve),Hn.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Ne(I(e.hb,e,t))),ze(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=Kn(e,null,e.W),xn(e)},Hn.prototype.close=function(){Nn(this.g)},Hn.prototype.u=function(e){var t;"string"==typeof e?((t={}).__data__=e,Cn(this.g,t)):this.v?((t={}).__data__=Ie(e),Cn(this.g,t)):Cn(this.g,e)},Hn.prototype.M=function(){this.g.j=null,delete this.j,Nn(this.g),delete this.g,Hn.Z.M.call(this)},S(Qn,Ze),S(Wn,et),S(Yn,Gn),Yn.prototype.xa=function(){be(this.g,"a")},Yn.prototype.wa=function(e){be(this.g,new Qn(e))},Yn.prototype.va=function(e){be(this.g,new Wn)},Yn.prototype.ua=function(){be(this.g,"b")},zn.prototype.createWebChannel=zn.prototype.g,Hn.prototype.send=Hn.prototype.u,Hn.prototype.open=Hn.prototype.m,F.NO_ERROR=0,F.TIMEOUT=8,F.HTTP_ERROR=6,We.COMPLETE="complete",(Xe.EventType=g).OPEN="a",g.CLOSE="b",g.ERROR="c",g.MESSAGE="d",ve.prototype.listen=ve.prototype.N,ln.prototype.listenOnce=ln.prototype.O,ln.prototype.getLastError=ln.prototype.La,ln.prototype.getLastErrorCode=ln.prototype.Da,ln.prototype.getStatus=ln.prototype.ba,ln.prototype.getResponseJson=ln.prototype.Qa,ln.prototype.getResponseText=ln.prototype.ga,ln.prototype.send=ln.prototype.ea;var Jn,Xn=je,Zn=F,er=We,tr=qe,nr=rn,rr=Xe,sr=ln;class ir{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ir.UNAUTHENTICATED=new ir(null),ir.GOOGLE_CREDENTIALS=new ir("google-credentials-uid"),ir.FIRST_PARTY=new ir("first-party-uid"),ir.MOCK_USER=new ir("mock-user");let or="9.1.2";const ar=new class{constructor(e){this.name=e,this._logLevel=h,this._logHandler=c,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in l))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?a[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,l.DEBUG,...e),this._logHandler(this,l.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,l.VERBOSE,...e),this._logHandler(this,l.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,l.INFO,...e),this._logHandler(this,l.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,l.WARN,...e),this._logHandler(this,l.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,l.ERROR,...e),this._logHandler(this,l.ERROR,...e)}}("@firebase/firestore");function hr(){return ar.logLevel}function ur(e,...t){ar.logLevel<=l.DEBUG&&(t=t.map(dr),ar.debug(`Firestore (${or}): ${e}`,...t))}function cr(e,...t){ar.logLevel<=l.ERROR&&(t=t.map(dr),ar.error(`Firestore (${or}): ${e}`,...t))}function lr(e,...t){ar.logLevel<=l.WARN&&(t=t.map(dr),ar.warn(`Firestore (${or}): ${e}`,...t))}function dr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function fr(e="Unexpected state"){throw cr(e=`FIRESTORE (${or}) INTERNAL ASSERTION FAILED: `+e),new Error(e)}function gr(e){e||fr()}const mr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class pr extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class yr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class wr{constructor(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${e}`}}class vr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ir.UNAUTHENTICATED))}shutdown(){}}class br{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Tr{constructor(e){this.t=e,this.currentUser=ir.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const s=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let i=new yr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new yr,t.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const e=i;t.enqueueRetryable(async()=>{await e.promise,await s(this.currentUser)})},a=e=>{ur("FirebaseCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(e=>a(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?a(e):(ur("FirebaseCredentialsProvider","Auth not yet detected"),i.resolve(),i=new yr))},0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(ur("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(gr("string"==typeof e.accessToken),new wr(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return gr(null===e||"string"==typeof e),new ir(e)}}class Er{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=ir.FIRST_PARTY}get authHeaders(){const e={"X-Goog-AuthUser":this.l},t=this.h.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),this.m&&(e["X-Goog-Iam-Authorization-Token"]=this.m),e}}class Ir{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Er(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(ir.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class _r{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.g(e),this.p=e=>t.writeSequenceNumber(e))}g(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.p&&this.p(e),e}}_r.T=-1;class Sr{static I(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var s=function(){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(40);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let e=0;e<40;e++)t[e]=Math.floor(256*Math.random());return t}();for(let e=0;e<s.length;++e)r.length<20&&s[e]<n&&(r+=t.charAt(s[e]%t.length))}return r}}function Nr(e,t){return e<t?-1:t<e?1:0}function Ar(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function Dr(e){return e+"\0"}class Cr{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new pr(mr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new pr(mr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new pr(mr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new pr(mr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Cr.fromMillis(Date.now())}static fromDate(e){return Cr.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),e=Math.floor(1e6*(e-1e3*t));return new Cr(t,e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Nr(this.nanoseconds,e.nanoseconds):Nr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class xr{constructor(e){this.timestamp=e}static fromTimestamp(e){return new xr(e)}static min(){return new xr(new Cr(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function kr(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Rr(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Lr(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Or{constructor(e,t,n){void 0===t?t=0:t>e.length&&fr(),void 0===n?n=e.length-t:n>e.length-t&&fr(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Or.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Or?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(n){for(let e=this.offset,t=this.limit();e<t;e++)n(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){const r=Math.min(t.length,n.length);for(let e=0;e<r;e++){const r=t.get(e),s=n.get(e);if(r<s)return-1;if(r>s)return 1}return t.length<n.length?-1:t.length>n.length?1:0}}class Mr extends Or{construct(e,t,n){return new Mr(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new pr(mr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new Mr(t)}static emptyPath(){return new Mr([])}}const Fr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Pr extends Or{construct(e,t,n){return new Pr(e,t,n)}static isValidIdentifier(e){return Fr.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=Pr.isValidIdentifier(e)?e:"`"+e+"`")).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Pr(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var s=()=>{if(0===n.length)throw new pr(mr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new pr(mr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new pr(mr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?i=!i:"."!==t||i?n+=t:s(),r++}if(s(),i)throw new pr(mr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Pr(t)}static emptyPath(){return new Pr([])}}class Vr{constructor(e){(this.fields=e).sort(Pr.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ar(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Ur{constructor(e){this.binaryString=e}static fromBase64String(e){return e=atob(e),new Ur(e)}static fromUint8Array(e){return e=function(t){let n="";for(let e=0;e<t.length;++e)n+=String.fromCharCode(t[e]);return n}(e),new Ur(e)}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Nr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ur.EMPTY_BYTE_STRING=new Ur("");const qr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Br(t){if(gr(!!t),"string"!=typeof t)return{seconds:jr(t.seconds),nanos:jr(t.nanos)};{let e=0;var n=qr.exec(t);gr(!!n),n[1]&&(n=(n[1]+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function jr(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Kr(e){return"string"==typeof e?Ur.fromBase64String(e):Ur.fromUint8Array(e)}function $r(e){return"server_timestamp"===(null===(e=((null===(e=null==e?void 0:e.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===e?void 0:e.stringValue)}function Gr(e){return e=Br(e.mapValue.fields.__local_write_time__.timestampValue),new Cr(e.seconds,e.nanos)}function zr(e){return null==e}function Hr(e){return 0===e&&1/e==-1/0}function Qr(e){return"number"==typeof e&&Number.isInteger(e)&&!Hr(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class Wr{constructor(e){this.path=e}static fromPath(e){return new Wr(Mr.fromString(e))}static fromName(e){return new Wr(Mr.fromString(e).popFirst(5))}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===Mr.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Mr.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Wr(new Mr(e.slice()))}}function Yr(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?$r(e)?4:10:fr()}function Jr(n,r){var e,t,s=Yr(n);if(s!==Yr(r))return!1;switch(s){case 0:return!0;case 1:return n.booleanValue===r.booleanValue;case 4:return Gr(n).isEqual(Gr(r));case 3:return function(e){if("string"==typeof n.timestampValue&&"string"==typeof e.timestampValue&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;var t=Br(n.timestampValue),e=Br(e.timestampValue);return t.seconds===e.seconds&&t.nanos===e.nanos}(r);case 5:return n.stringValue===r.stringValue;case 6:return t=r,Kr(n.bytesValue).isEqual(Kr(t.bytesValue));case 7:return n.referenceValue===r.referenceValue;case 8:return e=r,jr((t=n).geoPointValue.latitude)===jr(e.geoPointValue.latitude)&&jr(t.geoPointValue.longitude)===jr(e.geoPointValue.longitude);case 2:return t=r,"integerValue"in(e=n)&&"integerValue"in t?jr(e.integerValue)===jr(t.integerValue):"doubleValue"in e&&"doubleValue"in t&&((e=jr(e.doubleValue))===(t=jr(t.doubleValue))?Hr(e)===Hr(t):isNaN(e)&&isNaN(t));case 9:return Ar(n.arrayValue.values||[],r.arrayValue.values||[],Jr);case 10:return function(e){const t=e.mapValue.fields||{},n=r.mapValue.fields||{};if(kr(t)!==kr(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!Jr(t[e],n[e])))return!1;return!0}(n);default:return fr()}}function Xr(e,t){return void 0!==(e.values||[]).find(e=>Jr(e,t))}function Zr(e,t){var n,r,s,i=Yr(e),o=Yr(t);if(i!==o)return Nr(i,o);switch(i){case 0:return 0;case 1:return Nr(e.booleanValue,t.booleanValue);case 2:return r=t,(s=jr(e.integerValue||e.doubleValue))<(r=jr(r.integerValue||r.doubleValue))?-1:r<s?1:s===r?0:isNaN(s)?isNaN(r)?0:-1:1;case 3:return es(e.timestampValue,t.timestampValue);case 4:return es(Gr(e),Gr(t));case 5:return Nr(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Kr(e),r=Kr(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=Nr(n[e],r[e]);if(0!==t)return t}return Nr(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,s=t.geoPointValue,0!==(r=Nr(jr(n.latitude),jr(s.latitude)))?r:Nr(jr(n.longitude),jr(s.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Zr(n[e],r[e]);if(t)return t}return Nr(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let e=0;e<r.length&&e<i.length;++e){const t=Nr(r[e],i[e]);if(0!==t)return t;var o=Zr(n[r[e]],s[i[e]]);if(0!==o)return o}return Nr(r.length,i.length)}(e.mapValue,t.mapValue);default:throw fr()}}function es(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Nr(e,t);var n=Br(e),e=Br(t);return 0!==(t=Nr(n.seconds,e.seconds))?t:Nr(n.nanos,e.nanos)}function ts(e){return function s(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?`time(${(e=Br(r.timestampValue)).seconds},${e.nanos})`:"stringValue"in r?r.stringValue:"bytesValue"in r?Kr(r.bytesValue).toBase64():"referenceValue"in r?(t=r.referenceValue,Wr.fromName(t).toString()):"geoPointValue"in r?`geo(${(t=r.geoPointValue).latitude},${t.longitude})`:"arrayValue"in r?function(){let e="[",t=!0;for(const n of r.arrayValue.values||[])t?t=!1:e+=",",e+=s(n);return e+"]"}():"mapValue"in r?function(e){let t="{",n=!0;for(const r of Object.keys(e.fields||{}).sort())n?n=!1:t+=",",t+=`${r}:${s(e.fields[r])}`;return t+"}"}(r.mapValue):fr();var e,t}(e)}function ns(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function rs(e){return e&&"integerValue"in e}function ss(e){return!!e&&"arrayValue"in e}function is(e){return e&&"nullValue"in e}function os(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function as(e){return e&&"mapValue"in e}function hs(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return Rr(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=hs(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=hs(t.arrayValue.values[e]);return r}return Object.assign({},t)}class us{constructor(e){this.value=e}static empty(){return new us({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let t=this.value;for(let e=0;e<n.length-1;++e)if(t=(t.mapValue.fields||{})[n.get(e)],!as(t))return null;return t=(t.mapValue.fields||{})[n.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=hs(t)}setAll(e){let n=Pr.emptyPath(),r={},s=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,s),r={},s=[],n=t.popLast()}e?r[t.lastSegment()]=hs(e):s.push(t.lastSegment())}),e=this.getFieldsMap(n),this.applyChanges(e,r,s)}delete(e){const t=this.field(e.popLast());as(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Jr(this.value,e.value)}getFieldsMap(n){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let t=0;t<n.length;++t){let e=r.mapValue.fields[n.get(t)];as(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},r.mapValue.fields[n.get(t)]=e),r=e}return r.mapValue.fields}applyChanges(n,e,t){Rr(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new us(hs(this.value))}}class cs{constructor(e,t,n,r,s){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=s}static newInvalidDocument(e){return new cs(e,0,xr.min(),us.empty(),0)}static newFoundDocument(e,t,n){return new cs(e,1,t,n,0)}static newNoDocument(e,t){return new cs(e,2,t,us.empty(),0)}static newUnknownDocument(e,t){return new cs(e,3,t,us.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=us.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=us.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof cs&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new cs(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ls{constructor(e,t=null,n=[],r=[],s=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.A=null}}function ds(e,t=null,n=[],r=[],s=null,i=null,o=null){return new ls(e,t,n,r,s,i,o)}function fs(e){const t=e;if(null===t.A){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function(e){return e.field.canonicalString()+e.op.toString()+ts(e.value)}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),zr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=Ns(t.startAt)),t.endAt&&(e+="|ub:",e+=Ns(t.endAt)),t.A=e}return t.A}function gs(t,n){if(t.limit!==n.limit)return!1;if(t.orderBy.length!==n.orderBy.length)return!1;for(let e=0;e<t.orderBy.length;e++)if(r=t.orderBy[e],s=n.orderBy[e],r.dir!==s.dir||!r.field.isEqual(s.field))return!1;var r,s,i,o;if(t.filters.length!==n.filters.length)return!1;for(let e=0;e<t.filters.length;e++)if(i=t.filters[e],o=n.filters[e],i.op!==o.op||!i.field.isEqual(o.field)||!Jr(i.value,o.value))return!1;return t.collectionGroup===n.collectionGroup&&!!t.path.isEqual(n.path)&&!!Cs(t.startAt,n.startAt)&&Cs(t.endAt,n.endAt)}function ms(e){return Wr.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class ps extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.R(e,t,n):new ys(e,t,n):"array-contains"===t?new Ts(e,n):"in"===t?new Es(e,n):"not-in"===t?new Is(e,n):"array-contains-any"===t?new _s(e,n):new ps(e,t,n)}static R(e,t,n){return new("in"===t?ws:vs)(e,n)}matches(e){return e=e.data.field(this.field),"!="===this.op?null!==e&&this.P(Zr(e,this.value)):null!==e&&Yr(this.value)===Yr(e)&&this.P(Zr(e,this.value))}P(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return fr()}}v(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}}class ys extends ps{constructor(e,t,n){super(e,t,n),this.key=Wr.fromName(n.referenceValue)}matches(e){return e=Wr.comparator(e.key,this.key),this.P(e)}}class ws extends ps{constructor(e,t){super(e,"in",t),this.keys=bs(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class vs extends ps{constructor(e,t){super(e,"not-in",t),this.keys=bs(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function bs(e,t){return((null===(t=t.arrayValue)||void 0===t?void 0:t.values)||[]).map(e=>Wr.fromName(e.referenceValue))}class Ts extends ps{constructor(e,t){super(e,"array-contains",t)}matches(e){return ss(e=e.data.field(this.field))&&Xr(e.arrayValue,this.value)}}class Es extends ps{constructor(e,t){super(e,"in",t)}matches(e){return null!==(e=e.data.field(this.field))&&Xr(this.value.arrayValue,e)}}class Is extends ps{constructor(e,t){super(e,"not-in",t)}matches(e){return!Xr(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&(null!==(e=e.data.field(this.field))&&!Xr(this.value.arrayValue,e))}}class _s extends ps{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ss(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Xr(this.value.arrayValue,e))}}class Ss{constructor(e,t){this.position=e,this.before=t}}function Ns(e){return`${e.before?"b":"a"}:${e.position.map(e=>ts(e)).join(",")}`}class As{constructor(e,t="asc"){this.field=e,this.dir=t}}function Ds(t,n,r){let s=0;for(let e=0;e<t.position.length;e++){const i=n[e],o=t.position[e];if(s=i.field.isKeyField()?Wr.comparator(Wr.fromName(o.referenceValue),r.key):Zr(o,r.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return t.before?s<=0:s<0}function Cs(t,n){if(null===t)return null===n;if(null===n)return!1;if(t.before!==n.before||t.position.length!==n.position.length)return!1;for(let e=0;e<t.position.length;e++)if(!Jr(t.position[e],n.position[e]))return!1;return!0}class xs{constructor(e,t=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.V=null,this.S=null,this.startAt,this.endAt}}function ks(e,t,n,r,s,i,o,a){return new xs(e,t,n,r,s,i,o,a)}function Rs(e){return new xs(e)}function Ls(e){return!zr(e.limit)&&"F"===e.limitType}function Os(e){return!zr(e.limit)&&"L"===e.limitType}function Ms(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function Fs(e){for(const t of e.filters)if(t.v())return t.field;return null}function Ps(e){return null!==e.collectionGroup}function Vs(t){const n=t;if(null===n.V){n.V=[];const t=Fs(n),e=Ms(n);if(null!==t&&null===e)t.isKeyField()||n.V.push(new As(t)),n.V.push(new As(Pr.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.V.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.V.push(new As(Pr.keyField(),t))}}}return n.V}function Us(e){const t=e;if(!t.S)if("F"===t.limitType)t.S=ds(t.path,t.collectionGroup,Vs(t),t.filters,t.limit,t.startAt,t.endAt);else{const r=[];for(const s of Vs(t)){const t="desc"===s.dir?"asc":"desc";r.push(new As(s.field,t))}var n=t.endAt?new Ss(t.endAt.position,!t.endAt.before):null,e=t.startAt?new Ss(t.startAt.position,!t.startAt.before):null;t.S=ds(t.path,t.collectionGroup,r,t.filters,t.limit,n,e)}return t.S}function qs(e,t,n){return new xs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Bs(e,t){return gs(Us(e),Us(t))&&e.limitType===t.limitType}function js(e){return`${fs(Us(e))}|lt:${e.limitType}`}function Ks(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>`${e.field.canonicalString()} ${e.op} ${ts(e.value)}`).join(", ")}]`),zr(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+Ns(e.startAt)),e.endAt&&(t+=", endAt: "+Ns(e.endAt)),`Target(${t})`}(Us(e))}; limitType=${e.limitType})`}function $s(n,e){return e.isFoundDocument()&&(s=(r=e).key.path,null!==(t=n).collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):Wr.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s))&&function(e){for(const t of n.explicitOrderBy)if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(s=e,(!(e=n).startAt||Ds(e.startAt,Vs(e),s))&&(!e.endAt||!Ds(e.endAt,Vs(e),s)));var t,r,s}function Gs(s){return(e,t)=>{let n=!1;for(const r of Vs(s)){const s=function(e,t,n){var r,s=e.field.isKeyField()?Wr.comparator(t.key,n.key):(r=e.field,n=n,t=t.data.field(r),r=n.data.field(r),null!==t&&null!==r?Zr(t,r):fr());switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return fr()}}(r,e,t);if(0!==s)return s;n=n||r.field.isKeyField()}return 0}}function zs(e,t){if(e.D){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Hr(t)?"-0":t}}function Hs(e){return{integerValue:""+e}}function Qs(e,t){return Qr(t)?Hs(t):zs(e,t)}class Ws{constructor(){this._=void 0}}function Ys(e,t){return e instanceof ni?rs(e=t)||e&&"doubleValue"in e?t:{integerValue:0}:null}class Js extends Ws{}class Xs extends Ws{constructor(e){super(),this.elements=e}}function Zs(e,t){const n=si(t);for(const t of e.elements)n.some(e=>Jr(e,t))||n.push(t);return{arrayValue:{values:n}}}class ei extends Ws{constructor(e){super(),this.elements=e}}function ti(e,t){let n=si(t);for(const t of e.elements)n=n.filter(e=>!Jr(e,t));return{arrayValue:{values:n}}}class ni extends Ws{constructor(e,t){super(),this.N=e,this.C=t}}function ri(e){return jr(e.integerValue||e.doubleValue)}function si(e){return ss(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ii{constructor(e,t){this.field=e,this.transform=t}}class oi{constructor(e,t){this.version=e,this.transformResults=t}}class ai{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ai}static exists(e){return new ai(void 0,e)}static updateTime(e){return new ai(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function hi(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ui{}function ci(e,t,n){e instanceof gi?function(e,t,n){const r=e.value.clone(),s=yi(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof mi?function(e,t,n){if(!hi(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=yi(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(pi(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function li(e,t,n){e instanceof gi?function(e,t,n){if(hi(e.precondition,t)){const r=e.value.clone(),s=wi(e.fieldTransforms,n,t);r.setAll(s),t.convertToFoundDocument(fi(t),r).setHasLocalMutations()}}(e,t,n):e instanceof mi?function(e,t,n){if(hi(e.precondition,t)){const r=wi(e.fieldTransforms,n,t),s=t.data;s.setAll(pi(e)),s.setAll(r),t.convertToFoundDocument(fi(t),s).setHasLocalMutations()}}(e,t,n):hi(e.precondition,t)&&t.convertToNoDocument(xr.min())}function di(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Ar(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof Xs&&t instanceof Xs||e instanceof ei&&t instanceof ei?Ar(e.elements,t.elements,Jr):e instanceof ni&&t instanceof ni?Jr(e.C,t.C):e instanceof Js&&t instanceof Js)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}function fi(e){return e.isFoundDocument()?e.version:xr.min()}class gi extends ui{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class mi extends ui{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}}function pi(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function yi(t,n,r){const s=new Map;gr(t.length===r.length);for(let e=0;e<r.length;e++){var i=t[e],o=i.transform,a=n.data.field(i.field);s.set(i.field,(i=o,o=a,a=r[e],i instanceof Xs?Zs(i,o):i instanceof ei?ti(i,o):a))}return s}function wi(e,t,n){const r=new Map;for(const u of e){const e=u.transform,c=n.data.field(u.field);r.set(u.field,(s=e,i=c,o=t,0,s instanceof Js?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return i&&(e.fields.__previous_value__=i),{mapValue:e}}():s instanceof Xs?Zs(s,i):s instanceof ei?ti(s,i):(s=ri(h=Ys(a=s,i))+ri(a.C),rs(h)&&rs(a.C)?Hs(s):zs(a.N,s))))}var s,i,o,a,h;return r}class vi extends ui{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class bi extends ui{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class Ti{constructor(e){this.count=e}}function Ei(e){switch(e){default:return fr(),0;case mr.CANCELLED:case mr.UNKNOWN:case mr.DEADLINE_EXCEEDED:case mr.RESOURCE_EXHAUSTED:case mr.INTERNAL:case mr.UNAVAILABLE:case mr.UNAUTHENTICATED:return;case mr.INVALID_ARGUMENT:case mr.NOT_FOUND:case mr.ALREADY_EXISTS:case mr.PERMISSION_DENIED:case mr.FAILED_PRECONDITION:case mr.ABORTED:case mr.OUT_OF_RANGE:case mr.UNIMPLEMENTED:case mr.DATA_LOSS:return 1}}function Ii(e){if(void 0===e)return cr("GRPC error has no .code"),mr.UNKNOWN;switch(e){case Jn.OK:return mr.OK;case Jn.CANCELLED:return mr.CANCELLED;case Jn.UNKNOWN:return mr.UNKNOWN;case Jn.DEADLINE_EXCEEDED:return mr.DEADLINE_EXCEEDED;case Jn.RESOURCE_EXHAUSTED:return mr.RESOURCE_EXHAUSTED;case Jn.INTERNAL:return mr.INTERNAL;case Jn.UNAVAILABLE:return mr.UNAVAILABLE;case Jn.UNAUTHENTICATED:return mr.UNAUTHENTICATED;case Jn.INVALID_ARGUMENT:return mr.INVALID_ARGUMENT;case Jn.NOT_FOUND:return mr.NOT_FOUND;case Jn.ALREADY_EXISTS:return mr.ALREADY_EXISTS;case Jn.PERMISSION_DENIED:return mr.PERMISSION_DENIED;case Jn.FAILED_PRECONDITION:return mr.FAILED_PRECONDITION;case Jn.ABORTED:return mr.ABORTED;case Jn.OUT_OF_RANGE:return mr.OUT_OF_RANGE;case Jn.UNIMPLEMENTED:return mr.UNIMPLEMENTED;case Jn.DATA_LOSS:return mr.DATA_LOSS;default:return fr()}}(We=Jn={})[We.OK=0]="OK",We[We.CANCELLED=1]="CANCELLED",We[We.UNKNOWN=2]="UNKNOWN",We[We.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",We[We.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",We[We.NOT_FOUND=5]="NOT_FOUND",We[We.ALREADY_EXISTS=6]="ALREADY_EXISTS",We[We.PERMISSION_DENIED=7]="PERMISSION_DENIED",We[We.UNAUTHENTICATED=16]="UNAUTHENTICATED",We[We.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",We[We.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",We[We.ABORTED=10]="ABORTED",We[We.OUT_OF_RANGE=11]="OUT_OF_RANGE",We[We.UNIMPLEMENTED=12]="UNIMPLEMENTED",We[We.INTERNAL=13]="INTERNAL",We[We.UNAVAILABLE=14]="UNAVAILABLE",We[We.DATA_LOSS=15]="DATA_LOSS";class _i{constructor(e,t){this.comparator=e,this.root=t||Ni.EMPTY}insert(e,t){return new _i(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ni.BLACK,null,null))}remove(e){return new _i(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ni.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Si(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Si(this.root,e,this.comparator,!1)}getReverseIterator(){return new Si(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Si(this.root,e,this.comparator,!0)}}class Si{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ni{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:Ni.RED,this.left=null!=r?r:Ni.EMPTY,this.right=null!=s?s:Ni.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new Ni(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ni.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Ni.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,Ni.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,Ni.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw fr();if(this.right.isRed())throw fr();var e=this.left.check();if(e!==this.right.check())throw fr();return e+(this.isRed()?0:1)}}Ni.EMPTY=null,Ni.RED=!0,Ni.BLACK=!1,Ni.EMPTY=new class{constructor(){this.size=0}get key(){throw fr()}get value(){throw fr()}get color(){throw fr()}get left(){throw fr()}get right(){throw fr()}copy(e,t,n,r,s){return this}insert(e,t,n){return new Ni(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ai{constructor(e){this.comparator=e,this.data=new _i(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Di(this.data.getIterator())}getIteratorFrom(e){return new Di(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Ai))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new Ai(this.comparator);return t.data=e,t}}class Di{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const Ci=new _i(Wr.comparator),xi=new _i(Wr.comparator),ki=new _i(Wr.comparator),Ri=new Ai(Wr.comparator);function Li(...e){let t=Ri;for(const n of e)t=t.add(n);return t}const Oi=new Ai(Nr);class Mi{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,Fi.createSynthesizedTargetChangeForCurrentChange(e,t)),new Mi(xr.min(),n,Oi,Ci,Li())}}class Fi{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t){return new Fi(Ur.EMPTY_BYTE_STRING,t,Li(),Li(),Li())}}class Pi{constructor(e,t,n,r){this.k=e,this.removedTargetIds=t,this.key=n,this.$=r}}class Vi{constructor(e,t){this.targetId=e,this.O=t}}class Ui{constructor(e,t,n=Ur.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class qi{constructor(){this.F=0,this.M=Ki(),this.L=Ur.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return 0!==this.F}get K(){return this.U}j(e){0<e.approximateByteSize()&&(this.U=!0,this.L=e)}W(){let n=Li(),r=Li(),s=Li();return this.M.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:s=s.add(e);break;default:fr()}}),new Fi(this.L,this.B,n,r,s)}G(){this.U=!1,this.M=Ki()}H(e,t){this.U=!0,this.M=this.M.insert(e,t)}J(e){this.U=!0,this.M=this.M.remove(e)}Y(){this.F+=1}X(){--this.F}Z(){this.U=!0,this.B=!0}}class Bi{constructor(e){this.tt=e,this.et=new Map,this.nt=Ci,this.st=ji(),this.it=new Ai(Nr)}rt(e){for(const t of e.k)e.$&&e.$.isFoundDocument()?this.ot(t,e.$):this.at(t,e.key,e.$);for(const n of e.removedTargetIds)this.at(n,e.key,e.$)}ct(n){this.forEachTarget(n,e=>{const t=this.ut(e);switch(n.state){case 0:this.ht(e)&&t.j(n.resumeToken);break;case 1:t.X(),t.q||t.G(),t.j(n.resumeToken);break;case 2:t.X(),t.q||this.removeTarget(e);break;case 3:this.ht(e)&&(t.Z(),t.j(n.resumeToken));break;case 4:this.ht(e)&&(this.lt(e),t.j(n.resumeToken));break;default:fr()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.et.forEach((e,t)=>{this.ht(t)&&n(t)})}ft(e){const t=e.targetId,n=e.O.count,r=this.dt(t);if(r){const e=r.target;if(ms(e))if(0===n){const n=new Wr(e.path);this.at(t,n,cs.newNoDocument(n,xr.min()))}else gr(1===n);else this.wt(t)!==n&&(this.lt(t),this.it=this.it.add(t))}}_t(r){const s=new Map;this.et.forEach((e,t)=>{var n=this.dt(t);if(n){if(e.current&&ms(n.target)){const s=new Wr(n.target.path);null!==this.nt.get(s)||this.gt(t,s)||this.at(t,s,cs.newNoDocument(s,r))}e.K&&(s.set(t,e.W()),e.G())}});let i=Li();this.st.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>!(e=this.dt(e))||2===e.purpose||(n=!1)),n&&(i=i.add(e))});var e=new Mi(r,s,this.it,this.nt,i);return this.nt=Ci,this.st=ji(),this.it=new Ai(Nr),e}ot(e,t){var n;this.ht(e)&&(n=this.gt(e,t.key)?2:0,this.ut(e).H(t.key,n),this.nt=this.nt.insert(t.key,t),this.st=this.st.insert(t.key,this.yt(t.key).add(e)))}at(e,t,n){if(this.ht(e)){const r=this.ut(e);this.gt(e,t)?r.H(t,1):r.J(t),this.st=this.st.insert(t,this.yt(t).delete(e)),n&&(this.nt=this.nt.insert(t,n))}}removeTarget(e){this.et.delete(e)}wt(e){var t=this.ut(e).W();return this.tt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Y(e){this.ut(e).Y()}ut(e){let t=this.et.get(e);return t||(t=new qi,this.et.set(e,t)),t}yt(e){let t=this.st.get(e);return t||(t=new Ai(Nr),this.st=this.st.insert(e,t)),t}ht(e){var t=null!==this.dt(e);return t||ur("WatchChangeAggregator","Detected inactive target",e),t}dt(e){var t=this.et.get(e);return t&&t.q?null:this.tt.Tt(e)}lt(t){this.et.set(t,new qi),this.tt.getRemoteKeysForTarget(t).forEach(e=>{this.at(t,e,null)})}gt(e,t){return this.tt.getRemoteKeysForTarget(e).has(t)}}function ji(){return new _i(Wr.comparator)}function Ki(){return new _i(Wr.comparator)}const $i={asc:"ASCENDING",desc:"DESCENDING"},Gi={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class zi{constructor(e,t){this.databaseId=e,this.D=t}}function Hi(e,t){return e.D?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Qi(e,t){return e.D?t.toBase64():t.toUint8Array()}function Wi(e){return gr(!!e),xr.fromTimestamp((e=Br(e),new Cr(e.seconds,e.nanos)))}function Yi(e,t){return new Mr(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function Ji(e){return gr(po(e=Mr.fromString(e))),e}function Xi(e,t){return Yi(e.databaseId,t.path)}function Zi(e,t){const n=Ji(t);if(n.get(1)!==e.databaseId.projectId)throw new pr(mr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new pr(mr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Wr(ro(n))}function eo(e,t){return Yi(e.databaseId,t)}function to(e){return 4===(e=Ji(e)).length?Mr.emptyPath():ro(e)}function no(e){return new Mr(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ro(e){return gr(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function so(e,t,n){return{name:Xi(e,t),fields:n.value.mapValue.fields}}function io(e,t,n){const r=Zi(e,t.name),s=Wi(t.updateTime),i=new us({mapValue:{fields:t.fields}}),o=cs.newFoundDocument(r,s,i);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function oo(e,t){let n;if(t instanceof gi)n={update:so(e,t.key,t.value)};else if(t instanceof vi)n={delete:Xi(e,t.key)};else if(t instanceof mi)n={update:so(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof bi))return fr();n={verify:Xi(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof Js)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Xs)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof ei)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof ni)return{fieldPath:e.field.canonicalString(),increment:t.C};throw fr()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:Hi(e,(t=r.updateTime).toTimestamp())}:void 0!==r.exists?{exists:r.exists}:fr()),n;var r}function ao(t,n){const e=n.currentDocument?void 0!==(i=n.currentDocument).updateTime?ai.updateTime(Wi(i.updateTime)):void 0!==i.exists?ai.exists(i.exists):ai.none():ai.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)gr("REQUEST_TIME"===t.setToServerValue),n=new Js;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Xs(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new ei(e)}else"increment"in t?n=new ni(e,t.increment):fr();return t=Pr.fromServerFormat(t.fieldPath),new ii(t,n)}(t,e)):[];if(n.update){n.update.name;var s=Zi(t,n.update.name),i=new us({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new Vr(e.map(e=>Pr.fromServerFormat(e)))}();return new mi(s,i,t,e,r)}return new gi(s,i,e,r)}if(n.delete){const r=Zi(t,n.delete);return new vi(r,e)}if(n.verify){const r=Zi(t,n.verify);return new bi(r,e)}return fr()}function ho(e,t){return{documents:[eo(e,t.path)]}}function uo(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=eo(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=eo(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var s=function(e){if(0!==e.length)return 1===(e=e.map(e=>function(e){if("=="===e.op){if(os(e.value))return{unaryFilter:{field:go(e.field),op:"IS_NAN"}};if(is(e.value))return{unaryFilter:{field:go(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(os(e.value))return{unaryFilter:{field:go(e.field),op:"IS_NOT_NAN"}};if(is(e.value))return{unaryFilter:{field:go(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:go(e.field),op:(t=e.op,Gi[t]),value:e.value}};var t}(e))).length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(t.filters);return s&&(n.structuredQuery.where=s),(s=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:go(e.field),direction:(e=e.dir,$i[e])}}(e))}(t.orderBy))&&(n.structuredQuery.orderBy=s),s=t.limit,null!==(s=e.D||zr(s)?s:{value:s})&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt=lo(t.startAt)),t.endAt&&(n.structuredQuery.endAt=lo(t.endAt)),n}function co(e){let t=to(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;if(0<r){gr(1===r);const c=n.from[0];c.allDescendants?s=c.collectionId:t=t.child(c.collectionId)}let i=[];n.where&&(i=function t(e){return e?void 0!==e.unaryFilter?[function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=mo(e.unaryFilter.field);return ps.create(t,"==",{doubleValue:NaN});case"IS_NULL":return t=mo(e.unaryFilter.field),ps.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=mo(e.unaryFilter.field);return ps.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return n=mo(e.unaryFilter.field),ps.create(n,"!=",{nullValue:"NULL_VALUE"});default:return fr()}}(e)]:void 0!==e.fieldFilter?[(n=e,ps.create(mo(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return fr()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((e,t)=>e.concat(t)):fr():[];var n}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>function(e){return new As(mo(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let a=null;n.limit&&(a=zr(e="object"==typeof(e=n.limit)?e.value:e)?null:e);let h=null;n.startAt&&(h=fo(n.startAt));let u=null;return n.endAt&&(u=fo(n.endAt)),ks(t,s,o,i,a,"F",h,u)}function lo(e){return{before:e.before,values:e.position}}function fo(e){var t=!!e.before,e=e.values||[];return new Ss(e,t)}function go(e){return{fieldPath:e.canonicalString()}}function mo(e){return Pr.fromServerFormat(e.fieldPath)}function po(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function yo(t){let s="";for(let e=0;e<t.length;e++)0<s.length&&(s=wo(s)),s=function(t){let n=s;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(t.get(e));return wo(s)}function wo(e){return e+""}function vo(n){const r=n.length;if(gr(2<=r),2===r)return gr(""===n.charAt(0)&&""===n.charAt(1)),Mr.emptyPath();r;const s=[];let i="";for(let t=0;t<r;){const r=n.indexOf("",t);switch((r<0||r>o)&&fr(),n.charAt(r+1)){case"":const o=n.substring(t,r);let e;0===i.length?e=o:(i+=o,e=i,i=""),s.push(e);break;case"":i+=n.substring(t,r),i+="\0";break;case"":i+=n.substring(t,r+1);break;default:fr()}t=r+2}return new Mr(s)}class bo{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class To{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}To.store="owner",To.key="owner";class Eo{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}Eo.store="mutationQueues",Eo.keyPath="userId";class Io{constructor(e,t,n,r,s){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=s}}Io.store="mutations",Io.keyPath="batchId",Io.userMutationsIndex="userMutationsIndex",Io.userMutationsKeyPath=["userId","batchId"];class _o{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,yo(t)]}static key(e,t,n){return[e,yo(t),n]}}_o.store="documentMutations",_o.PLACEHOLDER=new _o;class So{constructor(e,t){this.path=e,this.readTime=t}}class No{constructor(e,t){this.path=e,this.version=t}}class Ao{constructor(e,t,n,r,s,i){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=s,this.parentPath=i}}Ao.store="remoteDocuments",Ao.readTimeIndex="readTimeIndex",Ao.readTimeIndexPath="readTime",Ao.collectionReadTimeIndex="collectionReadTimeIndex",Ao.collectionReadTimeIndexPath=["parentPath","readTime"];class Do{constructor(e){this.byteSize=e}}Do.store="remoteDocumentGlobal",Do.key="remoteDocumentGlobalKey";class Co{constructor(e,t,n,r,s,i,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=i,this.query=o}}Co.store="targets",Co.keyPath="targetId",Co.queryTargetsIndexName="queryTargetsIndex",Co.queryTargetsKeyPath=["canonicalId","targetId"];class xo{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}xo.store="targetDocuments",xo.keyPath=["targetId","path"],xo.documentTargetsIndex="documentTargetsIndex",xo.documentTargetsKeyPath=["path","targetId"];class ko{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}ko.key="targetGlobalKey",ko.store="targetGlobal";class Ro{constructor(e,t){this.collectionId=e,this.parent=t}}Ro.store="collectionParents",Ro.keyPath=["collectionId","parent"];class Lo{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}Lo.store="clientMetadata",Lo.keyPath="clientId";class Oo{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}Oo.store="bundles",Oo.keyPath="bundleId";class Mo{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}Mo.store="namedQueries",Mo.keyPath="name";const Fo=[Eo.store,Io.store,_o.store,Ao.store,Co.store,To.store,ko.store,xo.store,Lo.store,Do.store,Ro.store,Oo.store,Mo.store],Po="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Vo{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class Uo{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,s){return this.callbackAttached&&fr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(r,this.result):new Uo((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(s,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof Uo?t:Uo.resolve(t)}catch(e){return Uo.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Uo.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Uo.reject(t)}static resolve(n){return new Uo((e,t)=>{e(n)})}static reject(n){return new Uo((e,t)=>{t(n)})}static waitFor(e){return new Uo((t,n)=>{let r=0,s=0,i=!1;e.forEach(e=>{++r,e.next(()=>{++s,i&&s===r&&t()},e=>n(e))}),i=!0,s===r&&t()})}static or(e){let t=Uo.resolve(!1);for(const n of e)t=t.next(e=>e?Uo.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}}class qo{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.Et=new yr,this.transaction.oncomplete=()=>{this.Et.resolve()},this.transaction.onabort=()=>{e.error?this.Et.reject(new Ko(t,e.error)):this.Et.resolve()},this.transaction.onerror=e=>{e=Qo(e.target.error),this.Et.reject(new Ko(t,e))}}static open(e,t,n,r){try{return new qo(t,e.transaction(r,n))}catch(e){throw new Ko(t,e)}}get It(){return this.Et.promise}abort(e){e&&this.Et.reject(e),this.aborted||(ur("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){return e=this.transaction.objectStore(e),new Go(e)}}class Bo{constructor(e,t,n){this.name=e,this.version=t,this.At=n,12.2===Bo.Rt(d())&&cr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ur("SimpleDb","Removing database:",e),zo(window.indexedDB.deleteDatabase(e)).toPromise()}static bt(){if("object"!=typeof indexedDB)return!1;if(Bo.Pt())return!0;const e=d(),t=Bo.Rt(e),n=0<t&&t<10,r=Bo.vt(e),s=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||s)}static Pt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Vt)}static St(e,t){return e.store(t)}static Rt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static vt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Dt(s){return this.db||(ur("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{e=e.target.result,t(e)},r.onblocked=()=>{n(new Ko(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{"VersionError"===(e=e.target.error).name?n(new pr(mr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===e.name?n(new pr(mr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+e)):n(new Ko(s,e))},r.onupgradeneeded=e=>{ur("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.At.Ct(t,r.transaction,e.oldVersion,this.version).next(()=>{ur("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.Nt&&(this.db.onversionchange=e=>this.Nt(e)),this.db}xt(t){this.Nt=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var s="readonly"===t;let i=0;for(;;){++i;try{this.db=await this.Dt(e);const t=qo.open(this.db,e,s?"readonly":"readwrite",n),i=r(t).catch(e=>(t.abort(e),Uo.reject(e))).toPromise();return i.catch(()=>{}),await t.It,i}catch(e){const t="FirebaseError"!==e.name&&i<3;if(ur("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class jo{constructor(e){this.kt=e,this.$t=!1,this.Ot=null}get isDone(){return this.$t}get Ft(){return this.Ot}set cursor(e){this.kt=e}done(){this.$t=!0}Mt(e){this.Ot=e}delete(){return zo(this.kt.delete())}}class Ko extends pr{constructor(e,t){super(mr.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function $o(e){return"IndexedDbTransactionError"===e.name}class Go{constructor(e){this.store=e}put(e,t){return zo(void 0!==t?(ur("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(ur("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)))}add(e){return ur("SimpleDb","ADD",this.store.name,e,e),zo(this.store.add(e))}get(t){return zo(this.store.get(t)).next(e=>(ur("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return ur("SimpleDb","DELETE",this.store.name,e),zo(this.store.delete(e))}count(){return ur("SimpleDb","COUNT",this.store.name),zo(this.store.count())}Lt(e,t){const n=this.cursor(this.options(e,t)),r=[];return this.Bt(n,(e,t)=>{r.push(t)}).next(()=>r)}Ut(e,t){ur("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);return n.qt=!1,t=this.cursor(n),this.Bt(t,(e,t,n)=>n.delete())}Kt(e,t){let n;return t?n=e:(n={},t=e),e=this.cursor(n),this.Bt(e,t)}jt(r){const e=this.cursor({});return new Uo((n,t)=>{e.onerror=e=>{e=Qo(e.target.error),t(e)},e.onsuccess=e=>{const t=e.target.result;t?r(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}Bt(e,i){const o=[];return new Uo((s,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new jo(t),r=i(t.primaryKey,t.value,n);if(r instanceof Uo){const e=r.catch(e=>(n.done(),Uo.reject(e)));o.push(e)}n.isDone?s():null===n.Ft?t.continue():t.continue(n.Ft)}else s()}}).next(()=>Uo.waitFor(o))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.qt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function zo(e){return new Uo((t,n)=>{e.onsuccess=e=>{e=e.target.result,t(e)},e.onerror=e=>{e=Qo(e.target.error),n(e)}})}let Ho=!1;function Qo(e){const t=Bo.Rt(d());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new pr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ho||(Ho=!0,setTimeout(()=>{throw e},0)),e}}return e}class Wo extends Vo{constructor(e,t){super(),this.Qt=e,this.currentSequenceNumber=t}}function Yo(e,t){return Bo.St(e.Qt,t)}class Jo{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){var n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&ci(r,t,n[e])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&li(t,e,this.localWriteTime);for(const n of this.mutations)n.key.isEqual(e.key)&&li(n,e,this.localWriteTime)}applyToLocalDocumentSet(r){this.mutations.forEach(e=>{const t=r.get(e.key),n=t;this.applyToLocalView(n),t.isValidDocument()||n.convertToNoDocument(xr.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Li())}isEqual(e){return this.batchId===e.batchId&&Ar(this.mutations,e.mutations,(e,t)=>di(e,t))&&Ar(this.baseMutations,e.baseMutations,(e,t)=>di(e,t))}}class Xo{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){gr(e.mutations.length===n.length);let r=ki;var s=e.mutations;for(let e=0;e<s.length;e++)r=r.insert(s[e].key,n[e].version);return new Xo(e,t,n,r)}}class Zo{constructor(e,t,n,r,s=xr.min(),i=xr.min(),o=Ur.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}withSequenceNumber(e){return new Zo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Zo(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Zo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class ea{constructor(e){this.Wt=e}}function ta(e,t){if(t.document)return io(e.Wt,t.document,!!t.hasCommittedMutations);if(t.noDocument){const e=Wr.fromSegments(t.noDocument.path),n=oa(t.noDocument.readTime),r=cs.newNoDocument(e,n);return t.hasCommittedMutations?r.setHasCommittedMutations():r}if(t.unknownDocument){const e=Wr.fromSegments(t.unknownDocument.path),s=oa(t.unknownDocument.version);return cs.newUnknownDocument(e,s)}return fr()}function na(e,t,n){var r=ra(n),s=t.key.path.popLast().toArray();if(t.isFoundDocument()){var i={name:Xi(n=e.Wt,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:Hi(n,e.version.toTimestamp())},o=t.hasCommittedMutations;return new Ao(null,null,i,o,r,s)}if(t.isNoDocument()){var i=t.key.path.toArray(),o=ia(t.version),a=t.hasCommittedMutations;return new Ao(null,new So(i,o),null,a,r,s)}if(t.isUnknownDocument()){a=t.key.path.toArray(),t=ia(t.version);return new Ao(new No(a,t),null,null,!0,r,s)}return fr()}function ra(e){return[(e=e.toTimestamp()).seconds,e.nanoseconds]}function sa(e){return e=new Cr(e[0],e[1]),xr.fromTimestamp(e)}function ia(e){return e=e.toTimestamp(),new bo(e.seconds,e.nanoseconds)}function oa(e){return e=new Cr(e.seconds,e.nanoseconds),xr.fromTimestamp(e)}function aa(t,n){const r=(n.baseMutations||[]).map(e=>ao(t.Wt,e));for(let e=0;e<n.mutations.length-1;++e){const r=n.mutations[e];if(e+1<n.mutations.length&&void 0!==n.mutations[e+1].transform){const s=n.mutations[e+1];r.updateTransforms=s.transform.fieldTransforms,n.mutations.splice(e+1,1),++e}}const s=n.mutations.map(e=>ao(t.Wt,e)),e=Cr.fromMillis(n.localWriteTimeMs);return new Jo(n.batchId,e,r,s)}function ha(e){var t=oa(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?oa(e.lastLimboFreeSnapshotVersion):xr.min(),r=void 0!==e.query.documents?(gr(1===(r=e.query).documents.length),Us(Rs(to(r.documents[0])))):Us(co(e.query));return new Zo(r,e.targetId,0,e.lastListenSequenceNumber,t,n,Ur.fromBase64String(e.resumeToken))}function ua(e,t){var n=ia(t.snapshotVersion),r=ia(t.lastLimboFreeSnapshotVersion),s=(ms(t.target)?ho:uo)(e.Wt,t.target),e=t.resumeToken.toBase64();return new Co(t.targetId,fs(t.target),n,e,t.sequenceNumber,r,s)}function ca(e){var t=co({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?qs(t,t.limit,"L"):t}class la{getBundleMetadata(e,t){return da(e).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:oa(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return da(e).put({bundleId:t.id,createTime:ia(Wi(t.createTime)),version:t.version})}getNamedQuery(e,t){return fa(e).get(t).next(e=>{if(e)return{name:e.name,query:ca(e.bundledQuery),readTime:oa(e.readTime)}})}saveNamedQuery(e,t){return fa(e).put({name:t.name,readTime:ia(Wi(t.readTime)),bundledQuery:t.bundledQuery})}}function da(e){return Yo(e,Oo.store)}function fa(e){return Yo(e,Mo.store)}class ga{constructor(){this.Gt=new ma}addToCollectionParentIndex(e,t){return this.Gt.add(t),Uo.resolve()}getCollectionParents(e,t){return Uo.resolve(this.Gt.getEntries(t))}}class ma{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Ai(Mr.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Ai(Mr.comparator)).toArray()}}class pa{constructor(){this.zt=new ma}addToCollectionParentIndex(e,t){if(this.zt.has(t))return Uo.resolve();var n=t.lastSegment(),r=t.popLast();return e.addOnCommittedListener(()=>{this.zt.add(t)}),r={collectionId:n,parent:yo(r)},ya(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[Dr(n),""],!1,!0);return ya(e).Lt(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(vo(t.parent))}return r})}}function ya(e){return Yo(e,Ro.store)}const wa={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class va{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new va(e,va.DEFAULT_COLLECTION_PERCENTILE,va.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function ba(e,t,n){const r=e.store(Io.store),s=e.store(_o.store),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const h=r.Kt({range:o},(e,t,n)=>(a++,n.delete()));i.push(h.next(()=>{gr(1===a)}));const u=[];for(const e of n.mutations){const r=_o.key(t,e.key.path,n.batchId);i.push(s.delete(r)),u.push(e.key)}return Uo.waitFor(i).next(()=>u)}function Ta(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw fr();t=e.noDocument}return JSON.stringify(t).length}va.DEFAULT_COLLECTION_PERCENTILE=10,va.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,va.DEFAULT=new va(41943040,va.DEFAULT_COLLECTION_PERCENTILE,va.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),va.DISABLED=new va(-1,0,0);class Ea{constructor(e,t,n,r){this.userId=e,this.N=t,this.Ht=n,this.referenceDelegate=r,this.Jt={}}static Yt(e,t,n,r){return gr(""!==e.uid),e=e.isAuthenticated()?e.uid:"",new Ea(e,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return _a(e).Kt({index:Io.userMutationsIndex,range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(c,l,d,f){const g=Sa(c),m=_a(c);return m.add({}).next(e=>{gr("number"==typeof e);const t=new Jo(e,l,d,f),n=(s=this.N,i=this.userId,a=(o=t).baseMutations.map(e=>oo(s.Wt,e)),h=o.mutations.map(e=>oo(s.Wt,e)),new Io(i,o.batchId,o.localWriteTime.toMillis(),a,h)),r=[];var s,i,o,a,h;let u=new Ai((e,t)=>Nr(e.canonicalString(),t.canonicalString()));for(const c of f){const l=_o.key(this.userId,c.key.path,e);u=u.add(c.key.path.popLast()),r.push(m.put(n)),r.push(g.put(l,_o.PLACEHOLDER))}return u.forEach(e=>{r.push(this.Ht.addToCollectionParentIndex(c,e))}),c.addOnCommittedListener(()=>{this.Jt[e]=t.keys()}),Uo.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return _a(e).get(t).next(e=>e?(gr(e.userId===this.userId),aa(this.N,e)):null)}Xt(e,t){return this.Jt[t]?Uo.resolve(this.Jt[t]):this.lookupMutationBatch(e,t).next(e=>e?(e=e.keys(),this.Jt[t]=e):null)}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return _a(e).Kt({index:Io.userMutationsIndex,range:n},(e,t,n)=>{t.userId===this.userId&&(gr(t.batchId>=r),s=aa(this.N,t)),n.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return _a(e).Kt({index:Io.userMutationsIndex,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return _a(e).Lt(Io.userMutationsIndex,t).next(e=>e.map(e=>aa(this.N,e)))}getAllMutationBatchesAffectingDocumentKey(i,o){const e=_o.prefixForPath(this.userId,o.path),t=IDBKeyRange.lowerBound(e),a=[];return Sa(i).Kt({range:t},(e,t,n)=>{var[r,s,e]=e,s=vo(s);if(r===this.userId&&o.path.isEqual(s))return _a(i).get(e).next(e=>{if(!e)throw fr();gr(e.userId===this.userId),a.push(aa(this.N,e))});n.done()}).next(()=>a)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new Ai(Nr);const n=[];return e.forEach(i=>{var e=_o.prefixForPath(this.userId,i.path),e=IDBKeyRange.lowerBound(e),e=Sa(t).Kt({range:e},(e,t,n)=>{var[r,s,e]=e,s=vo(s);r===this.userId&&i.path.isEqual(s)?o=o.add(e):n.done()});n.push(e)}),Uo.waitFor(n).next(()=>this.Zt(t,o))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,o=i.length+1,n=_o.prefixForPath(this.userId,i),r=IDBKeyRange.lowerBound(n);let a=new Ai(Nr);return Sa(e).Kt({range:r},(e,t,n)=>{var[r,s,e]=e,s=vo(s);r===this.userId&&i.isPrefixOf(s)?s.length===o&&(a=a.add(e)):n.done()}).next(()=>this.Zt(e,a))}Zt(t,e){const n=[],r=[];return e.forEach(e=>{r.push(_a(t).get(e).next(e=>{if(null===e)throw fr();gr(e.userId===this.userId),n.push(aa(this.N,e))}))}),Uo.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return ba(t.Qt,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.te(n.batchId)}),Uo.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}te(e){delete this.Jt[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return Uo.resolve();const t=IDBKeyRange.lowerBound(_o.prefixForUser(this.userId)),r=[];return Sa(n).Kt({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=vo(e[1]);r.push(t)}else n.done()}).next(()=>{gr(0===r.length)})})}containsKey(e,t){return Ia(e,this.userId,t)}ee(e){return Na(e).get(this.userId).next(e=>e||new Eo(this.userId,-1,""))}}function Ia(e,s,t){const n=_o.prefixForPath(s,t.path),i=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return Sa(e).Kt({range:r,qt:!0},(e,t,n)=>{var[r,e]=e;r===s&&e===i&&(o=!0),n.done()}).next(()=>o)}function _a(e){return Yo(e,Io.store)}function Sa(e){return Yo(e,_o.store)}function Na(e){return Yo(e,Eo.store)}class Aa{constructor(e){this.ne=e}next(){return this.ne+=2,this.ne}static se(){return new Aa(0)}static ie(){return new Aa(-1)}}class Da{constructor(e,t){this.referenceDelegate=e,this.N=t}allocateTargetId(n){return this.re(n).next(e=>{const t=new Aa(e.highestTargetId);return e.highestTargetId=t.next(),this.oe(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.re(e).next(e=>xr.fromTimestamp(new Cr(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.re(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.re(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.oe(t,e)))}addTargetData(t,n){return this.ae(t,n).next(()=>this.re(t).next(e=>(e.targetCount+=1,this.ce(n,e),this.oe(t,e))))}updateTargetData(e,t){return this.ae(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Ca(t).delete(e.targetId)).next(()=>this.re(t)).next(e=>(gr(0<e.targetCount),--e.targetCount,this.oe(t,e)))}removeTargets(n,r,s){let i=0;const o=[];return Ca(n).Kt((e,t)=>{(t=ha(t)).sequenceNumber<=r&&null===s.get(t.targetId)&&(i++,o.push(this.removeTargetData(n,t)))}).next(()=>Uo.waitFor(o)).next(()=>i)}forEachTarget(e,n){return Ca(e).Kt((e,t)=>{t=ha(t),n(t)})}re(e){return xa(e).get(ko.key).next(e=>(gr(null!==e),e))}oe(e,t){return xa(e).put(ko.key,t)}ae(e,t){return Ca(e).put(ua(this.N,t))}ce(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.re(e).next(e=>e.targetCount)}getTargetData(e,r){var t=fs(r),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let s=null;return Ca(e).Kt({range:t,index:Co.queryTargetsIndexName},(e,t,n)=>{t=ha(t),gs(r,t.target)&&(s=t,n.done())}).next(()=>s)}addMatchingKeys(n,e,r){const s=[],i=ka(n);return e.forEach(e=>{var t=yo(e.path);s.push(i.put(new xo(r,t))),s.push(this.referenceDelegate.addReference(n,r,e))}),Uo.waitFor(s)}removeMatchingKeys(n,e,r){const s=ka(n);return Uo.forEach(e,e=>{var t=yo(e.path);return Uo.waitFor([s.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=ka(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=ka(e);let s=Li();return r.Kt({range:n,qt:!0},(e,t,n)=>{e=vo(e[1]),e=new Wr(e),s=s.add(e)}).next(()=>s)}containsKey(e,t){t=yo(t.path),t=IDBKeyRange.bound([t],[Dr(t)],!1,!0);let r=0;return ka(e).Kt({index:xo.documentTargetsIndex,qt:!0,range:t},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}Tt(e,t){return Ca(e).get(t).next(e=>e?ha(e):null)}}function Ca(e){return Yo(e,Co.store)}function xa(e){return Yo(e,ko.store)}function ka(e){return Yo(e,xo.store)}async function Ra(e){if(e.code!==mr.FAILED_PRECONDITION||e.message!==Po)throw e;ur("LocalStore","Unexpectedly lost primary lease")}function La([e,t],[n,r]){return 0===(n=Nr(e,n))?Nr(t,r):n}class Oa{constructor(e){this.ue=e,this.buffer=new Ai(La),this.he=0}le(){return++this.he}fe(e){var t;e=[e,this.le()],this.buffer.size<this.ue?this.buffer=this.buffer.add(e):La(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))}get maxValue(){return this.buffer.last()[0]}}class Ma{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.de=!1,this.we=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this._e(e)}stop(){this.we&&(this.we.cancel(),this.we=null)}get started(){return null!==this.we}_e(e){var t=this.de?3e5:6e4;ur("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.we=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.we=null,this.de=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){$o(e)?ur("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await Ra(e)}await this._e(e)})}}class Fa{constructor(e,t){this.me=e,this.params=t}calculateTargetCount(e,t){return this.me.ge(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Uo.resolve(_r.T);const n=new Oa(t);return this.me.forEachTarget(e,e=>n.fe(e.sequenceNumber)).next(()=>this.me.ye(e,e=>n.fe(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.me.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.me.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(ur("LruGarbageCollector","Garbage collection skipped; disabled"),Uo.resolve(wa)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(ur("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),wa):this.pe(t,n))}getCacheSize(e){return this.me.getCacheSize(e)}pe(t,n){let r,s,i,o,a,h,u;const c=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(s=e>this.params.maximumSequenceNumbersToCollect?(ur("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,o=Date.now(),this.nthSequenceNumber(t,s))).next(e=>(r=e,a=Date.now(),this.removeTargets(t,r,n))).next(e=>(i=e,h=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(u=Date.now(),hr()<=l.DEBUG&&ur("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-c}ms\n\tDetermined least recently used ${s} in `+(a-o)+"ms\n"+`\tRemoved ${i} targets in `+(h-a)+"ms\n"+`\tRemoved ${e} documents in `+(u-h)+"ms\n"+`Total Duration: ${u-c}ms`),Uo.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:e})))}}class Pa{constructor(e,t){this.db=e,this.garbageCollector=(e=this,new Fa(e,t))}ge(e){const n=this.Te(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Te(e){let t=0;return this.ye(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}ye(e,n){return this.Ee(e,(e,t)=>n(t))}addReference(e,t,n){return Va(e,n)}removeReference(e,t,n){return Va(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Va(e,t)}Ie(t,n){let r=!1;return Na(t).jt(e=>Ia(t,e,n).next(e=>(e&&(r=!0),Uo.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let o=0;return this.Ee(n,(t,e)=>{if(e<=r){const r=this.Ie(n,t).next(e=>{if(!e)return o++,s.getEntry(n,t).next(()=>(s.removeEntry(t),ka(n).delete([0,yo(t.path)])))});i.push(r)}}).next(()=>Uo.waitFor(i)).next(()=>s.apply(n)).next(()=>o)}removeTarget(e,t){return t=t.withSequenceNumber(e.currentSequenceNumber),this.db.getTargetCache().updateTargetData(e,t)}updateLimboDocument(e,t){return Va(e,t)}Ee(e,r){const t=ka(e);let s,i=_r.T;return t.Kt({index:xo.documentTargetsIndex},([e],{path:t,sequenceNumber:n})=>{0===e?(i!==_r.T&&r(new Wr(vo(s)),i),i=n,s=t):i=_r.T}).next(()=>{i!==_r.T&&r(new Wr(vo(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Va(e,t){return ka(e).put((e=e.currentSequenceNumber,new xo(0,yo(t.path),e)))}class Ua{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(t,n){const e=this.mapKeyFn(t),r=this.inner[e];if(void 0!==r){for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return void(r[e]=[t,n]);r.push([t,n])}else this.inner[e]=[[t,n]]}delete(t){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return!1;for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return 1===r.length?delete this.inner[n]:r.splice(e,1),!0;return!1}forEach(r){Rr(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return Lr(this.inner)}}class qa{constructor(){this.changes=new Ua(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){return(e=this.changes.get(e))?e.readTime:xr.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:cs.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Uo.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Ba{constructor(e,t){this.N=e,this.Ht=t}addEntry(e,t,n){return $a(e).put(Ga(t),n)}removeEntry(e,t){const n=$a(e),r=Ga(t);return n.delete(r)}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.Ae(t,e)))}getEntry(e,t){return $a(e).get(Ga(t)).next(e=>this.Re(t,e))}be(e,t){return $a(e).get(Ga(t)).next(e=>({document:this.Re(t,e),size:Ta(e)}))}getEntries(e,t){let n=Ci;return this.Pe(e,t,(e,t)=>{t=this.Re(e,t),n=n.insert(e,t)}).next(()=>n)}ve(e,t){let r=Ci,s=new _i(Wr.comparator);return this.Pe(e,t,(e,t)=>{var n=this.Re(e,t);r=r.insert(e,n),s=s.insert(e,Ta(t))}).next(()=>({documents:r,Ve:s}))}Pe(e,t,s){if(t.isEmpty())return Uo.resolve();const n=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator();let o=i.getNext();return $a(e).Kt({range:n},(e,t,n)=>{for(var r=Wr.fromSegments(e);o&&Wr.comparator(o,r)<0;)s(o,null),o=i.getNext();o&&o.isEqual(r)&&(s(o,t),o=i.hasNext()?i.getNext():null),o?n.Mt(o.path.toArray()):n.done()}).next(()=>{for(;o;)s(o,null),o=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(e,r,t){let s=Ci;const i=r.path.length+1,n={};if(t.isEqual(xr.min())){const e=r.path.toArray();n.range=IDBKeyRange.lowerBound(e)}else{const e=r.path.toArray(),s=ra(t);n.range=IDBKeyRange.lowerBound([e,s],!0),n.index=Ao.collectionReadTimeIndex}return $a(e).Kt(n,(e,t,n)=>{e.length===i&&(t=ta(this.N,t),r.path.isPrefixOf(t.key.path)?$s(r,t)&&(s=s.insert(t.key,t)):n.done())}).next(()=>s)}newChangeBuffer(e){return new ja(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return Ka(e).get(Do.key).next(e=>(gr(!!e),e))}Ae(e,t){return Ka(e).put(Do.key,t)}Re(e,t){if(t){const e=ta(this.N,t);if(!e.isNoDocument()||!e.version.isEqual(xr.min()))return e}return cs.newInvalidDocument(e)}}class ja extends qa{constructor(e,t){super(),this.Se=e,this.trackRemovals=t,this.De=new Ua(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){const i=[];let o=0,a=new Ai((e,t)=>Nr(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.De.get(e);if(t.document.isValidDocument()){var r=na(this.Se.N,t.document,this.getReadTime(e));a=a.add(e.path.popLast()),t=Ta(r),o+=t-n,i.push(this.Se.addEntry(s,e,r))}else if(o-=n,this.trackRemovals){const o=na(this.Se.N,cs.newNoDocument(e,xr.min()),this.getReadTime(e));i.push(this.Se.addEntry(s,e,o))}else i.push(this.Se.removeEntry(s,e))}),a.forEach(e=>{i.push(this.Se.Ht.addToCollectionParentIndex(s,e))}),i.push(this.Se.updateMetadata(s,o)),Uo.waitFor(i)}getFromCache(e,t){return this.Se.be(e,t).next(e=>(this.De.set(t,e.size),e.document))}getAllFromCache(e,t){return this.Se.ve(e,t).next(({documents:e,Ve:t})=>(t.forEach((e,t)=>{this.De.set(e,t)}),e))}}function Ka(e){return Yo(e,Do.store)}function $a(e){return Yo(e,Ao.store)}function Ga(e){return e.path.toArray()}class za{constructor(e){this.N=e}Ct(t,n,e,r){gr(e<r&&0<=e&&r<=11);const s=new qo("createOrUpgrade",n);var i;e<1&&1<=r&&(t.createObjectStore(To.store),(i=t).createObjectStore(Eo.store,{keyPath:Eo.keyPath}),i.createObjectStore(Io.store,{keyPath:Io.keyPath,autoIncrement:!0}).createIndex(Io.userMutationsIndex,Io.userMutationsKeyPath,{unique:!0}),i.createObjectStore(_o.store),Ha(t),t.createObjectStore(Ao.store));let o=Uo.resolve();return e<3&&3<=r&&(0!==e&&((i=t).deleteObjectStore(xo.store),i.deleteObjectStore(Co.store),i.deleteObjectStore(ko.store),Ha(t)),o=o.next(()=>function(){const e=s.store(ko.store),t=new ko(0,0,xr.min().toTimestamp(),0);return e.put(ko.key,t)}())),e<4&&4<=r&&(0!==e&&(o=o.next(()=>function(r,s){return s.store(Io.store).Lt().next(e=>{r.deleteObjectStore(Io.store),r.createObjectStore(Io.store,{keyPath:Io.keyPath,autoIncrement:!0}).createIndex(Io.userMutationsIndex,Io.userMutationsKeyPath,{unique:!0});const t=s.store(Io.store),n=e.map(e=>t.put(e));return Uo.waitFor(n)})}(t,s))),o=o.next(()=>{t.createObjectStore(Lo.store,{keyPath:Lo.keyPath})})),e<5&&5<=r&&(o=o.next(()=>this.Ce(s))),e<6&&6<=r&&(o=o.next(()=>(t.createObjectStore(Do.store),this.Ne(s)))),e<7&&7<=r&&(o=o.next(()=>this.xe(s))),e<8&&8<=r&&(o=o.next(()=>this.ke(t,s))),e<9&&9<=r&&(o=o.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),function(){const e=n.objectStore(Ao.store);e.createIndex(Ao.readTimeIndex,Ao.readTimeIndexPath,{unique:!1}),e.createIndex(Ao.collectionReadTimeIndex,Ao.collectionReadTimeIndexPath,{unique:!1})}()})),e<10&&10<=r&&(o=o.next(()=>this.$e(s))),e<11&&11<=r&&(o=o.next(()=>{t.createObjectStore(Oo.store,{keyPath:Oo.keyPath}),t.createObjectStore(Mo.store,{keyPath:Mo.keyPath})})),o}Ne(t){let n=0;return t.store(Ao.store).Kt((e,t)=>{n+=Ta(t)}).next(()=>{var e=new Do(n);return t.store(Do.store).put(Do.key,e)})}Ce(n){const e=n.store(Eo.store),r=n.store(Io.store);return e.Lt().next(e=>Uo.forEach(e,t=>{var e=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.Lt(Io.userMutationsIndex,e).next(e=>Uo.forEach(e,e=>(gr(e.userId===t.userId),e=aa(this.N,e),ba(n,t.userId,e).next(()=>{}))))}))}xe(e){const o=e.store(xo.store),t=e.store(Ao.store);return e.store(ko.store).get(ko.key).next(s=>{const i=[];return t.Kt((e,t)=>{const n=new Mr(e),r=[0,yo(n)];i.push(o.get(r).next(e=>e?Uo.resolve():(e=>o.put(new xo(0,yo(e),s.highestListenSequenceNumber)))(n)))}).next(()=>Uo.waitFor(i))})}ke(e,t){e.createObjectStore(Ro.store,{keyPath:Ro.keyPath});const n=t.store(Ro.store),r=new ma,s=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:yo(r)})}};return t.store(Ao.store).Kt({qt:!0},(e,t)=>{const n=new Mr(e);return s(n.popLast())}).next(()=>t.store(_o.store).Kt({qt:!0},([,e],t)=>{const n=vo(e);return s(n.popLast())}))}$e(e){const n=e.store(Co.store);return n.Kt((e,t)=>(t=ha(t),t=ua(this.N,t),n.put(t)))}}function Ha(e){e.createObjectStore(xo.store,{keyPath:xo.keyPath}).createIndex(xo.documentTargetsIndex,xo.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Co.store,{keyPath:Co.keyPath}).createIndex(Co.queryTargetsIndexName,Co.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(ko.store)}const Qa="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Wa{constructor(e,t,n,r,s,i,o,a,h,u){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Oe=s,this.window=i,this.document=o,this.Fe=h,this.Me=u,this.Le=null,this.Be=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ue=null,this.inForeground=!1,this.qe=null,this.Ke=null,this.je=Number.NEGATIVE_INFINITY,this.Qe=e=>Promise.resolve(),!Wa.bt())throw new pr(mr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Pa(this,r),this.We=t+"main",this.N=new ea(a),this.Ge=new Bo(this.We,11,new za(this.N)),this.ze=new Da(this.referenceDelegate,this.N),this.Ht=new pa,this.He=(t=this.N,a=this.Ht,new Ba(t,a)),this.Je=new la,this.window&&this.window.localStorage?this.Ye=this.window.localStorage:(this.Ye=null,!1===u&&cr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Xe().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new pr(mr.FAILED_PRECONDITION,Qa);return this.Ze(),this.tn(),this.en(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.ze.getHighestSequenceNumber(e))}).then(e=>{this.Le=new _r(e,this.Fe)}).then(()=>{this.Be=!0}).catch(e=>(this.Ge&&this.Ge.close(),Promise.reject(e)))}nn(t){return this.Qe=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ge.xt(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget(async()=>{this.started&&await this.Xe()}))}Xe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Ja(t).put(new Lo(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.sn(t).next(e=>{e||(this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)))})}).next(()=>this.rn(t)).next(e=>this.isPrimary&&!e?this.on(t).next(()=>!1):!!e&&this.an(t).next(()=>!0))).catch(e=>{if($o(e))return ur("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ur("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Oe.enqueueRetryable(()=>this.Qe(e)),this.isPrimary=e})}sn(e){return Ya(e).get(To.key).next(e=>Uo.resolve(this.cn(e)))}un(e){return Ja(e).delete(this.clientId)}async hn(){if(this.isPrimary&&!this.ln(this.je,18e5)){this.je=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=Yo(e,Lo.store);return r.Lt().next(e=>{const t=this.fn(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return Uo.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ye)for(const t of e)this.Ye.removeItem(this.dn(t.clientId))}}en(){this.Ke=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Xe().then(()=>this.hn()).then(()=>this.en()))}cn(e){return!!e&&e.ownerId===this.clientId}rn(t){return this.Me?Uo.resolve(!0):Ya(t).get(To.key).next(e=>{if(null!==e&&this.ln(e.leaseTimestampMs,5e3)&&!this.wn(e.ownerId)){if(this.cn(e)&&this.networkEnabled)return!0;if(!this.cn(e)){if(!e.allowTabSynchronization)throw new pr(mr.FAILED_PRECONDITION,Qa);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ja(t).Lt().next(e=>void 0===this.fn(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,e=this.networkEnabled===e.networkEnabled;if(t||n&&e)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&ur("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Be=!1,this._n(),this.Ke&&(this.Ke.cancel(),this.Ke=null),this.mn(),this.gn(),await this.Ge.runTransaction("shutdown","readwrite",[To.store,Lo.store],e=>{const t=new Wo(e,_r.T);return this.on(t).next(()=>this.un(t))}),this.Ge.close(),this.yn()}fn(e,t){return e.filter(e=>this.ln(e.updateTimeMs,t)&&!this.wn(e.clientId))}pn(){return this.runTransaction("getActiveClients","readonly",e=>Ja(e).Lt().next(e=>this.fn(e,18e5).map(e=>e.clientId)))}get started(){return this.Be}getMutationQueue(e){return Ea.Yt(e,this.N,this.Ht,this.referenceDelegate)}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getIndexManager(){return this.Ht}getBundleCache(){return this.Je}runTransaction(t,n,r){ur("IndexedDbPersistence","Starting transaction:",t);let s;return this.Ge.runTransaction(t,"readonly"===n?"readonly":"readwrite",Fo,e=>(s=new Wo(e,this.Le?this.Le.next():_r.T),"readwrite-primary"===n?this.sn(s).next(e=>!!e||this.rn(s)).next(e=>{if(!e)throw cr(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)),new pr(mr.FAILED_PRECONDITION,Po);return r(s)}).next(e=>this.an(s).next(()=>e)):this.Tn(s).next(()=>r(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}Tn(e){return Ya(e).get(To.key).next(e=>{if(null!==e&&this.ln(e.leaseTimestampMs,5e3)&&!this.wn(e.ownerId)&&!this.cn(e)&&!(this.Me||this.allowTabSynchronization&&e.allowTabSynchronization))throw new pr(mr.FAILED_PRECONDITION,Qa)})}an(e){var t=new To(this.clientId,this.allowTabSynchronization,Date.now());return Ya(e).put(To.key,t)}static bt(){return Bo.bt()}on(e){const t=Ya(e);return t.get(To.key).next(e=>this.cn(e)?(ur("IndexedDbPersistence","Releasing primary lease."),t.delete(To.key)):Uo.resolve())}ln(e,t){var n=Date.now();return!(e<n-t||n<e&&(cr(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ze(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=()=>{this.Oe.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Xe()))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)}mn(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)}tn(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ue=()=>{this._n(),!function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match("Version/14")&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ue))}gn(){this.Ue&&(this.window.removeEventListener("pagehide",this.Ue),this.Ue=null)}wn(e){var t;try{var n=null!==(null===(t=this.Ye)||void 0===t?void 0:t.getItem(this.dn(e)));return ur("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return cr("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}_n(){if(this.Ye)try{this.Ye.setItem(this.dn(this.clientId),String(Date.now()))}catch(e){cr("Failed to set zombie client id.",e)}}yn(){if(this.Ye)try{this.Ye.removeItem(this.dn(this.clientId))}catch(e){}}dn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ya(e){return Yo(e,To.store)}function Ja(e){return Yo(e,Lo.store)}function Xa(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Za{constructor(e,t){this.progress=e,this.En=t}}class eh{constructor(e,t,n){this.He=e,this.In=t,this.Ht=n}An(t,n){return this.In.getAllMutationBatchesAffectingDocumentKey(t,n).next(e=>this.Rn(t,n,e))}Rn(e,t,n){return this.He.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}bn(e,n){e.forEach((e,t)=>{for(const e of n)e.applyToLocalView(t)})}Pn(t,e){return this.He.getEntries(t,e).next(e=>this.vn(t,e).next(()=>e))}vn(e,t){return this.In.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.bn(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,Wr.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Vn(e,t.path):Ps(t)?this.Sn(e,t,n):this.Dn(e,t,n);var r}Vn(e,t){return this.An(e,new Wr(t)).next(e=>{let t=xi;return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Sn(n,r,s){const i=r.collectionGroup;let o=xi;return this.Ht.getCollectionParents(n,i).next(e=>Uo.forEach(e,e=>{var t=(t=r,e=e.child(i),new xs(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.Dn(n,t,s).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}Dn(t,n,e){let s,i;return this.He.getDocumentsMatchingQuery(t,n,e).next(e=>(s=e,this.In.getAllMutationBatchesAffectingQuery(t,n))).next(e=>(i=e,this.Cn(t,i,s).next(t=>{s=t;for(const t of i)for(const r of t.mutations){var n=r.key;let e=s.get(n);null==e&&(e=cs.newInvalidDocument(n),s=s.insert(n,e)),li(r,e,t.localWriteTime),e.isFoundDocument()||(s=s.remove(n))}}))).next(()=>(s.forEach((e,t)=>{$s(n,t)||(s=s.remove(e))}),s))}Cn(e,t,n){let r=Li();for(const e of t)for(const t of e.mutations)t instanceof mi&&null===n.get(t.key)&&(r=r.add(t.key));let s=n;return this.He.getEntries(e,r).next(e=>(e.forEach((e,t)=>{t.isFoundDocument()&&(s=s.insert(e,t))}),s))}}class th{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Nn=n,this.xn=r}static kn(e,t){let n=Li(),r=Li();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new th(e,t.fromCache,n,r)}}class nh{$n(e){this.On=e}getDocumentsMatchingQuery(t,r,s,i){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||s.isEqual(xr.min())?this.Fn(t,r):this.On.Pn(t,i).next(e=>{const n=this.Mn(r,e);return(Ls(r)||Os(r))&&this.Ln(r.limitType,n,i,s)?this.Fn(t,r):(hr()<=l.DEBUG&&ur("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ks(r)),this.On.getDocumentsMatchingQuery(t,r,s).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t)))})}Mn(n,e){let r=new Ai(Gs(n));return e.forEach((e,t)=>{$s(n,t)&&(r=r.add(t))}),r}Ln(e,t,n,r){if(n.size!==t.size)return!0;const s="F"===e?t.last():t.first();return!!s&&(s.hasPendingWrites||0<s.version.compareTo(r))}Fn(e,t){return hr()<=l.DEBUG&&ur("QueryEngine","Using full collection scan to execute query:",Ks(t)),this.On.getDocumentsMatchingQuery(e,t,xr.min())}}class rh{constructor(e,t,n,r){this.persistence=e,this.Bn=t,this.N=r,this.Un=new _i(Nr),this.qn=new Ua(e=>fs(e),gs),this.Kn=xr.min(),this.In=e.getMutationQueue(n),this.jn=e.getRemoteDocumentCache(),this.ze=e.getTargetCache(),this.Qn=new eh(this.jn,this.In,this.persistence.getIndexManager()),this.Je=e.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Un))}}function sh(e,t,n,r){return new rh(e,t,n,r)}async function ih(e,t){const n=e;let r=n.In,o=n.Qn;return e=await n.persistence.runTransaction("Handle user change","readonly",s=>{let i;return n.In.getAllMutationBatches(s).next(e=>(i=e,r=n.persistence.getMutationQueue(t),o=new eh(n.jn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(s))).next(e=>{const t=[],n=[];let r=Li();for(const s of i){t.push(s.batchId);for(const e of s.mutations)r=r.add(e.key)}for(const s of e){n.push(s.batchId);for(const e of s.mutations)r=r.add(e.key)}return o.Pn(s,r).next(e=>({Wn:e,removedBatchIds:t,addedBatchIds:n}))})}),n.In=r,n.Qn=o,n.Bn.$n(n.Qn),e}function oh(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.ze.getLastRemoteSnapshotVersion(e))}function ah(e,o,t,a,h){let n=Li();return t.forEach(e=>n=n.add(e)),o.getEntries(e,n).next(s=>{let i=Ci;return t.forEach((e,t)=>{const n=s.get(e),r=(null==h?void 0:h.get(e))||a;t.isNoDocument()&&t.version.isEqual(xr.min())?(o.removeEntry(e,r),i=i.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(o.addEntry(t,r),i=i.insert(e,t)):ur("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),i})}function hh(e,r){const s=e;return s.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return s.ze.getTargetData(t,r).next(e=>e?(n=e,Uo.resolve(n)):s.ze.allocateTargetId(t).next(e=>(n=new Zo(r,e,0,t.currentSequenceNumber),s.ze.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=s.Un.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(s.Un=s.Un.insert(e.targetId,e),s.qn.set(r,e.targetId)),e})}async function uh(e,t,n){const r=e,s=r.Un.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,e=>r.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!$o(e))throw e;ur("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Un=r.Un.remove(t),r.qn.delete(s.target)}function ch(e,n,r){const s=e;let i=xr.min(),o=Li();return s.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,s=r.qn.get(n);return void 0!==s?Uo.resolve(r.Un.get(s)):r.ze.getTargetData(t,n)}(s,t,Us(n)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.ze.getMatchingKeysForTargetId(t,e.targetId).next(e=>{o=e})}).next(()=>s.Bn.getDocumentsMatchingQuery(t,n,r?i:xr.min(),r?o:Li())).next(e=>({documents:e,Gn:o})))}function lh(e,t){const n=e,r=n.ze,s=n.Un.get(t);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",e=>r.Tt(e,t).next(e=>e?e.target:null))}function dh(e){const n=e;return n.persistence.runTransaction("Get new document changes","readonly",e=>function(e,t,n){const r=e;let s=Ci,i=ra(n);const o=$a(t),a=IDBKeyRange.lowerBound(i,!0);return o.Kt({index:Ao.readTimeIndex,range:a},(e,t)=>{var n=ta(r.N,t);s=s.insert(n.key,n),i=t.readTime}).next(()=>({En:s,readTime:sa(i)}))}(n.jn,e,n.Kn)).then(({En:e,readTime:t})=>(n.Kn=t,e))}class fh{constructor(e){this.N=e,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(e,t){return Uo.resolve(this.Yn.get(t))}saveBundleMetadata(e,t){return this.Yn.set(t.id,{id:t.id,version:t.version,createTime:Wi(t.createTime)}),Uo.resolve()}getNamedQuery(e,t){return Uo.resolve(this.Xn.get(t))}saveNamedQuery(e,t){return this.Xn.set(t.name,{name:t.name,query:ca(t.bundledQuery),readTime:Wi(t.readTime)}),Uo.resolve()}}class gh{constructor(){this.Zn=new Ai(mh.ts),this.es=new Ai(mh.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,t){t=new mh(e,t),this.Zn=this.Zn.add(t),this.es=this.es.add(t)}ss(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.rs(new mh(e,t))}os(e,t){e.forEach(e=>this.removeReference(e,t))}cs(e){const t=new Wr(new Mr([])),n=new mh(t,e),r=new mh(t,e+1),s=[];return this.es.forEachInRange([n,r],e=>{this.rs(e),s.push(e.key)}),s}us(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){var t=new Wr(new Mr([])),n=new mh(t,e),e=new mh(t,e+1);let r=Li();return this.es.forEachInRange([n,e],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new mh(e,0);return null!==(t=this.Zn.firstAfterOrEqual(t))&&e.isEqual(t.key)}}class mh{constructor(e,t){this.key=e,this.ls=t}static ts(e,t){return Wr.comparator(e.key,t.key)||Nr(e.ls,t.ls)}static ns(e,t){return Nr(e.ls,t.ls)||Wr.comparator(e.key,t.key)}}class ph{constructor(e,t){this.Ht=e,this.referenceDelegate=t,this.In=[],this.fs=1,this.ds=new Ai(mh.ts)}checkEmpty(e){return Uo.resolve(0===this.In.length)}addMutationBatch(e,t,n,r){var s=this.fs;this.fs++,0<this.In.length&&this.In[this.In.length-1],n=new Jo(s,t,n,r),this.In.push(n);for(const t of r)this.ds=this.ds.add(new mh(t.key,s)),this.Ht.addToCollectionParentIndex(e,t.key.path.popLast());return Uo.resolve(n)}lookupMutationBatch(e,t){return Uo.resolve(this.ws(t))}getNextMutationBatchAfterBatchId(e,t){return t=(t=this._s(t+1))<0?0:t,Uo.resolve(this.In.length>t?this.In[t]:null)}getHighestUnacknowledgedBatchId(){return Uo.resolve(0===this.In.length?-1:this.fs-1)}getAllMutationBatches(e){return Uo.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new mh(t,0),r=new mh(t,Number.POSITIVE_INFINITY),s=[];return this.ds.forEachInRange([n,r],e=>{e=this.ws(e.ls),s.push(e)}),Uo.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ai(Nr);return t.forEach(e=>{var t=new mh(e,0),e=new mh(e,Number.POSITIVE_INFINITY);this.ds.forEachInRange([t,e],e=>{n=n.add(e.ls)})}),Uo.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;Wr.isDocumentKey(s)||(s=s.child("")),t=new mh(new Wr(s),0);let i=new Ai(Nr);return this.ds.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(i=i.add(e.ls)),!0)},t),Uo.resolve(this.gs(i))}gs(e){const t=[];return e.forEach(e=>{null!==(e=this.ws(e))&&t.push(e)}),t}removeMutationBatch(n,r){gr(0===this.ys(r.batchId,"removed")),this.In.shift();let s=this.ds;return Uo.forEach(r.mutations,e=>{var t=new mh(e.key,r.batchId);return s=s.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.ds=s})}te(e){}containsKey(e,t){var n=new mh(t,0),n=this.ds.firstAfterOrEqual(n);return Uo.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.In.length,Uo.resolve()}ys(e,t){return this._s(e)}_s(e){return 0===this.In.length?0:e-this.In[0].batchId}ws(e){return(e=this._s(e))<0||e>=this.In.length?null:this.In[e]}}class yh{constructor(e,t){this.Ht=e,this.ps=t,this.docs=new _i(Wr.comparator),this.size=0}addEntry(e,t,n){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.ps(t);return this.docs=this.docs.insert(r,{document:t.clone(),size:o,readTime:n}),this.size+=o-i,this.Ht.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Uo.resolve(n?n.document.clone():cs.newInvalidDocument(t))}getEntries(e,t){let n=Ci;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.clone():cs.newInvalidDocument(e))}),Uo.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=Ci;const s=new Wr(t.path.child("")),i=this.docs.getIteratorFrom(s);for(;i.hasNext();){const{key:e,value:{document:s,readTime:o}}=i.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||$s(t,s)&&(r=r.insert(s.key,s.clone()))}return Uo.resolve(r)}Ts(e,t){return Uo.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new wh(this)}getSize(e){return Uo.resolve(this.size)}}class wh extends qa{constructor(e){super(),this.Se=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.document.isValidDocument()?r.push(this.Se.addEntry(n,t.document,this.getReadTime(e))):this.Se.removeEntry(e)}),Uo.waitFor(r)}getFromCache(e,t){return this.Se.getEntry(e,t)}getAllFromCache(e,t){return this.Se.getEntries(e,t)}}class vh{constructor(e){this.persistence=e,this.Es=new Ua(e=>fs(e),gs),this.lastRemoteSnapshotVersion=xr.min(),this.highestTargetId=0,this.Is=0,this.As=new gh,this.targetCount=0,this.Rs=Aa.se()}forEachTarget(e,n){return this.Es.forEach((e,t)=>n(t)),Uo.resolve()}getLastRemoteSnapshotVersion(e){return Uo.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Uo.resolve(this.Is)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),Uo.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Is&&(this.Is=t),Uo.resolve()}ae(e){this.Es.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Rs=new Aa(t),this.highestTargetId=t),e.sequenceNumber>this.Is&&(this.Is=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,Uo.resolve()}updateTargetData(e,t){return this.ae(t),Uo.resolve()}removeTargetData(e,t){return this.Es.delete(t.target),this.As.cs(t.targetId),--this.targetCount,Uo.resolve()}removeTargets(n,r,s){let i=0;const o=[];return this.Es.forEach((e,t)=>{t.sequenceNumber<=r&&null===s.get(t.targetId)&&(this.Es.delete(e),o.push(this.removeMatchingKeysForTargetId(n,t.targetId)),i++)}),Uo.waitFor(o).next(()=>i)}getTargetCount(e){return Uo.resolve(this.targetCount)}getTargetData(e,t){return t=this.Es.get(t)||null,Uo.resolve(t)}addMatchingKeys(e,t,n){return this.As.ss(t,n),Uo.resolve()}removeMatchingKeys(t,e,n){this.As.os(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach(e=>{s.push(r.markPotentiallyOrphaned(t,e))}),Uo.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.As.cs(t),Uo.resolve()}getMatchingKeysForTargetId(e,t){return t=this.As.hs(t),Uo.resolve(t)}containsKey(e,t){return Uo.resolve(this.As.containsKey(t))}}class bh{constructor(e,t){var n;this.bs={},this.Le=new _r(0),this.Be=!1,this.Be=!0,this.referenceDelegate=e(this),this.ze=new vh(this),this.Ht=new ga,this.He=(n=this.Ht,e=e=>this.referenceDelegate.Ps(e),new yh(n,e)),this.N=new ea(t),this.Je=new fh(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(e){let t=this.bs[e.toKey()];return t||(t=new ph(this.Ht,this.referenceDelegate),this.bs[e.toKey()]=t),t}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(e,t,n){ur("MemoryPersistence","Starting transaction:",e);const r=new Th(this.Le.next());return this.referenceDelegate.vs(),n(r).next(e=>this.referenceDelegate.Vs(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ss(t,n){return Uo.or(Object.values(this.bs).map(e=>()=>e.containsKey(t,n)))}}class Th extends Vo{constructor(e){super(),this.currentSequenceNumber=e}}class Eh{constructor(e){this.persistence=e,this.Ds=new gh,this.Cs=null}static Ns(e){return new Eh(e)}get xs(){if(this.Cs)return this.Cs;throw fr()}addReference(e,t,n){return this.Ds.addReference(n,t),this.xs.delete(n.toString()),Uo.resolve()}removeReference(e,t,n){return this.Ds.removeReference(n,t),this.xs.add(n.toString()),Uo.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),Uo.resolve()}removeTarget(e,t){this.Ds.cs(t.targetId).forEach(e=>this.xs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.xs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}vs(){this.Cs=new Set}Vs(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Uo.forEach(this.xs,e=>{const t=Wr.fromPath(e);return this.ks(n,t).next(e=>{e||r.removeEntry(t)})}).next(()=>(this.Cs=null,r.apply(n)))}updateLimboDocument(e,t){return this.ks(e,t).next(e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())})}Ps(e){return 0}ks(e,t){return Uo.or([()=>Uo.resolve(this.Ds.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ss(e,t)])}}function Ih(e,t){return`firestore_clients_${e}_${t}`}function _h(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Sh(e,t){return`firestore_targets_${e}_${t}`}class Nh{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static $s(e,t,n){var r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new pr(r.error.code,r.error.message))),i?new Nh(e,t,r.state,s):(cr("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ah{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static $s(e,t){var n=JSON.parse(t);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new pr(n.error.code,n.error.message))),s?new Ah(e,n.state,r):(cr("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Dh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=Oi;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=Qr(n.activeTargetIds[e]),s=s.add(n.activeTargetIds[e]);return r?new Dh(e,s):(cr("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ch{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Ch(t.clientId,t.onlineState):(cr("SharedClientState",`Failed to parse online state: ${e}`),null)}}class xh{constructor(){this.activeTargetIds=Oi}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ms(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class kh{constructor(e,t,n,r,s){this.window=e,this.Oe=t,this.persistenceKey=n,this.Ls=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Bs=this.Us.bind(this),this.qs=new _i(Nr),this.started=!1,this.Ks=[],n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),this.storage=this.window.localStorage,this.currentUser=s,this.js=Ih(this.persistenceKey,this.Ls),this.Qs=`firestore_sequence_number_${this.persistenceKey}`,this.qs=this.qs.insert(this.Ls,new xh),this.Ws=new RegExp(`^firestore_clients_${n}_([^_]*)$`),this.Gs=new RegExp(`^firestore_mutations_${n}_(\\d+)(?:_(.*))?$`),this.zs=new RegExp(`^firestore_targets_${n}_(\\d+)$`),this.Hs=`firestore_online_state_${this.persistenceKey}`,this.Js=`firestore_bundle_loaded_${this.persistenceKey}`,this.window.addEventListener("storage",this.Bs)}static bt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.pn();for(const n of e)if(n!==this.Ls){const e=this.getItem(Ih(this.persistenceKey,n));var t;!e||(t=Dh.$s(n,e))&&(this.qs=this.qs.insert(t.clientId,t))}this.Ys();const n=this.storage.getItem(this.Hs);if(n){const e=this.Xs(n);e&&this.Zs(e)}for(const e of this.Ks)this.Us(e);this.Ks=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Qs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ti(this.qs)}isActiveQueryTarget(n){let r=!1;return this.qs.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.ei(e,"pending")}updateMutationState(e,t,n){this.ei(e,t,n),this.ni(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(Sh(this.persistenceKey,e)))||(n=Ah.$s(e,n))&&(t=n.state)),this.si.Fs(e),this.Ys(),t}removeLocalQueryTarget(e){this.si.Ms(e),this.Ys()}isLocalQueryTarget(e){return this.si.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Sh(this.persistenceKey,e))}updateQueryState(e,t,n){this.ii(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.ni(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.ri(e)}notifyBundleLoaded(){this.oi()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Bs),this.removeItem(this.js),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return ur("SharedClientState","READ",e,t),t}setItem(e,t){ur("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ur("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Us(e){const r=e;r.storageArea===this.storage&&(ur("SharedClientState","EVENT",r.key,r.newValue),r.key!==this.js?this.Oe.enqueueRetryable(async()=>{if(this.started){if(null!==r.key)if(this.Ws.test(r.key)){if(null==r.newValue){var e=this.ai(r.key);return this.ci(e,null)}if(e=this.ui(r.key,r.newValue))return this.ci(e.clientId,e)}else if(this.Gs.test(r.key)){if(null!==r.newValue){var t=this.hi(r.key,r.newValue);if(t)return this.li(t)}}else if(this.zs.test(r.key)){if(null!==r.newValue&&(t=this.fi(r.key,r.newValue)))return this.di(t)}else if(r.key===this.Hs){if(null!==r.newValue){var n=this.Xs(r.newValue);if(n)return this.Zs(n)}}else if(r.key===this.Qs)(n=function(e){let t=_r.T;if(null!=e)try{var n=JSON.parse(e);gr("number"==typeof n),t=n}catch(e){cr("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(r.newValue))!==_r.T&&this.sequenceNumberHandler(n);else if(r.key===this.Js)return this.syncEngine.wi()}else this.Ks.push(r)}):cr("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get si(){return this.qs.get(this.Ls)}Ys(){this.setItem(this.js,this.si.Os())}ei(e,t,n){const r=new Nh(this.currentUser,e,t,n),s=_h(this.persistenceKey,this.currentUser,e);this.setItem(s,r.Os())}ni(e){e=_h(this.persistenceKey,this.currentUser,e),this.removeItem(e)}ri(e){e={clientId:this.Ls,onlineState:e},this.storage.setItem(this.Hs,JSON.stringify(e))}ii(e,t,n){const r=Sh(this.persistenceKey,e),s=new Ah(e,t,n);this.setItem(r,s.Os())}oi(){this.setItem(this.Js,"value-not-used")}ai(e){return(e=this.Ws.exec(e))?e[1]:null}ui(e,t){return e=this.ai(e),Dh.$s(e,t)}hi(e,t){var n=this.Gs.exec(e),e=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Nh.$s(new ir(n),e,t)}fi(e,t){return e=this.zs.exec(e),e=Number(e[1]),Ah.$s(e,t)}Xs(e){return Ch.$s(e)}async li(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine._i(e.batchId,e.state,e.error);ur("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}di(e){return this.syncEngine.mi(e.targetId,e.state,e.error)}ci(e,t){const n=t?this.qs.insert(e,t):this.qs.remove(e),r=this.ti(this.qs),s=this.ti(n),i=[],o=[];return s.forEach(e=>{r.has(e)||i.push(e)}),r.forEach(e=>{s.has(e)||o.push(e)}),this.syncEngine.gi(i,o).then(()=>{this.qs=n})}Zs(e){this.qs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ti(e){let n=Oi;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class Rh{constructor(){this.yi=new xh,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.yi.Fs(e),this.pi[e]||"not-current"}updateQueryState(e,t,n){this.pi[e]=t}removeLocalQueryTarget(e){this.yi.Ms(e)}isLocalQueryTarget(e){return this.yi.activeTargetIds.has(e)}clearQueryState(e){delete this.pi[e]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(e){return this.yi.activeTargetIds.has(e)}start(){return this.yi=new xh,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class Lh{Ti(e){}shutdown(){}}class Oh{constructor(){this.Ei=()=>this.Ii(),this.Ai=()=>this.Ri(),this.bi=[],this.Pi()}Ti(e){this.bi.push(e)}shutdown(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ai)}Pi(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ai)}Ii(){ur("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.bi)e(0)}Ri(){ur("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.bi)e(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Mh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Fh{constructor(e){this.vi=e.vi,this.Vi=e.Vi}Si(e){this.Di=e}Ci(e){this.Ni=e}onMessage(e){this.xi=e}close(){this.Vi()}send(e){this.vi(e)}ki(){this.Di()}$i(e){this.Ni(e)}Oi(e){this.xi(e)}}class Ph extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.Fi=t+"://"+e.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(t,e,n,r){const s=this.Bi(t,e);return ur("RestConnection","Sending: ",s,n),this.Ui(e={},r),this.qi(t,s,e,n).then(e=>(ur("RestConnection","Received: ",e),e),e=>{throw lr("RestConnection",`${t} failed with error: `,e,"url: ",s,"request:",n),e})}Ki(e,t,n,r){return this.Li(e,t,n,r)}Ui(e,t){if(e["X-Goog-Api-Client"]="gl-js/ fire/"+or,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t)for(const n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n])}Bi(e,t){return e=Mh[e],`${this.Fi}/v1/${t}:${e}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}qi(a,t,n,r){return new Promise((s,i)=>{const o=new sr;o.listenOnce(er.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case Zn.NO_ERROR:var e=o.getResponseJson();ur("Connection","XHR received:",JSON.stringify(e)),s(e);break;case Zn.TIMEOUT:ur("Connection",'RPC "'+a+'" timed out'),i(new pr(mr.DEADLINE_EXCEEDED,"Request time out"));break;case Zn.HTTP_ERROR:var t,n=o.getStatus();if(ur("Connection",'RPC "'+a+'" failed with status:',n,"response text:",o.getResponseText()),0<n){const a=o.getResponseJson().error;a&&a.status&&a.message?(r=a.status.toLowerCase().replace(/_/g,"-"),t=0<=Object.values(mr).indexOf(r)?r:mr.UNKNOWN,i(new pr(t,a.message))):i(new pr(mr.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new pr(mr.UNAVAILABLE,"Connection failed."));break;default:fr()}}finally{ur("Connection",'RPC "'+a+'" completed.')}var r});var e=JSON.stringify(r);o.send(t,"POST",e,n,15)})}ji(e,t){const n=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=new zn,s=Xn(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(i.xmlHttpFactory=new nr({})),this.Ui(i.initMessageHeaders,t),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=d().indexOf("Electron/")||function(){const e=d();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}()||0<=d().indexOf("MSAppHost/")||"object"==typeof(o="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==o.id||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");ur("Connection","Creating WebChannel: "+o,i);const a=r.createWebChannel(o,i);let h=!1,u=!1;const c=new Fh({vi:e=>{u?ur("Connection","Not sending because WebChannel is closed:",e):(h||(ur("Connection","Opening WebChannel transport."),a.open(),h=!0),ur("Connection","WebChannel sending:",e),a.send(e))},Vi:()=>a.close()}),l=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return l(a,rr.EventType.OPEN,()=>{u||ur("Connection","WebChannel transport opened.")}),l(a,rr.EventType.CLOSE,()=>{u||(u=!0,ur("Connection","WebChannel transport closed"),c.$i())}),l(a,rr.EventType.ERROR,e=>{u||(u=!0,lr("Connection","WebChannel transport errored:",e),c.$i(new pr(mr.UNAVAILABLE,"The operation could not be completed")))}),l(a,rr.EventType.MESSAGE,e=>{if(!u){gr(!!(e=e.data[0]));var n=e.error||(null===(n=e[0])||void 0===n?void 0:n.error);if(n){ur("Connection","WebChannel received error:",n);var r=n.status;let e=function(e){if(void 0!==(e=Jn[r]))return Ii(e)}(),t=n.message;void 0===e&&(e=mr.INTERNAL,t="Unknown error status: "+r+" with message "+n.message),u=!0,c.$i(new pr(e,t)),a.close()}else ur("Connection","WebChannel received:",e),c.Oi(e)}}),l(s,tr.STAT_EVENT,e=>{10===e.stat?ur("Connection","Detected buffering proxy"):11===e.stat&&ur("Connection","Detected no buffering proxy")}),setTimeout(()=>{c.ki()},0),c}}function Vh(){return"undefined"!=typeof window?window:null}function Uh(){return"undefined"!=typeof document?document:null}function qh(e){return new zi(e,!0)}class Bh{constructor(e,t,n=1e3,r=1.5,s=6e4){this.Oe=e,this.timerId=t,this.Qi=n,this.Wi=r,this.Gi=s,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(e){this.cancel();var t=Math.floor(this.zi+this.Zi()),n=Math.max(0,Date.now()-this.Ji),r=Math.max(0,t-n);0<r&&ur("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.zi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,r,()=>(this.Ji=Date.now(),e())),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}}class jh{constructor(e,t,n,r,s,i){this.Oe=e,this.er=n,this.nr=r,this.credentialsProvider=s,this.listener=i,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new Bh(e,t)}ar(){return 1===this.state||2===this.state||4===this.state}cr(){return 2===this.state}start(){3!==this.state?this.auth():this.ur()}async stop(){this.ar()&&await this.close(0)}hr(){this.state=0,this.rr.reset()}lr(){this.cr()&&null===this.ir&&(this.ir=this.Oe.enqueueAfterDelay(this.er,6e4,()=>this.dr()))}wr(e){this._r(),this.stream.send(e)}async dr(){if(this.cr())return this.close(0)}_r(){this.ir&&(this.ir.cancel(),this.ir=null)}async close(e,t){this._r(),this.rr.cancel(),this.sr++,3!==e?this.rr.reset():t&&t.code===mr.RESOURCE_EXHAUSTED?(cr(t.toString()),cr("Using maximum backoff delay to prevent overloading the backend."),this.rr.Yi()):t&&t.code===mr.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ci(t)}mr(){}auth(){this.state=1;const e=this.gr(this.sr),t=this.sr;this.credentialsProvider.getToken().then(e=>{this.sr===t&&this.yr(e)},t=>{e(()=>{var e=new pr(mr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.pr(e)})})}yr(e){const t=this.gr(this.sr);this.stream=this.Tr(e),this.stream.Si(()=>{t(()=>(this.state=2,this.listener.Si()))}),this.stream.Ci(e=>{t(()=>this.pr(e))}),this.stream.onMessage(e=>{t(()=>this.onMessage(e))})}ur(){this.state=4,this.rr.Xi(async()=>{this.state=0,this.start()})}pr(e){return ur("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(3,e)}gr(t){return e=>{this.Oe.enqueueAndForget(()=>this.sr===t?e():(ur("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Kh extends jh{constructor(e,t,n,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle",t,n,s),this.N=r}Tr(e){return this.nr.ji("Listen",e)}onMessage(e){this.rr.reset();var t,n=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(i=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:fr(),s=t.targetChange.targetIds||[],i=(o=t.targetChange.resumeToken,e.D?(gr(void 0===o||"string"==typeof o),Ur.fromBase64String(o||"")):(gr(void 0===o||o instanceof Uint8Array),Ur.fromUint8Array(o||new Uint8Array))),o=t.targetChange.cause,a=o&&(o=void 0===(a=o).code?mr.UNKNOWN:Ii(a.code),new pr(o,a.message||""));n=new Ui(r,s,i,a||null)}else if("documentChange"in t){t.documentChange,(u=t.documentChange).document,u.document.name,u.document.updateTime;var i=Zi(e,u.document.name),h=Wi(u.document.updateTime),a=new us({mapValue:{fields:u.document.fields}}),h=cs.newFoundDocument(i,h,a),a=u.targetIds||[],u=u.removedTargetIds||[];n=new Pi(a,u,h.key,h)}else if("documentDelete"in t){t.documentDelete,(u=t.documentDelete).document;var h=Zi(e,u.document),c=u.readTime?Wi(u.readTime):xr.min(),c=cs.newNoDocument(h,c),u=u.removedTargetIds||[];n=new Pi([],u,c.key,c)}else if("documentRemove"in t){t.documentRemove,(c=t.documentRemove).document;var l=Zi(e,c.document),c=c.removedTargetIds||[];n=new Pi([],c,l,null)}else{if(!("filter"in t))return fr();{t.filter;const e=t.filter;e.targetId,l=e.count||0,t=new Ti(l),l=e.targetId,n=new Vi(l,t)}}return n}(this.N,e),e=!("targetChange"in(t=e))||(t=t.targetChange).targetIds&&t.targetIds.length||!t.readTime?xr.min():Wi(t.readTime);return this.listener.Er(n,e)}Ir(e){const t={};var n;t.database=no(this.N),t.addTarget=function(e,t){let n;var r=t.target;return n=ms(r)?{documents:ho(e,r)}:{query:uo(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=Qi(e,t.resumeToken):0<t.snapshotVersion.compareTo(xr.min())&&(n.readTime=Hi(e,t.snapshotVersion.toTimestamp())),n}(this.N,e),(e=(this.N,n=e,null==(e=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return fr()}}())?null:{"goog-listen-tags":e}))&&(t.labels=e),this.wr(t)}Ar(e){const t={};t.database=no(this.N),t.removeTarget=e,this.wr(t)}}class $h extends jh{constructor(e,t,n,r,s){super(e,"write_stream_connection_backoff","write_stream_idle",t,n,s),this.N=r,this.Rr=!1}get br(){return this.Rr}start(){this.Rr=!1,this.lastStreamToken=void 0,super.start()}mr(){this.Rr&&this.Pr([])}Tr(e){return this.nr.ji("Write",e)}onMessage(e){if(gr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Rr){this.rr.reset();var t=(n=e.writeResults,r=e.commitTime,n&&0<n.length?(gr(void 0!==r),n.map(e=>function(e,t){let n=e.updateTime?Wi(e.updateTime):Wi(t);return n.isEqual(xr.min())&&(n=Wi(t)),new oi(n,e.transformResults||[])}(e,r))):[]),n=Wi(e.commitTime);return this.listener.vr(n,t)}var r;return gr(!e.writeResults||0===e.writeResults.length),this.Rr=!0,this.listener.Vr()}Sr(){const e={};e.database=no(this.N),this.wr(e)}Pr(e){e={streamToken:this.lastStreamToken,writes:e.map(e=>oo(this.N,e))},this.wr(e)}}class Gh extends class{}{constructor(e,t,n){super(),this.credentials=e,this.nr=t,this.N=n,this.Dr=!1}Cr(){if(this.Dr)throw new pr(mr.FAILED_PRECONDITION,"The client has already been terminated.")}Li(t,n,r){return this.Cr(),this.credentials.getToken().then(e=>this.nr.Li(t,n,r,e)).catch(e=>{throw"FirebaseError"===e.name?(e.code===mr.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new pr(mr.UNKNOWN,e.toString())})}Ki(t,n,r){return this.Cr(),this.credentials.getToken().then(e=>this.nr.Ki(t,n,r,e)).catch(e=>{throw"FirebaseError"===e.name?(e.code===mr.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new pr(mr.UNKNOWN,e.toString())})}terminate(){this.Dr=!0}}class zh{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Nr=0,this.kr=null,this.$r=!0}Or(){0===this.Nr&&(this.Fr("Unknown"),this.kr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.kr=null,this.Mr("Backend didn't respond within 10 seconds."),this.Fr("Offline"),Promise.resolve())))}Lr(e){"Online"===this.state?this.Fr("Unknown"):(this.Nr++,1<=this.Nr&&(this.Br(),this.Mr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Fr("Offline")))}set(e){this.Br(),this.Nr=0,"Online"===e&&(this.$r=!1),this.Fr(e)}Fr(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Mr(e){e=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`,this.$r?(cr(e),this.$r=!1):ur("OnlineStateTracker",e)}Br(){null!==this.kr&&(this.kr.cancel(),this.kr=null)}}class Hh{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ur=[],this.qr=new Map,this.Kr=new Set,this.jr=[],this.Qr=s,this.Qr.Ti(e=>{n.enqueueAndForget(async()=>{nu(this)&&(ur("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.Kr.add(4),await Wh(t),t.Wr.set("Unknown"),t.Kr.delete(4),await Qh(t)}(this))})}),this.Wr=new zh(n,r)}}async function Qh(e){if(nu(e))for(const t of e.jr)await t(!0)}async function Wh(e){for(const t of e.jr)await t(!1)}function Yh(e,t){const n=e;n.qr.has(t.targetId)||(n.qr.set(t.targetId,t),tu(n)?eu(n):cu(n).cr()&&Xh(n,t))}function Jh(e,t){const n=e,r=cu(n);n.qr.delete(t),r.cr()&&Zh(n,t),0===n.qr.size&&(r.cr()?r.lr():nu(n)&&n.Wr.set("Unknown"))}function Xh(e,t){e.Gr.Y(t.targetId),cu(e).Ir(t)}function Zh(e,t){e.Gr.Y(t),cu(e).Ar(t)}function eu(t){t.Gr=new Bi({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>t.qr.get(e)||null}),cu(t).start(),t.Wr.Or()}function tu(e){return nu(e)&&!cu(e).ar()&&0<e.qr.size}function nu(e){return 0===e.Kr.size}function ru(e){e.Gr=void 0}async function su(e,t,n){if(!$o(t))throw t;e.Kr.add(1),await Wh(e),e.Wr.set("Offline"),n=n||(()=>oh(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{ur("RemoteStore","Retrying IndexedDB access"),await n(),e.Kr.delete(1),await Qh(e)})}function iu(t,n){return n().catch(e=>su(t,e,n))}async function ou(e){const t=e,n=lu(t);let r=0<t.Ur.length?t.Ur[t.Ur.length-1].batchId:-1;for(;nu(s=t)&&s.Ur.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.In.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.Ur.length&&n.lr();break}r=e.batchId,function(e,t){e.Ur.push(t);const n=lu(e);n.cr()&&n.br&&n.Pr(t.mutations)}(t,e)}catch(e){await su(t,e)}var s;au(t)&&hu(t)}function au(e){return nu(e)&&!lu(e).ar()&&0<e.Ur.length}function hu(e){lu(e).start()}async function uu(e,t){const n=e;t?(n.Kr.delete(2),await Qh(n)):(n.Kr.add(2),await Wh(n),n.Wr.set("Unknown"))}function cu(t){return t.zr||(t.zr=function(e,t,n){const r=e;return r.Cr(),new Kh(t,r.nr,r.credentials,r.N,n)}(t.datastore,t.asyncQueue,{Si:async function(n){n.qr.forEach((e,t)=>{Xh(n,e)})}.bind(null,t),Ci:async function(e,t){ru(e),tu(e)?(e.Wr.Lr(t),eu(e)):e.Wr.set("Unknown")}.bind(null,t),Er:async function(e,r,t){if(e.Wr.set("Online"),r instanceof Ui&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.qr.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.qr.delete(n),e.Gr.removeTarget(n))}(e)}catch(t){ur("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await su(e,t)}else if(r instanceof Pi?e.Gr.rt(r):r instanceof Vi?e.Gr.ft(r):e.Gr.ct(r),!t.isEqual(xr.min()))try{const r=await oh(e.localStore);0<=t.compareTo(r)&&await function(r,s){const e=r.Gr._t(s);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.qr.get(t);n&&r.qr.set(t,n.withResumeToken(e.resumeToken,s))}}),e.targetMismatches.forEach(e=>{const t=r.qr.get(e);t&&(r.qr.set(e,t.withResumeToken(Ur.EMPTY_BYTE_STRING,t.snapshotVersion)),Zh(r,e),e=new Zo(t.target,e,1,t.sequenceNumber),Xh(r,e))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){ur("RemoteStore","Failed to raise snapshot:",r),await su(e,r)}}.bind(null,t)}),t.jr.push(async e=>{e?(t.zr.hr(),tu(t)?eu(t):t.Wr.set("Unknown")):(await t.zr.stop(),ru(t))})),t.zr}function lu(t){return t.Hr||(t.Hr=function(e,t,n){const r=e;return r.Cr(),new $h(t,r.nr,r.credentials,r.N,n)}(t.datastore,t.asyncQueue,{Si:async function(e){lu(e).Sr()}.bind(null,t),Ci:async function(e,t){t&&lu(e).br&&await async function(e,t){if(Ei(n=t.code)&&n!==mr.ABORTED){const n=e.Ur.shift();lu(e).hr(),await iu(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await ou(e)}var n}(e,t),au(e)&&hu(e)}.bind(null,t),Vr:async function(e){const t=lu(e);for(const n of e.Ur)t.Pr(n.mutations)}.bind(null,t),vr:async function(e,t,n){const r=e.Ur.shift(),s=Xo.from(r,t,n);await iu(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),await ou(e)}.bind(null,t)}),t.jr.push(async e=>{e?(t.Hr.hr(),await ou(t)):(await t.Hr.stop(),0<t.Ur.length&&(ur("RemoteStore",`Stopping write stream with ${t.Ur.length} pending writes`),t.Ur=[]))})),t.Hr}class du{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new yr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,o=new du(e,t,i,r,s);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new pr(mr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function fu(e,t){if(cr("AsyncQueue",`${t}: ${e}`),$o(e))return new pr(mr.UNAVAILABLE,`${t}: ${e}`);throw e}class gu{constructor(n){this.comparator=n?(e,t)=>n(e,t)||Wr.comparator(e.key,t.key):(e,t)=>Wr.comparator(e.key,t.key),this.keyedMap=xi,this.sortedSet=new _i(this.comparator)}static emptySet(e){return new gu(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){return(e=this.keyedMap.get(e))?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof gu))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new gu;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class mu{constructor(){this.Jr=new _i(Wr.comparator)}track(e){var t=e.doc.key,n=this.Jr.get(t);!n||0!==e.type&&3===n.type?this.Jr=this.Jr.insert(t,e):3===e.type&&1!==n.type?this.Jr=this.Jr.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Jr=this.Jr.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Jr=this.Jr.remove(t):1===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):fr()}Yr(){const n=[];return this.Jr.inorderTraversal((e,t)=>{n.push(t)}),n}}class pu{constructor(e,t,n,r,s,i,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new pu(e,t,gu.emptySet(t),s,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Bs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class yu{constructor(){this.Xr=void 0,this.listeners=[]}}class wu{constructor(){this.queries=new Ua(e=>js(e),Bs),this.onlineState="Unknown",this.Zr=new Set}}async function vu(e,t){const n=e,r=t.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new yu),s)try{i.Xr=await n.onListen(r)}catch(e){const n=fu(e,`Initialization of query '${Ks(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,i),i.listeners.push(t),t.eo(n.onlineState),!i.Xr||t.no(i.Xr)&&Tu(n)}async function bu(e,t){const n=e,r=t.query;let s=!1;const i=n.queries.get(r);if(i){const e=i.listeners.indexOf(t);0<=e&&(i.listeners.splice(e,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function Tu(e){e.Zr.forEach(e=>{e.next()})}class Eu{constructor(e,t,n){this.query=e,this.so=t,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}no(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new pu(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.io?this.oo(e)&&(this.so.next(e),t=!0):this.ao(e,this.onlineState)&&(this.co(e),t=!0),this.ro=e,t}onError(e){this.so.error(e)}eo(e){this.onlineState=e;let t=!1;return this.ro&&!this.io&&this.ao(this.ro,e)&&(this.co(this.ro),t=!0),t}ao(e,t){return!e.fromCache||!(this.options.uo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}oo(e){if(0<e.docChanges.length)return!0;var t=this.ro&&this.ro.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}co(e){e=pu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.io=!0,this.so.next(e)}}class Iu{constructor(e,t){this.payload=e,this.byteLength=t}ho(){return"metadata"in this.payload}}class _u{constructor(e){this.N=e}zn(e){return Zi(this.N,e)}Hn(e){return e.metadata.exists?io(this.N,e.document,!1):cs.newNoDocument(this.zn(e.metadata.name),this.Jn(e.metadata.readTime))}Jn(e){return Wi(e)}}class Su{constructor(e,t,n){this.lo=e,this.localStore=t,this.N=n,this.queries=[],this.documents=[],this.progress=Nu(e)}fo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}wo(e){const t=new Map,n=new _u(this.N);for(const s of e)if(s.metadata.queries){const e=n.zn(s.metadata.name);for(const n of s.metadata.queries){var r=(t.get(n)||Li()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const s=e;let i=Li(),o=Ci,a=ki;for(const e of n){const n=t.zn(e.metadata.name);e.document&&(i=i.add(n)),o=o.insert(n,t.Hn(e)),a=a.insert(n,t.Jn(e.metadata.readTime))}const h=s.jn.newChangeBuffer({trackRemovals:!0}),u=await hh(s,Us(Rs(Mr.fromString(`__bundle__/docs/${r}`))));return s.persistence.runTransaction("Apply bundle documents","readwrite",t=>ah(t,h,o,xr.min(),a).next(e=>(h.apply(t),e)).next(e=>s.ze.removeMatchingKeysForTargetId(t,u.targetId).next(()=>s.ze.addMatchingKeys(t,i,u.targetId)).next(()=>s.Qn.vn(t,e)).next(()=>e)))}(this.localStore,new _u(this.N),this.documents,this.lo.id),t=this.wo(this.documents);for(const e of this.queries)await async function(e,n,r=Li()){const s=await hh(e,Us(ca(n.bundledQuery))),i=e;return i.persistence.runTransaction("Save named query","readwrite",e=>{var t=Wi(n.readTime);return 0<=s.snapshotVersion.compareTo(t)?i.Je.saveNamedQuery(e,n):(t=s.withResumeToken(Ur.EMPTY_BYTE_STRING,t),i.Un=i.Un.insert(t.targetId,t),i.ze.updateTargetData(e,t).next(()=>i.ze.removeMatchingKeysForTargetId(e,s.targetId)).next(()=>i.ze.addMatchingKeys(e,r,s.targetId)).next(()=>i.Je.saveNamedQuery(e,n)))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",new Za(Object.assign({},this.progress),e)}}function Nu(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Au{constructor(e){this.key=e}}class Du{constructor(e){this.key=e}}class Cu{constructor(e,t){this.query=e,this._o=t,this.mo=null,this.current=!1,this.yo=Li(),this.mutatedKeys=Li(),this.po=Gs(e),this.To=new gu(this.po)}get Eo(){return this._o}Io(e,t){const a=t?t.Ao:new mu,h=(t||this).To;let u=(t||this).mutatedKeys,c=h,l=!1;const d=Ls(this.query)&&h.size===this.query.limit?h.last():null,f=Os(this.query)&&h.size===this.query.limit?h.first():null;if(e.inorderTraversal((e,t)=>{const n=h.get(e),r=$s(this.query,t)?t:null,s=!!n&&this.mutatedKeys.has(n.key),i=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let o=!1;n&&r?n.data.isEqual(r.data)?s!==i&&(a.track({type:3,doc:r}),o=!0):this.Ro(n,r)||(a.track({type:2,doc:r}),o=!0,(d&&0<this.po(r,d)||f&&this.po(r,f)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),o=!0):n&&!r&&(a.track({type:1,doc:n}),o=!0,(d||f)&&(l=!0)),o&&(u=r?(c=c.add(r),i?u.add(e):u.delete(e)):(c=c.delete(e),u.delete(e)))}),Ls(this.query)||Os(this.query))for(;c.size>this.query.limit;){const e=Ls(this.query)?c.last():c.first();c=c.delete(e.key),u=u.delete(e.key),a.track({type:1,doc:e})}return{To:c,Ao:a,Ln:l,mutatedKeys:u}}Ro(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.To;this.To=e.To,this.mutatedKeys=e.mutatedKeys;const s=e.Ao.Yr();s.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fr()}};return n(e)-n(t)}(e.type,t.type)||this.po(e.doc,t.doc)),this.bo(n);var i=t?this.Po():[],t=(n=0===this.yo.size&&this.current?1:0)!==this.mo;return this.mo=n,0!==s.length||t?{snapshot:new pu(this.query,e.To,r,s,e.mutatedKeys,0==n,t,!1),vo:i}:{vo:i}}eo(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({To:this.To,Ao:new mu,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{vo:[]}}Vo(e){return!this._o.has(e)&&!!this.To.has(e)&&!this.To.get(e).hasLocalMutations}bo(e){e&&(e.addedDocuments.forEach(e=>this._o=this._o.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._o=this._o.delete(e)),this.current=e.current)}Po(){if(!this.current)return[];const t=this.yo;this.yo=Li(),this.To.forEach(e=>{this.Vo(e.key)&&(this.yo=this.yo.add(e.key))});const n=[];return t.forEach(e=>{this.yo.has(e)||n.push(new Du(e))}),this.yo.forEach(e=>{t.has(e)||n.push(new Au(e))}),n}So(e){return this._o=e.Gn,this.yo=Li(),e=this.Io(e.documents),this.applyChanges(e,!0)}Do(){return pu.fromInitialDocuments(this.query,this.To,this.mutatedKeys,0===this.mo)}}class xu{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ku{constructor(e){this.key=e,this.Co=!1}}class Ru{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.No={},this.xo=new Ua(e=>js(e),Bs),this.ko=new Map,this.$o=new Set,this.Oo=new _i(Wr.comparator),this.Fo=new Map,this.Mo=new gh,this.Lo={},this.Bo=new Map,this.Uo=Aa.ie(),this.onlineState="Unknown",this.qo=void 0}get isPrimaryClient(){return!0===this.qo}}async function Lu(n,e,t,r){n.Ko=(e,s,t)=>async function(e,t,n){let r=t.view.Io(s);return r.Ln&&(r=await ch(e.localStore,t.query,!1).then(({documents:e})=>t.view.Io(e,r))),n=n&&n.targetChanges.get(t.targetId),n=t.view.applyChanges(r,e.isPrimaryClient,n),Bu(e,t.targetId,n.vo),n.snapshot}(n,e,t);const s=await ch(n.localStore,e,!0),i=new Cu(e,s.Gn),o=i.Io(s.documents),a=Fi.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),h=i.applyChanges(o,n.isPrimaryClient,a);return Bu(n,t,h.vo),r=new xu(e,t,i),n.xo.set(e,r),n.ko.has(t)?n.ko.get(t).push(e):n.ko.set(t,[e]),h.snapshot}async function Ou(e,t,n){const r=Qu(e);try{const e=await function(e,r){const s=e,i=Cr.now(),t=r.reduce((e,t)=>e.add(t.key),Li());let o;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>s.Qn.Pn(n,t).next(e=>{o=e;const t=[];for(const n of r){const r=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=Ys(r.transform,e||null);null!=s&&(null==n&&(n=us.empty()),n.set(r.field,s))}return n||null}(n,o.get(n.key));null!=r&&t.push(new mi(n.key,r,function r(e){const s=[];return Rr(e.fields,(e,t)=>{const n=new Pr([e]);if(as(t)){const e=r(t.mapValue).fields;if(0===e.length)s.push(n);else for(const t of e)s.push(n.child(t))}else s.push(n)}),new Vr(s)}(r.value.mapValue),ai.exists(!0)))}return s.In.addMutationBatch(n,i,t,r)})).then(e=>(e.applyToLocalDocumentSet(o),{batchId:e.batchId,changes:o}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Lo[e.currentUser.toKey()];r=r||new _i(Nr),r=r.insert(t,n),e.Lo[e.currentUser.toKey()]=r}(r,e.batchId,n),await Ku(r,e.changes),await ou(r.remoteStore)}catch(e){const t=fu(e,"Failed to persist write");n.reject(t)}}async function Mu(e,t){const r=e;try{const e=await function(e,n){const c=e,l=n.snapshotVersion;let d=c.Un;return c.persistence.runTransaction("Apply remote event","readwrite-primary",h=>{const e=c.jn.newChangeBuffer({trackRemovals:!0});d=c.Un;const u=[];n.targetChanges.forEach((e,t)=>{const n=d.get(t);if(n){u.push(c.ze.removeMatchingKeys(h,e.removedDocuments,t).next(()=>c.ze.addMatchingKeys(h,e.addedDocuments,t)));const a=e.resumeToken;var r,s,i,o;0<a.approximateByteSize()&&(r=n.withResumeToken(a,l).withSequenceNumber(h.currentSequenceNumber),d=d.insert(t,r),s=n,o=e,gr(0<(i=r).resumeToken.approximateByteSize()),0!==s.resumeToken.approximateByteSize()&&!(3e8<=i.snapshotVersion.toMicroseconds()-s.snapshotVersion.toMicroseconds()||0<o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size)||u.push(c.ze.updateTargetData(h,r)))}});let t=Ci;if(n.documentUpdates.forEach((e,t)=>{n.resolvedLimboDocuments.has(e)&&u.push(c.persistence.referenceDelegate.updateLimboDocument(h,e))}),u.push(ah(h,e,n.documentUpdates,l,void 0).next(e=>{t=e})),!l.isEqual(xr.min())){const n=c.ze.getLastRemoteSnapshotVersion(h).next(e=>c.ze.setTargetsMetadata(h,h.currentSequenceNumber,l));u.push(n)}return Uo.waitFor(u).next(()=>e.apply(h)).next(()=>c.Qn.vn(h,t)).next(()=>t)}).then(e=>(c.Un=d,e))}(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.Fo.get(t);n&&(gr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.Co=!0:0<e.modifiedDocuments.size?gr(n.Co):0<e.removedDocuments.size&&(gr(n.Co),n.Co=!1))}),await Ku(r,e,t)}catch(e){await Ra(e)}}function Fu(n,r,e){const t=n;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const n=[];t.xo.forEach((e,t)=>{(t=t.view.eo(r)).snapshot&&n.push(t.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.eo(n)&&(r=!0)}),r&&Tu(t)}(t.eventManager,r),n.length&&t.No.Er(n),t.onlineState=r,t.isPrimaryClient&&t.sharedClientState.setOnlineState(r)}}function Pu(e,t){(e.Bo.get(t)||[]).forEach(e=>{e.resolve()}),e.Bo.delete(t)}function Vu(e,t,n){const r=e;let s=r.Lo[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.Lo[r.currentUser.toKey()]=s}}function Uu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.ko.get(e))t.xo.delete(r),n&&t.No.jo(r,n);t.ko.delete(e),t.isPrimaryClient&&t.Mo.cs(e).forEach(e=>{t.Mo.containsKey(e)||qu(t,e)})}function qu(e,t){e.$o.delete(t.path.canonicalString());var n=e.Oo.get(t);null!==n&&(Jh(e.remoteStore,n),e.Oo=e.Oo.remove(t),e.Fo.delete(n),ju(e))}function Bu(e,t,n){for(const r of n)r instanceof Au?(e.Mo.addReference(r.key,t),function(e){const t=r.key,n=t.path.canonicalString();e.Oo.get(t)||e.$o.has(n)||(ur("SyncEngine","New document in limbo: "+t),e.$o.add(n),ju(e))}(e)):r instanceof Du?(ur("SyncEngine","Document no longer in limbo: "+r.key),e.Mo.removeReference(r.key,t),e.Mo.containsKey(r.key)||qu(e,r.key)):fr()}function ju(e){for(;0<e.$o.size&&e.Oo.size<e.maxConcurrentLimboResolutions;){var t=e.$o.values().next().value;e.$o.delete(t);var n=new Wr(Mr.fromString(t)),t=e.Uo.next();e.Fo.set(t,new ku(n)),e.Oo=e.Oo.insert(n,t),Yh(e.remoteStore,new Zo(Us(Rs(n.path)),t,2,_r.T))}}async function Ku(e,n,r){const s=e,i=[],o=[],a=[];s.xo.isEmpty()||(s.xo.forEach((e,t)=>{a.push(s.Ko(t,n,r).then(e=>{e&&(s.isPrimaryClient&&s.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),i.push(e),e=th.kn(t.targetId,e),o.push(e))}))}),await Promise.all(a),s.No.Er(i),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>Uo.forEach(t,t=>Uo.forEach(t.Nn,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>Uo.forEach(t.xn,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!$o(e))throw e;ur("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Un.get(t),n=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(n);r.Un=r.Un.insert(t,s)}}}(s.localStore,o))}async function $u(r,e){const s=r;if(Hu(s),Qu(s),!0===e&&!0!==s.qo){const r=s.sharedClientState.getAllActiveQueryTargets(),e=await Gu(s,r.toArray());s.qo=!0,await uu(s.remoteStore,!0);for(const r of e)Yh(s.remoteStore,r)}else if(!1===e&&!1!==s.qo){const r=[];let n=Promise.resolve();s.ko.forEach((e,t)=>{s.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(Uu(s,t),uh(s.localStore,t,!0))),Jh(s.remoteStore,t)}),await n,await Gu(s,r),function(){const n=s;n.Fo.forEach((e,t)=>{Jh(n.remoteStore,t)}),n.Mo.us(),n.Fo=new Map,n.Oo=new _i(Wr.comparator)}(),s.qo=!1,await uu(s.remoteStore,!1)}}async function Gu(t,n){const r=t,s=[],i=[];for(const t of n){let e;var o=r.ko.get(t);if(o&&0!==o.length){e=await hh(r.localStore,Us(o[0]));for(const t of o){const n=r.xo.get(t),c=(r,h=n,a=await ch((u=r).localStore,h.query,!0),a=h.view.So(a),u.isPrimaryClient&&Bu(u,h.targetId,a.vo),await a);c.snapshot&&i.push(c.snapshot)}}else{o=await lh(r.localStore,t);e=await hh(r.localStore,o),await Lu(r,zu(o),t,!1)}s.push(e)}var a,h,u;return r.No.Er(i),s}function zu(e){return ks(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Hu(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=Mu.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,t){const n=e,r=n.Fo.get(t);if(r&&r.Co)return Li().add(r.key);{let e=Li();const r=n.ko.get(t);if(!r)return e;for(const t of r){const r=n.xo.get(t);e=e.unionWith(r.view.Eo)}return e}}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const s=r.Fo.get(t),i=s&&s.key;if(i){let e=new _i(Wr.comparator);e=e.insert(i,cs.newNoDocument(i,xr.min()));const n=Li().add(i),s=new Mi(xr.min(),new Map,new Ai(Nr),e,n);await Mu(r,s),r.Oo=r.Oo.remove(i),r.Fo.delete(t),ju(r)}else await uh(r.localStore,t,!1).then(()=>Uu(r,t,n)).catch(Ra)}.bind(null,t),t.No.Er=function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.listeners)t.no(e)&&(r=!0);s.Xr=e}}r&&Tu(n)}.bind(null,t.eventManager),t.No.jo=function(e,t,n){const r=e,s=r.queries.get(t);if(s)for(const e of s.listeners)e.onError(n);r.queries.delete(t)}.bind(null,t.eventManager),t}function Qu(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=async function(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const s=e;return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=s.jn.newChangeBuffer({trackRemovals:!0});return function(e,t,r,s){const i=r.batch,n=i.keys();let o=Uo.resolve();return n.forEach(n=>{o=o.next(()=>s.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);gr(null!==t),e.version.compareTo(t)<0&&(i.applyToRemoteDocument(e,r),e.isValidDocument()&&s.addEntry(e,r.commitVersion))})}),o.next(()=>e.In.removeMutationBatch(t,i))}(s,e,r,n).next(()=>n.apply(e)).next(()=>s.In.performConsistencyCheck(e)).next(()=>s.Qn.Pn(e,t))})}(n.localStore,t);Vu(n,r,null),Pu(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Ku(n,e)}catch(e){await Ra(e)}}.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=async function(e,t,n){const r=e;try{const e=await function(e,r){const s=e;return s.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return s.In.lookupMutationBatch(t,r).next(e=>(gr(null!==e),n=e.keys(),s.In.removeMutationBatch(t,e))).next(()=>s.In.performConsistencyCheck(t)).next(()=>s.Qn.Pn(t,n))})}(r.localStore,t);Vu(r,t,n),Pu(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Ku(r,e)}catch(n){await Ra(n)}}.bind(null,t),t}class Wu{constructor(){this.synchronizeTabs=!1}async initialize(e){this.N=qh(e.databaseInfo.databaseId),this.sharedClientState=this.Wo(e),this.persistence=this.Go(e),await this.persistence.start(),this.gcScheduler=this.zo(e),this.localStore=this.Ho(e)}zo(e){return null}Ho(e){return sh(this.persistence,new nh,e.initialUser,this.N)}Go(e){return new bh(Eh.Ns,this.N)}Wo(e){return new Rh}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Yu extends Wu{constructor(e,t,n){super(),this.Jo=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await async function(e){const t=e;return t.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(){const e=$a(t);let r=xr.min();return e.Kt({index:Ao.readTimeIndex,reverse:!0},(e,t,n)=>{t.readTime&&(r=sa(t.readTime)),n.done()}).next(()=>r)}()).then(e=>{t.Kn=e})}(this.localStore),await this.Jo.initialize(this,e),await Qu(this.Jo.syncEngine),await ou(this.Jo.remoteStore),await this.persistence.nn(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Ho(e){return sh(this.persistence,new nh,e.initialUser,this.N)}zo(e){var t=this.persistence.referenceDelegate.garbageCollector;return new Ma(t,e.asyncQueue)}Go(e){var t=Xa(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?va.withCacheSize(this.cacheSizeBytes):va.DEFAULT;return new Wa(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Vh(),Uh(),this.N,this.sharedClientState,!!this.forceOwnership)}Wo(e){return new Rh}}class Ju extends Yu{constructor(e,t){super(e,t,!1),this.Jo=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e),e=this.Jo.syncEngine,this.sharedClientState instanceof kh&&(this.sharedClientState.syncEngine={_i:async function(e,t,n,r){var s=e;null!==(e=await function(e,n){const r=e,s=r.In;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.Xt(t,n).next(e=>e?r.Qn.Pn(t,e):Uo.resolve(null)))}(s.localStore,t))?("pending"===n?await ou(s.remoteStore):"acknowledged"===n||"rejected"===n?(Vu(s,t,r||null),Pu(s,t),s.localStore.In.te(t)):fr(),await Ku(s,e)):ur("SyncEngine","Cannot apply mutation batch with id: "+t)}.bind(null,e),mi:async function(e,t,n,r){const s=e;if(s.qo)ur("SyncEngine","Ignoring unexpected query state notification.");else if(s.ko.has(t))switch(n){case"current":case"not-current":{const e=await dh(s.localStore),r=Mi.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await Ku(s,e,r);break}case"rejected":await uh(s.localStore,t,!0),Uu(s,t,r);break;default:fr()}}.bind(null,e),gi:async function(e,t,n){const r=Hu(e);if(r.qo){for(const e of t)if(r.ko.has(e))ur("SyncEngine","Adding an already active target "+e);else{const t=await lh(r.localStore,e),n=await hh(r.localStore,t);await Lu(r,zu(t),n.targetId,!1),Yh(r.remoteStore,n)}for(const e of n)r.ko.has(e)&&await uh(r.localStore,e,!1).then(()=>{Jh(r.remoteStore,e),Uu(r,e)}).catch(Ra)}}.bind(null,e),pn:function(e){return e.localStore.persistence.pn()}.bind(null,e),wi:async function(e){const t=e;return dh(t.localStore).then(e=>Ku(t,e))}.bind(null,e)},await this.sharedClientState.start()),await this.persistence.nn(async e=>{await $u(this.Jo.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())})}Wo(e){var t=Vh();if(!kh.bt(t))throw new pr(mr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Xa(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new kh(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Xu{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Fu(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=async function(e,t){const n=e;var r;n.currentUser.isEqual(t)||(ur("SyncEngine","User change. New user:",t.toKey()),r=await ih(n.localStore,t),n.currentUser=t,(e=n).Bo.forEach(e=>{e.forEach(e=>{e.reject(new pr(mr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Bo.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await Ku(n,r.Wn))}.bind(null,this.syncEngine),await uu(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new wu}createDatastore(e){var t=qh(e.databaseInfo.databaseId),n=(n=e.databaseInfo,new Ph(n));return e=e.credentials,new Gh(e,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,s=e=>Fu(this.syncEngine,e,0),e=new(Oh.bt()?Oh:Lh),new Hh(t,n,r,s,e);var t,n,r,s}createSyncEngine(e,t){return function(e,t,n,r,s,i,o){const a=new Ru(e,t,n,r,s,i);return o&&(a.qo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;ur("RemoteStore","RemoteStore shutting down."),t.Kr.add(5),await Wh(t),t.Qr.shutdown(),t.Wr.set("Unknown")}(this.remoteStore)}}function Zu(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class ec{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Yo(this.observer.next,e)}error(e){this.observer.error?this.Yo(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Xo(){this.muted=!0}Yo(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class tc{constructor(e,t){this.Zo=e,this.N=t,this.metadata=new yr,this.buffer=new Uint8Array,this.ta=new TextDecoder("utf-8"),this.ea().then(e=>{e&&e.ho()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.Zo.cancel()}async getMetadata(){return this.metadata.promise}async Qo(){return await this.getMetadata(),this.ea()}async ea(){var e=await this.na();if(null===e)return null;var t=this.ta.decode(e),n=Number(t);return isNaN(n)&&this.sa(`length string (${t}) is not valid number`),t=await this.ia(n),new Iu(JSON.parse(t),e.length+n)}ra(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async na(){for(;this.ra()<0&&!await this.oa(););if(0===this.buffer.length)return null;var e=this.ra();e<0&&this.sa("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async ia(e){for(;this.buffer.length<e;)await this.oa()&&this.sa("Reached the end of bundle when more is expected.");var t=this.ta.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}sa(e){throw this.Zo.cancel(),new Error(`Invalid bundle format: ${e}`)}async oa(){var e=await this.Zo.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class nc{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new pr(mr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=no(r.N)+"/documents",s={documents:t.map(e=>Xi(r.N,e))},i=await r.Ki("BatchGetDocuments",n,s),o=new Map;i.forEach(e=>{const t=(n=r.N,"found"in e?function(e,t){gr(!!t.found),t.found.name,t.found.updateTime;var n=Zi(e,t.found.name),e=Wi(t.found.updateTime),t=new us({mapValue:{fields:t.found.fields}});return cs.newFoundDocument(n,e,t)}(n,e):"missing"in e?(n=n,gr(!!(e=e).missing),gr(!!e.readTime),n=Zi(n,e.missing),e=Wi(e.readTime),cs.newNoDocument(n,e)):fr());var n;o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{gr(!!(e=o.get(e.toString()))),a.push(e)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new vi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{t=Wr.fromPath(t),this.mutations.push(new bi(t,this.precondition(t)))}),await async function(e,t){const n=e,r=no(n.N)+"/documents",s={writes:t.map(e=>oo(n.N,e))};await n.Li("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw fr();t=xr.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new pr(mr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?ai.updateTime(t):ai.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return ai.exists(!0);if(t.isEqual(xr.min()))throw new pr(mr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ai.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class rc{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.aa=5,this.rr=new Bh(this.asyncQueue,"transaction_retry")}run(){--this.aa,this.ca()}ca(){this.rr.Xi(async()=>{const t=new nc(this.datastore),e=this.ua(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.ha(e)}))}).catch(e=>{this.ha(e)})})}ua(e){try{var t=this.updateFunction(e);return!zr(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ha(e){0<this.aa&&this.la(e)?(--this.aa,this.asyncQueue.enqueueAndForget(()=>(this.ca(),Promise.resolve()))):this.deferred.reject(e)}la(e){return"FirebaseError"===e.name&&("aborted"===(e=e.code)||"failed-precondition"===e||!Ei(e))}}class sc{constructor(e,t,n){this.credentials=e,this.asyncQueue=t,this.databaseInfo=n,this.user=ir.UNAUTHENTICATED,this.clientId=Sr.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(t,async e=>{ur("FirestoreClient","Received user=",e.uid),await this.credentialListener(e),this.user=e})}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.credentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new pr(mr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new yr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.shutdown(),n.resolve()}catch(e){var t=fu(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function ic(e,t){e.asyncQueue.verifyOperationInProgress(),ur("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await ih(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function oc(e,t){e.asyncQueue.verifyOperationInProgress();var n=await ac(e);ur("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>async function(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),ur("RemoteStore","RemoteStore received new credentials"),e=nu(n),n.Kr.add(3),await Wh(n),e&&n.Wr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Kr.delete(3),await Qh(n)}(t.remoteStore,e)),e.onlineComponents=t}async function ac(e){return e.offlineComponents||(ur("FirestoreClient","Using default OfflineComponentProvider"),await ic(e,new Wu)),e.offlineComponents}async function hc(e){return e.onlineComponents||(ur("FirestoreClient","Using default OnlineComponentProvider"),await oc(e,new Xu)),e.onlineComponents}function uc(e){return ac(e).then(e=>e.persistence)}function cc(e){return ac(e).then(e=>e.localStore)}function lc(e){return hc(e).then(e=>e.remoteStore)}function dc(e){return hc(e).then(e=>e.syncEngine)}async function fc(e){const t=await hc(e),n=t.eventManager;return n.onListen=async function(e,t){const n=Hu(e);let r,s;const i=n.xo.get(t);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.Do();else{const e=await hh(n.localStore,Us(t)),i=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,s=await Lu(n,t,r,"current"===i),n.isPrimaryClient&&Yh(n.remoteStore,e)}return s}.bind(null,t.syncEngine),n.onUnlisten=async function(e,t){const n=e,r=n.xo.get(t),s=n.ko.get(r.targetId);if(1<s.length)return n.ko.set(r.targetId,s.filter(e=>!Bs(e,t))),void n.xo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await uh(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),Jh(n.remoteStore,r.targetId),Uu(n,r.targetId)}).catch(Ra)):(Uu(n,r.targetId),await uh(n.localStore,r.targetId,!0))}.bind(null,t.syncEngine),n}function gc(e,t,n={}){const r=new yr;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,s,i,o){const e=new ec({next:e=>{r.enqueueAndForget(()=>bu(n,a));var t=e.docs.has(s);!t&&e.fromCache?o.reject(new pr(mr.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&i&&"server"===i.source?o.reject(new pr(mr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):o.resolve(e)},error:e=>o.reject(e)}),a=new Eu(Rs(s.path),e,{includeMetadataChanges:!0,uo:!0});return vu(n,a)}(await fc(e),e.asyncQueue,t,n,r)),r.promise}function mc(e,t,n={}){const r=new yr;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,s){const i=new ec({next:e=>{n.enqueueAndForget(()=>bu(t,o)),e.fromCache&&"server"===r.source?s.reject(new pr(mr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(e)},error:e=>s.reject(e)}),o=new Eu(e,i,{includeMetadataChanges:!0,uo:!0});return vu(t,o)}(await fc(e),e.asyncQueue,t,n,r)),r.promise}function pc(e,t,n,r){const s=(n=n,t=qh(t),n=function(e){if(e instanceof Uint8Array)return Zu(e,void 0);if(e instanceof ArrayBuffer)return Zu(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n="string"==typeof n?(new TextEncoder).encode(n):n),new tc(n,t));e.asyncQueue.enqueueAndForget(async()=>{!function(e,t){const n=e;!async function(t,n,r){try{var s=await n.getMetadata();if(await function(e,t){const n=e,r=Wi(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Je.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,s))return await n.close(),void r._completeWith({taskState:"Success",documentsLoaded:s.totalDocuments,bytesLoaded:s.totalBytes,totalDocuments:s.totalDocuments,totalBytes:s.totalBytes});r._updateProgress(Nu(s));const o=new Su(s,t.localStore,n.N);let e=await n.Qo();for(;e;){const t=await o.fo(e);t&&r._updateProgress(t),e=await n.Qo()}var i=await o.complete();await Ku(t,i.En,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Je.saveBundleMetadata(e,t))}(t.localStore,s),r._completeWith(i.progress)}catch(t){lr("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t)}}(n,t,r).then(()=>{n.sharedClientState.notifyBundleLoaded()})}(await dc(e),s)})}class yc{constructor(e,t,n,r,s,i,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class wc{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof wc&&e.projectId===this.projectId&&e.database===this.database}}const vc=new Map;function bc(e,t,n){if(!n)throw new pr(mr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Tc(e,t,n,r){if(!0===t&&!0===r)throw new pr(mr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Ec(e){if(!Wr.isDocumentKey(e))throw new pr(mr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Ic(e){if(Wr.isDocumentKey(e))throw new pr(mr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function _c(e){return void 0===e?"undefined":null===e?"null":"string"==typeof e?(20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e)):"number"==typeof e||"boolean"==typeof e?""+e:"object"!=typeof e?"function"==typeof e?"a function":fr():e instanceof Array?"an array":(e=e.constructor?e.constructor.name:null)?`a custom ${e} object`:"an object"}function Sc(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new pr(mr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");throw e=_c(e),new pr(mr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}function Nc(e,t){if(t<=0)throw new pr(mr.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Ac{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new pr(mr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new pr(mr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Tc("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Dc{constructor(e,t){this._credentials=t,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ac({}),this._settingsFrozen=!1,e instanceof wc?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new pr(mr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new wc(e.options.projectId)}(e))}get app(){if(!this._app)throw new pr(mr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new pr(mr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ac(e),void 0!==e.credentials&&(this._credentials=function(e){if(!e)return new vr;switch(e.type){case"gapi":var t=e.client;return gr(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new Ir(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new pr(mr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=vc.get(e);t&&(ur("ComponentProvider","Removing Datastore"),vc.delete(e),t.terminate())}(this),Promise.resolve()}}class Cc{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new kc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Cc(this.firestore,e,this._key)}}class xc{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new xc(this.firestore,e,this._query)}}class kc extends xc{constructor(e,t,n){super(e,t,Rs(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Cc(this.firestore,null,new Wr(e))}withConverter(e){return new kc(this.firestore,e,this._path)}}function Rc(e,t,...n){if(e=f(e),bc("collection","path",t),e instanceof Dc){var r=Mr.fromString(t,...n);return Ic(r),new kc(e,null,r)}if(!(e instanceof Cc||e instanceof kc))throw new pr(mr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Ic(n=e._path.child(Mr.fromString(t,...n))),new kc(e.firestore,null,n)}function Lc(e,t,...n){if(e=f(e),bc("doc","path",t=1===arguments.length?Sr.I():t),e instanceof Dc){var r=Mr.fromString(t,...n);return Ec(r),new Cc(e,null,new Wr(r))}if(!(e instanceof Cc||e instanceof kc))throw new pr(mr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Ec(n=e._path.child(Mr.fromString(t,...n))),new Cc(e.firestore,e instanceof kc?e.converter:null,new Wr(n))}function Oc(e,t){return e=f(e),t=f(t),(e instanceof Cc||e instanceof kc)&&(t instanceof Cc||t instanceof kc)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Mc(e,t){return e=f(e),t=f(t),e instanceof xc&&t instanceof xc&&e.firestore===t.firestore&&Bs(e._query,t._query)&&e.converter===t.converter}class Fc{constructor(){this.fa=Promise.resolve(),this.da=[],this.wa=!1,this._a=[],this.ma=null,this.ga=!1,this.ya=!1,this.pa=[],this.rr=new Bh(this,"async_queue_retry"),this.Ta=()=>{var e=Uh();e&&ur("AsyncQueue","Visibility state changed to "+e.visibilityState),this.rr.tr()};const e=Uh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ta)}get isShuttingDown(){return this.wa}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ea(),this.Ia(e)}enterRestrictedMode(e){if(!this.wa){this.wa=!0,this.ya=e||!1;const t=Uh();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ta)}}enqueue(e){if(this.Ea(),this.wa)return new Promise(()=>{});const t=new yr;return this.Ia(()=>this.wa&&this.ya?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.da.push(e),this.Aa()))}async Aa(){if(0!==this.da.length){try{await this.da[0](),this.da.shift(),this.rr.reset()}catch(e){if(!$o(e))throw e;ur("AsyncQueue","Operation failed with retryable error: "+e)}0<this.da.length&&this.rr.Xi(()=>this.Aa())}}Ia(e){var t=this.fa.then(()=>(this.ga=!0,e().catch(e=>{throw this.ma=e,this.ga=!1,cr("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.ga=!1,e))));return this.fa=t}enqueueAfterDelay(e,t,n){return this.Ea(),-1<this.pa.indexOf(e)&&(t=0),n=du.createAndSchedule(this,e,t,n,e=>this.Ra(e)),this._a.push(n),n}Ea(){this.ma&&fr()}verifyOperationInProgress(){}async ba(){for(var e;await(e=this.fa),e!==this.fa;);}Pa(e){for(const t of this._a)if(t.timerId===e)return!0;return!1}va(t){return this.ba().then(()=>{this._a.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this._a)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.ba()})}Va(e){this.pa.push(e)}Ra(e){e=this._a.indexOf(e),this._a.splice(e,1)}}function Pc(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class Vc{constructor(){this._progressObserver={},this._taskCompletionResolver=new yr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Uc extends Dc{constructor(e,t){super(e,t),this.type="firestore",this._queue=new Fc,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Bc(this),this._firestoreClient.terminate()}}function qc(e){return e._firestoreClient||Bc(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Bc(e){var t,n,r,s=e._freezeSettings(),s=(t=e._databaseId,n=(null===(r=e._app)||void 0===r?void 0:r.options.appId)||"",r=e._persistenceKey,new yc(t,n,r,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));e._firestoreClient=new sc(e._credentials,e._queue,s)}function jc(e,n,r){const s=new yr;return e.asyncQueue.enqueue(async()=>{try{await ic(e,r),await oc(e,n),s.resolve()}catch(e){if(!("FirebaseError"===(t=e).name?t.code===mr.FAILED_PRECONDITION||t.code===mr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),s.reject(e)}var t}).then(()=>s.promise)}function Kc(e){if(e._initialized||e._terminated)throw new pr(mr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class $c{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new pr(mr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pr(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Gc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Gc(Ur.fromBase64String(e))}catch(e){throw new pr(mr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Gc(Ur.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class zc{constructor(e){this._methodName=e}}class Hc{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new pr(mr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new pr(mr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Nr(this._lat,e._lat)||Nr(this._long,e._long)}}const Qc=/^__.*__$/;class Wc{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new mi(e,this.data,this.fieldMask,t,this.fieldTransforms):new gi(e,this.data,t,this.fieldTransforms)}}class Yc{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new mi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Jc(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw fr()}}class Xc{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.N=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Sa(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Da(){return this.settings.Da}Ca(e){return new Xc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Na(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Ca({path:n,xa:!1});return r.ka(e),r}$a(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Ca({path:n,xa:!1});return r.Sa(),r}Oa(e){return this.Ca({path:void 0,xa:!0})}Fa(e){return wl(e,this.settings.methodName,this.settings.Ma||!1,this.path,this.settings.La)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Sa(){if(this.path)for(let e=0;e<this.path.length;e++)this.ka(this.path.get(e))}ka(e){if(0===e.length)throw this.Fa("Document fields must not be empty");if(Jc(this.Da)&&Qc.test(e))throw this.Fa('Document fields cannot begin and end with "__"')}}class Zc{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.N=n||qh(e)}Ba(e,t,n,r=!1){return new Xc({Da:e,methodName:t,La:n,path:Pr.emptyPath(),xa:!1,Ma:r},this.databaseId,this.N,this.ignoreUndefinedProperties)}}function el(e){var t=e._freezeSettings(),n=qh(e._databaseId);return new Zc(e._databaseId,!!t.ignoreUndefinedProperties,n)}function tl(e,t,n,r,s,i={}){const o=e.Ba(i.merge||i.mergeFields?2:0,t,n,s);gl("Data must be an object, but it was:",o,r),r=dl(r,o);let a,h;if(i.merge)a=new Vr(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const u of i.mergeFields){const s=ml(t,u,n);if(!o.contains(s))throw new pr(mr.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);vl(e,s)||e.push(s)}a=new Vr(e),h=o.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,h=o.fieldTransforms;return new Wc(new us(r),a,h)}class nl extends zc{_toFieldTransform(e){if(2!==e.Da)throw 1===e.Da?e.Fa(`${this._methodName}() can only appear at the top level of your update data`):e.Fa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof nl}}function rl(e,t,n){return new Xc({Da:3,La:t.settings.La,methodName:e._methodName,xa:n},t.databaseId,t.N,t.ignoreUndefinedProperties)}class sl extends zc{_toFieldTransform(e){return new ii(e.path,new Js)}isEqual(e){return e instanceof sl}}class il extends zc{constructor(e,t){super(e),this.Ua=t}_toFieldTransform(e){const t=rl(this,e,!0),n=this.Ua.map(e=>ll(e,t)),r=new Xs(n);return new ii(e.path,r)}isEqual(e){return this===e}}class ol extends zc{constructor(e,t){super(e),this.Ua=t}_toFieldTransform(e){const t=rl(this,e,!0),n=this.Ua.map(e=>ll(e,t)),r=new ei(n);return new ii(e.path,r)}isEqual(e){return this===e}}class al extends zc{constructor(e,t){super(e),this.qa=t}_toFieldTransform(e){var t=new ni(e.N,Qs(e.N,this.qa));return new ii(e.path,t)}isEqual(e){return this===e}}function hl(e,r,s,t){const i=e.Ba(1,r,s);gl("Data must be an object, but it was:",i,t);const o=[],a=us.empty();return Rr(t,(e,t)=>{var n=yl(r,e,s);t=f(t),e=i.$a(n),t instanceof nl?o.push(n):null!=(e=ll(t,e))&&(o.push(n),a.set(n,e))}),t=new Vr(o),new Yc(a,t,i.fieldTransforms)}function ul(t,n,e,r,s,i){const o=t.Ba(1,n,e),a=[ml(n,r,e)],h=[s];if(i.length%2!=0)throw new pr(mr.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<i.length;e+=2)a.push(ml(n,i[e])),h.push(i[e+1]);const u=[],c=us.empty();for(let e=a.length-1;0<=e;--e)if(!vl(u,a[e])){const n=a[e];var l=f(h[e]);const r=o.$a(n);if(l instanceof nl)u.push(n);else{const t=ll(l,r);null!=t&&(u.push(n),c.set(n,t))}}return s=new Vr(u),new Yc(c,s,o.fieldTransforms)}function cl(e,t,n,r=!1){return ll(n,e.Ba(r?4:3,t))}function ll(i,e){if(fl(i=f(i)))return gl("Unsupported field value:",e,i),dl(i,e);if(i instanceof zc)return function(e,t){if(!Jc(t.Da))throw t.Fa(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Fa(`${e._methodName}() is not currently supported inside arrays`);(e=e._toFieldTransform(t))&&t.fieldTransforms.push(e)}(i,e),null;if(void 0===i&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.xa&&4!==e.Da)throw e.Fa("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const s of i){let e=ll(s,t.Oa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=f(i)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Qs(t.N,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=Cr.fromDate(e);return{timestampValue:Hi(t.N,n)}}if(e instanceof Cr)return n=new Cr(e.seconds,1e3*Math.floor(e.nanoseconds/1e3)),{timestampValue:Hi(t.N,n)};if(e instanceof Hc)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Gc)return{bytesValue:Qi(t.N,e._byteString)};if(e instanceof Cc){const r=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(r))throw t.Fa(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Yi(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Fa(`Unsupported field value: ${_c(e)}`)}(0,e)}function dl(e,n){const r={};return Lr(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):Rr(e,(e,t)=>{null!=(t=ll(t,n.Na(e)))&&(r[e]=t)}),{mapValue:{fields:r}}}function fl(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Cr||e instanceof Hc||e instanceof Gc||e instanceof Cc||e instanceof zc)}function gl(e,t,n){if(!fl(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(n=_c(n))?t.Fa(e+" a custom object"):t.Fa(e+" "+n);var r}function ml(e,t,n){if((t=f(t))instanceof $c)return t._internalPath;if("string"==typeof t)return yl(e,t);throw wl("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}const pl=new RegExp("[~\\*/\\[\\]]");function yl(t,n,r){if(0<=n.search(pl))throw wl(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new $c(...n.split("."))._internalPath}catch(e){throw wl(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function wl(e,t,n,r,s){var i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let h="";return(i||o)&&(h+=" (found",i&&(h+=` in field ${r}`),o&&(h+=` in document ${s}`),h+=")"),new pr(mr.INVALID_ARGUMENT,a+e+h)}function vl(e,t){return e.some(e=>e.isEqual(t))}class bl{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Cc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new Tl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document&&null!==(e=this._document.data.field(El("DocumentSnapshot.get",e))))return this._userDataWriter.convertValue(e)}}class Tl extends bl{data(){return super.data()}}function El(e,t){return"string"==typeof t?yl(e,t):(t instanceof $c?t:t._delegate)._internalPath}class Il{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _l extends bl{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new Sl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document&&null!==(e=this._document.data.field(El("DocumentSnapshot.get",e))))return this._userDataWriter.convertValue(e,t.serverTimestamps)}}class Sl extends _l{data(e={}){return super.data(e)}}class Nl{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Il(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new Sl(this._firestore,this._userDataWriter,e.key,e,new Il(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){if((e=!!e.includeMetadataChanges)&&this._snapshot.excludesMetadataChanges)throw new pr(mr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,t){if(i._snapshot.oldDocs.isEmpty()){let t=0;return i._snapshot.docChanges.map(e=>({type:"added",doc:new Sl(i._firestore,i._userDataWriter,e.doc.key,e.doc,new Il(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:t++}))}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new Sl(i._firestore,i._userDataWriter,e.doc.key,e.doc,new Il(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=s.indexOf(e.doc.key),s=s.delete(e.doc.key)),1!==e.type&&(s=s.add(e.doc),r=s.indexOf(e.doc.key)),{type:function(){switch(e.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fr()}}(),doc:t,oldIndex:n,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Al(e,t){return e instanceof _l&&t instanceof _l?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Nl&&t instanceof Nl&&e._firestore===t._firestore&&Mc(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Dl(e){if(Os(e)&&0===e.explicitOrderBy.length)throw new pr(mr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Cl{}function xl(e,...t){for(const n of t)e=n._apply(e);return e}class kl extends Cl{constructor(e,t,n){super(),this.Ka=e,this.ja=t,this.Qa=n,this.type="where"}_apply(e){var t=el(e.firestore),t=function(e,t,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new pr(mr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on FieldPath.documentId().`);if("in"===i||"not-in"===i){Vl(o,i);const t=[];for(const n of o)t.push(Pl(r,e,n));a={arrayValue:{values:t}}}else a=Pl(r,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Vl(o,i),a=cl(n,t,o,"in"===i||"not-in"===i);return function(e,t){if(t.v()){const r=Fs(e);if(null!==r&&!r.isEqual(t.field))throw new pr(mr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${t.field.toString()}'`);var n=Ms(e);null!==n&&Ul(0,t.field,n)}const r=function(e,t){for(const n of e.filters)if(0<=t.indexOf(n.op))return n.op;return null}(e,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new pr(mr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new pr(mr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}(e,i=ps.create(s,i,a)),i}(e._query,"where",t,e.firestore._databaseId,this.Ka,this.ja,this.Qa);return new xc(e.firestore,e.converter,(t=(e=e._query).filters.concat([t]),new xs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))}}class Rl extends Cl{constructor(e,t){super(),this.Ka=e,this.Wa=t,this.type="orderBy"}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new pr(mr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new pr(mr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new As(t,n);return t=r,null!==Ms(n=e)||null!==(e=Fs(n))&&Ul(0,e,t.field),r}(e._query,this.Ka,this.Wa);return new xc(e.firestore,e.converter,(t=(e=e._query).explicitOrderBy.concat([t]),new xs(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class Ll extends Cl{constructor(e,t,n){super(),this.type=e,this.Ga=t,this.za=n}_apply(e){return new xc(e.firestore,e.converter,qs(e._query,this.Ga,this.za))}}class Ol extends Cl{constructor(e,t,n){super(),this.type=e,this.Ha=t,this.Ja=n}_apply(e){var t=Fl(e,this.type,this.Ha,this.Ja);return new xc(e.firestore,e.converter,(e=e._query,new xs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)))}}class Ml extends Cl{constructor(e,t,n){super(),this.type=e,this.Ha=t,this.Ja=n}_apply(e){var t=Fl(e,this.type,this.Ha,this.Ja);return new xc(e.firestore,e.converter,(e=e._query,new xs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)))}}function Fl(e,t,n,r){if(n[0]=f(n[0]),n[0]instanceof bl)return function(e,t,n,r,s){if(!r)throw new pr(mr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of Vs(e))if(n.field.isKeyField())i.push(ns(t,r.key));else{const e=r.data.field(n.field);if($r(e))throw new pr(mr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new pr(mr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}i.push(e)}return new Ss(i,s)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var s=el(e.firestore);return function(t,n,r,s,i,e){const o=t.explicitOrderBy;if(i.length>o.length)throw new pr(mr.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let e=0;e<i.length;e++){const h=i[e];if(o[e].field.isKeyField()){if("string"!=typeof h)throw new pr(mr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof h}`);if(!Ps(t)&&-1!==h.indexOf("/"))throw new pr(mr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${s}() must be a plain document ID, but '${h}' contains a slash.`);const r=t.path.child(Mr.fromString(h));if(!Wr.isDocumentKey(r))throw new pr(mr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${s}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);const i=new Wr(r);a.push(ns(n,i))}else{const t=cl(r,s,h);a.push(t)}}return new Ss(a,e)}(e._query,e.firestore._databaseId,s,t,n,r)}function Pl(e,t,n){if("string"==typeof(n=f(n))){if(""===n)throw new pr(mr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ps(t)&&-1!==n.indexOf("/"))throw new pr(mr.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);if(t=t.path.child(Mr.fromString(n)),!Wr.isDocumentKey(t))throw new pr(mr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${t}' is not because it has an odd number of segments (${t.length}).`);return ns(e,new Wr(t))}if(n instanceof Cc)return ns(e,n._key);throw new pr(mr.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${_c(n)}.`)}function Vl(e,t){if(!Array.isArray(e)||0===e.length)throw new pr(mr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new pr(mr.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function Ul(e,t,n){if(!n.isEqual(t))throw new pr(mr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class ql{convertValue(e,t="none"){switch(Yr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return jr(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Kr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw fr()}}convertObject(e,n){const r={};return Rr(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new Hc(jr(e.latitude),jr(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){return $r(t=t.mapValue.fields.__previous_value__)?e(t):t}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Gr(e));default:return null}}convertTimestamp(e){return e=Br(e),new Cr(e.seconds,e.nanos)}convertDocumentKey(e,t){const n=Mr.fromString(e);gr(po(n));const r=new wc(n.get(1),n.get(3)),s=new Wr(n.popFirst(5));return r.isEqual(t)||cr(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Bl(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class jl extends ql{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gc(e)}convertReference(e){return e=this.convertDocumentKey(e,this.firestore._databaseId),new Cc(this.firestore,null,e)}}class Kl{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=el(e)}set(e,t,n){this._verifyNotCommitted();const r=$l(e,this._firestore),s=Bl(r.converter,t,n),i=tl(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,ai.none())),this}update(e,t,n,...r){this._verifyNotCommitted(),e=$l(e,this._firestore);let s;return s="string"==typeof(t=f(t))||t instanceof $c?ul(this._dataReader,"WriteBatch.update",e._key,t,n,r):hl(this._dataReader,"WriteBatch.update",e._key,t),this._mutations.push(s.toMutation(e._key,ai.exists(!0))),this}delete(e){return this._verifyNotCommitted(),e=$l(e,this._firestore),this._mutations=this._mutations.concat(new vi(e._key,ai.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new pr(mr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function $l(e,t){if((e=f(e)).firestore!==t)throw new pr(mr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Gl extends ql{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gc(e)}convertReference(e){return e=this.convertDocumentKey(e,this.firestore._databaseId),new Cc(this.firestore,null,e)}}function zl(e,t,n){e=Sc(e,Cc);var r=Sc(e.firestore,Uc),t=Bl(e.converter,t,n);return Wl(r,[tl(el(r),"setDoc",e._key,t,null!==e.converter,n).toMutation(e._key,ai.none())])}function Hl(e,t,n,...r){e=Sc(e,Cc);var s=Sc(e.firestore,Uc),i=el(s);let o;return o="string"==typeof(t=f(t))||t instanceof $c?ul(i,"updateDoc",e._key,t,n,r):hl(i,"updateDoc",e._key,t),Wl(s,[o.toMutation(e._key,ai.exists(!0))])}function Ql(t,...n){var e;t=f(t);let r={includeMetadataChanges:!1},s=0;"object"!=typeof n[s]||Pc(n[s])||(r=n[s],s++);var i={includeMetadataChanges:r.includeMetadataChanges};if(Pc(n[s])){const t=n[s];n[s]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[s+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[s+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let o,a,h;if(t instanceof Cc)a=Sc(t.firestore,Uc),h=Rs(t._key.path),o={next:e=>{n[s]&&n[s](Yl(a,t,e))},error:n[s+1],complete:n[s+2]};else{const u=Sc(t,xc);a=Sc(u.firestore,Uc),h=u._query;const c=new Gl(a);o={next:e=>{n[s]&&n[s](new Nl(a,c,u,e))},error:n[s+1],complete:n[s+2]},Dl(t._query)}return function(e,t,n,r){const s=new ec(r),i=new Eu(t,s,n);return e.asyncQueue.enqueueAndForget(async()=>vu(await fc(e),i)),()=>{s.Xo(),e.asyncQueue.enqueueAndForget(async()=>bu(await fc(e),i))}}(qc(a),h,i,o)}function Wl(e,t){return function(e,t){const n=new yr;return e.asyncQueue.enqueueAndForget(async()=>Ou(await dc(e),t,n)),n.promise}(qc(e),t)}function Yl(e,t,n){var r=n.docs.get(t._key),s=new Gl(e);return new _l(e,s,t._key,r,new Il(n.hasPendingWrites,n.fromCache),t.converter)}class Jl extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=el(e)}get(e){const n=$l(e,this._firestore),r=new jl(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return fr();const t=e[0];if(t.isFoundDocument())return new bl(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new bl(this._firestore,r,n._key,null,n.converter);throw fr()})}set(e,t,n){return t=Bl((e=$l(e,this._firestore)).converter,t,n),n=tl(this._dataReader,"Transaction.set",e._key,t,null!==e.converter,n),this._transaction.set(e._key,n),this}update(e,t,n,...r){return e=$l(e,this._firestore),t="string"==typeof(t=f(t))||t instanceof $c?ul(this._dataReader,"Transaction.update",e._key,t,n,r):hl(this._dataReader,"Transaction.update",e._key,t),this._transaction.update(e._key,t),this}delete(e){return e=$l(e,this._firestore),this._transaction.delete(e._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=$l(e,this._firestore),n=new Gl(this._firestore);return super.get(e).then(e=>new _l(this._firestore,n,t._key,e._document,new Il(!1,!1),t.converter))}}function Xl(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new pr("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function Zl(){if("undefined"==typeof Uint8Array)throw new pr("unimplemented","Uint8Arrays are not available in this environment.")}function ed(){if("undefined"==typeof atob)throw new pr("unimplemented","Blobs are unavailable in Firestore in this environment.")}We=_d.SDK_VERSION,or=We,_d._registerComponent(new s("firestore",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=new Uc(n,new Tr(e.getProvider("auth-internal")));return t=Object.assign({useFetchStreams:!0},t),r._setSettings(t),r},"PUBLIC")),_d.registerVersion("@firebase/firestore","3.1.0",void 0);class td{constructor(e){this._delegate=e}static fromBase64String(e){return ed(),new td(Gc.fromBase64String(e))}static fromUint8Array(e){return Zl(),new td(Gc.fromUint8Array(e))}toBase64(){return ed(),this._delegate.toBase64()}toUint8Array(){return Zl(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function nd(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const n of["next","error","complete"])if(n in t&&"function"==typeof t[n])return 1}}(e)}class rd{enableIndexedDbPersistence(e,t){return function(e,t){Kc(e=Sc(e,Uc));var n=qc(e),r=e._freezeSettings();return jc(n,e=new Xu,new Yu(e,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){Kc(e=Sc(e,Uc));var t=qc(e),n=e._freezeSettings();return jc(t,e=new Xu,new Ju(e,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(t){if(t._initialized&&!t._terminated)throw new pr(mr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const n=new yr;return t._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{e=Xa(t._databaseId,t._persistenceKey),await(Bo.bt()?(e+="main",void await Bo.delete(e)):Promise.resolve()),n.resolve()}catch(e){n.reject(e)}var e}),n.promise}(e._delegate)}}class sd{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof wc||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||lr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(n,e,r,s={}){const i=(n=Sc(n,Dc))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&lr("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${r}`,ssl:!1})),s.mockUserToken){let e,t;if("string"==typeof s.mockUserToken)e=s.mockUserToken,t=ir.MOCK_USER;else{e=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0;if(!(t=e.sub||e.user_id))throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return e=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:t,user_id:t,firebase:{sign_in_provider:"custom",identities:{}}},e),[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(e)),""].join(".")}(s.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const i=s.mockUserToken.sub||s.mockUserToken.user_id;if(!i)throw new pr(mr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new ir(i)}n._credentials=new br(new wr(e,t))}}(this._delegate,e,t,n)}enableNetwork(){return e=this._delegate,(n=qc(e=Sc(e,Uc))).asyncQueue.enqueue(async()=>{const e=await uc(n),t=await lc(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.Kr.delete(0),Qh(e)}()});var e,n}disableNetwork(){return e=this._delegate,(n=qc(e=Sc(e,Uc))).asyncQueue.enqueue(async()=>{const e=await uc(n),t=await lc(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.Kr.add(0),await Wh(e),e.Wr.set("Offline")}()});var e,n}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Tc("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(e){const t=new yr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;nu(n.remoteStore)||ur("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.In.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.Bo.get(e)||[];r.push(t),n.Bo.set(e,r)}catch(e){const n=fu(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await dc(e),t)),t.promise}(qc(Sc(this._delegate,Uc)))}onSnapshotsInSync(e){return t=this._delegate,e=e,function(e,t){const n=new ec(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Zr.add(t),t.next()}(await fc(e),n)),()=>{n.Xo(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Zr.delete(t)}(await fc(e),n))}}(qc(t=Sc(t,Uc)),Pc(e)?e:{next:e});var t}get app(){if(!this._appCompat)throw new pr("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new wd(this,Rc(this._delegate,e))}catch(e){throw cd(e,"collection()","Firestore.collection()")}}doc(e){try{return new ud(this,Lc(this._delegate,e))}catch(e){throw cd(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new md(this,function(e,t){if(e=Sc(e,Dc),bc("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new pr(mr.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new xc(e,null,new xs(Mr.emptyPath(),t))}(this._delegate,e))}catch(e){throw cd(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return n=this._delegate,r=e=>t(new od(this,e)),function(t,n){const r=new yr;return t.asyncQueue.enqueueAndForget(async()=>{var e=await hc(t).then(e=>e.datastore);new rc(t.asyncQueue,e,n,r).run()}),r.promise}(qc(n),e=>r(new Jl(n,e)));var n,r}batch(){return qc(this._delegate),new ad(new Kl(this._delegate,e=>Wl(this._delegate,e)))}loadBundle(e){return n=e,r=qc(t=Sc(this._delegate,Uc)),e=new Vc,pc(r,t._databaseId,n,e),e;var t,n,r}namedQuery(e){return t=this._delegate,e=e,n=qc(t=Sc(t,Uc)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Je.getNamedQuery(e,t))}(await cc(n),r)).then(e=>e?new xc(t,null,e.query):null).then(e=>e?new md(this,e):null);var t,n,r}}class id extends ql{constructor(e){super(),this.firestore=e}convertBytes(e){return new td(new Gc(e))}convertReference(e){return e=this.convertDocumentKey(e,this.firestore._databaseId),ud.forKey(e,this.firestore,null)}}class od{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new id(e)}get(e){const t=vd(e);return this._delegate.get(t).then(e=>new fd(this._firestore,new _l(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){return e=vd(e),n?(Xl("Transaction.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){return e=vd(e),2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){return e=vd(e),this._delegate.delete(e),this}}class ad{constructor(e){this._delegate=e}set(e,t,n){return e=vd(e),n?(Xl("WriteBatch.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){return e=vd(e),2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){return e=vd(e),this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class hd{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){return e=new Sl(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null),this._delegate.fromFirestore(new gd(this._firestore,e),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=hd.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let s=r.get(t);return s||(s=new hd(e,new id(e),t),r.set(t,s)),s}}hd.INSTANCES=new WeakMap;class ud{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new id(e)}static forPath(e,t,n){if(e.length%2!=0)throw new pr("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new ud(t,new Cc(t._delegate,n,new Wr(e)))}static forKey(e,t,n){return new ud(t,new Cc(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new wd(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new wd(this.firestore,Rc(this._delegate,e))}catch(e){throw cd(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=f(e))instanceof Cc&&Oc(this._delegate,e)}set(e,t){t=Xl("DocumentReference.set",t);try{return t?zl(this._delegate,e,t):zl(this._delegate,e)}catch(e){throw cd(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?Hl(this._delegate,e):Hl(this._delegate,e,t,...n)}catch(e){throw cd(e,"updateDoc()","DocumentReference.update()")}}delete(){return Wl(Sc((e=this._delegate).firestore,Uc),[new vi(e._key,ai.none())]);var e}onSnapshot(...e){var t=ld(e),e=dd(e,e=>new fd(this.firestore,new _l(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return Ql(this._delegate,t,e)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?function(t){t=Sc(t,Cc);const n=Sc(t.firestore,Uc),e=qc(n),r=new Gl(n);return function(e,t){const n=new yr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.Qn.An(e,t))}(t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new pr(mr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){t=fu(e,`Failed to get document '${t} from cache`),n.reject(t)}}(await cc(e),t,n)),n.promise}(e,t._key).then(e=>new _l(n,r,t._key,e,new Il(null!==e&&e.hasLocalMutations,!0),t.converter))}:"server"===(null==e?void 0:e.source)?function(t){t=Sc(t,Cc);const n=Sc(t.firestore,Uc);return gc(qc(n),t._key,{source:"server"}).then(e=>Yl(n,t,e))}:function(t){t=Sc(t,Cc);const n=Sc(t.firestore,Uc);return gc(qc(n),t._key).then(e=>Yl(n,t,e))})(this._delegate),t.then(e=>new fd(this.firestore,new _l(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new ud(this.firestore,e?this._delegate.withConverter(hd.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function cd(e,t,n){return e.message=e.message.replace(t,n),e}function ld(e){for(const t of e)if("object"==typeof t&&!nd(t))return t;return{}}function dd(e,t){let n;return n=nd(e[0])?e[0]:nd(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{n.next&&n.next(t(e))},error:null===(e=n.error)||void 0===e?void 0:e.bind(n),complete:null===(e=n.complete)||void 0===e?void 0:e.bind(n)}}class fd{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new ud(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Al(this._delegate,e._delegate)}}class gd extends fd{data(e){return void 0!==(e=this._delegate.data(e))||fr(),e}}class md{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new id(e)}where(e,t,n){try{return new md(this.firestore,xl(this._delegate,(s=t,i=n,r=El("where",e),new kl(r,s,i))))}catch(e){throw cd(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,s,i}orderBy(e,t){try{return new md(this.firestore,xl(this._delegate,([n,r="asc"]=[e,t],n=El("orderBy",n),new Rl(n,r))))}catch(e){throw cd(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r}limit(e){try{return new md(this.firestore,xl(this._delegate,(Nc("limit",t=e),new Ll("limit",t,"F"))))}catch(e){throw cd(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new md(this.firestore,xl(this._delegate,(Nc("limitToLast",t=e),new Ll("limitToLast",t,"L"))))}catch(e){throw cd(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new md(this.firestore,xl(this._delegate,function(...e){return new Ol("startAt",e,!0)}(...e)))}catch(e){throw cd(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new md(this.firestore,xl(this._delegate,function(...e){return new Ol("startAfter",e,!1)}(...e)))}catch(e){throw cd(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new md(this.firestore,xl(this._delegate,function(...e){return new Ml("endBefore",e,!0)}(...e)))}catch(e){throw cd(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new md(this.firestore,xl(this._delegate,function(...e){return new Ml("endAt",e,!1)}(...e)))}catch(e){throw cd(e,"endAt()","Query.endAt()")}}isEqual(e){return Mc(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?function(t){t=Sc(t,xc);const n=Sc(t.firestore,Uc),e=qc(n),r=new Gl(n);return function(e,t){const n=new yr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await ch(e,t,!0),s=new Cu(t,r.Gn),i=s.Io(r.documents),o=s.applyChanges(i,!1);n.resolve(o.snapshot)}catch(e){t=fu(e,`Failed to execute query '${t} against cache`),n.reject(t)}}(await cc(e),t,n)),n.promise}(e,t._query).then(e=>new Nl(n,r,t,e))}:"server"===(null==e?void 0:e.source)?function(t){t=Sc(t,xc);const n=Sc(t.firestore,Uc),e=qc(n),r=new Gl(n);return mc(e,t._query,{source:"server"}).then(e=>new Nl(n,r,t,e))}:function(t){t=Sc(t,xc);const n=Sc(t.firestore,Uc),e=qc(n),r=new Gl(n);return Dl(t._query),mc(e,t._query).then(e=>new Nl(n,r,t,e))})(this._delegate),t.then(e=>new yd(this.firestore,new Nl(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=ld(e),e=dd(e,e=>new yd(this.firestore,new Nl(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return Ql(this._delegate,t,e)}withConverter(e){return new md(this.firestore,e?this._delegate.withConverter(hd.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class pd{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new gd(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class yd{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new md(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new gd(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new pd(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new gd(this._firestore,e))})}isEqual(e){return Al(this._delegate,e._delegate)}}class wd extends md{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new ud(this.firestore,e):null}doc(e){try{return void 0===e?new ud(this.firestore,Lc(this._delegate)):new ud(this.firestore,Lc(this._delegate,e))}catch(e){throw cd(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Sc(e.firestore,Uc),r=Lc(e),s=Bl(e.converter,t);return Wl(n,[tl(el(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,ai.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new ud(this.firestore,e))}isEqual(e){return Oc(this._delegate,e._delegate)}withConverter(e){return new wd(this.firestore,e?this._delegate.withConverter(hd.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function vd(e){return Sc(e,Cc)}var We={Firestore:sd,GeoPoint:Hc,Timestamp:Cr,Blob:td,Transaction:od,WriteBatch:ad,DocumentReference:ud,DocumentSnapshot:fd,Query:md,QueryDocumentSnapshot:gd,QuerySnapshot:yd,CollectionReference:wd,FieldPath:class Td{constructor(...e){this._delegate=new $c(...e)}static documentId(){return new Td(Pr.keyField().canonicalString())}isEqual(e){return(e=f(e))instanceof $c&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class Ed{constructor(e){this._delegate=e}static serverTimestamp(){const e=new sl("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Ed(e)}static delete(){const e=new nl("deleteField");return e._methodName="FieldValue.delete",new Ed(e)}static arrayUnion(...e){const t=function(...e){return new il("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new Ed(t)}static arrayRemove(...e){const t=function(...e){return new ol("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new Ed(t)}static increment(e){const t=new al("increment",e);return t._methodName="FieldValue.increment",new Ed(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){ar.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1},t=t.default,bd=(e,t)=>new sd(e,t,new rd);t.INTERNAL.registerComponent(new s("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("firestore").getImmediate();return bd(t,e)},"PUBLIC").setServiceProps(Object.assign({},We))),t.registerVersion("@firebase/firestore-compat","0.1.3")}.apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore-compat.js - be sure to load firebase-app.js first.")}});