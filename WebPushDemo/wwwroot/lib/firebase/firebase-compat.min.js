!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()}(this,function(){"use strict";function r(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function i(e){return"string"!=typeof e?String(e):e}function e(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return p&&(e[Symbol.iterator]=function(){return e}),e}function o(t){this.map={},t instanceof o?t.forEach(function(e,t){this.append(t,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function s(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function a(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function t(e){var t=new FileReader,n=a(t);return t.readAsArrayBuffer(e),n}function n(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function c(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e)if("string"==typeof e)this._bodyText=e;else if(f&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(g&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(d&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(m&&f&&v(e))this._bodyArrayBuffer=n(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!m||!ArrayBuffer.prototype.isPrototypeOf(e)&&!_(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=n(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):d&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},f&&(this.blob=function(){var e=s(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?s(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(t)}),this.text=function(){var e,t,n=s(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,n=a(t=new FileReader),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},g&&(this.formData=function(){return this.text().then(u)}),this.json=function(){return this.text().then(JSON.parse)},this}function l(e,t){var n,r=(t=t||{}).body;if(e instanceof l){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new o(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new o(t.headers)),this.method=(e=(n=t.method||this.method||"GET").toUpperCase(),-1<w.indexOf(e)?e:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function u(e){var n=new FormData;return e.trim().split("&").forEach(function(e){var t;e&&(e=(t=e.split("=")).shift().replace(/\+/g," "),t=t.join("=").replace(/\+/g," "),n.append(decodeURIComponent(e),decodeURIComponent(t)))}),n}function h(e,t){t=t||{},this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new o(t.headers),this.url=t.url||"",this._initBody(e)}var d,p,f,g,m,y,v,_,w,b;function I(e){try{return!!e()}catch(e){return!0}}function T(e){if(!D(e))throw TypeError(String(e)+" is not an object");return e}(nr="undefined"!=typeof self?self:void 0).fetch||(d="URLSearchParams"in nr,p="Symbol"in nr&&"iterator"in Symbol,f="FileReader"in nr&&"Blob"in nr&&function(){try{return new Blob,!0}catch(e){return!1}}(),g="FormData"in nr,(m="ArrayBuffer"in nr)&&(y=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],v=function(e){return e&&DataView.prototype.isPrototypeOf(e)},_=ArrayBuffer.isView||function(e){return e&&-1<y.indexOf(Object.prototype.toString.call(e))}),o.prototype.append=function(e,t){e=r(e),t=i(t);var n=this.map[e];this.map[e]=n?n+","+t:t},o.prototype.delete=function(e){delete this.map[r(e)]},o.prototype.get=function(e){return e=r(e),this.has(e)?this.map[e]:null},o.prototype.has=function(e){return this.map.hasOwnProperty(r(e))},o.prototype.set=function(e,t){this.map[r(e)]=i(t)},o.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},o.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),e(n)},o.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),e(t)},o.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),e(n)},p&&(o.prototype[Symbol.iterator]=o.prototype.entries),w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],l.prototype.clone=function(){return new l(this,{body:this._bodyInit})},c.call(l.prototype),c.call(h.prototype),h.prototype.clone=function(){return new h(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},h.error=function(){var e=new h(null,{status:0,statusText:""});return e.type="error",e},b=[301,302,303,307,308],h.redirect=function(e,t){if(-1===b.indexOf(t))throw new RangeError("Invalid status code");return new h(null,{status:t,headers:{location:e}})},nr.Headers=o,nr.Request=l,nr.Response=h,nr.fetch=function(n,s){return new Promise(function(r,e){var t=new l(n,s),i=new XMLHttpRequest;i.onload=function(){var n,e={status:i.status,statusText:i.statusText,headers:(t=i.getAllResponseHeaders()||"",n=new o,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var t=e.split(":");(e=t.shift().trim())&&(t=t.join(":").trim(),n.append(e,t))}),n)};e.url="responseURL"in i?i.responseURL:e.headers.get("X-Request-URL");var t="response"in i?i.response:i.responseText;r(new h(t,e))},i.onerror=function(){e(new TypeError("Network request failed"))},i.ontimeout=function(){e(new TypeError("Network request failed"))},i.open(t.method,t.url,!0),"include"===t.credentials?i.withCredentials=!0:"omit"===t.credentials&&(i.withCredentials=!1),"responseType"in i&&f&&(i.responseType="blob"),t.headers.forEach(function(e,t){i.setRequestHeader(t,e)}),i.send(void 0===t._bodyInit?null:t._bodyInit)})},nr.fetch.polyfill=!0);var E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S=(Pt=function(e){return e&&e.Math==Math&&e})("object"==typeof globalThis&&globalThis)||Pt("object"==typeof window&&window)||Pt("object"==typeof self&&self)||Pt("object"==typeof E&&E)||Function("return this")(),k={exports:{}},C=!I(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),A={},N=WE=function(e){return"object"==typeof e?null!==e:"function"==typeof e},R=S.document,P=N(R)&&N(R.createElement),x=pi=function(e){return P?R.createElement(e):{}},O=!C&&!I(function(){return 7!=Object.defineProperty(x("div"),"a",{get:function(){return 7}}).a}),D=WE,L=WE,M=O,F=T,U=pc=function(e,t){if(!L(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!L(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!L(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!L(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},q=Object.defineProperty;A.f=C?q:function(e,t,n){if(F(e),t=U(t,!0),F(n),M)try{return q(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var j=A,V=fc=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},B=S,K=mc=C?function(e,t,n){return j.f(e,t,V(1,n))}:function(e,t,n){return e[t]=n,e},z=ar=function(t,n){try{K(B,t,n)}catch(e){B[t]=n}return n},$=un=S[Vt="__core-js_shared__"]||z(Vt,{});function W(e,t){return G.call(e,t)}function H(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++Q+Y).toString(36)}(k.exports=function(e,t){return $[e]||($[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"});var G={}.hasOwnProperty,Q=0,Y=Math.random(),J=I,X=(nc=!!Object.getOwnPropertySymbols&&!J(function(){return!String(Symbol())}))&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Z=S,ee=k.exports,te=W,ne=H,re=nc,ie=X,se=ee("wks"),oe=Z.Symbol,ae=ie?oe:oe&&oe.withoutSetter||ne;(an={})[(Ic=function(e){return te(se,e)||(re&&te(oe,e)?se[e]=oe[e]:se[e]=ae("Symbol."+e)),se[e]})("toStringTag")]="z";var ce="[object z]"===String(an),le={exports:{}},ue=un,he=Function.toString;"function"!=typeof ue.inspectSource&&(ue.inspectSource=function(e){return he.call(e)});var de,pe,fe,ge,me,ye,ve,_e=Zi=ue.inspectSource,we="function"==typeof(pn=S.WeakMap)&&/native code/.test(_e(pn)),be=k.exports,Ie=H,Te=be("keys"),Ee=WE,Se=mc,ke=W,Ce=bc=function(e){return Te[e]||(Te[e]=Ie(e))},Ae=Xc={},Ne=S.WeakMap,Re=we?(de=new Ne,pe=de.get,fe=de.has,ge=de.set,me=function(e,t){return ge.call(de,e,t),t},ye=function(e){return pe.call(de,e)||{}},function(e){return fe.call(de,e)}):(Ae[ve=Ce("state")]=!0,me=function(e,t){return Se(e,ve,t),t},ye=function(e){return ke(e,ve)?e[ve]:{}},function(e){return ke(e,ve)}),Pe={set:me,get:ye,has:Re,enforce:function(e){return Re(e)?ye(e):me(e,{})},getterFor:function(n){return function(e){var t;if(!Ee(e)||(t=ye(e)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return t}}},xe=S,Oe=mc,De=W,Le=ar,Me=Zi,Fe=Pe.get,Ue=Pe.enforce,qe=String(String).split("String");(le.exports=function(e,t,n,r){var i=!!r&&!!r.unsafe,s=!!r&&!!r.enumerable,r=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof t||De(n,"name")||Oe(n,"name",t),Ue(n).source=qe.join("string"==typeof t?t:"")),e!==xe?(i?!r&&e[t]&&(s=!0):delete e[t],s?e[t]=n:Oe(e,t,n)):s?e[t]=n:Le(t,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&Fe(this).source||Me(this)});var je={}.toString,Ve=ce,Be=wa=function(e){return je.call(e).slice(8,-1)},Ke=Ic("toStringTag"),ze="Arguments"==Be(function(){return arguments}()),$e=Ve?Be:function(e){var t;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(e=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Ke))?e:ze?Be(t):"Object"==(e=Be(t))&&"function"==typeof t.callee?"Arguments":e},We=$e,He=le.exports;ce||He(Object.prototype,"toString",ce?{}.toString:function(){return"[object "+We(this)+"]"},{unsafe:!0});var Ge=Math.ceil,Qe=Math.floor,Ye=Pa=function(e){return isNaN(e=+e)?0:(0<e?Qe:Ge)(e)},Je=xa=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},Xe={codeAt:(On=function(s){return function(e,t){var n,r=String(Je(e)),i=Ye(t),e=r.length;return i<0||e<=i?s?"":void 0:(t=r.charCodeAt(i))<55296||56319<t||i+1===e||(n=r.charCodeAt(i+1))<56320||57343<n?s?r.charAt(i):t:s?r.slice(i,i+2):n-56320+(t-55296<<10)+65536}})(!1),charAt:On(!0)},Ze={},et={},tt={}.propertyIsEnumerable,nt=Object.getOwnPropertyDescriptor,rt=nt&&!tt.call({1:2},1);function it(e){return ct(lt(e))}et.f=rt?function(e){return!!(e=nt(this,e))&&e.enumerable}:tt;var st=I,ot=wa,at="".split,ct=da=st(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==ot(e)?at.call(e,""):Object(e)}:Object,lt=xa,ut=et,ht=fc,dt=it,pt=pc,ft=W,gt=O,mt=Object.getOwnPropertyDescriptor;function yt(e){return"function"==typeof e?e:void 0}function vt(e,t){return arguments.length<2?yt(wt[e])||yt(bt[e]):wt[e]&&wt[e][t]||bt[e]&&bt[e][t]}Ze.f=C?mt:function(e,t){if(e=dt(e),t=pt(t,!0),gt)try{return mt(e,t)}catch(e){}if(ft(e,t))return ht(!ut.f.call(e,t),e[t])};var _t=S,wt=_t,bt=S,It={},Tt=Pa,Et=Math.min,St=function(e){return 0<e?Et(Tt(e),9007199254740991):0},kt=Pa,Ct=Math.max,At=Math.min,Nt=it,Rt=St,Pt={includes:(nr=function(a){return function(e,t,n){var r,i=Nt(e),s=Rt(i.length),o=(e=s,(n=kt(n=n))<0?Ct(n+e,0):At(n,e));if(a&&t!=t){for(;o<s;)if((r=i[o++])!=r)return!0}else for(;o<s;o++)if((a||o in i)&&i[o]===t)return a||o||0;return!a&&-1}})(!0),indexOf:nr(!1)},xt=W,Ot=it,Dt=Pt.indexOf,Lt=Xc,Mt=E=function(e,t){var n,r=Ot(e),i=0,s=[];for(n in r)!xt(Lt,n)&&xt(r,n)&&s.push(n);for(;t.length>i;)xt(r,n=t[i++])&&(~Dt(s,n)||s.push(n));return s},Ft=(N=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]).concat("length","prototype");It.f=Object.getOwnPropertyNames||function(e){return Mt(e,Ft)},(z={}).f=Object.getOwnPropertySymbols;var Ut=It,qt=z,jt=T,Vt=vt("Reflect","ownKeys")||function(e){var t=Ut.f(jt(e)),n=qt.f;return n?t.concat(n(e)):t},Bt=W,Kt=Vt,zt=Ze,$t=A,J=function(e,t){for(var n=Kt(t),r=$t.f,i=zt.f,s=0;s<n.length;s++){var o=n[s];Bt(e,o)||r(e,o,i(t,o))}},Wt=I,Ht=/#|\.prototype\./,Gt=(ee=function(e,t){return(e=Qt[Gt(e)])==Jt||e!=Yt&&("function"==typeof t?Wt(t):!!t)}).normalize=function(e){return String(e).replace(Ht,".").toLowerCase()},Qt=ee.data={},Yt=ee.NATIVE="N",Jt=ee.POLYFILL="P",Xt=S,Zt=Ze.f,en=mc,tn=le.exports,nn=ar,rn=J,sn=Z=ee,ie=function(e,t){var n,r,i,s=e.target,o=e.global,a=e.stat,c=o?Xt:a?Xt[s]||nn(s,{}):(Xt[s]||{}).prototype;if(c)for(n in t){if(r=t[n],i=e.noTargetGet?(i=Zt(c,n))&&i.value:c[n],!sn(o?n:s+(a?".":"#")+n,e.forced)&&void 0!==i){if(typeof r==typeof i)continue;rn(r,i)}(e.sham||i&&i.sham)&&en(r,"sham",!0),tn(c,n,r,e)}},on=xa,ne=function(e){return Object(on(e))},an=!I(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),cn=W,ln=ne,un=an,hn=bc("IE_PROTO"),dn=Object.prototype,_e=ue=un?Object.getPrototypeOf:function(e){return e=ln(e),cn(e,hn)?e[hn]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?dn:null},pn=mc,be=W,we=Ic("iterator"),Ne=!1;function fn(){}[].keys&&("next"in(ni=[].keys())?(hr=_e(_e(ni)))!==Object.prototype&&(Ar=hr):Ne=!0),be(Ar=null==Ar?{}:Ar,we)||pn(Ar,we,function(){return this});function gn(e){return"<"+An+">"+e+"</"+An+">"}var mn,Ae={IteratorPrototype:Ar,BUGGY_SAFARI_ITERATORS:Ne},yn=E,vn=N,Ce=Object.keys||function(e){return yn(e,vn)},_n=A,wn=T,bn=Ce,Ve=C?Object.defineProperties:function(e,t){wn(e);for(var n,r=bn(t),i=r.length,s=0;s<i;)_n.f(e,n=r[s++],t[n]);return e},He=vt("document","documentElement"),In=T,Tn=Ve,En=N,ce=Xc,Sn=He,kn=pi,Cn="prototype",An="script",Nn=bc("IE_PROTO"),Rn=function(){try{mn=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;Rn=mn?function(e){e.write(gn("")),e.close();var t=e.parentWindow.Object;return e=null,t}(mn):(e=kn("iframe"),t="java"+An+":",e.style.display="none",Sn.appendChild(e),e.src=String(t),(e=e.contentWindow.document).open(),e.write(gn("document.F=Object")),e.close(),e.F);for(var n=En.length;n--;)delete Rn[Cn][En[n]];return Rn()};function Pn(){return this}function xn(){return this}ce[Nn]=!0;var On=Object.create||function(e,t){var n;return null!==e?(fn[Cn]=In(e),n=new fn,fn[Cn]=null,n[Nn]=e):n=Rn(),void 0===t?n:Tn(n,t)},Dn=A.f,Ln=W,Mn=Ic("toStringTag"),rt=function(e,t,n){e&&!Ln(e=n?e:e.prototype,Mn)&&Dn(e,Mn,{configurable:!0,value:t})},tt={},Fn=Ae.IteratorPrototype,Un=On,qn=fc,jn=rt,Vn=tt,Bn=WE,Kn=T,st=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,e={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(e,[]),r=e instanceof Array}catch(e){}return function(e,t){return Kn(e),function(e){if(!Bn(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(t),r?n.call(e,t):e.__proto__=t,e}}():void 0),zn=ie,$n=ue,Wn=st,Hn=rt,Gn=mc,Qn=le.exports,O=Ic,Yn=tt,Jn=Ae.IteratorPrototype,Xn=Ae.BUGGY_SAFARI_ITERATORS,Zn=O("iterator"),er="values",tr="entries",nr=function(e,t,n,r,i,s,o){var a;function c(e){if(e===i&&g)return g;if(!Xn&&e in p)return p[e];switch(e){case"keys":case er:case tr:return function(){return new n(this,e)}}return function(){return new n(this)}}h=t,h+=" Iterator",(a=n).prototype=Un(Fn,{next:qn(1,r)}),jn(a,h,!1),Vn[h]=Pn;var l,u,h=t+" Iterator",d=!1,p=e.prototype,f=p[Zn]||p["@@iterator"]||i&&p[i],g=!Xn&&f||c(i);if((r="Array"==t&&p.entries||f)&&(e=$n(r.call(new e)),Jn!==Object.prototype&&e.next&&($n(e)!==Jn&&(Wn?Wn(e,Jn):"function"!=typeof e[Zn]&&Gn(e,Zn,xn)),Hn(e,h,!0))),i==er&&f&&f.name!==er&&(d=!0,g=function(){return f.call(this)}),p[Zn]!==g&&Gn(p,Zn,g),Yn[t]=g,i)if(l={values:c(er),keys:s?g:c("keys"),entries:c(tr)},o)for(u in l)!Xn&&!d&&u in p||Qn(p,u,l[u]);else zn({target:t,proto:!0,forced:Xn||d},l);return l},rr=Xe.charAt,Vt=nr,ir="String Iterator",sr=(Pt=Pe).set,or=Pt.getterFor(ir);Vt(String,"String",function(e){sr(this,{type:ir,string:String(e),index:0})},function(){var e=or(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(n=rr(t,n),e.index+=n.length,{value:n,done:!1})});var ee=On,ar=A,cr=Ic("unscopables"),lr=Array.prototype;null==lr[cr]&&ar.f(lr,cr,{configurable:!0,value:ee(null)});var ur=it,un=an=function(e){lr[cr][e]=!0},_e=tt,hr=nr,dr="Array Iterator",pr=(ni=Pe).set,fr=ni.getterFor(dr),be=hr(Array,"Array",function(e,t){pr(this,{type:dr,target:ur(e),index:0,kind:t})},function(){var e=fr(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values");_e.Arguments=_e.Array,un("keys"),un("values"),un("entries");var gr,mr=S,yr={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},vr=be,_r=mc,wr=(pn=Ic)("iterator"),br=pn("toStringTag"),Ir=vr.values;for(gr in yr){var Tr=mr[gr],Er=Tr&&Tr.prototype;if(Er){if(Er[wr]!==Ir)try{_r(Er,wr,Ir)}catch(aw){Er[wr]=Ir}if(Er[br]||_r(Er,br,gr),yr[gr])for(var Sr in vr)if(Er[Sr]!==vr[Sr])try{_r(Er,Sr,vr[Sr])}catch(aw){Er[Sr]=vr[Sr]}}}function kr(e,t){this.stopped=e,this.result=t}var we=S.Promise,Cr=le.exports,Ar=function(e,t,n){for(var r in t)Cr(e,r,t[r],n);return e},Nr=vt,Rr=A,Pr=C,xr=Ic("species"),Ne=function(e){var t=Nr(e),e=Rr.f;Pr&&t&&!t[xr]&&e(t,xr,{configurable:!0,get:function(){return this}})},E=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Ve=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},N={exports:{}},Or=tt,Dr=Ic("iterator"),Lr=Array.prototype,ce=function(e){return void 0!==e&&(Or.Array===e||Lr[Dr]===e)},Mr=E,Ae=function(r,i,e){if(Mr(r),void 0===i)return r;switch(e){case 0:return function(){return r.call(i)};case 1:return function(e){return r.call(i,e)};case 2:return function(e,t){return r.call(i,e,t)};case 3:return function(e,t,n){return r.call(i,e,t,n)}}return function(){return r.apply(i,arguments)}},Fr=$e,Ur=tt,qr=Ic("iterator"),jr=T,Vr=T,Br=ce,Kr=St,zr=Ae,$r=O=function(e){if(null!=e)return e[qr]||e["@@iterator"]||Ur[Fr(e)]},Wr=Xe=function(e,t,n,r){try{return r?t(jr(n)[0],n[1]):t(n)}catch(t){throw void 0!==(n=e.return)&&jr(n.call(e)),t}};(N.exports=function(e,t,n,r,i){var s,o,a,c,l,u,h=zr(t,n,r?2:1);if(i)s=e;else{if("function"!=typeof(i=$r(e)))throw TypeError("Target is not iterable");if(Br(i)){for(o=0,a=Kr(e.length);o<a;o++)if((c=r?h(Vr(u=e[o])[0],u[1]):h(e[o]))&&c instanceof kr)return c;return new kr(!1)}s=i.call(e)}for(l=s.next;!(u=l.call(s)).done;)if("object"==typeof(c=Wr(s,h,u.value,r))&&c&&c instanceof kr)return c;return new kr(!1)}).stop=function(e){return new kr(!0,e)};var Hr=Ic("iterator"),Gr=!1;try{var Qr=0;(ai={next:function(){return{done:!!Qr++}},return:function(){Gr=!0}})[Hr]=function(){return this},Array.from(ai,function(){throw 2})}catch(aw){}function Yr(e){return function(){di(e)}}var Jr,Pt=function(e,t){if(!t&&!Gr)return!1;var n=!1;try{var r={};r[Hr]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Xr=T,Zr=E,ei=Ic("species"),Vt=function(e,t){var n;return void 0===(e=Xr(e).constructor)||null==(n=Xr(e)[ei])?t:Zr(n)},ar=vt("navigator","userAgent")||"",ee=/(iphone|ipod|ipad).*applewebkit/i.test(ar),ti=S,ni=I,hr=wa,_e=Ae,ri=He,ii=pi,un=ee,si=ti.location,pn=ti.setImmediate,tt=ti.clearImmediate,oi=ti.process,ai=ti.MessageChannel,ci=ti.Dispatch,li=0,ui={},hi="onreadystatechange",di=function(e){var t;ui.hasOwnProperty(e)&&(t=ui[e],delete ui[e],t())},He=function(e){di(e.data)},pi=function(e){ti.postMessage(e+"",si.protocol+"//"+si.host)};pn&&tt||(pn=function(e){for(var t=[],n=1;n<arguments.length;)t.push(arguments[n++]);return ui[++li]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Jr(li),li},tt=function(e){delete ui[e]},"process"==hr(oi)?Jr=function(e){oi.nextTick(Yr(e))}:ci&&ci.now?Jr=function(e){ci.now(Yr(e))}:ai&&!un?(ki=(Ei=new ai).port2,Ei.port1.onmessage=He,Jr=_e(ki.postMessage,ki,1)):!ti.addEventListener||"function"!=typeof postMessage||ti.importScripts||ni(pi)||"file:"===si.protocol?Jr=hi in ii("script")?function(e){ri.appendChild(ii("script"))[hi]=function(){ri.removeChild(this),di(e)}}:function(e){setTimeout(Yr(e),0)}:(Jr=pi,ti.addEventListener("message",He,!1)));var fi,gi,mi,yi,vi,_i,wi,bi,hr={set:pn,clear:tt},Ii=S,un=Ze.f,ai=wa,Ti=hr.set,Ei=ee,_e=Ii.MutationObserver||Ii.WebKitMutationObserver,Si=Ii.process,ki=Ii.Promise,Ci="process"==ai(Si);function Ai(e){var n,r;this.promise=new e(function(e,t){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=e,r=t}),this.resolve=Ni(n),this.reject=Ni(r)}(pi=(ni=un(Ii,"queueMicrotask"))&&ni.value)||(fi=function(){var e,t;for(Ci&&(e=Si.domain)&&e.exit();gi;){t=gi.fn,gi=gi.next;try{t()}catch(e){throw gi?yi():mi=void 0,e}}mi=void 0,e&&e.enter()},yi=Ci?function(){Si.nextTick(fi)}:_e&&!Ei?(vi=!0,_i=document.createTextNode(""),new _e(fi).observe(_i,{characterData:!0}),function(){_i.data=vi=!vi}):ki&&ki.resolve?(wi=ki.resolve(void 0),bi=wi.then,function(){bi.call(wi,fi)}):function(){Ti.call(Ii,fi)});var He=pi||function(e){e={fn:e,next:void 0},mi&&(mi.next=e),gi||(gi=e,yi()),mi=e},Ni=E;(pn={}).f=function(e){return new Ai(e)};var Ri=T,Pi=WE,xi=pn,tt=function(e,t){return Ri(e),Pi(t)&&t.constructor===e?t:((0,(e=xi.f(e)).resolve)(t),e.promise)},Oi=S,ee=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},ai=ar;(Ei=(ni=(un=S.process)&&un.versions)&&ni.v8)?Hi=(zi=Ei.split("."))[0]+zi[1]:ai&&(!(zi=ai.match(/Edge\/(\d+)/))||74<=zi[1])&&(zi=ai.match(/Chrome\/(\d+)/))&&(Hi=zi[1]);function Di(e,t,n){var r;gs?((r=ls.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),ji.dispatchEvent(r)):r={promise:t,reason:n},(t=ji["on"+e])?t(r):e===ms&&Xi("Unhandled promise rejection",n)}function Li(e){return e.rejection!==_s&&!e.parent}var Mi,Fi,Ui,qi,_e=Hi&&+Hi,ki=ie,ji=S,pi=vt,ar=we,un=le.exports,ni=Ar,Ei=rt,ai=Ne,Vi=WE,Bi=E,Ki=Ve,zi=wa,$i=Zi,Wi=N.exports,Hi=Pt,Gi=Vt,Qi=hr.set,Yi=He,Ji=tt,Xi=function(e,t){var n=Oi.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},Zi=pn,es=ee,hr=Pe,He=Z,ts=_e,ns=Ic("species"),rs="Promise",is=hr.get,ss=hr.set,os=hr.getterFor(rs),as=ar,cs=ji.TypeError,ls=ji.document,us=ji.process,hs=pi("fetch"),ds=Zi.f,ps=ds,fs="process"==zi(us),gs=!!(ls&&ls.createEvent&&ji.dispatchEvent),ms="unhandledrejection",ys=1,vs=2,_s=1,Hi=(He=He(rs,function(){if($i(as)===String(as)){if(66===ts)return!0;if(!fs&&"function"!=typeof PromiseRejectionEvent)return!0}if(51<=ts&&/native code/.test(as))return!1;function e(e){e(function(){},function(){})}var t=as.resolve(1);return(t.constructor={})[ns]=e,!(t.then(function(){})instanceof e)}))||!Hi(function(e){as.all(e).catch(function(){})}),ws=function(e){var t;return!(!Vi(e)||"function"!=typeof(t=e.then))&&t},bs=function(p,f,g){var m;f.notified||(f.notified=!0,m=f.reactions,Yi(function(){for(var n,r,e=f.value,t=f.state==ys,i=0;m.length>i;){var s,o,a,c=m[i++],l=t?c.ok:c.fail,u=c.resolve,h=c.reject,d=c.domain;try{l?(t||(2===f.rejection&&function(e,t){Qi.call(ji,function(){fs?us.emit("rejectionHandled",e):Di("rejectionhandled",e,t.value)})}(p,f),f.rejection=_s),!0===l?s=e:(d&&d.enter(),s=l(e),d&&(d.exit(),a=!0)),s===c.promise?h(cs("Promise-chain cycle")):(o=ws(s))?o.call(s,u,h):u(s)):h(e)}catch(e){d&&!a&&d.exit(),h(e)}}f.reactions=[],f.notified=!1,g&&!f.rejection&&(n=p,r=f,Qi.call(ji,function(){var e,t=r.value;if(Li(r)&&(e=es(function(){fs?us.emit("unhandledRejection",t,n):Di(ms,n,t)}),r.rejection=fs||Li(r)?2:_s,e.error))throw e.value}))}))},Is=function(t,n,r,i){return function(e){t(n,r,e,i)}},Ts=function(e,t,n,r){t.done||(t.done=!0,(t=r||t).value=n,t.state=vs,bs(e,t,!0))},Es=function(n,r,e,t){if(!r.done){r.done=!0,t&&(r=t);try{if(n===e)throw cs("Promise can't be resolved itself");var i=ws(e);i?Yi(function(){var t={done:!1};try{i.call(e,Is(Es,n,t,r),Is(Ts,n,t,r))}catch(e){Ts(n,t,e,r)}}):(r.value=e,r.state=ys,bs(n,r,!1))}catch(e){Ts(n,{done:!1},e,r)}}};He&&(as=function(e){Ki(this,as,rs),Bi(e),Mi.call(this);var t=is(this);try{e(Is(Es,this,t),Is(Ts,this,t))}catch(e){Ts(this,t,e)}},(Mi=function(e){ss(this,{type:rs,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=ni(as.prototype,{then:function(e,t){var n=os(this),r=ds(Gi(this,as));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=fs?us.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&bs(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Fi=function(){var e=new Mi,t=is(e);this.promise=e,this.resolve=Is(Es,e,t),this.reject=Is(Ts,e,t)},Zi.f=ds=function(e){return e===as||e===Ui?new Fi:ps(e)},"function"==typeof ar&&(qi=ar.prototype.then,un(ar.prototype,"then",function(e,t){var n=this;return new as(function(e,t){qi.call(n,e,t)}).then(e,t)},{unsafe:!0}),"function"==typeof hs&&ki({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return Ji(as,hs.apply(ji,arguments))}}))),ki({global:!0,wrap:!0,forced:He},{Promise:as}),Ei(as,rs,!1),ai(rs),Ui=pi(rs),ki({target:rs,stat:!0,forced:He},{reject:function(e){var t=ds(this);return t.reject.call(void 0,e),t.promise}}),ki({target:rs,stat:!0,forced:He},{resolve:function(e){return Ji(this,e)}}),ki({target:rs,stat:!0,forced:Hi},{all:function(e){var a=this,t=ds(a),c=t.resolve,l=t.reject,n=es(function(){var r=Bi(a.resolve),i=[],s=0,o=1;Wi(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(a,e).then(function(e){n||(n=!0,i[t]=e,--o||c(i))},l)}),--o||c(i)});return n.error&&l(n.value),t.promise},race:function(e){var n=this,r=ds(n),i=r.reject,t=es(function(){var t=Bi(n.resolve);Wi(e,function(e){t.call(n,e).then(r.resolve,i)})});return t.error&&i(t.value),r.promise}});var pi=ie,Ss=E,ks=pn,Cs=ee,As=N.exports;pi({target:"Promise",stat:!0},{allSettled:function(e){var a=this,t=ks.f(a),c=t.resolve,n=t.reject,r=Cs(function(){var r=Ss(a.resolve),i=[],s=0,o=1;As(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(a,e).then(function(e){n||(n=!0,i[t]={status:"fulfilled",value:e},--o||c(i))},function(e){n||(n=!0,i[t]={status:"rejected",reason:e},--o||c(i))})}),--o||c(i)});return r.error&&n(r.value),t.promise}});var He=ie,Ns=we,ki=I,Rs=vt,Ps=Vt,xs=tt,Hi=le.exports;function Os(e,t){var n=this;if(!(n instanceof Os))return new Os(e,t);Ms&&(n=Ms(new Error(t),Ls(n)));var r=[];return Fs(e,r.push,r),Ds?qs(n,{errors:r,type:"AggregateError"}):n.errors=r,void 0!==t&&Us(n,"message",String(t)),n}He({target:"Promise",proto:!0,real:!0,forced:!!Ns&&ki(function(){Ns.prototype.finally.call({then:function(){}},function(){})})},{finally:function(t){var n=Ps(this,Rs("Promise")),e="function"==typeof t;return this.then(e?function(e){return xs(n,t()).then(function(){return e})}:t,e?function(e){return xs(n,t()).then(function(){throw e})}:t)}}),"function"!=typeof Ns||Ns.prototype.finally||Hi(Ns.prototype,"finally",Rs("Promise").prototype.finally),_t.Promise;var pi=ie,Ds=C,Ls=ue,Ms=st,we=On,tt=A,He=fc,Fs=N.exports,Us=mc,qs=(ki=Pe).set,js=ki.getterFor("AggregateError");Os.prototype=we(Error.prototype,{constructor:He(5,Os),message:He(5,""),name:He(5,"AggregateError")}),Ds&&tt.f(Os.prototype,"errors",{get:function(){return js(this).errors},configurable:!0}),pi({global:!0},{AggregateError:Os});var Vs=pn,Bs=ee;ie({target:"Promise",stat:!0},{try:function(e){var t=Vs.f(this);return((e=Bs(e)).error?t.reject:t.resolve)(e.value),t.promise}});var Hi=ie,Ks=E,zs=vt,$s=pn,Ws=ee,Hs=N.exports,Gs="No one promise resolved";function Qs(e){throw e}Hi({target:"Promise",stat:!0},{any:function(e){var c=this,t=$s.f(c),l=t.resolve,u=t.reject,n=Ws(function(){var r=Ks(c.resolve),i=[],s=0,o=1,a=!1;Hs(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(c,e).then(function(e){n||a||(a=!0,l(e))},function(e){n||a||(n=!0,i[t]=e,--o||u(new(zs("AggregateError"))(i,Gs)))})}),--o||u(new(zs("AggregateError"))(i,Gs))});return n.error&&u(n.value),t.promise}});var Ys=wa,ki=Array.isArray||function(e){return"Array"==Ys(e)},Js=WE,Xs=ki,Zs=Ic("species"),eo=Ae,to=da,no=ne,ro=St,io=we=function(e,t){var n;return new(void 0===(n=Xs(e)&&("function"==typeof(n=e.constructor)&&(n===Array||Xs(n.prototype))||Js(n)&&null===(n=n[Zs]))?void 0:n)?Array:n)(0===t?0:t)},so=[].push,tt={forEach:(He=function(d){var p=1==d,f=2==d,g=3==d,m=4==d,y=6==d,v=5==d||y;return function(e,t,n,r){for(var i,s,o=no(e),a=to(o),c=eo(t,n,3),l=ro(a.length),u=0,r=r||io,h=p?r(e,l):f?r(e,0):void 0;u<l;u++)if((v||u in a)&&(s=c(i=a[u],u,o),d))if(p)h[u]=s;else if(s)switch(d){case 3:return!0;case 5:return i;case 6:return u;case 2:so.call(h,i)}else if(m)return!1;return y?-1:g||m?m:h}})(0),map:He(1),filter:He(2),some:He(3),every:He(4),find:He(5),findIndex:He(6)},oo=C,ao=I,co=W,lo=Object.defineProperty,uo={},pi=function(e,t){if(co(uo,e))return uo[e];var n=[][e],r=!!co(t=t||{},"ACCESSORS")&&t.ACCESSORS,i=co(t,0)?t[0]:Qs,s=co(t,1)?t[1]:void 0;return uo[e]=!!n&&!ao(function(){if(r&&!oo)return!0;var e={length:-1};r?lo(e,1,{enumerable:!0,get:Qs}):e[1]=1,n.call(e,i,s)})},pn=ie,ho=tt.find,ee=an,po=!0,He=pi(Hi="find");Hi in[]&&Array(1)[Hi](function(){po=!1}),pn({target:"Array",proto:!0,forced:po||!He},{find:function(e){return ho(this,e,1<arguments.length?arguments[1]:void 0)}}),ee(Hi);var fo=S,go=Ae,mo=Function.call;(pn=function(e,t,n){return go(mo,fo[e].prototype[t],n)})("Array","find");var He=ie,yo=tt.findIndex,ee=an,vo=!0,an=pi(Hi="findIndex");Hi in[]&&Array(1)[Hi](function(){vo=!1}),He({target:"Array",proto:!0,forced:vo||!an},{findIndex:function(e){return yo(this,e,1<arguments.length?arguments[1]:void 0)}}),ee(Hi),pn("Array","findIndex");var _o=pc,wo=A,bo=fc,Io=Ae,To=ne,Eo=Xe,So=ce,ko=St,Co=an=function(e,t,n){(t=_o(t))in e?wo.f(e,t,bo(0,n)):e[t]=n},Ao=O,ee=function(e){var t,n,r,i,s,o,a=To(e),c="function"==typeof this?this:Array,l=arguments.length,u=1<l?arguments[1]:void 0,h=void 0!==u,e=Ao(a),d=0;if(h&&(u=Io(u,2<l?arguments[2]:void 0,2)),null==e||c==Array&&So(e))for(n=new c(t=ko(a.length));d<t;d++)o=h?u(a[d],d):a[d],Co(n,d,o);else for(s=(i=e.call(a)).next,n=new c;!(r=s.call(i)).done;d++)o=h?Eo(i,u,[r.value,d],!0):r.value,Co(n,d,o);return n.length=d,n};ie({target:"Array",stat:!0,forced:!Pt(function(e){Array.from(e)})},{from:ee}),_t.Array.from;var No,He=I,Hi=ie,Ro=tt.some,Xe=pi,ce=!!(No=[].some)&&He(function(){No.call(null,function(){throw 1},1)}),ee=Xe("some");function Po(e){return Lo(e)&&Mo(Go,Fo(e))}Hi({target:"Array",proto:!0,forced:!ce||!ee},{some:function(e){return Ro(this,e,1<arguments.length?arguments[1]:void 0)}}),pn("Array","some");var xo,pi="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Oo=C,Do=S,Lo=WE,Mo=W,Fo=$e,Uo=mc,qo=le.exports,Xe=A.f,Hi=ue,jo=st,ce=Ic,ee=H,Vo=Do.Int8Array,Bo=Vo&&Vo.prototype,ue=($e=Do.Uint8ClampedArray)&&$e.prototype,Ko=Vo&&Hi(Vo),zo=Bo&&Hi(Bo),$o=($e=Object.prototype).isPrototypeOf,ce=ce("toStringTag"),Wo=ee("TYPED_ARRAY_TAG"),Ho=pi&&!!jo&&"Opera"!==Fo(Do.opera),pi=!1,Go={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8};for(xo in Go)Do[xo]||(Ho=!1);if((!Ho||"function"!=typeof Ko||Ko===Function.prototype)&&(Ko=function(){throw TypeError("Incorrect invocation")},Ho))for(xo in Go)Do[xo]&&jo(Do[xo],Ko);if((!Ho||!zo||zo===$e)&&(zo=Ko.prototype,Ho))for(xo in Go)Do[xo]&&jo(Do[xo].prototype,zo);if(Ho&&Hi(ue)!==zo&&jo(ue,zo),Oo&&!Mo(zo,ce))for(xo in pi=!0,Xe(zo,ce,{get:function(){return Lo(this)?this[Wo]:void 0}}),Go)Do[xo]&&Uo(Do[xo],Wo,xo);var Xe=S,ce={NATIVE_ARRAY_BUFFER_VIEWS:Ho,TYPED_ARRAY_TAG:pi&&Wo,aTypedArray:function(e){if(Po(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(jo){if($o.call(Ko,e))return e}else for(var t in Go)if(Mo(Go,xo)&&(t=Do[t])&&(e===t||$o.call(t,e)))return e;throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n){if(Oo){if(n)for(var r in Go)(r=Do[r])&&Mo(r.prototype,e)&&delete r.prototype[e];zo[e]&&!n||qo(zo,e,!n&&Ho&&Bo[e]||t)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(Oo){if(jo){if(n)for(r in Go)(i=Do[r])&&Mo(i,e)&&delete i[e];if(Ko[e]&&!n)return;try{return qo(Ko,e,!n&&Ho&&Vo[e]||t)}catch(e){}}for(r in Go)!(i=Do[r])||i[e]&&!n||qo(i,e,t)}},isView:function(e){return"DataView"===(e=Fo(e))||Mo(Go,e)},isTypedArray:Po,TypedArray:Ko,TypedArrayPrototype:zo},pi=be,be=Ic("iterator"),Xe=Xe.Uint8Array,Qo=pi.values,Yo=pi.keys,Jo=pi.entries,Xo=ce.aTypedArray,pi=ce.exportTypedArrayMethod,Xe=!!(ce=Xe&&Xe.prototype[be])&&("values"==ce.name||null==ce.name),ce=function(){return Qo.call(Xo(this))};pi("entries",function(){return Jo.call(Xo(this))}),pi("keys",function(){return Yo.call(Xo(this))}),pi("values",ce,!Xe),pi(be,ce,!Xe);var Zo=C,ce=I,ea=Ce,ta=z,na=et,ra=ne,ia=da,sa=Object.assign,oa=Object.defineProperty,Xe=!sa||ce(function(){if(Zo&&1!==sa({b:1},sa(oa({},"a",{enumerable:!0,get:function(){oa(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=sa({},e)[n]||ea(sa({},t)).join("")!=r})?function(e,t){for(var n=ra(e),r=arguments.length,i=1,s=ta.f,o=na.f;i<r;)for(var a,c=ia(arguments[i++]),l=s?ea(c).concat(s(c)):ea(c),u=l.length,h=0;h<u;)a=l[h++],Zo&&!o.call(c,a)||(n[a]=c[a]);return n}:sa;ie({target:"Object",stat:!0,forced:Object.assign!==Xe},{assign:Xe}),_t.Object.assign;var aa=C,ca=Ce,la=it,ua=et.f,Xe=ie,ha=(ce={entries:(da=function(a){return function(e){for(var t,n=la(e),r=ca(n),i=r.length,s=0,o=[];s<i;)t=r[s++],aa&&!ua.call(n,t)||o.push(a?[t,n[t]]:n[t]);return o}})(!0),values:da(!1)}).entries;Xe({target:"Object",stat:!0},{entries:function(e){return ha(e)}}),_t.Object.entries;var da=ie,pa=ce.values;da({target:"Object",stat:!0},{values:function(e){return pa(e)}}),_t.Object.values;var fa=WE,ga=wa,ma=Ic("match"),Xe=function(e){if(fa(t=e)&&(void 0!==(n=t[ma])?!!n:"RegExp"==ga(t)))throw TypeError("The method doesn't accept regular expressions");var t,n;return e},ya=Ic("match"),va=Xe,_a=xa;ie({target:"String",proto:!0,forced:!(ce=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[ya]=!1,"/./"[t](n)}catch(e){}}return!1})("includes")},{includes:function(e){return!!~String(_a(this)).indexOf(va(e),1<arguments.length?arguments[1]:void 0)}}),pn("String","includes");var da=ie,wa=Ze.f,ba=St,Ia=Xe,Ta=xa,ce=ce,Ea="".startsWith,Sa=Math.min;da({target:"String",proto:!0,forced:!(!(ce=ce("startsWith"))&&(wa=wa(String.prototype,"startsWith"))&&!wa.writable||ce)},{startsWith:function(e){var t=String(Ta(this));Ia(e);var n=ba(Sa(1<arguments.length?arguments[1]:void 0,t.length)),e=String(e);return Ea?Ea.call(t,e,n):t.slice(n,n+e.length)===e}}),pn("String","startsWith");var ka=Pa,Ca=xa;ie({target:"String",proto:!0},{repeat:"".repeat||function(e){var t=String(Ca(this)),n="",r=ka(e);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n}}),pn("String","repeat");var Aa=I,Na=_e,Ra=Ic("species"),Pa=ie,xa=I,Oa=ki,Da=WE,La=ne,Ma=St,Fa=an,Ua=we,pn=function(t){return 51<=Na||!Aa(function(){var e=[];return(e.constructor={})[Ra]=function(){return{foo:1}},1!==e[t](Boolean).foo})},St=_e,qa=Ic("isConcatSpreadable"),ja=9007199254740991,Va="Maximum allowed index exceeded",an=51<=St||!xa(function(){var e=[];return e[qa]=!1,e.concat()[0]!==e}),we=pn("concat");Pa({target:"Array",proto:!0,forced:!an||!we},{concat:function(e){for(var t,n,r,i=La(this),s=Ua(i,0),o=0,a=-1,c=arguments.length;a<c;a++)if(function(e){if(Da(e)){var t=e[qa];return void 0!==t?t:Oa(e)}}(r=-1===a?i:arguments[a])){if(n=Ma(r.length),ja<o+n)throw TypeError(Va);for(t=0;t<n;t++,o++)t in r&&Fa(s,o,r[t])}else{if(ja<=o)throw TypeError(Va);Fa(s,o++,r)}return s.length=o,s}});var _e={},Ba=it,Ka=It.f,za={}.toString,$a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];function Wa(e,t){var n=Mc[e]=hc(Rc[kc]);return Cc(n,{type:Sc,tag:e,description:t}),tc||(n.description=t),n}function Ha(t,e){oc(t);var n=cc(e),e=dc(n).concat(Ya(n));return Tc(e,function(e){tc&&!Qa.call(n,e)||Ga(t,e,n[e])}),t}_e.f=function(e){return $a&&"[object Window]"==za.call(e)?function(e){try{return Ka(e)}catch(e){return $a.slice()}}(e):Ka(Ba(e))},(St={}).f=Ic;function Ga(e,t,n){return e===Nc&&Ga(Fc,t,n),oc(e),t=lc(t,!0),oc(n),rc(Mc,t)?(n.enumerable?(rc(e,Ec)&&e[Ec][t]&&(e[Ec][t]=!1),n=hc(n,{enumerable:uc(0,!1)})):(rc(e,Ec)||Oc(e,Ec,uc(1,{})),e[Ec][t]=!0),Vc(e,t,n)):Oc(e,t,n)}function Qa(e){var t=lc(e,!0),e=Lc.call(this,t);return!(this===Nc&&rc(Mc,t)&&!rc(Fc,t))&&(!(e||!rc(this,t)||!rc(Mc,t)||rc(this,Ec)&&this[Ec][t])||e)}function Ya(e){var t=e===Nc,e=Dc(t?Fc:cc(e)),n=[];return Tc(e,function(e){!rc(Mc,e)||t&&!rc(Nc,e)||n.push(Mc[e])}),n}var Ja=_t,Xa=W,Za=St,ec=A.f,xa=function(e){var t=Ja.Symbol||(Ja.Symbol={});Xa(t,e)||ec(t,e,{value:Za.f(e)})},pn=ie,Pa=S,an=vt,tc=C,we=nc,nc=X,X=I,rc=W,ic=ki,sc=WE,oc=T,ac=ne,cc=it,lc=pc,uc=fc,hc=On,dc=Ce,pc=It,fc=_e,gc=z,Ce=Ze,It=A,_e=et,z=mc,Ze=le.exports,et=k.exports,mc=bc,yc=Xc,vc=H,_c=Ic,k=St,wc=xa,bc=rt,Ic=Pe,Tc=tt.forEach,Ec=mc("hidden"),Sc="Symbol",kc="prototype",mc=_c("toPrimitive"),Cc=Ic.set,Ac=Ic.getterFor(Sc),Nc=Object[kc],Rc=Pa.Symbol,Pc=an("JSON","stringify"),xc=Ce.f,Oc=It.f,Dc=fc.f,Lc=_e.f,Mc=et("symbols"),Fc=et("op-symbols"),Uc=et("string-to-symbol-registry"),qc=et("symbol-to-string-registry"),et=et("wks"),jc=!(Pa=Pa.QObject)||!Pa[kc]||!Pa[kc].findChild,Vc=tc&&X(function(){return 7!=hc(Oc({},"a",{get:function(){return Oc(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=xc(Nc,t);r&&delete Nc[t],Oc(e,t,n),r&&e!==Nc&&Oc(Nc,t,r)}:Oc,Bc=nc?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof Rc},Pa=function(e,t){var n=cc(e),e=lc(t,!0);if(n!==Nc||!rc(Mc,e)||rc(Fc,e))return!(t=xc(n,e))||!rc(Mc,e)||rc(n,Ec)&&n[Ec][e]||(t.enumerable=!0),t},nc=function(e){var e=Dc(cc(e)),t=[];return Tc(e,function(e){rc(Mc,e)||rc(yc,e)||t.push(e)}),t};we||(Ze((Rc=function(){if(this instanceof Rc)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=vc(e),n=function(e){this===Nc&&n.call(Fc,e),rc(this,Ec)&&rc(this[Ec],t)&&(this[Ec][t]=!1),Vc(this,t,uc(1,e))};return tc&&jc&&Vc(Nc,t,{configurable:!0,set:n}),Wa(t,e)})[kc],"toString",function(){return Ac(this).tag}),Ze(Rc,"withoutSetter",function(e){return Wa(vc(e),e)}),_e.f=Qa,It.f=Ga,Ce.f=Pa,pc.f=fc.f=nc,gc.f=Ya,k.f=function(e){return Wa(_c(e),e)},tc&&(Oc(Rc[kc],"description",{configurable:!0,get:function(){return Ac(this).description}}),Ze(Nc,"propertyIsEnumerable",Qa,{unsafe:!0}))),pn({global:!0,wrap:!0,forced:!we,sham:!we},{Symbol:Rc}),Tc(dc(et),function(e){wc(e)}),pn({target:Sc,stat:!0,forced:!we},{for:function(e){var t=String(e);return rc(Uc,t)?Uc[t]:(e=Rc(t),Uc[t]=e,qc[e]=t,e)},keyFor:function(e){if(!Bc(e))throw TypeError(e+" is not a symbol");if(rc(qc,e))return qc[e]},useSetter:function(){jc=!0},useSimple:function(){jc=!1}}),pn({target:"Object",stat:!0,forced:!we,sham:!tc},{create:function(e,t){return void 0===t?hc(e):Ha(hc(e),t)},defineProperty:Ga,defineProperties:Ha,getOwnPropertyDescriptor:Pa}),pn({target:"Object",stat:!0,forced:!we},{getOwnPropertyNames:nc,getOwnPropertySymbols:Ya}),pn({target:"Object",stat:!0,forced:X(function(){gc.f(1)})},{getOwnPropertySymbols:function(e){return gc.f(ac(e))}}),Pc&&pn({target:"JSON",stat:!0,forced:!we||X(function(){var e=Rc();return"[null]"!=Pc([e])||"{}"!=Pc({a:e})||"{}"!=Pc(Object(e))})},{stringify:function(e,t,n){for(var r,i=[e],s=1;s<arguments.length;)i.push(arguments[s++]);if((sc(r=t)||void 0!==e)&&!Bc(e))return ic(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Bc(t))return t}),i[1]=t,Pc.apply(null,i)}}),Rc[kc][mc]||z(Rc[kc],mc,Rc[kc].valueOf),bc(Rc,Sc),yc[Ec]=!0,xa("asyncIterator");var Kc,zc,$c,Wc,Hc,mc=ie,Gc=W,Qc=WE,bc=A.f,J=J,Yc=S.Symbol;function Jc(e){tl(e,rl,{value:{objectID:"O"+ ++il,weakData:{}}})}!C||"function"!=typeof Yc||"description"in Yc.prototype&&void 0===Yc().description||(Kc={},J(zc=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof zc?new Yc(e):void 0===e?Yc():Yc(e);return""===e&&(Kc[t]=!0),t},Yc),(J=zc.prototype=Yc.prototype).constructor=zc,$c=J.toString,Wc="Symbol(test)"==String(Yc("test")),Hc=/^Symbol\((.*)\)[^)]+$/,bc(J,"description",{configurable:!0,get:function(){var e=Qc(this)?this.valueOf():this,t=$c.call(e);return Gc(Kc,e)?"":""===(t=Wc?t.slice(7,-1):t.replace(Hc,"$1"))?void 0:t}}),mc({global:!0,forced:!0},{Symbol:zc})),xa("hasInstance"),xa("isConcatSpreadable"),xa("iterator"),xa("match"),xa("matchAll"),xa("replace"),xa("search"),xa("species"),xa("split"),xa("toPrimitive"),xa("toStringTag"),xa("unscopables"),rt(Math,"Math",!0),rt(S.JSON,"JSON",!0),_t.Symbol,xa("asyncDispose"),xa("dispose"),xa("observable"),xa("patternMatch"),xa("replaceAll"),St.f("iterator");var xa={exports:{}},St=!I(function(){return Object.isExtensible(Object.preventExtensions({}))}),Xc=Xc,Zc=WE,el=W,tl=A.f,nl=St,rl=H("meta"),il=0,sl=Object.isExtensible||function(){return!0},ol=xa.exports={REQUIRED:!1,fastKey:function(e,t){if(!Zc(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!el(e,rl)){if(!sl(e))return"F";if(!t)return"E";Jc(e)}return e[rl].objectID},getWeakData:function(e,t){if(!el(e,rl)){if(!sl(e))return!0;if(!t)return!1;Jc(e)}return e[rl].weakData},onFreeze:function(e){return nl&&ol.REQUIRED&&sl(e)&&!el(e,rl)&&Jc(e),e}};Xc[rl]=!0;var al=WE,cl=st,ll=ie,ul=S,hl=Z,dl=le.exports,pl=xa.exports,fl=N.exports,gl=Ve,ml=WE,yl=I,vl=Pt,_l=rt,rt=function(a,e,t){function n(e){var n=p[e];dl(p,e,"add"==e?function(e){return n.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(u&&!ml(e))&&n.call(this,0===e?0:e)}:"get"==e?function(e){return u&&!ml(e)?void 0:n.call(this,0===e?0:e)}:"has"==e?function(e){return!(u&&!ml(e))&&n.call(this,0===e?0:e)}:function(e,t){return n.call(this,0===e?0:e,t),this})}var r,i,s,o,c,l=-1!==a.indexOf("Map"),u=-1!==a.indexOf("Weak"),h=l?"set":"add",d=ul[a],p=d&&d.prototype,f=d,g={};return hl(a,"function"!=typeof d||!(u||p.forEach&&!yl(function(){(new d).entries().next()})))?(f=t.getConstructor(e,a,l,h),pl.REQUIRED=!0):hl(a,!0)&&(i=(r=new f)[h](u?{}:-0,1)!=r,s=yl(function(){r.has(1)}),o=vl(function(e){new d(e)}),c=!u&&yl(function(){for(var e=new d,t=5;t--;)e[h](t,t);return!e.has(-0)}),o||(((f=e(function(e,t){var n,r,i,s,o;return gl(e,f,a),n=new d,r=e,i=f,cl&&"function"==typeof(s=r.constructor)&&s!==i&&al(o=s.prototype)&&o!==i.prototype&&cl(n,o),e=n,null!=t&&fl(t,e[h],e,l),e})).prototype=p).constructor=f),(s||c)&&(n("delete"),n("has"),l&&n("get")),(c||i)&&n(h),u&&p.clear&&delete p.clear),g[a]=f,ll({global:!0,forced:f!=d},g),_l(f,a),u||t.setStrong(f,a,l),f},wl=A.f,bl=On,Il=Ar,Tl=Ae,El=Ve,Sl=N.exports,kl=nr,Cl=Ne,Al=C,Nl=xa.exports.fastKey,Rl=Pe.set,Pl=Pe.getterFor;rt("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},nr={getConstructor:function(e,n,r,i){function s(e,t,n){var r,i=c(e),s=o(e,t);return s?s.value=n:(i.last=s={index:r=Nl(t,!0),key:t,value:n,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=s),n&&(n.next=s),Al?i.size++:e.size++,"F"!==r&&(i.index[r]=s)),e}function o(e,t){var n,r=c(e);if("F"!==(e=Nl(t)))return r.index[e];for(n=r.first;n;n=n.next)if(n.key==t)return n}var a=e(function(e,t){El(e,a,n),Rl(e,{type:n,index:bl(null),first:void 0,last:void 0,size:0}),Al||(e.size=0),null!=t&&Sl(t,e[i],e,r)}),c=Pl(n);return Il(a.prototype,{clear:function(){for(var e=c(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,Al?e.size=0:this.size=0},delete:function(e){var t,n=c(this),r=o(this,e);return r&&(t=r.next,e=r.previous,delete n.index[r.index],r.removed=!0,e&&(e.next=t),t&&(t.previous=e),n.first==r&&(n.first=t),n.last==r&&(n.last=e),Al?n.size--:this.size--),!!r},forEach:function(e){for(var t,n=c(this),r=Tl(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!o(this,e)}}),Il(a.prototype,r?{get:function(e){return(e=o(this,e))&&e.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),Al&&wl(a.prototype,"size",{get:function(){return c(this).size}}),a},setStrong:function(e,t,n){var r=t+" Iterator",i=Pl(t),s=Pl(r);kl(e,t,function(e,t){Rl(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=s(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:e.target=void 0,done:!0}},n?"entries":"values",!n,!0),Cl(t)}}),_t.Map;var xl=E,Ol=Ae,Dl=N.exports;ie({target:"Map",stat:!0},{from:Ne=function(e){var t,n,r,i,s=arguments.length,o=1<s?arguments[1]:void 0;return xl(this),(t=void 0!==o)&&xl(o),null==e?new this:(n=[],t?(r=0,i=Ol(o,2<s?arguments[2]:void 0,2),Dl(e,function(e){n.push(i(e,r++))})):Dl(e,n.push,n),new this(n))}}),ie({target:"Map",stat:!0},{of:C=function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}});var Ll=T,Ml=E,Fl=xa=function(){for(var e,t=Ll(this),n=Ml(t.delete),r=!0,i=0,s=arguments.length;i<s;i++)e=n.call(t,arguments[i]),r=r&&e;return!!r};ie({target:"Map",proto:!0,real:!0,forced:!1},{deleteAll:function(){return Fl.apply(this,arguments)}});var Ul=T,ql=O,O=ie,jl=T,Vl=Ae,Bl=Pe=function(e){return Map.prototype.entries.call(e)},Kl=N.exports;O({target:"Map",proto:!0,real:!0,forced:!1},{every:function(e){var n=jl(this),t=Bl(n),r=Vl(e,1<arguments.length?arguments[1]:void 0,3);return!Kl(t,function(e,t){if(!r(t,e,n))return Kl.stop()},void 0,!0,!0).stopped}});var O=ie,zl=vt,$l=T,Wl=E,Hl=Ae,Gl=Vt,Ql=Pe,Yl=N.exports;O({target:"Map",proto:!0,real:!0,forced:!1},{filter:function(e){var n=$l(this),t=Ql(n),r=Hl(e,1<arguments.length?arguments[1]:void 0,3),i=new(Gl(n,zl("Map"))),s=Wl(i.set);return Yl(t,function(e,t){r(t,e,n)&&s.call(i,e,t)},void 0,!0,!0),i}});var O=ie,Jl=T,Xl=Ae,Zl=Pe,eu=N.exports;O({target:"Map",proto:!0,real:!0,forced:!1},{find:function(e){var n=Jl(this),t=Zl(n),r=Xl(e,1<arguments.length?arguments[1]:void 0,3);return eu(t,function(e,t){if(r(t,e,n))return eu.stop(t)},void 0,!0,!0).result}});var O=ie,tu=T,nu=Ae,ru=Pe,iu=N.exports;O({target:"Map",proto:!0,real:!0,forced:!1},{findKey:function(e){var n=tu(this),t=ru(n),r=nu(e,1<arguments.length?arguments[1]:void 0,3);return iu(t,function(e,t){if(r(t,e,n))return iu.stop(e)},void 0,!0,!0).result}});var O=ie,su=N.exports,ou=E;O({target:"Map",stat:!0},{groupBy:function(e,n){var r=new this;ou(n);var i=ou(r.has),s=ou(r.get),o=ou(r.set);return su(e,function(e){var t=n(e);i.call(r,t)?s.call(r,t).push(e):o.call(r,t,[e])}),r}});var O=ie,au=T,cu=Pe,lu=N.exports;O({target:"Map",proto:!0,real:!0,forced:!1},{includes:function(r){return lu(cu(au(this)),function(e,t){if((n=t)===(t=r)||n!=n&&t!=t)return lu.stop();var n},void 0,!0,!0).stopped}});var O=ie,uu=N.exports,hu=E;O({target:"Map",stat:!0},{keyBy:function(e,t){var n=new this;hu(t);var r=hu(n.set);return uu(e,function(e){r.call(n,t(e),e)}),n}});var O=ie,du=T,pu=Pe,fu=N.exports;O({target:"Map",proto:!0,real:!0,forced:!1},{keyOf:function(n){return fu(pu(du(this)),function(e,t){if(t===n)return fu.stop(e)},void 0,!0,!0).result}});var O=ie,gu=vt,mu=T,yu=E,vu=Ae,_u=Vt,wu=Pe,bu=N.exports;O({target:"Map",proto:!0,real:!0,forced:!1},{mapKeys:function(e){var n=mu(this),t=wu(n),r=vu(e,1<arguments.length?arguments[1]:void 0,3),i=new(_u(n,gu("Map"))),s=yu(i.set);return bu(t,function(e,t){s.call(i,r(t,e,n),t)},void 0,!0,!0),i}});var O=ie,Iu=vt,Tu=T,Eu=E,Su=Ae,ku=Vt,Cu=Pe,Au=N.exports;O({target:"Map",proto:!0,real:!0,forced:!1},{mapValues:function(e){var n=Tu(this),t=Cu(n),r=Su(e,1<arguments.length?arguments[1]:void 0,3),i=new(ku(n,Iu("Map"))),s=Eu(i.set);return Au(t,function(e,t){s.call(i,e,r(t,e,n))},void 0,!0,!0),i}});var O=ie,Nu=T,Ru=E,Pu=N.exports;O({target:"Map",proto:!0,real:!0,forced:!1},{merge:function(e){for(var t=Nu(this),n=Ru(t.set),r=0;r<arguments.length;)Pu(arguments[r++],n,t,!0);return t}});var O=ie,xu=T,Ou=E,Du=Pe,Lu=N.exports;O({target:"Map",proto:!0,real:!0,forced:!1},{reduce:function(n){var r=xu(this),e=Du(r),i=arguments.length<2,s=i?void 0:arguments[1];if(Ou(n),Lu(e,function(e,t){s=i?(i=!1,t):n(s,t,e,r)},void 0,!0,!0),i)throw TypeError("Reduce of empty map with no initial value");return s}});var O=ie,Mu=T,Fu=Ae,Uu=Pe,qu=N.exports;O({target:"Map",proto:!0,real:!0,forced:!1},{some:function(e){var n=Mu(this),t=Uu(n),r=Fu(e,1<arguments.length?arguments[1]:void 0,3);return qu(t,function(e,t){if(r(t,e,n))return qu.stop()},void 0,!0,!0).stopped}});var ju=T,Vu=E;ie({target:"Map",proto:!0,real:!0,forced:!1},{update:function(e,t){var n=ju(this),r=arguments.length;Vu(t);var i=n.has(e);if(!i&&r<3)throw TypeError("Updating absent value");return r=i?n.get(e):Vu(2<r?arguments[2]:void 0)(e,n),n.set(e,t(r,e,n)),n}});var Bu=T;ie({target:"Map",proto:!0,real:!0,forced:!1},{upsert:O=function(e,t){var n,r=Bu(this),i=2<arguments.length?arguments[2]:void 0;if("function"!=typeof t&&"function"!=typeof i)throw TypeError("At least one callback required");return r.has(e)?(n=r.get(e),"function"==typeof t&&(n=t(n),r.set(e,n))):"function"==typeof i&&(n=i(),r.set(e,n)),n}}),ie({target:"Map",proto:!0,real:!0,forced:!1},{updateOrInsert:O}),rt("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},nr),_t.Set,ie({target:"Set",stat:!0},{from:Ne}),ie({target:"Set",stat:!0},{of:C});var Ku=T,zu=E;ie({target:"Set",proto:!0,real:!0,forced:!1},{addAll:function(){return function(){for(var e=Ku(this),t=zu(e.add),n=0,r=arguments.length;n<r;n++)t.call(e,arguments[n]);return e}.apply(this,arguments)}});var $u=xa;ie({target:"Set",proto:!0,real:!0,forced:!1},{deleteAll:function(){return $u.apply(this,arguments)}});var xa=ie,Wu=T,Hu=Ae,Gu=C=function(e){return Set.prototype.values.call(e)},Qu=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{every:function(e){var t=Wu(this),n=Gu(t),r=Hu(e,1<arguments.length?arguments[1]:void 0,3);return!Qu(n,function(e){if(!r(e,e,t))return Qu.stop()},void 0,!1,!0).stopped}});var xa=ie,Yu=vt,Ju=T,Xu=E,Zu=Vt,eh=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{difference:function(e){var t=Ju(this),n=new(Zu(t,Yu("Set")))(t),r=Xu(n.delete);return eh(e,function(e){r.call(n,e)}),n}});var xa=ie,th=vt,nh=T,rh=E,ih=Ae,sh=Vt,oh=C,ah=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{filter:function(e){var t=nh(this),n=oh(t),r=ih(e,1<arguments.length?arguments[1]:void 0,3),i=new(sh(t,th("Set"))),s=rh(i.add);return ah(n,function(e){r(e,e,t)&&s.call(i,e)},void 0,!1,!0),i}});var xa=ie,ch=T,lh=Ae,uh=C,hh=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{find:function(e){var t=ch(this),n=uh(t),r=lh(e,1<arguments.length?arguments[1]:void 0,3);return hh(n,function(e){if(r(e,e,t))return hh.stop(e)},void 0,!1,!0).result}});var xa=ie,dh=vt,ph=T,fh=E,gh=Vt,mh=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{intersection:function(e){var t=ph(this),n=new(gh(t,dh("Set"))),r=fh(t.has),i=fh(n.add);return mh(e,function(e){r.call(t,e)&&i.call(n,e)}),n}});var xa=ie,yh=T,vh=E,_h=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{isDisjointFrom:function(e){var t=yh(this),n=vh(t.has);return!_h(e,function(e){if(!0===n.call(t,e))return _h.stop()}).stopped}});var xa=ie,wh=vt,bh=T,Ih=E,Th=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{isSubsetOf:function(e){var t=function(e){var t=ql(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return Ul(t.call(e))}(this),n=bh(e),r=n.has;return"function"!=typeof r&&(n=new(wh("Set"))(e),r=Ih(n.has)),!Th(t,function(e){if(!1===r.call(n,e))return Th.stop()},void 0,!1,!0).stopped}});var xa=ie,Eh=T,Sh=E,kh=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{isSupersetOf:function(e){var t=Eh(this),n=Sh(t.has);return!kh(e,function(e){if(!1===n.call(t,e))return kh.stop()}).stopped}});var xa=ie,Ch=T,Ah=C,Nh=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{join:function(e){var t=Ch(this),n=Ah(t),t=void 0===e?",":String(e);return Nh(n,(e=[]).push,e,!1,!0),e.join(t)}});var xa=ie,Rh=vt,Ph=T,xh=E,Oh=Ae,Dh=Vt,Lh=C,Mh=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{map:function(e){var t=Ph(this),n=Lh(t),r=Oh(e,1<arguments.length?arguments[1]:void 0,3),i=new(Dh(t,Rh("Set"))),s=xh(i.add);return Mh(n,function(e){s.call(i,r(e,e,t))},void 0,!1,!0),i}});var xa=ie,Fh=T,Uh=E,qh=C,jh=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{reduce:function(t){var n=Fh(this),e=qh(n),r=arguments.length<2,i=r?void 0:arguments[1];if(Uh(t),jh(e,function(e){i=r?(r=!1,e):t(i,e,e,n)},void 0,!1,!0),r)throw TypeError("Reduce of empty set with no initial value");return i}});var xa=ie,Vh=T,Bh=Ae,Kh=C,zh=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{some:function(e){var t=Vh(this),n=Kh(t),r=Bh(e,1<arguments.length?arguments[1]:void 0,3);return zh(n,function(e){if(r(e,e,t))return zh.stop()},void 0,!1,!0).stopped}});var xa=ie,$h=vt,Wh=T,Hh=E,Gh=Vt,Qh=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{symmetricDifference:function(e){var t=Wh(this),n=new(Gh(t,$h("Set")))(t),r=Hh(n.delete),i=Hh(n.add);return Qh(e,function(e){r.call(n,e)||i.call(n,e)}),n}});var xa=ie,Yh=vt,Jh=T,Xh=E,Zh=Vt,ed=N.exports;xa({target:"Set",proto:!0,real:!0,forced:!1},{union:function(e){var t=Jh(this),t=new(Zh(t,Yh("Set")))(t);return ed(e,Xh(t.add),t),t}});var td=WE,nd=Math.floor;function rd(n){const r=[];let i=0;for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);e<128?r[i++]=e:(e<2048?r[i++]=e>>6|192:(55296==(64512&e)&&t+1<n.length&&56320==(64512&n.charCodeAt(t+1))?(e=65536+((1023&e)<<10)+(1023&n.charCodeAt(++t)),r[i++]=e>>18|240,r[i++]=e>>12&63|128):r[i++]=e>>12|224,r[i++]=e>>6&63|128),r[i++]=63&e|128)}return r}function id(e){return e=rd(e),ld.encodeByteArray(e,!0)}ie({target:"Number",stat:!0},{isInteger:function(e){return!td(e)&&isFinite(e)&&nd(e)===e}}),_t.Number.isInteger;function sd(e){try{return ld.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}const od={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},ad=function(e,t){if(!e)throw cd(t)},cd=function(e){return new Error("Firebase Database ("+od.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},ld={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();var i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const s=[];for(let n=0;n<r.length;n+=3){var o=r[n],a=n+1<r.length,c=a?r[n+1]:0,l=n+2<r.length,u=l?r[n+2]:0;let e=(15&c)<<2|u>>6,t=63&u;l||(t=64,a||(e=64)),s.push(i[o>>2],i[(3&o)<<4|c>>4],i[e],i[t])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(rd(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var i,s,o=e[n++];o<128?t[r++]=String.fromCharCode(o):191<o&&o<224?(i=e[n++],t[r++]=String.fromCharCode((31&o)<<6|63&i)):239<o&&o<365?(s=((7&o)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))):(i=e[n++],s=e[n++],t[r++]=String.fromCharCode((15&o)<<12|(63&i)<<6|63&s))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(t,e){this.init_();var n=e?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let e=0;e<t.length;){var i=n[t.charAt(e++)],s=e<t.length?n[t.charAt(e)]:0;++e;var o=e<t.length?n[t.charAt(e)]:64;++e;var a=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==s||null==o||null==a)throw Error();r.push(i<<2|s>>4),64!==o&&(r.push(s<<4&240|o>>2),64!==a&&r.push(o<<6&192|a))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},ud=function(e){return id(e).replace(/\./g,"")};function hd(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const n=t;return new Date(n.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const r in t)t.hasOwnProperty(r)&&"__proto__"!==r&&(e[r]=hd(e[r],t[r]));return e}class dd{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(n){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof n&&(this.promise.catch(()=>{}),1===n.length?n(e):n(e,t))}}}function pd(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0;if(!(t=e.sub||e.user_id))throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return e=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:t,user_id:t,firebase:{sign_in_provider:"custom",identities:{}}},e),[ud(JSON.stringify({alg:"none",type:"JWT"})),ud(JSON.stringify(e)),""].join(".")}function fd(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function gd(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(fd())}function md(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return}}function yd(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function vd(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function _d(){const e=fd();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function wd(){return!0===od.NODE_ADMIN}function bd(){return"object"==typeof indexedDB}function Id(){return new Promise((t,n)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var e;n((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){n(e)}})}function Td(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class Ed extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Ed.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Sd.prototype.create)}}class Sd{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},t=`${this.service}/${e}`,e=(e=this.errors[e])?(r=n,e.replace(kd,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",e=`${this.serviceName}: ${e} (${t}).`;return new Ed(t,e,n)}}const kd=/\{\$([^}]+)}/g;function Cd(e){return JSON.parse(e)}function Ad(e){return JSON.stringify(e)}function Nd(e){let t={},n={},r={},i="";try{var s=e.split(".");t=Cd(sd(s[0])||""),n=Cd(sd(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function Rd(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Pd(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function xd(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Od(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function Dd(e,t){if(e===t)return 1;const n=Object.keys(e),r=Object.keys(t);for(const o of n){if(!r.includes(o))return;var i=e[o],s=t[o];if(Ld(i)&&Ld(s)){if(!Dd(i,s))return}else if(i!==s)return}for(const a of r)if(!n.includes(a))return;return 1}function Ld(e){return null!==e&&"object"==typeof e}function Md(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Fd(e){const n={},t=e.replace(/^\?/,"").split("&");return t.forEach(e=>{var t;e&&([t,e]=e.split("="),n[decodeURIComponent(t)]=decodeURIComponent(e))}),n}function Ud(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,0<n?n:void 0)}class qd{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,n){n=n||0;const r=this.W_;if("string"==typeof t)for(let e=0;e<16;e++)r[e]=t.charCodeAt(n)<<24|t.charCodeAt(n+1)<<16|t.charCodeAt(n+2)<<8|t.charCodeAt(n+3),n+=4;else for(let e=0;e<16;e++)r[e]=t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3],n+=4;for(let e=16;e<80;e++){var i=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=4294967295&(i<<1|i>>>31)}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4],u,h;for(let e=0;e<80;e++){h=e<40?e<20?(u=c^o&(a^c),1518500249):(u=o^a^c,1859775393):e<60?(u=o&a|c&(o|a),2400959708):(u=o^a^c,3395469782);var d=(s<<5|s>>>27)+u+l+h+r[e]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=d}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(n,r){if(null!=n){var i=(r=void 0===r?n.length:r)-this.blockSize;let e=0;const s=this.buf_;let t=this.inbuf_;for(;e<r;){if(0===t)for(;e<=i;)this.compress_(n,e),e+=this.blockSize;if("string"==typeof n){for(;e<r;)if(s[t]=n.charCodeAt(e),++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}else for(;e<r;)if(s[t]=n[e],++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}this.inbuf_=t,this.total_+=r}}digest(){const n=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;56<=e;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let r=0;for(let t=0;t<5;t++)for(let e=24;0<=e;e-=8)n[r]=this.chain_[t]>>e&255,++r;return n}}function jd(e,t){const n=new Vd(e,t);return n.subscribe.bind(n)}class Vd{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");return r=function(e){if("object"==typeof e&&null!==e)for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return 1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=Bd),void 0===r.error&&(r.error=Bd),void 0===r.complete&&(r.complete=Bd),n=this.unsubscribeOne.bind(this,this.observers.length),this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),n}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Bd(){}function Kd(e,t,n,r){let i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i)throw r=e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".",new Error(r)}function zd(e,t){return`${e} failed: ${t} argument `}function $d(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(zd(e,t)+"must be a valid function.")}function Wd(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(zd(e,t)+"must be a valid context object.")}const Hd=function(t){let n=0;for(let e=0;e<t.length;e++){var r=t.charCodeAt(e);r<128?n++:r<2048?n+=2:55296<=r&&r<=56319?(n+=4,e++):n+=3}return n};function Gd(e,t=1e3,n=2){return n=t*Math.pow(n,e),e=Math.round(.5*n*(Math.random()-.5)*2),Math.min(144e5,n+e)}function Qd(e){return e&&e._delegate?e._delegate:e}function Yd(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function Jd(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xd(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function Zd(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||((r=r||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var ep=(tp.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},tp.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},tp.prototype.setServiceProps=function(e){return this.serviceProps=e,this},tp.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},tp);function tp(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}var np="[DEFAULT]",rp=(ip.prototype.get=function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)&&(e=new dd,this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize()))try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}return this.instancesDeferred.get(t).promise},ip.prototype.getImmediate=function(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),e=null!==(e=null==e?void 0:e.optional)&&void 0!==e&&e;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(e)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(t){if(e)return null;throw t}},ip.prototype.getComponent=function(){return this.component},ip.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:np})}catch(e){}try{for(var r=Jd(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var s=Xd(i.value,2),o=s[0],a=s[1],c=this.normalizeInstanceIdentifier(o);try{var l=this.getOrInitializeService({instanceIdentifier:c});a.resolve(l)}catch(e){}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}},ip.prototype.clearInstance=function(e){this.instancesDeferred.delete(e=void 0===e?np:e),this.instancesOptions.delete(e),this.instances.delete(e)},ip.prototype.delete=function(){return e=this,c=function(){var t,n,r,i,s,o,a,e;return n=this,r=function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(Zd(Zd([],Xd(t.filter(function(e){return"INTERNAL"in e}).map(function(e){return e.INTERNAL.delete()}))),Xd(t.filter(function(e){return"_delete"in e}).map(function(e){return e._delete()}))))];case 1:return e.sent(),[2]}},a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function c(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(o=2&t[0]?s.return:t[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,t[1])).done)return o;switch(s=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],s=0}finally{i=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},new(a=(a=o=void 0)||Promise)(function(n,t){function r(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,i)}s((c=c.apply(e,o||[])).next())});var e,o,a,c},ip.prototype.isComponentSet=function(){return null!=this.component},ip.prototype.isInitialized=function(e){return this.instances.has(e=void 0===e?np:e)},ip.prototype.getOptions=function(e){return this.instancesOptions.get(e=void 0===e?np:e)||{}},ip.prototype.initialize=function(e){var t,n,r=void 0===(r=(e=void 0===e?{}:e).options)?{}:r,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(this.name+"("+i+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var s=this.getOrInitializeService({instanceIdentifier:i,options:r});try{for(var o=Jd(this.instancesDeferred.entries()),a=o.next();!a.done;a=o.next()){var c=Xd(a.value,2),l=c[0],u=c[1];i===this.normalizeInstanceIdentifier(l)&&u.resolve(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return s},ip.prototype.onInit=function(e,t){var n=this.normalizeInstanceIdentifier(t),r=null!==(t=this.onInitCallbacks.get(n))&&void 0!==t?t:new Set;return r.add(e),this.onInitCallbacks.set(n,r),(t=this.instances.get(n))&&e(t,n),function(){r.delete(e)}},ip.prototype.invokeOnInitCallbacks=function(e,t){var n,r,i=this.onInitCallbacks.get(t);if(i)try{for(var s=Jd(i),o=s.next();!o.done;o=s.next()){var a=o.value;try{a(e,t)}catch(e){}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},ip.prototype.getOrInitializeService=function(e){var t=e.instanceIdentifier,n=e.options,r=void 0===n?{}:n;if(!(e=this.instances.get(t))&&this.component&&(e=this.component.instanceFactory(this.container,{instanceIdentifier:(n=t)===np?void 0:n,options:r}),this.instances.set(t,e),this.instancesOptions.set(t,r),this.invokeOnInitCallbacks(e,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,e)}catch(e){}return e||null},ip.prototype.normalizeInstanceIdentifier=function(e){return void 0===e&&(e=np),!this.component||this.component.multipleInstances?e:np},ip.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},ip);function ip(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}var sp,op=(ap.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},ap.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},ap.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new rp(e,this);return this.providers.set(e,t),t},ap.prototype.getProviders=function(){return Array.from(this.providers.values())},ap);function ap(e){this.name=e,this.providers=new Map}const cp=[];(xa=sp=sp||{})[xa.DEBUG=0]="DEBUG",xa[xa.VERBOSE=1]="VERBOSE",xa[xa.INFO=2]="INFO",xa[xa.WARN=3]="WARN",xa[xa.ERROR=4]="ERROR",xa[xa.SILENT=5]="SILENT";const lp={debug:sp.DEBUG,verbose:sp.VERBOSE,info:sp.INFO,warn:sp.WARN,error:sp.ERROR,silent:sp.SILENT},up=sp.INFO,hp={[sp.DEBUG]:"log",[sp.VERBOSE]:"log",[sp.INFO]:"info",[sp.WARN]:"warn",[sp.ERROR]:"error"},dp=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=hp[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};class pp{constructor(e){this.name=e,this._logLevel=up,this._logHandler=dp,this._userLogHandler=null,cp.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in sp))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?lp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,sp.DEBUG,...e),this._logHandler(this,sp.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,sp.VERBOSE,...e),this._logHandler(this,sp.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,sp.INFO,...e),this._logHandler(this,sp.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,sp.WARN,...e),this._logHandler(this,sp.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,sp.ERROR,...e),this._logHandler(this,sp.ERROR,...e)}}class fp{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{return"VERSION"===(null==(t=(t=e).getComponent())?void 0:t.type)?`${(e=e.getImmediate()).library}/${e.version}`:null;var t}).filter(e=>e).join(" ")}}const gp=new pp("@firebase/app"),mp="[DEFAULT]",yp={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},vp=new Map,_p=new Map;function wp(t,n){try{t.container.addComponent(n)}catch(e){gp.debug(`Component ${n.name} failed to register with FirebaseApp ${t.name}`,e)}}function bp(e,t){e.container.addOrOverwriteComponent(t)}function Ip(e){var t=e.name;if(_p.has(t))return gp.debug(`There were multiple attempts to register component ${t}.`),!1;_p.set(t,e);for(const n of vp.values())wp(n,e);return!0}function Tp(e,t){return e.container.getProvider(t)}const Ep=new Sd("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class Sp{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ep("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ep.create("app-deleted",{appName:this._name})}}const kp="9.1.2";function Cp(e,t={}){if("object"!=typeof t){const r=t;t={name:r}}var n=Object.assign({name:mp,automaticDataCollectionEnabled:!1},t);const r=n.name;if("string"!=typeof r||!r)throw Ep.create("bad-app-name",{appName:String(r)});if(t=vp.get(r)){if(Dd(e,t.options)&&Dd(n,t.config))return t;throw Ep.create("duplicate-app",{appName:r})}const i=new op(r);for(const s of _p.values())i.addComponent(s);return n=new Sp(e,n,i),vp.set(r,n),n}function Ap(e=mp){var t=vp.get(e);if(!t)throw Ep.create("no-app",{appName:e});return t}async function Np(e){var t=e.name;vp.has(t)&&(vp.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function Rp(e,t,n){var r;let i=null!==(r=yp[e])&&void 0!==r?r:e;if(n&&(i+=`-${n}`),e=i.match(/\s|\//),n=t.match(/\s|\//),e||n){const s=[`Unable to register library "${i}" with version "${t}":`];return e&&s.push(`library name "${i}" contains illegal characters (whitespace or "/")`),e&&n&&s.push("and"),n&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void gp.warn(s.join(" "))}Ip(new ep(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}function Pp(e,t){if(null!==e&&"function"!=typeof e)throw Ep.create("invalid-log-argument");!function(s,e){for(const t of cp){let i=null;e&&e.level&&(i=lp[e.level]),t.userLogHandler=null===s?null:(e,t,...n)=>{var r=n.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");t>=(null!==i&&void 0!==i?i:e.logLevel)&&s({level:sp[t].toLowerCase(),message:r,args:n,type:e.name})}}}(e,t)}function xp(e){var t=e;cp.forEach(e=>{e.setLogLevel(t)})}Ip(new ep("platform-logger",e=>new fp(e),"PRIVATE")),Rp("@firebase/app","0.7.3",void 0),Rp("fire-js","");var Op=Object.freeze({__proto__:null,SDK_VERSION:kp,_DEFAULT_ENTRY_NAME:mp,_addComponent:wp,_addOrOverwriteComponent:bp,_apps:vp,_clearComponents:function(){_p.clear()},_components:_p,_getProvider:Tp,_registerComponent:Ip,_removeServiceInstance:function(e,t,n=mp){Tp(e,t).clearInstance(n)},deleteApp:Np,getApp:Ap,getApps:function(){return Array.from(vp.values())},initializeApp:Cp,onLog:Pp,registerVersion:Rp,setLogLevel:xp,FirebaseError:Ed});class Dp{constructor(e,t){this._delegate=e,this.firebase=t,wp(e,new ep("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),Np(this._delegate)))}_getService(e,t=mp){this._delegate.checkDestroyed();const n=this._delegate.container.getProvider(e);return n.isInitialized()||"EXPLICIT"!==(null===(e=n.getComponent())||void 0===e?void 0:e.instantiationMode)||n.initialize(),n.getImmediate({identifier:t})}_removeServiceInstance(e,t=mp){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){wp(this._delegate,e)}_addOrOverwriteComponent(e){bp(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Lp=new Sd("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});WE=function e(){const t=function(i){const n={},s={__esModule:!0,initializeApp:function(e,t={}){return e=Cp(e,t),Rd(n,e.name)?n[e.name]:(t=new i(e,s),n[e.name]=t)},app:o,registerVersion:Rp,setLogLevel:xp,onLog:Pp,apps:null,SDK_VERSION:kp,INTERNAL:{registerComponent:function(n){const r=n.name,t=r.replace("-compat","");var e;return Ip(n)&&"PUBLIC"===n.type&&(e=(e=o())=>{if("function"!=typeof e[t])throw Lp.create("invalid-app-argument",{appName:r});return e[t]()},void 0!==n.serviceProps&&hd(e,n.serviceProps),s[t]=e,i.prototype[t]=function(...e){const t=this._getService.bind(this,r);return t.apply(this,n.multipleInstances?e:[])}),"PUBLIC"===n.type?s[t]:null},removeApp:function(e){delete n[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:Op}};function o(e){if(e=e||mp,!Rd(n,e))throw Lp.create("no-app",{appName:e});return n[e]}return s.default=s,Object.defineProperty(s,"apps",{get:function(){return Object.keys(n).map(e=>n[e])}}),o.App=i,s}(Dp);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){hd(t,e)},createSubscribe:jd,ErrorFactory:Sd,deepExtend:hd}),t}();const Mp=new pp("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){Mp.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const Vj=self.firebase.SDK_VERSION;Vj&&0<=Vj.indexOf("LITE")&&Mp.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const Fp=WE;function Up(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function qp(n,r,i){var s,e=new Promise(function(e,t){Up(s=n[r].apply(n,i)).then(e,t)});return e.request=s,e}function jp(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function Vp(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return qp(this[n],e,arguments)})})}function Bp(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function Kp(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=qp(e,n,arguments)).then(function(e){if(e)return new $p(e,t.request)});var e,t})})}function zp(e){this._index=e}function $p(e,t){this._cursor=e,this._request=t}function Wp(e){this._store=e}function Hp(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function Gp(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new Hp(n)}function Qp(e){this._db=e}function Yp(e,t,n){var r=(t=qp(indexedDB,"open",[e,t])).request;return r&&(r.onupgradeneeded=function(e){n&&n(new Gp(r.result,e.oldVersion,r.transaction))}),t.then(function(e){return new Qp(e)})}function Jp(e){return qp(indexedDB,"deleteDatabase",[e])}Rp("@firebase/app-compat","0.1.4",void 0),Fp.registerVersion("firebase","9.1.2","app-compat"),jp(zp,"_index",["name","keyPath","multiEntry","unique"]),Vp(zp,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),Kp(zp,"_index",IDBIndex,["openCursor","openKeyCursor"]),jp($p,"_cursor",["direction","key","primaryKey","value"]),Vp($p,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&($p.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),Up(t._request).then(function(e){if(e)return new $p(e,t._request)})})})}),Wp.prototype.createIndex=function(){return new zp(this._store.createIndex.apply(this._store,arguments))},Wp.prototype.index=function(){return new zp(this._store.index.apply(this._store,arguments))},jp(Wp,"_store",["name","keyPath","indexNames","autoIncrement"]),Vp(Wp,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),Kp(Wp,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),Bp(Wp,"_store",IDBObjectStore,["deleteIndex"]),Hp.prototype.objectStore=function(){return new Wp(this._tx.objectStore.apply(this._tx,arguments))},jp(Hp,"_tx",["objectStoreNames","mode"]),Bp(Hp,"_tx",IDBTransaction,["abort"]),Gp.prototype.createObjectStore=function(){return new Wp(this._db.createObjectStore.apply(this._db,arguments))},jp(Gp,"_db",["name","version","objectStoreNames"]),Bp(Gp,"_db",IDBDatabase,["deleteObjectStore","close"]),Qp.prototype.transaction=function(){return new Hp(this._db.transaction.apply(this._db,arguments))},jp(Qp,"_db",["name","version","objectStoreNames"]),Bp(Qp,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[Wp,zp].forEach(function(e){i in e.prototype&&(e.prototype[i.replace("open","iterate")]=function(){var e=(n=arguments,Array.prototype.slice.call(n)),t=e[e.length-1],n=this._store||this._index,r=n[i].apply(n,e.slice(0,-1));r.onsuccess=function(){t(r.result)}})})}),[zp,Wp].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,i=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(i.push(e.value),void 0===n||i.length!=n?e.continue():t(i)):t(i)})})})});const Xp=1e4,Zp="w:0.5.1",ef="FIS_v2",tf="https://firebaseinstallations.googleapis.com/v1",nf=36e5,rf=new Sd("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function sf(e){return e instanceof Ed&&e.code.includes("request-failed")}function of({projectId:e}){return`${tf}/projects/${e}/installations`}function af(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function cf(e,t){return t=(await t.json()).error,rf.create("request-failed",{requestName:e,serverCode:t.code,serverMessage:t.message,serverStatus:t.status})}function lf({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function uf(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function hf(t){return new Promise(e=>{setTimeout(e,t)})}const df=/^[cdef][\w-]{21}$/,pf="";function ff(e){return`${e.appName}!${e.appId}`}const gf=new Map;function mf(e,t){yf(e=ff(e),t),function(e,t){const n=(!vf&&"BroadcastChannel"in self&&(vf=new BroadcastChannel("[Firebase] FID Change"),vf.onmessage=e=>{yf(e.data.key,e.data.fid)}),vf);n&&n.postMessage({key:e,fid:t}),0===gf.size&&vf&&(vf.close(),vf=null)}(e,t)}function yf(e,t){if(e=gf.get(e))for(const n of e)n(t)}let vf=null;const _f="firebase-installations-store";let wf=null;function bf(){return wf=wf||Yp("firebase-installations-database",1,e=>{0===e.oldVersion&&e.createObjectStore(_f)}),wf}async function If(e,t){var n=ff(e);const r=await bf(),i=r.transaction(_f,"readwrite"),s=i.objectStore(_f);var o=await s.get(n);return await s.put(t,n),await i.complete,o&&o.fid===t.fid||mf(e,t.fid),t}async function Tf(e){e=ff(e);const t=await bf(),n=t.transaction(_f,"readwrite");await n.objectStore(_f).delete(e),await n.complete}async function Ef(e,t){var n=ff(e);const r=await bf(),i=r.transaction(_f,"readwrite"),s=i.objectStore(_f);var o=await s.get(n);return void 0===(t=t(o))?await s.delete(n):await s.put(t,n),await i.complete,!t||o&&o.fid===t.fid||mf(e,t.fid),t}async function Sf(r){let i;var e=await Ef(r,e=>{var t,n;return e=Cf(e||{fid:function(){try{const t=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){const e=function(){const e=btoa(String.fromCharCode(...t));return e.replace(/\+/g,"-").replace(/\//g,"_")}();return e.substr(0,22)}(t);return df.test(e)?e:pf}catch(e){return pf}}(),registrationStatus:0}),t=r,e=0!==(n=e).registrationStatus?1===n.registrationStatus?{installationEntry:n,registrationPromise:async function(e){let t=await kf(e);for(;1===t.registrationStatus;)await hf(100),t=await kf(e);if(0!==t.registrationStatus)return t;var{installationEntry:n,registrationPromise:r}=await Sf(e);return r||n}(t)}:{installationEntry:n}:navigator.onLine?{installationEntry:n={fid:n.fid,registrationStatus:1,registrationTime:Date.now()},registrationPromise:t=async function(t,n){try{return If(t,await async function(e,{fid:t}){const n=of(e);var r=lf(e),e={fid:t,authVersion:ef,appId:e.appId,sdkVersion:Zp};const i={method:"POST",headers:r,body:JSON.stringify(e)},s=await uf(()=>fetch(n,i));if(s.ok)return{fid:(e=await s.json()).fid||t,registrationStatus:2,refreshToken:e.refreshToken,authToken:af(e.authToken)};throw await cf("Create Installation",s)}(t,n))}catch(e){throw sf(e)&&409===e.customData.serverCode?await Tf(t):await If(t,{fid:n.fid,registrationStatus:0}),e}}(t,n)}:{installationEntry:n,registrationPromise:Promise.reject(rf.create("app-offline"))},i=e.registrationPromise,e.installationEntry});return e.fid===pf?{installationEntry:await i}:{installationEntry:e,registrationPromise:i}}function kf(e){return Ef(e,e=>{if(!e)throw rf.create("installation-not-found");return Cf(e)})}function Cf(e){return 1===e.registrationStatus&&e.registrationTime+Xp<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function Af({appConfig:e,platformLoggerProvider:t},n){const r=([i,s]=[e,n.fid],`${of(i)}/${s}/authTokens:generate`);var i,s;const o=function(e,{refreshToken:t}){const n=lf(e);return n.append("Authorization",`${ef} ${t}`),n}(e,n),a=t.getImmediate({optional:!0});a&&o.append("x-firebase-client",a.getPlatformInfoString()),t={installation:{sdkVersion:Zp}};const c={method:"POST",headers:o,body:JSON.stringify(t)},l=await uf(()=>fetch(r,c));if(l.ok)return af(await l.json());throw await cf("Generate Auth Token",l)}async function Nf(s,o=!1){let a;var e=await Ef(s.appConfig,e=>{if(!Pf(e))throw rf.create("not-registered");var t,n,r,i=e.authToken;if(o||2!==(t=i).requestStatus||(n=t,(r=Date.now())<n.creationTime||n.creationTime+n.expiresIn<r+nf)){if(1===i.requestStatus)return a=async function(e,t){let n=await Rf(e.appConfig);for(;1===n.authToken.requestStatus;)await hf(100),n=await Rf(e.appConfig);var r=n.authToken;return 0===r.requestStatus?Nf(e,t):r}(s,o),e;if(!navigator.onLine)throw rf.create("app-offline");return t=e,i={requestStatus:1,requestTime:Date.now()},i=Object.assign(Object.assign({},t),{authToken:i}),a=async function(e,t){try{var n=await Af(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await If(e.appConfig,r),n}catch(n){throw!sf(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode?(t=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}),await If(e.appConfig,t)):await Tf(e.appConfig),n}}(s,i),i}return e});return a?await a:e.authToken}function Rf(e){return Ef(e,e=>{if(!Pf(e))throw rf.create("not-registered");var t=e.authToken;return 1===t.requestStatus&&t.requestTime+Xp<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function Pf(e){return void 0!==e&&2===e.registrationStatus}function xf(e){return rf.create("missing-app-config-values",{valueName:e})}const Of="installations";Ip(new ep(Of,e=>({app:e=e.getProvider("app").getImmediate(),appConfig:function(e){if(!e||!e.options)throw xf("App Configuration");if(!e.name)throw xf("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw xf(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(e),platformLoggerProvider:Tp(e,"platform-logger"),_delete:()=>Promise.resolve()}),"PUBLIC")),Ip(new ep("installations-internal",e=>{const t=Tp(e.getProvider("app").getImmediate(),Of).getImmediate();return{getId:()=>async function(e){const{installationEntry:t,registrationPromise:n}=await Sf(e.appConfig);return(n||Nf(e)).catch(console.error),t.fid}(t),getToken:e=>async function(e,t=!1){var n=e;return await((e=(await Sf(e=n.appConfig)).registrationPromise)&&await e),(await Nf(n,t)).token}(t,e)}},"PRIVATE")),Rp("@firebase/installations","0.5.1");const Df="analytics",Lf="firebase_id",Mf="origin",Ff="https://www.googletagmanager.com/gtag/js",Uf=new pp("@firebase/analytics");function qf(e){return Promise.all(e.map(e=>e.catch(e=>e)))}const jf=new Sd("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),Vf=30,Bf=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function Kf(e,t=Bf,n){var{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw jf.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw jf.create("no-api-key")}e=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()};const o=new zf;return setTimeout(async()=>{o.abort()},void 0!==n?n:6e4),async function e(t,{throttleEndTimeMillis:n,backoffCount:r},i,s=Bf){var o,a,{appId:c,measurementId:l}=t;try{o=i,a=n,await new Promise((e,t)=>{var n=Math.max(a-Date.now(),0);const r=setTimeout(e,n);o.addEventListener(()=>{clearTimeout(r),t(jf.create("fetch-throttle",{throttleEndTimeMillis:a}))})})}catch(n){if(l)return Uf.warn("Timed out fetching this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${l}`+` provided in the "measurementId" field in the local Firebase config. [${n.message}]`),{appId:c,measurementId:l};throw n}try{var u=await async function(t){var n,{appId:e,apiKey:t}=t,t={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":t})},e="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",e);const r=await fetch(e,t);if(200===r.status||304===r.status)return r.json();{let e="";try{var i=await r.json();null!==(n=i.error)&&void 0!==n&&n.message&&(e=i.error.message)}catch(t){}throw jf.create("config-fetch-failed",{httpStatus:r.status,responseMessage:e})}}(t);return s.deleteThrottleMetadata(c),u}catch(n){if(!((u=n)instanceof Ed&&u.customData)||429!==(u=Number(u.customData.httpStatus))&&500!==u&&503!==u&&504!==u){if(s.deleteThrottleMetadata(c),l)return Uf.warn("Failed to fetch this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${l}`+` provided in the "measurementId" field in the local Firebase config. [${n.message}]`),{appId:c,measurementId:l};throw n}l=503===Number(n.customData.httpStatus)?Gd(r,s.intervalMillis,Vf):Gd(r,s.intervalMillis),r={throttleEndTimeMillis:Date.now()+l,backoffCount:r+1};return s.setThrottleMetadata(c,r),Uf.debug(`Calling attemptFetch again in ${l} millis`),e(t,r,i,s)}}({appId:r,apiKey:i,measurementId:s},e,o,t)}class zf{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function $f(t,e,n,r,i,s,o){const a=Kf(t);a.then(e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Uf.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>Uf.error(e)),e.push(a);var c=async function(){if(!bd())return Uf.warn(jf.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await Id()}catch(e){return Uf.warn(jf.create("indexeddb-unavailable",{errorInfo:e}).message),!1}return!0}().then(e=>{if(e)return r.getId()}),[e,c]=await Promise.all([a,c]);!function(){var e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Ff))return t}()&&function(e,t){const n=document.createElement("script");n.src=`${Ff}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(s,e.measurementId),i("js",new Date);const l=null!==(o=null==o?void 0:o.config)&&void 0!==o?o:{};return l[Mf]="firebase",l.update=!0,null!=c&&(l[Lf]=c),i("config",e.measurementId,l),e.measurementId}class Wf{constructor(e){this.app=e}_delete(){return delete Hf[this.app.options.appId],Promise.resolve()}}let Hf={},Gf=[];const Qf={};let Yf="dataLayer",Jf="gtag",Xf,Zf,eg=!1;function tg(e,t,n){!function(){const e=[];var t;yd()&&e.push("This is a browser extension environment."),Td()||e.push("Cookies are not available."),0<e.length&&(t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=jf.create("invalid-analytics-context",{errorInfo:t}),Uf.warn(t.message))}();var r,i,s=e.options.appId;if(!s)throw jf.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw jf.create("no-api-key");Uf.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest'+` measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId}`+' provided in the "measurementId" field in the local Firebase config.')}if(null!=Hf[s])throw jf.create("already-exists",{id:s});return eg||(function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t,t}(Yf),{wrappedGtag:r,gtagCore:i}=function(e,t,n,r,i){let s=function(){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=(o=s,a=e,c=t,l=n,async function(e,t,n){try{"event"===e?await async function(e,n,r,i,s){try{let t=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const c=await qf(r);for(const l of e){var o=c.find(e=>e.measurementId===l),a=o&&n[o.appId];if(!a){t=[];break}t.push(a)}}0===t.length&&(t=Object.values(n)),await Promise.all(t),e("event",i,s||{})}catch(e){Uf.error(e)}}(o,a,c,t,n):"config"===e?await async function(e,t,n,r,i,s){r=l[i];try{if(r)await t[r];else{const a=await qf(n);var o=a.find(e=>e.measurementId===i);o&&await t[o.appId]}}catch(e){Uf.error(e)}e("config",i,s)}(o,a,c,0,t,n):o("set",t)}catch(e){Uf.error(e)}}),{gtagCore:s,wrappedGtag:window[i]};var o,a,c,l}(Hf,Gf,Qf,Yf,Jf),Zf=r,Xf=i,eg=!0),Hf[s]=$f(e,Gf,Qf,t,Xf,Yf,n),new Wf(e)}function ng(e,t,n,i){e=Qd(e),async function(e,t,n,r){i&&i.global?e("event",n,r):(t=await t,e("event",n,Object.assign(Object.assign({},r),{send_to:t})))}(Zf,Hf[e.app.options.appId],t,n).catch(e=>Uf.error(e))}Ip(new ep(Df,(e,{options:t})=>tg(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),Ip(new ep("analytics-internal",function(e){try{const r=e.getProvider(Df).getImmediate();return{logEvent:(e,t,n)=>ng(r,e,t,n)}}catch(e){throw jf.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),Rp("@firebase/analytics","0.7.1");class rg{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){ng(this._delegate,e,t,n)}setCurrentScreen(e,t){var n,r;n=this._delegate,e=e,r=t,n=Qd(n),async function(e,t,n){return r&&r.global?(e("set",{screen_name:n}),Promise.resolve()):void e("config",await t,{update:!0,screen_name:n})}(Zf,Hf[n.app.options.appId],e).catch(e=>Uf.error(e))}setUserId(e,t){var n,r;n=this._delegate,e=e,r=t,n=Qd(n),async function(e,t,n){return r&&r.global?(e("set",{user_id:n}),Promise.resolve()):void e("config",await t,{update:!0,user_id:n})}(Zf,Hf[n.app.options.appId],e).catch(e=>Uf.error(e))}setUserProperties(e,t){var n,s;n=this._delegate,e=e,s=t,n=Qd(n),async function(e,t,n){if(s&&s.global){const r={};for(const i of Object.keys(n))r[`user_properties.${i}`]=n[i];return e("set",r),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(Zf,Hf[n.app.options.appId],e).catch(e=>Uf.error(e))}setAnalyticsCollectionEnabled(e){var t;t=this._delegate,e=e,t=Qd(t),async function(e,t){e=await e,window[`ga-disable-${e}`]=!t}(Hf[t.app.options.appId],e).catch(e=>Uf.error(e))}}(ie=C={}).ADD_SHIPPING_INFO="add_shipping_info",ie.ADD_PAYMENT_INFO="add_payment_info",ie.ADD_TO_CART="add_to_cart",ie.ADD_TO_WISHLIST="add_to_wishlist",ie.BEGIN_CHECKOUT="begin_checkout",ie.CHECKOUT_PROGRESS="checkout_progress",ie.EXCEPTION="exception",ie.GENERATE_LEAD="generate_lead",ie.LOGIN="login",ie.PAGE_VIEW="page_view",ie.PURCHASE="purchase",ie.REFUND="refund",ie.REMOVE_FROM_CART="remove_from_cart",ie.SCREEN_VIEW="screen_view",ie.SEARCH="search",ie.SELECT_CONTENT="select_content",ie.SELECT_ITEM="select_item",ie.SELECT_PROMOTION="select_promotion",ie.SET_CHECKOUT_OPTION="set_checkout_option",ie.SHARE="share",ie.SIGN_UP="sign_up",ie.TIMING_COMPLETE="timing_complete",ie.VIEW_CART="view_cart",ie.VIEW_ITEM="view_item",ie.VIEW_ITEM_LIST="view_item_list",ie.VIEW_PROMOTION="view_promotion",ie.VIEW_SEARCH_RESULTS="view_search_results";E={Analytics:rg,settings:function(e){if(eg)throw jf.create("already-initialized");e.dataLayerName&&(Yf=e.dataLayerName),e.gtagName&&(Jf=e.gtagName)},isSupported:async function(){if(yd())return!1;if(!Td())return!1;if(!bd())return!1;try{return Id()}catch(e){return!1}},EventName:C};Fp.INTERNAL.registerComponent(new ep("analytics-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("analytics").getImmediate();return new rg(t,e)},"PUBLIC").setServiceProps(E).setMultipleInstances(!0)),Fp.registerVersion("@firebase/analytics-compat","0.1.2");const ig=new Map,sg={activated:!1,tokenObservers:[]},og={initialized:!1,enabled:!1};function ag(e){return ig.get(e)||sg}function cg(e,t){ig.set(e,t)}const lg="https://content-firebaseappcheck.googleapis.com/v1beta",ug={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class hg{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=r))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new dd,t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new dd,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){return e?(this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration()):(e=this.nextErrorWaitInterval,this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e)}}const dg=new Sd("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error."});function pg(){return self.grecaptcha}function fg(e){if(!ag(e).activated)throw dg.create("use-before-activation",{appName:e.name})}async function gg({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});i&&(r["X-Firebase-Client"]=i.getPlatformInfoString()),t={method:"POST",body:JSON.stringify(t),headers:r};let s;try{s=await fetch(e,t)}catch(e){throw dg.create("fetch-network-error",{originalErrorMessage:e.message})}if(200!==s.status)throw dg.create("fetch-status-error",{httpStatus:s.status});let o;try{o=await s.json()}catch(e){throw dg.create("fetch-parse-error",{originalErrorMessage:e.message})}if(!(e=o.ttl.match(/^([\d.]+)(s)$/))||!e[2]||isNaN(Number(e[1])))throw dg.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration "+`format: ${o.ttl}`});return t=1e3*Number(e[1]),e=Date.now(),{token:o.attestationToken,expireTimeMillis:e+t,issuedAtTimeMillis:e}}const mg="firebase-app-check-store",yg="debug-token";let vg=null;function _g(){return vg||(vg=new Promise((t,n)=>{try{const e=indexedDB.open("firebase-app-check-database",1);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(dg.create("storage-open",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(mg,{keyPath:"compositeKey"})}}catch(e){n(dg.create("storage-open",{originalErrorMessage:e.message}))}}),vg)}async function wg(e,t){const n=await _g(),r=n.transaction(mg,"readwrite"),i=r.objectStore(mg),s=i.put({compositeKey:e,value:t});return new Promise((t,n)=>{s.onsuccess=e=>{t()},r.onerror=e=>{n(dg.create("storage-set",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))}})}async function bg(e){const t=await _g(),r=t.transaction(mg,"readonly"),n=r.objectStore(mg),i=n.get(e);return new Promise((t,n)=>{i.onsuccess=e=>{e=e.target.result,t(e?e.value:void 0)},r.onerror=e=>{n(dg.create("storage-get",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))}})}function Ig(e){return`${e.options.appId}-${e.name}`}const Tg=new pp("@firebase/app-check");function Eg(e,t){return bd()?wg(Ig(e),t).catch(e=>{Tg.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}function Sg(){return og.enabled}async function kg(){var e=og;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function Cg(){var e=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}();const t=og;if(t.initialized=!0,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===e.FIREBASE_APPCHECK_DEBUG_TOKEN){t.enabled=!0;const n=new dd;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(async function(){let e=void 0;try{e=await bg(yg)}catch(e){}if(e)return e;var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)}),n=t;return wg(yg,n).catch(e=>Tg.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`)),t}())}}const Ag={error:"UNKNOWN_ERROR"};async function Ng(e,t=!1){var n,r=e.app;fg(r);const i=ag(r);let s=i.token,o=void 0;if(s||(n=await i.cachedTokenPromise)&&Og(n)&&(s=n,cg(r,Object.assign(Object.assign({},i),{token:s})),xg(r,{token:s.token})),!t&&s&&Og(s))return{token:s.token};if(Sg()){var a=await gg(function(e,t){var{projectId:n,appId:r,apiKey:e}=e.options;return{url:`${lg}/projects/${n}/apps/${r}:exchangeDebugToken?key=${e}`,body:{debug_token:t}}}(r,await kg()),e.platformLoggerProvider);return await Eg(r,a),cg(r,Object.assign(Object.assign({},i),{token:a})),{token:a.token}}try{s=await i.provider.getToken()}catch(e){Tg.error(e),o=e}let c;return s?(c={token:s.token},cg(r,Object.assign(Object.assign({},i),{token:s})),await Eg(r,s)):c=(a=o,{token:(t=Ag,ld.encodeString(JSON.stringify(t),!1)),error:a}),xg(r,c),c}function Rg(e,t,n,r){var i=e.app;const s=ag(i);t={next:n,error:r,type:t};const o=Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,t]});if(o.tokenRefresher||(e=function(t){const n=t.app;return new hg(async()=>{var e=ag(n).token?await Ng(t,!0):await Ng(t);if(e.error)throw e.error},()=>!0,()=>{if((t=ag(n)).token){var e=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5,t=t.token.expireTimeMillis-3e5,e=Math.min(e,t);return Math.max(0,e-Date.now())}return 0},ug.RETRIAL_MIN_WAIT,ug.RETRIAL_MAX_WAIT)}(e),o.tokenRefresher=e),!o.tokenRefresher.isRunning()&&s.isTokenAutoRefreshEnabled&&o.tokenRefresher.start(),s.token&&Og(s.token)){const a=s.token;Promise.resolve().then(()=>n({token:a.token})).catch(()=>{})}else null==s.token&&s.cachedTokenPromise.then(e=>{e&&Og(e)&&n({token:e.token})}).catch(()=>{});cg(i,o)}function Pg(e,t){const n=ag(e);var r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),cg(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function xg(e,t){for(const n of ag(e).tokenObservers)try{"EXTERNAL"===n.type&&null!=t.error?n.error(t.error):n.next(t)}catch(e){}}function Og(e){return 0<e.expireTimeMillis-Date.now()}class Dg{constructor(e,t){this.app=e,this.platformLoggerProvider=t}_delete(){for(const e of ag(this.app).tokenObservers)Pg(this.app,e.next);return Promise.resolve()}}function Lg(t,n){var e=ag(t);const r=new dd;cg(t,Object.assign(Object.assign({},e),{reCAPTCHAState:{initialized:r}}));const i=`fire_app_check_${t.name}`,s=document.createElement("div");s.id=i,s.style.display="none",document.body.appendChild(s);const o=pg();return o?o.ready(()=>{Mg(t,n,o,i),r.resolve(o)}):function(){const e=document.createElement("script");e.src="https://www.google.com/recaptcha/api.js",e.onload=()=>{const e=pg();if(!e)throw new Error("no recaptcha");e.ready(()=>{Mg(t,n,e,i),r.resolve(e)})},document.head.appendChild(e)}(),r.promise}function Mg(e,t,n,r){r=n.render(r,{sitekey:t,size:"invisible"}),t=ag(e),cg(e,Object.assign(Object.assign({},t),{reCAPTCHAState:Object.assign(Object.assign({},t.reCAPTCHAState),{widgetId:r})}))}class Fg{constructor(e){this._siteKey=e}async getToken(){if(!this._app||!this._platformLoggerProvider)throw dg.create("use-before-activation",{appName:""});var e=await async function(r){fg(r);const i=await ag(r).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{const n=ag(r).reCAPTCHAState;i.ready(()=>{e(i.execute(n.widgetId,{action:"fire_app_check"}))})})}(this._app).catch(e=>{throw dg.create("recaptcha-error")});return gg(function(e,t){var{projectId:n,appId:r,apiKey:e}=e.options;return{url:`${lg}/projects/${n}/apps/${r}:exchangeRecaptchaToken?key=${e}`,body:{recaptcha_token:t}}}(this._app,e),this._platformLoggerProvider)}initialize(e){this._app=e,this._platformLoggerProvider=Tp(e,"platform-logger"),Lg(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Fg&&this._siteKey===e._siteKey}}class Ug{constructor(e){this._customProviderOptions=e}async getToken(){if(!this._app)throw dg.create("use-before-activation",{appName:""});var t=await this._customProviderOptions.getToken(),e=null!==(e=function(){const e=Nd(t.token).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null}())&&e<Date.now()&&0<e?1e3*e:Date.now();return Object.assign(Object.assign({},t),{issuedAtTimeMillis:e})}initialize(e){this._app=e}isEqual(e){return e instanceof Ug&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function qg(e=Ap(),t){const n=Tp(e=Qd(e),"app-check");if(og.initialized||Cg(),Sg()&&kg().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),n.isInitialized()){var r=n.getImmediate();const i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw dg.create("already-initialized",{appName:e.name})}return r=n.initialize({options:t}),function(t,e,n){const r=ag(t),i=Object.assign(Object.assign({},r),{activated:!0});i.provider=e,i.cachedTokenPromise=async function(t){if(bd()){let e=void 0;try{e=await bg(Ig(t))}catch(e){Tg.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return e}}(t).then(e=>(e&&Og(e)&&cg(t,Object.assign(Object.assign({},ag(t)),{token:e})),e)),i.isTokenAutoRefreshEnabled=void 0===n?t.automaticDataCollectionEnabled:n,cg(t,i),i.provider.initialize(t)}(e,t.provider,t.isTokenAutoRefreshEnabled),r}const jg="app-check-internal";Ip(new ep("app-check",e=>{var t=e.getProvider("app").getImmediate(),e=e.getProvider("platform-logger");return new Dg(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(jg).initialize()})),Ip(new ep(jg,e=>{var t=e=e.getProvider("app-check").getImmediate();return{getToken:e=>Ng(t,e),addTokenListener:e=>Rg(t,"INTERNAL",e),removeTokenListener:e=>Pg(t.app,e)}},"PUBLIC").setInstantiationMode("EXPLICIT")),Rp("@firebase/app-check","0.4.2");const Vg=new Sd("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."});class Bg{constructor(e){this.app=e}activate(e,t){e="string"==typeof e?new Fg(e):e instanceof Fg||e instanceof Ug?e:new Ug({getToken:e.getToken});this._delegate=qg(this.app,{provider:e,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw Vg.create("use-before-activation",{appName:this.app.name});!function(e,t){const n=ag(e=e.app);n.tokenRefresher&&(!0===t?n.tokenRefresher.start():n.tokenRefresher.stop()),cg(e,Object.assign(Object.assign({},n),{isTokenAutoRefreshEnabled:t}))}(this._delegate,e)}getToken(n){if(!this._delegate)throw Vg.create("use-before-activation",{appName:this.app.name});return async function(e,t){if((t=await Ng(e,n)).error)throw t.error;return{token:t.token}}(this._delegate)}onTokenChanged(e,t,n){if(!this._delegate)throw Vg.create("use-before-activation",{appName:this.app.name});return function(e,t,n){let r,i=()=>{};return r=null!=t.next?t.next.bind(t):t,null!=t.error?i=t.error.bind(t):n&&(i=n),Rg(e,"EXTERNAL",r,i),()=>Pg(e.app,r)}(this._delegate,e,t)}}var Kg,zg;Fp.INTERNAL.registerComponent(new ep("appCheck-compat",e=>(e=e.getProvider("app-compat").getImmediate(),new Bg(e)),"PUBLIC").setServiceProps({ReCaptchaV3Provider:Fg,CustomProvider:Ug})),Fp.registerVersion("@firebase/app-check-compat","0.1.3");const $g={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Wg="EMAIL_SIGNIN",Hg="PASSWORD_RESET",Gg="RECOVER_EMAIL",Qg="REVERT_SECOND_FACTOR_ADDITION",Yg="VERIFY_AND_CHANGE_EMAIL",Jg="VERIFY_EMAIL";function Xg(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function Zg(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}const em=Xg,tm=new Sd("auth","Firebase",Xg()),nm=new pp("@firebase/auth");function rm(e,...t){nm.logLevel<=sp.ERROR&&nm.error(`Auth (${kp}): ${e}`,...t)}function im(e,...t){throw cm(e,...t)}function sm(e,...t){return cm(e,...t)}function om(e,t,n){n=Object.assign(Object.assign({},em()),{[t]:n});const r=new Sd("auth","Firebase",n);return r.create(t,{appName:e.name})}function am(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&im(e,"argument-error"),om(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function cm(e,...t){if("string"==typeof e)return tm.create(e,...t);{var n=t[0];const r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}}function lm(e,t,...n){if(!e)throw cm(t,...n)}function um(e){throw rm(e="INTERNAL ASSERTION FAILED: "+e),new Error(e)}function hm(e,t){e||um(t)}const dm=new Map;function pm(e){hm(e instanceof Function,"Expected a class definition");let t=dm.get(e);return t?hm(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,dm.set(e,t)),t}function fm(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function gm(){return"http:"===mm()||"https:"===mm()}function mm(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class ym{constructor(e,t){hm((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=gd()||vd()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(gm()||yd()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function vm(e,t){hm(e.emulator,"Emulator should always be set here");e=e.emulator.url;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}class _m{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:void um("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:void um("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:void um("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}const wm={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},bm=new ym(3e4,6e4);function Im(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Tm(i,s,o,a,e={}){return Em(i,e,()=>{let e={},t={};a&&("GET"===s?t=a:e={body:JSON.stringify(a)});var n=Md(Object.assign({key:i.config.apiKey},t)).slice(1);const r=new(_m.headers());return r.set("Content-Type","application/json"),r.set("X-Client-Version",i._getSdkClientVersion()),i.languageCode&&r.set("X-Firebase-Locale",i.languageCode),_m.fetch()(km(i,i.config.apiHost,o,n),Object.assign({method:s,headers:r,referrerPolicy:"no-referrer"},e))})}async function Em(e,t,n){e._canInitEmulator=!1,t=Object.assign(Object.assign({},wm),t);try{const s=new Cm(e),o=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();var r=await o.json();if("needConfirmation"in r)throw Am(e,"account-exists-with-different-credential",r);if(o.ok&&!("errorMessage"in r))return r;{const a=o.ok?r.errorMessage:r.error.message,[c,l]=a.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===c)throw Am(e,"credential-already-in-use",r);if("EMAIL_EXISTS"===c)throw Am(e,"email-already-in-use",r);var i=t[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw om(e,i,l);im(e,i)}}catch(t){if(t instanceof Ed)throw t;im(e,"network-request-failed")}}async function Sm(e,t,n,r,i={}){return"mfaPendingCredential"in(i=await Tm(e,t,n,r,i))&&im(e,"multi-factor-auth-required",{serverResponse:i}),i}function km(e,t,n,r){return r=`${t}${n}?${r}`,e.config.emulator?vm(e.config,r):`${e.config.apiScheme}://${r}`}class Cm{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(sm(this.auth,"timeout")),bm.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Am(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=sm(e,t,r);return i.customData._tokenResponse=n,i}function Nm(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Rm(e){return 1e3*Number(e)}function Pm(e){var[t,n,e]=e.split(".");if(void 0===t||void 0===n||void 0===e)return rm("JWT malformed, contained fewer than 3 sections"),null;try{var r=sd(n);return r?JSON.parse(r):(rm("Failed to decode base64 JWT payload"),null)}catch(e){return rm("Caught error parsing JWT payload as JSON",e),null}}async function xm(e,t,n=!1){if(n)return t;try{return t}catch(n){throw n instanceof Ed&&("auth/user-disabled"===(t=n.code)||"auth/user-token-expired"===t)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class Om{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){var t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}return this.errorBackoff=3e4,t=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5,Math.max(0,t)}schedule(e=!1){this.isRunning&&(e=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},e))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class Dm{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Nm(this.lastLoginAt),this.creationTime=Nm(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Lm(e){var t=e.auth,n=await e.getIdToken(),r=await xm(e,async function(){return Tm(t,"POST","/v1/accounts:lookup",{idToken:n})}());lm(null==r?void 0:r.users.length,t,"internal-error");var i,s,o=r.users[0];e._notifyReloadListener(o),t=null!==(n=o.providerUserInfo)&&void 0!==n&&n.length?o.providerUserInfo.map(e=>{return{providerId:e.providerId,uid:(e=Yd(e,["providerId"])).rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}}):[],i=e.providerData,s=t,r=[...i=i.filter(t=>!s.some(e=>e.providerId===t.providerId)),...s],n=e.isAnonymous,t=!(e.email&&o.passwordHash||null!=r&&r.length),t=!!n&&t,t={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:r,metadata:new Dm(o.createdAt,o.lastLoginAt),isAnonymous:t},Object.assign(e,t)}class Mm{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){lm(e.idToken,"internal-error"),lm(void 0!==e.idToken,"internal-error"),lm(void 0!==e.refreshToken,"internal-error");var t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(lm(t=Pm(t=e.idToken),"internal-error"),lm(void 0!==t.exp,"internal-error"),lm(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return lm(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){var r,i,{accessToken:t,refreshToken:e,expiresIn:n}=(i=t,await{accessToken:(n=await Em(r=e,{},()=>{var e=Md({grant_type:"refresh_token",refresh_token:i}).slice(1),{tokenApiHost:t,apiKey:n}=r.config,n=km(r,t,"/v1/token",`key=${n}`);return _m.fetch()(n,{method:"POST",headers:{"X-Client-Version":r._getSdkClientVersion(),"Content-Type":"application/x-www-form-urlencoded"},body:e})})).access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token});this.updateTokensAndExpiration(t,e,Number(n))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){var{refreshToken:n,accessToken:r,expirationTime:t}=t;const i=new Mm;return n&&(lm("string"==typeof n,"internal-error",{appName:e}),i.refreshToken=n),r&&(lm("string"==typeof r,"internal-error",{appName:e}),i.accessToken=r),t&&(lm("number"==typeof t,"internal-error",{appName:e}),i.expirationTime=t),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Mm,this.toJSON())}_performRefresh(){return um("not implemented")}}function Fm(e,t){lm("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Um{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,e=Yd(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new Om(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=e.displayName||null,this.email=e.email||null,this.emailVerified=e.emailVerified||!1,this.phoneNumber=e.phoneNumber||null,this.photoURL=e.photoURL||null,this.isAnonymous=e.isAnonymous||!1,this.tenantId=e.tenantId||null,this.metadata=new Dm(e.createdAt||void 0,e.lastLoginAt||void 0)}async getIdToken(e){return lm(e=await xm(this,this.stsTokenManager.getToken(this.auth,e)),this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(e){return async function(e,t=!1){const n=Qd(e);var r=await n.getIdToken(t),i=Pm(r);return lm(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error"),t=null==(e="object"==typeof i.firebase?i.firebase:void 0)?void 0:e.sign_in_provider,{claims:i,token:r,authTime:Nm(Rm(i.auth_time)),issuedAtTime:Nm(Rm(i.iat)),expirationTime:Nm(Rm(i.exp)),signInProvider:t||null,signInSecondFactor:(null==e?void 0:e.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=Qd(e);await Lm(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(lm(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Um(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){lm(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Lm(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){var t=await this.getIdToken();return await xm(this,async function(e){return Tm(e,"POST","/v1/accounts:delete",{idToken:t})}(this.auth)),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n=null!==(l=t.displayName)&&void 0!==l?l:void 0,r=null!==(o=t.email)&&void 0!==o?o:void 0,i=null!==(c=t.phoneNumber)&&void 0!==c?c:void 0,s=null!==(a=t.photoURL)&&void 0!==a?a:void 0,o=null!==(l=t.tenantId)&&void 0!==l?l:void 0,a=null!==(c=t._redirectEventId)&&void 0!==c?c:void 0,c=null!==(l=t.createdAt)&&void 0!==l?l:void 0,l=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0;const{uid:u,emailVerified:h,isAnonymous:d,providerData:p,stsTokenManager:f}=t;lm(u&&f,e,"internal-error"),t=Mm.fromJSON(this.name,f),lm("string"==typeof u,e,"internal-error"),Fm(n,e.name),Fm(r,e.name),lm("boolean"==typeof h,e,"internal-error"),lm("boolean"==typeof d,e,"internal-error"),Fm(i,e.name),Fm(s,e.name),Fm(o,e.name),Fm(a,e.name),Fm(c,e.name),Fm(l,e.name);const g=new Um({uid:u,auth:e,email:r,emailVerified:h,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:o,stsTokenManager:t,createdAt:c,lastLoginAt:l});return p&&Array.isArray(p)&&(g.providerData=p.map(e=>Object.assign({},e))),a&&(g._redirectEventId=a),g}static async _fromIdTokenResponse(e,t,n=!1){const r=new Mm;return r.updateFromServerResponse(t),await Lm(n=new Um({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n})),n}}class qm{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){return void 0===(e=this.storage[e])?null:e}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}qm.type="NONE";const jm=qm;function Vm(e,t,n){return`firebase:${e}:${t}:${n}`}class Bm{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;var{config:e,name:n}=this.auth;this.fullUserKey=Vm(this.userKey,e.apiKey,n),this.fullPersistenceKey=Vm("persistence",e.apiKey,n),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?Um._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence!==e){var t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Bm(pm(jm),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||pm(jm);const s=Vm(n,e.config.apiKey,e.name);let o=null;for(const u of t)try{var a=await u._get(s);if(a){var c=Um._fromJSON(e,a);u!==i&&(o=c),i=u;break}}catch(e){}var l=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&l.length&&(i=l[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Bm(i,e,n)}}function Km(e){const t=e.toLowerCase();return t.includes("opera/")||t.includes("opr/")||t.includes("opios/")?"Opera":Hm(t)?"IEMobile":t.includes("msie")||t.includes("trident/")?"IE":t.includes("edge/")?"Edge":zm(t)?"Firefox":t.includes("silk/")?"Silk":Qm(t)?"Blackberry":Ym(t)?"Webos":$m(t)?"Safari":!t.includes("chrome/")&&!Wm(t)||t.includes("edge/")?Gm(t)?"Android":2===(null==(e=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))?void 0:e.length)?e[1]:"Other":"Chrome"}function zm(e=fd()){return/firefox\//i.test(e)}function $m(e=fd()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Wm(e=fd()){return/crios\//i.test(e)}function Hm(e=fd()){return/iemobile/i.test(e)}function Gm(e=fd()){return/android/i.test(e)}function Qm(e=fd()){return/blackberry/i.test(e)}function Ym(e=fd()){return/webos/i.test(e)}function Jm(e=fd()){return/iphone|ipad|ipod/i.test(e)}function Xm(e=fd()){return Jm(e)||Gm(e)||Ym(e)||Qm(e)||/windows phone/i.test(e)||Hm(e)}function Zm(e,t=[]){let n;switch(e){case"Browser":n=Km(fd());break;case"Worker":n=`${Km(fd())}-${e}`;break;default:n=e}return t=t.length?t.join(","):"FirebaseCore-web",`${n}/JsCore/${kp}/${t}`}class ey{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ny(this),this.idTokenSubscription=new ny(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tm,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=pm(n)),this._initializationPromise=this.queue(async()=>{var e;this._deleted||(this.persistenceManager=await Bm.create(this,t),this._deleted||(null!==(e=this._popupRedirectResolver)&&void 0!==e&&e._shouldInitProactively&&await this._popupRedirectResolver._initialize(this),await this.initializeCurrentUser(n),this._deleted||(this._isInitialized=!0)))}),this._initializationPromise}async _onStorageEvent(){if(!this._deleted){var e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e)return this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e)}}async initializeCurrentUser(e){var t,n;let r=await this.assertedPersistence.getCurrentUser();return e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId,n=null===r||void 0===r?void 0:r._redirectEventId,e=await this.tryRedirectSignIn(e),t&&t!==n||null==e||!e.user||(r=e.user)),r?r._redirectEventId?(lm(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)):this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Lm(e)}catch(e){if("auth/network-request-failed"!==e.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?Qd(e):null;return t&&lm(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&lm(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(pm(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Sd("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){return this.redirectPersistenceManager||(lm(e=e&&pm(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await Bm.create(this,[pm(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!==(e=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==e?e:null,this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser)))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return lm(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return lm(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Zm(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getSdkClientVersion(){return this.clientVersion}}function ty(e){return Qd(e)}class ny{constructor(e){this.auth=e,this.observer=null,this.addObserver=jd(e=>this.observer=e)}get next(){return lm(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function ry(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function iy(e){return e?(e=Number(e),isNaN(e)?null:e):null}class sy{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return um("not implemented")}_getIdTokenResponse(e){return um("not implemented")}_linkToIdToken(e,t){return um("not implemented")}_getReauthenticationResolver(e){return um("not implemented")}}async function oy(e,t){return Tm(e,"POST","/v1/accounts:resetPassword",Im(e,t))}async function ay(e,t){return Tm(e,"POST","/v1/accounts:update",t)}async function cy(e,t){return Tm(e,"POST","/v1/accounts:sendOobCode",Im(e,t))}class ly extends sy{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new ly(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new ly(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){if(null!=(e="string"==typeof e?JSON.parse(e):e)&&e.email&&null!=e&&e.password){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":return async function(e){return Sm(t,"POST","/v1/accounts:signInWithPassword",Im(t,e))}({returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e){return Sm(t,"POST","/v1/accounts:signInWithEmailLink",Im(t,e))}({email:this._email,oobCode:this._password});default:im(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return ay(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e){return Sm(t,"POST","/v1/accounts:signInWithEmailLink",Im(t,e))}({idToken:e,email:this._email,oobCode:this._password});default:im(t,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function uy(e,t){return Sm(e,"POST","/v1/accounts:signInWithIdp",Im(e,t))}class hy extends sy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new hy(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):im("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var{providerId:t,signInMethod:e}=n="string"==typeof e?JSON.parse(e):e,n=Yd(n,["providerId","signInMethod"]);if(!t||!e)return null;const r=new hy(t,e);return r.idToken=n.idToken||void 0,r.accessToken=n.accessToken||void 0,r.secret=n.secret,r.nonce=n.nonce,r.pendingToken=n.pendingToken||null,r}_getIdTokenResponse(e){return uy(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,uy(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,uy(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Md(t)}return e}}const dy={USER_NOT_FOUND:"user-not-found"};class py extends sy{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new py({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new py({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Sm(e,"POST","/v1/accounts:signInWithPhoneNumber",Im(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){if((t=await Sm(e,"POST","/v1/accounts:signInWithPhoneNumber",Im(e,t))).temporaryProof)throw Am(e,"account-exists-with-different-credential",t);return t}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Sm(e,"POST","/v1/accounts:signInWithPhoneNumber",Im(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),dy)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:e}=e="string"==typeof e?JSON.parse(e):e;return n||t||r||e?new py({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:e}):null}}class fy{constructor(e){var t=Fd(Ud(e)),n=null!==(r=t.apiKey)&&void 0!==r?r:null,r=null!==(e=t.oobCode)&&void 0!==e?e:null,e=function(){switch(null!==(e=t.mode)&&void 0!==e?e:null){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}();lm(n&&r&&e,"argument-error"),this.apiKey=n,this.operation=e,this.code=r,this.continueUrl=null!==(r=t.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(r=t.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(t=t.tenantId)&&void 0!==t?t:null}static parseLink(e){var t,n,r=(n=(t=Fd(Ud(r=e)).link)?Fd(Ud(t)).deep_link_id:null,((e=Fd(Ud(r)).deep_link_id)?Fd(Ud(e)).link:null)||e||n||t||r);try{return new fy(r)}catch(e){return null}}}class gy{constructor(){this.providerId=gy.PROVIDER_ID}static credential(e,t){return ly._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){return lm(t=fy.parseLink(t),"argument-error"),ly._fromEmailAndCode(e,t.code,t.tenantId)}}gy.PROVIDER_ID="password",gy.EMAIL_PASSWORD_SIGN_IN_METHOD="password",gy.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class my{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class yy extends my{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class vy extends yy{static credentialFromJSON(e){return lm("providerId"in(e="string"==typeof e?JSON.parse(e):e)&&"signInMethod"in e,"argument-error"),hy._fromParams(e)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return lm(e.idToken||e.accessToken,"argument-error"),hy._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return vy.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return vy.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:e}=e;if(!(n||r||t||i))return null;if(!e)return null;try{return new vy(e)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class _y extends yy{constructor(){super("facebook.com")}static credential(e){return hy._fromParams({providerId:_y.PROVIDER_ID,signInMethod:_y.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _y.credentialFromTaggedObject(e)}static credentialFromError(e){return _y.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return _y.credential(e.oauthAccessToken)}catch(e){return null}}}_y.FACEBOOK_SIGN_IN_METHOD="facebook.com",_y.PROVIDER_ID="facebook.com";class wy extends yy{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return hy._fromParams({providerId:wy.PROVIDER_ID,signInMethod:wy.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return wy.credentialFromTaggedObject(e)}static credentialFromError(e){return wy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:e}=e;if(!t&&!e)return null;try{return wy.credential(t,e)}catch(e){return null}}}wy.GOOGLE_SIGN_IN_METHOD="google.com",wy.PROVIDER_ID="google.com";class by extends yy{constructor(){super("github.com")}static credential(e){return hy._fromParams({providerId:by.PROVIDER_ID,signInMethod:by.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return by.credentialFromTaggedObject(e)}static credentialFromError(e){return by.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return by.credential(e.oauthAccessToken)}catch(e){return null}}}by.GITHUB_SIGN_IN_METHOD="github.com",by.PROVIDER_ID="github.com";class Iy extends sy{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return uy(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,uy(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,uy(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:t,signInMethod:n,pendingToken:e}="string"==typeof e?JSON.parse(e):e;return t&&n&&e&&t===n?new Iy(t,e):null}static _create(e,t){return new Iy(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Ty extends yy{constructor(){super("twitter.com")}static credential(e,t){return hy._fromParams({providerId:Ty.PROVIDER_ID,signInMethod:Ty.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ty.credentialFromTaggedObject(e)}static credentialFromError(e){return Ty.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:e}=e;if(!t||!e)return null;try{return Ty.credential(t,e)}catch(e){return null}}}async function Ey(e,t){return Sm(e,"POST","/v1/accounts:signUp",Im(e,t))}Ty.TWITTER_SIGN_IN_METHOD="twitter.com",Ty.PROVIDER_ID="twitter.com";class Sy{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){return e=await Um._fromIdTokenResponse(e,n,r),r=ky(n),new Sy({user:e,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);var r=ky(n);return new Sy({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function ky(e){return e.providerId||("phoneNumber"in e?"phone":null)}class Cy extends Ed{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,this.name="FirebaseError",Object.setPrototypeOf(this,Cy.prototype),this.appName=e.name,this.code=t.code,this.tenantId=null!==(e=e.tenantId)&&void 0!==e?e:void 0,this.serverResponse=t.customData.serverResponse}static _fromErrorAndOperation(e,t,n,r){return new Cy(e,t,n,r)}}function Ay(t,n,e,r){const i="reauthenticate"===n?e._getReauthenticationResolver(t):e._getIdTokenResponse(t);return i.catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw Cy._fromErrorAndOperation(t,e,n,r);throw e})}function Ny(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Ry(e,t,n=!1){return n=await xm(e,t._linkToIdToken(e.auth,await e.getIdToken()),n),Sy._forOperation(e,"link",n)}async function Py(e,t,n){await Lm(t);const r=Ny(t.providerData);var i=!1===e?"provider-already-linked":"no-such-provider";lm(r.has(n)===e,t.auth,i)}async function xy(e,t,n=!1){var r=e.auth,i="reauthenticate";try{var s=await xm(e,Ay(r,i,t,e),n);lm(s.idToken,r,"internal-error");var o=Pm(s.idToken);lm(o,r,"internal-error");var a=o.sub;return lm(e.uid===a,r,"user-mismatch"),Sy._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&im(r,"user-mismatch"),e}}async function Oy(e,t,n=!1){return t=await Ay(e,"signIn",t),t=await Sy._fromIdTokenResponse(e,"signIn",t),n||await e._updateCurrentUser(t.user),t}async function Dy(e,t){return Oy(ty(e),t)}async function Ly(e,t){return await Py(!1,e=Qd(e),t.providerId),Ry(e,t)}async function My(e,t){return xy(Qd(e),t)}class Fy{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Uy._fromServerResponse(e,t):im(e,"internal-error")}}class Uy extends Fy{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Uy(t)}}function qy(e,t,n){var r;lm(0<(null===(r=n.url)||void 0===r?void 0:r.length),e,"invalid-continue-uri"),lm(void 0===n.dynamicLinkDomain||0<n.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(lm(0<n.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(lm(0<n.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function jy(e,t){var n=Qd(e),r=await oy(n,{oobCode:t});switch(lm(t=r.requestType,n,"internal-error"),t){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":lm(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":lm(r.mfaInfo,n,"internal-error");default:lm(r.email,n,"internal-error")}let i=null;return r.mfaInfo&&(i=Fy._fromServerResponse(ty(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:i},operation:t}}async function Vy(e,t,n){var r=e.auth;const i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n),r=await xm(e,ay(r,i)),await e._updateTokensIfNecessary(r,!0)}class By{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Ky extends By{constructor(e,t,n,r){super(e,t,n),this.username=r}}class zy extends By{constructor(e,t){super(e,"facebook.com",t)}}class $y extends Ky{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Wy extends By{constructor(e,t){super(e,"google.com",t)}}class Hy extends Ky{constructor(e,t,n){super(e,"twitter.com",t,n)}}class Gy{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new Gy("enroll",e)}static _fromMfaPendingCredential(e){return new Gy("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return Gy._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.idToken)return Gy._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Qy{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,r){const i=ty(e);e=(r.serverResponse.mfaInfo||[]).map(e=>Fy._fromServerResponse(i,e)),lm(r.serverResponse.mfaPendingCredential,i,"internal-error");const s=Gy._fromMfaPendingCredential(r.serverResponse.mfaPendingCredential);return new Qy(s,e,async e=>{e=await e._process(i,s),delete r.serverResponse.mfaInfo,delete r.serverResponse.mfaPendingCredential;var t=Object.assign(Object.assign({},r.serverResponse),{idToken:e.idToken,refreshToken:e.refreshToken});switch(r.operationType){case"signIn":var n=await Sy._fromIdTokenResponse(i,r.operationType,t);return await i._updateCurrentUser(n.user),n;case"reauthenticate":return lm(r.user,i,"internal-error"),Sy._forOperation(r.user,r.operationType,t);default:im(i,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class Yy{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>Fy._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new Yy(e)}async getSession(){return Gy._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e;return e=await this.getSession(),t=await xm(this.user,n._process(this.user.auth,e,t)),await this.user._updateTokensIfNecessary(t),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid;var n=await this.user.getIdToken(),n=await xm(this.user,Tm(e=this.user.auth,"POST","/v2/accounts/mfaEnrollment:withdraw",Im(e,{idToken:n,mfaEnrollmentId:t})));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(n);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==e.code)throw e}}}const Jy=new WeakMap,Xy="__sak";class Zy{constructor(e,t){this.storage=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Xy,"1"),this.storage.removeItem(Xy),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){return e=this.storage.getItem(e),Promise.resolve(e?JSON.parse(e):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}}class ev extends Zy{constructor(){var e;super(window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=($m(e=fd())||Jm(e))&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Xm(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){var t=this.storage.getItem(r),n=this.localCache[r];t!==n&&e(r,n,t)}}onStorageEvent(e,t=!1){if(e.key){const i=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){var n=this.storage.getItem(i);if(e.newValue!==n)null!==e.newValue?this.storage.setItem(i,e.newValue):this.storage.removeItem(i);else if(this.localCache[i]===e.newValue&&!t)return}var r=()=>{var e=this.storage.getItem(i);!t&&this.localCache[i]===e||this.notifyListeners(i,e)},n=this.storage.getItem(i);_d()&&10===document.documentMode&&n!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}else this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)})}notifyListeners(e,t){if(this.localCache[e]=t,e=this.listeners[e])for(const n of Array.from(e))n(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}ev.type="LOCAL";const tv=ev;class nv extends Zy{constructor(){super(window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}nv.type="SESSION";const rv=nv;class iv{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));return e||(e=new iv(t),this.receivers.push(e),e)}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data;null!=(e=this.handlersMap[r])&&e.size&&(t.ports[0].postMessage({status:"ack",eventId:n,eventType:r}),e=Array.from(e).map(async e=>e(t.origin,i)),e=await Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:e}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function sv(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}iv.receivers=[];class ov{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,o=50){const a="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let c,l;return new Promise((n,r)=>{const i=sv("",20);a.port1.start();const s=setTimeout(()=>{r(new Error("unsupported_event"))},o);l={messageChannel:a,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),c=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),n(t.data.response);break;default:clearTimeout(s),clearTimeout(c),r(new Error("invalid_response"))}}},this.handlers.add(l),a.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[a.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function av(){return window}function cv(){return void 0!==av().WorkerGlobalScope&&"function"==typeof av().importScripts}const lv="firebaseLocalStorageDb",uv="firebaseLocalStorage";class hv{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function dv(e,t){return e.transaction([uv],t?"readwrite":"readonly").objectStore(uv)}function pv(){const r=indexedDB.open(lv,1);return new Promise((n,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const e=r.result;try{e.createObjectStore(uv,{keyPath:"fbase_key"})}catch(e){t(e)}}),r.addEventListener("success",async()=>{const e=r.result;var t;e.objectStoreNames.contains(uv)?n(e):(e.close(),t=indexedDB.deleteDatabase(lv),await new hv(t).toPromise(),n(await pv()))})})}async function fv(e,t,n){return n=dv(e,!0).put({fbase_key:t,value:n}),new hv(n).toPromise()}function gv(e,t){return t=dv(e,!0).delete(t),new hv(t).toPromise()}class mv{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await pv(),this.db)}async _withRetries(e){let t=0;for(;;)try{return e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return cv()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=iv._getInstance(cv()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t,n;this.activeServiceWorker=await async function(){if(null===navigator||void 0===navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),this.activeServiceWorker&&(this.sender=new ov(this.activeServiceWorker),(n=await this.sender._send("ping",{},800))&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0))}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;var e=await pv();return await fv(e,Xy,"1"),await gv(e,Xy),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(e=>fv(e,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(e){var t=await this._withRetries(t=>async function(e){return e=dv(t,!1).get(e),void 0===(e=await new hv(e).toPromise())?null:e.value}(e));return this.localCache[e]=t}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>gv(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e,t,n=await this._withRetries(e=>(e=dv(e,!1).getAll(),new hv(e).toPromise()));if(!n)return[];if(0!==this.pendingWrites)return[];const r=[],i=new Set;for({fbase_key:e,value:t}of n)i.add(e),JSON.stringify(this.localCache[e])!==JSON.stringify(t)&&(this.notifyListeners(e,t),r.push(e));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r}notifyListeners(e,t){if(this.localCache[e]=t,e=this.listeners[e])for(const n of Array.from(e))n(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}mv.type="LOCAL";const yv=mv;function vv(r){return new Promise((e,n)=>{const t=document.createElement("script");t.setAttribute("src",r),t.onload=e,t.onerror=e=>{const t=sm("internal-error");t.customData=e,n(t)},t.type="text/javascript",t.charset="UTF-8",(null!==(e=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==e?e:document).appendChild(t)})}function _v(e){return`__${e}${Math.floor(1e6*Math.random())}`}class wv{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var n=this.counter;return this._widgets.set(n,new bv(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t=e||1e12;null===(e=this._widgets.get(t))||void 0===e||e.delete(),this._widgets.delete(t)}getResponse(e){return(null===(e=this._widgets.get(e||1e12))||void 0===e?void 0:e.getResponse())||""}async execute(e){return null===(e=this._widgets.get(e||1e12))||void 0===e||e.execute(),""}}class bv{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()},lm(e="string"==typeof e?document.getElementById(e):e,"argument-error",{appName:t}),this.container=e,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<50;e++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Iv=_v("rcb"),Tv=new ym(3e4,6e4);class Ev{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!av().grecaptcha}load(s,o=""){return lm(o.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(o),s,"argument-error"),this.shouldResolveImmediately(o)?Promise.resolve(av().grecaptcha):new Promise((t,r)=>{const i=av().setTimeout(()=>{r(sm(s,"network-request-failed"))},Tv.get());av()[Iv]=()=>{av().clearTimeout(i),delete av()[Iv];const e=av().grecaptcha;if(e){const n=e.render;e.render=(e,t)=>(t=n(e,t),this.counter++,t),this.hostLanguage=o,t(e)}else r(sm(s,"internal-error"))},vv(`https://www.google.com/recaptcha/api.js??${Md({onload:Iv,render:"explicit",hl:o})}`).catch(()=>{clearTimeout(i),r(sm(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!av().grecaptcha&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class Sv{async load(e){return new wv(e)}clearedOneInstance(){}}const kv="recaptcha",Cv={theme:"light",type:"image"};class Av{constructor(e,t=Object.assign({},Cv),n){this.parameters=t,this.type=kv,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ty(n),this.isInvisible="invisible"===this.parameters.size,lm("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment"),lm(e="string"==typeof e?document.getElementById(e):e,this.auth,"argument-error"),this.container=e,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?Sv:Ev),this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha();return r.getResponse(e)||new Promise(t=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),t(e))};this.tokenChangeListeners.add(n),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){lm(!this.parameters.sitekey,this.auth,"argument-error"),lm(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),lm("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof n)n(t);else if("string"==typeof n){const e=av()[n];"function"==typeof e&&e(t)}}}assertNotDestroyed(){lm(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){lm(gm()&&!cv(),this.auth,"internal-error"),await function(){let t=null;return new Promise(e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await Tm(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");lm(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return lm(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Nv{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){return e=py._fromVerification(this.verificationId,e),this.onConfirmation(e)}}async function Rv(e,t,n){var r,i,s=await n.verify();try{if(lm("string"==typeof s,e,"argument-error"),lm(n.type===kv,e,"argument-error"),"session"in(i="string"==typeof t?{phoneNumber:t}:t)){var o=i.session;if("phoneNumber"in i)return lm("enroll"===o.type,e,"internal-error"),(await Tm(e,"POST","/v2/accounts/mfaEnrollment:start",Im(e,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}}))).phoneSessionInfo.sessionInfo;lm("signin"===o.type,e,"internal-error");var a=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;return lm(a,e,"missing-multi-factor-info"),(await Tm(e,"POST","/v2/accounts/mfaSignIn:start",Im(e,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}}))).phoneResponseInfo.sessionInfo}return(await Tm(e,"POST","/v1/accounts:sendVerificationCode",Im(e,{phoneNumber:i.phoneNumber,recaptchaToken:s}))).sessionInfo}finally{n._reset()}}class Pv{constructor(e){this.providerId=Pv.PROVIDER_ID,this.auth=ty(e)}verifyPhoneNumber(e,t){return Rv(this.auth,e,Qd(t))}static credential(e,t){return py._fromVerification(e,t)}static credentialFromResult(e){return Pv.credentialFromTaggedObject(e)}static credentialFromError(e){return Pv.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{phoneNumber:t,temporaryProof:e}=e;return t&&e?py._fromTokenResponse(t,e):null}}function xv(e,t){return t?pm(t):(lm(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Pv.PROVIDER_ID="phone",Pv.PHONE_SIGN_IN_METHOD="phone";class Ov extends sy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return uy(e,this._buildIdpRequest())}_linkToIdToken(e,t){return uy(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return uy(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Dv(e){return Oy(e.auth,new Ov(e),e.bypassAuthState)}function Lv(e){var{auth:t,user:n}=e;return lm(n,t,"internal-error"),xy(n,new Ov(e),e.bypassAuthState)}async function Mv(e){var{auth:t,user:n}=e;return lm(n,t,"internal-error"),Ry(n,new Ov(e),e.bypassAuthState)}class Fv{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:e}=e;if(s)this.reject(s);else{r={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(e)(r))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Dv;case"linkViaPopup":case"linkViaRedirect":return Mv;case"reauthViaPopup":case"reauthViaRedirect":return Lv;default:im(this.auth,"internal-error")}}resolve(e){hm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){hm(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Uv=new ym(2e3,1e4);class qv extends Fv{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,qv.currentPopupAction&&qv.currentPopupAction.cancel(),qv.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return lm(e,this.auth,"internal-error"),e}async onExecution(){hm(1===this.filter.length,"Popup operations only handle one event");var e=sv();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(sm(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(sm(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,qv.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e;null!==(e=null===(e=this.authWindow)||void 0===e?void 0:e.window)&&void 0!==e&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(sm(this.auth,"popup-closed-by-user"))},2e3):this.pollId=window.setTimeout(t,Uv.get())};t()}}qv.currentPopupAction=null;const jv="pendingRedirect",Vv=new Map;class Bv extends Fv{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Vv.get(this.auth._key());if(!e){try{const i=(t=this.resolver,r=$v(this.auth),n="true"===await zv(t)._get(r),await zv(t)._remove(r),await n?await super.execute():null);e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}Vv.set(this.auth._key(),e)}var t,n,r;return e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Kv(e,t){return zv(e)._set($v(t),"true")}function zv(e){return pm(e._redirectPersistence)}function $v(e){return Vm(jv,e.config.apiKey,e.name)}async function Wv(e,t,n=!1){const r=ty(e);e=xv(r,t);const i=new Bv(r,e,n),s=await i.execute();return s&&!n&&(delete s.user._redirectEventId,await r._persistUserIfCurrent(s.user),await r._setRedirectUser(null,t)),s}async function Hv(e){var t=sv(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Gv{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(n=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return 1;case"unknown":return Yv(e);default:return}}(t)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(e,t){var n;e.error&&!Yv(e)?(n=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error",t.onError(sm(this.auth,n))):t.onAuthEvent(e)}isEventForConsumer(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(Qv(e))}saveEventToCache(e){this.cachedEventUids.add(Qv(e)),this.lastProcessedEventTime=Date.now()}}function Qv(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Yv({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function Jv(e,t={}){return Tm(e,"GET","/v1/projects",t)}const Xv=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Zv=/^https?/;const e_=new ym(3e4,6e4);function t_(){const t=av().___jsl;if(null!==t&&void 0!==t&&t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let n_=null;const r_=new ym(5e3,15e3),i_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},s_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function o_(o){const e=(t=o,n_=n_||(i=t,new Promise((e,t)=>{function n(){t_(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{t_(),t(sm(i,"network-request-failed"))},timeout:e_.get()})}if(null!==(r=null===(r=av().gapi)||void 0===r?void 0:r.iframes)&&void 0!==r&&r.Iframe)e(gapi.iframes.getContext());else{if(null===(r=av().gapi)||void 0===r||!r.load){var r=_v("iframefcb");return av()[r]=()=>{gapi.load?n():t(sm(i,"network-request-failed"))},vv(`https://apis.google.com/js/api.js?onload=${r}`)}n()}}).catch(e=>{throw n_=null,e})),await n_);var i,t=av().gapi;return lm(t,o,"internal-error"),e.open({where:document.body,url:function(e){var t=e.config;lm(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?vm(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`;const r={apiKey:t.apiKey,appName:e.name,v:kp};(t=s_.get(e.config.apiHost))&&(r.eid=t);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Md(r).slice(1)}`}(o),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:i_,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});const n=sm(o,"network-request-failed"),r=av().setTimeout(()=>{t(n)},r_.get());function i(){av().clearTimeout(r),e(s)}s.ping(i).then(i,()=>{t(n)})}))}const a_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class c_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function l_(e,t,n,r=500,i=600){var s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},a_),{width:r.toString(),height:i.toString(),top:s,left:o});o=fd().toLowerCase(),n&&(a=Wm(o)?"_blank":n),zm(o)&&(t=t||"http://localhost",c.scrollbars="yes");var l,n=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if([o=fd()]=[o],Jm(o)&&null!==(l=window.navigator)&&void 0!==l&&l.standalone&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new c_(null);const u=window.open(t||"",a,n);lm(u,e,"popup-blocked");try{u.focus()}catch(e){}return new c_(u)}function u_(e,t,n,r,i,s){lm(e.config.authDomain,e,"auth-domain-config-required"),lm(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:kp,eventId:i};if(t instanceof my){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",xd(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(var[a,c]of Object.entries(s||{}))o[a]=c}if(t instanceof yy){const u=t.getScopes().filter(e=>""!==e);0<u.length&&(o.scopes=u.join(","))}e.tenantId&&(o.tid=e.tenantId);const l=o;for(const h of Object.keys(l))void 0===l[h]&&delete l[h];return`${e=e.config,e.emulator?vm(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}?${Md(l).slice(1)}`}const h_="webStorageSupport",d_=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rv,this._completeRedirectFn=Wv}async _openPopup(e,t,n,r){var i;return hm(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),l_(e,u_(e,t,n,fm(),r),sv())}async _openRedirect(e,t,n,r){return await this._originValidation(e),r=u_(e,t,n,fm(),r),av().location.href=r,new Promise(()=>{})}_initialize(e){var t=e._key();if(this.eventManagers[t]){const{manager:r,promise:n}=this.eventManagers[t];return r?Promise.resolve(r):(hm(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n}async initAndGetManager(t){const e=await o_(t),n=new Gv(t);return e.register("authEvent",e=>(lm(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,n){const e=this.iframes[t._key()];e.send(h_,{type:h_},e=>{void 0!==(e=null===(e=null==e?void 0:e[0])||void 0===e?void 0:e[h_])&&n(!!e),im(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(!e.config.emulator){for(const t of(await Jv(e)).authorizedDomains)try{if(function(e){const t=fm(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){var i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(Zv.test(n)){if(Xv.test(e))return r===e;const s=e.replace(/\./g,"\\."),o=new RegExp("^(.+\\."+s+"|"+s+")$","i");return o.test(r)}}(t))return}catch(e){}im(e,"unauthorized-domain")}}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Xm()||$m()||Jm()}};class p_ extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return um("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new p_(e)}_finalizeEnroll(e,t,n){return Tm(e,"POST","/v2/accounts/mfaEnrollment:finalize",Im(e,n={idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}_finalizeSignIn(e,t){return Tm(e,"POST","/v2/accounts/mfaSignIn:finalize",Im(e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}}class f_{constructor(){}static assertion(e){return p_._fromCredential(e)}}f_.FACTOR_ID="phone";class g_{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){lm(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function m_(){return window}Kg="Browser",Ip(new ep("auth",(e,{options:n})=>{const{apiKey:r,authDomain:i}=(e=e.getProvider("app").getImmediate()).options;return(e=>{lm(r&&!r.includes(":"),"invalid-api-key",{appName:e.name}),lm(!(null!==i&&void 0!==i&&i.includes(":")),"argument-error",{appName:e.name});var t={apiKey:r,authDomain:i,clientPlatform:Kg,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Zm(Kg)};return function(e,t){const n=(null==t?void 0:t.persistence)||[];var r=(Array.isArray(n)?n:[n]).map(pm);null!=t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(t=new ey(e,t),n),t})(e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),Ip(new ep("auth-internal",e=>(e=ty(e.getProvider("auth").getImmediate()),new g_(e)),"PRIVATE").setInstantiationMode("EXPLICIT")),Rp("@firebase/auth","0.18.2",void 0);class y_ extends Gv{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}async function v_(e){var t=await __()._get(w_(e));return t&&await __()._remove(w_(e)),t}function __(){return pm(tv)}function w_(e){return Vm("authEvent",e.config.apiKey,e.name)}function b_(e){if(null==e||!e.includes("?"))return{};const[,...t]=e.split("?");return Fd(t.join("?"))}const I_=class{constructor(){this._redirectPersistence=rv,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Wv}async _initialize(e){var t=e._key();let n=this.eventManagers.get(t);return n||(n=new y_(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){im(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i=e,s=m_();lm("function"==typeof(null===(c=null==s?void 0:s.universalLinks)||void 0===c?void 0:c.subscribe),i,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),lm(void 0!==(null===(c=null==s?void 0:s.BuildInfo)||void 0===c?void 0:c.packageName),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),lm("function"==typeof(null===(c=null===(c=null===(c=null==s?void 0:s.cordova)||void 0===c?void 0:c.plugins)||void 0===c?void 0:c.browsertab)||void 0===c?void 0:c.openUrl),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),lm("function"==typeof(null===(c=null===(c=null===(c=null==s?void 0:s.cordova)||void 0===c?void 0:c.plugins)||void 0===c?void 0:c.browsertab)||void 0===c?void 0:c.isAvailable),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),lm("function"==typeof(null===(s=null===(s=null==s?void 0:s.cordova)||void 0===s?void 0:s.InAppBrowser)||void 0===s?void 0:s.open),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});const o=await this._initialize(e);await o.initialized(),o.resetRedirect(),Vv.clear(),await this._originValidation(e);var a,c,i=([a,c,s=null]=[e,n,r],{type:c,eventId:s,urlResponse:null,sessionId:function(){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<20;e++){var r=Math.floor(Math.random()*n.length);t.push(n.charAt(r))}return t.join("")}(),postBody:null,tenantId:a.tenantId,error:sm(a,"no-auth-event")});return n=e,r=i,await __()._set(w_(n),r),t=await function(r){const i=m_().cordova;return new Promise(n=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(r):t=i.InAppBrowser.open(r,(e=fd(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),n(t)})})}(await async function(e,t,n){var r=m_().BuildInfo;hm(t.sessionId,"AuthEvent did not contain a session ID");var i=await async function(e){const t=function(t){if(hm(/[0-9a-zA-Z]+/.test(t),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(t);const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId);const s={};return Jm()?s.ibi=r.packageName:Gm()?s.apn=r.packageName:im(e,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=i,u_(e,n,t.type,void 0,null!==(t=t.eventId)&&void 0!==t?t:void 0,s)}(e,i,t)),async function(o,a,c){const l=m_().cordova;let u=()=>{};try{await new Promise((n,e)=>{let t=null;function r(){var e;n();const t=null===(e=l.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==c?void 0:c.close)&&c.close()}function i(){t=t||window.setTimeout(()=>{e(sm(o,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&i()}a.addPassiveListener(r),document.addEventListener("resume",i,!1),Gm()&&document.addEventListener("visibilitychange",s,!1),u=()=>{a.removePassiveListener(r),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),t&&window.clearTimeout(t)}})}finally{u()}}(e,o,t)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){var t=m_().BuildInfo;const n={};Jm()?n.iosBundleId=t.packageName:Gm()?n.androidPackageName=t.packageName:im(e,"operation-not-supported-in-this-environment"),await Jv(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(r,i){const{universalLinks:e,handleOpenURL:t,BuildInfo:n}=m_(),s=setTimeout(async()=>{await v_(r),i.onEvent(T_())},500),o=async e=>{clearTimeout(s);var t=await v_(r);let n=null;t&&null!=e&&e.url&&(n=function(e,t){var n,r,i;const s=(n=b_(o=t),i=b_(r=n.link?decodeURIComponent(n.link):void 0).link,(n=b_(t=n.deep_link_id?decodeURIComponent(n.deep_link_id):void 0).link)||t||i||r||o);if(s.includes("/__/auth/callback")){var o=b_(s);return(o=(o=null===(o=null===(o=null==(o=o.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(o.firebaseError)):null)?void 0:o.code)||void 0===o?void 0:o.split("auth/"))||void 0===o?void 0:o[1])?sm(o):null)?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:o,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:s,postBody:null}}return null}(t,e.url)),i.onEvent(n||T_())};void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,o);const a=t,c=`${n.packageName.toLowerCase()}://`;m_().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function T_(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:sm("no-auth-event")}}function E_(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function S_(e=fd()){return!("file:"!==E_()&&"ionic:"!==E_()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function k_(){try{const n=self.localStorage;var e=sv();if(n)return n.setItem(e,"1"),n.removeItem(e),t=fd(),!(_d()&&11===(null===document||void 0===document?void 0:document.documentMode)||([t=fd()]=[t],/Edge\/\d+/.test(t)))||bd()}catch(e){return C_()&&bd()}var t;return!1}function C_(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function A_(){return("http:"===E_()||"https:"===E_()||yd()||S_())&&!(vd()||md())&&k_()&&!C_()}function N_(){return S_()&&"undefined"!=typeof document}const R_={LOCAL:"local",NONE:"none",SESSION:"session"},P_=lm,x_="persistence";async function O_(e){await e._initializationPromise;const t=D_();var n=Vm(x_,e.config.apiKey,e.name);null!==t&&void 0!==t&&t.sessionStorage&&t.sessionStorage.setItem(n,e._getPersistence())}function D_(){return"undefined"!=typeof window?window:null}const L_=lm;class M_{constructor(){this.browserResolver=pm(d_),this.cordovaResolver=pm(I_),this.underlyingResolver=null,this._redirectPersistence=rv,this._completeRedirectFn=Wv}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return N_()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return L_(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!N_()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function F_(e){return e.unwrap()}function U_(e){var t=(e instanceof Ed?e.customData:e)._tokenResponse;if(!t)return null;if(!(e instanceof Ed)&&"temporaryProof"in t&&"phoneNumber"in t)return Pv.credentialFromResult(e);const n=t.providerId;if(!n||n===$g.PASSWORD)return null;let r;switch(n){case $g.GOOGLE:r=wy;break;case $g.FACEBOOK:r=_y;break;case $g.GITHUB:r=by;break;case $g.TWITTER:r=Ty;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:a,nonce:c}=t;return s||o||i||a?a?n.startsWith("saml.")?Iy._create(n,a):hy._fromParams({providerId:n,signInMethod:n,pendingToken:a,idToken:i,accessToken:s}):new vy(n).credential({idToken:i,accessToken:s,rawNonce:c}):null}return e instanceof Ed?r.credentialFromError(e):r.credentialFromResult(e)}function q_(t,e){return e.catch(e=>{throw e instanceof Ed&&function(e,t){var n,r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===t.code){const s=t;s.resolver=new V_(e,(e=Qd(i=e),lm((i=n=t).operationType,e,"argument-error"),lm(null===(n=i.serverResponse)||void 0===n?void 0:n.mfaPendingCredential,e,"argument-error"),Qy._fromError(e,i)))}else if(r){var i=U_(t);const o=t;i&&(o.credential=i,o.tenantId=r.tenantId||void 0,o.email=r.email||void 0,o.phoneNumber=r.phoneNumber||void 0)}}(t,e),e}).then(e=>{var t=e.operationType,n=e.user;return{operationType:t,credential:U_(e),additionalUserInfo:function(e){var{user:t,_tokenResponse:e}=e;return t.isAnonymous&&!e?{providerId:null,isNewUser:!1,profile:null}:function(e){if(!e)return null;var t=e.providerId,n=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},r=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!t&&null!=e&&e.idToken){var i=null===(i=null===(i=Pm(e.idToken))||void 0===i?void 0:i.firebase)||void 0===i?void 0:i.sign_in_provider;if(i)return i="anonymous"!==i&&"custom"!==i?i:null,new By(r,i)}if(!t)return null;switch(t){case"facebook.com":return new zy(r,n);case"github.com":return new $y(r,n);case"google.com":return new Wy(r,n);case"twitter.com":return new Hy(r,n,e.screenName||null);case"custom":case"anonymous":return new By(r,null);default:return new By(r,t,n)}}(e)}(e),user:B_.getOrCreate(n)}})}async function j_(t,e){const n=await e;return{verificationId:n.verificationId,confirm:e=>q_(t,n.confirm(e))}}class V_{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return q_(F_(this.auth),this.resolver.resolveSignIn(e))}}class B_{constructor(e){this._delegate=e,this.multiFactor=(e=Qd(e),Jy.has(e)||Jy.set(e,Yy._fromUser(e)),Jy.get(e))}static getOrCreate(e){return B_.USER_MAP.has(e)||B_.USER_MAP.set(e,new B_(e)),B_.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return q_(this.auth,Ly(this._delegate,e))}async linkWithPhoneNumber(e,t){return j_(this.auth,async function(e,t,n){const r=Qd(e);return await Py(!1,r,"phone"),n=await Rv(r.auth,t,Qd(n)),new Nv(n,e=>Ly(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return q_(this.auth,async function(e,t,n){am((e=Qd(e)).auth,t,my),n=xv(e.auth,n);const r=new qv(e.auth,"linkViaPopup",t,n,e);return r.executeNotNull()}(this._delegate,e,M_))}async linkWithRedirect(e){return await O_(ty(this.auth)),i=this._delegate,t=e,e=M_,async function(e,t,n){am((e=Qd(i)).auth,t,my);const r=xv(e.auth,n);return await Py(!1,e,t.providerId),await Kv(r,e.auth),n=await Hv(e),r._openRedirect(e.auth,t,"linkViaRedirect",n)}(0,t,e);var i,t}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return q_(this.auth,My(this._delegate,e))}reauthenticateWithPhoneNumber(r,i){return j_(this.auth,async function(e,t){const n=Qd(e);return t=await Rv(n.auth,r,Qd(i)),new Nv(t,e=>My(n,e))}(this._delegate))}reauthenticateWithPopup(e){return q_(this.auth,async function(e,t,n){am((e=Qd(e)).auth,t,my),n=xv(e.auth,n);const r=new qv(e.auth,"reauthViaPopup",t,n,e);return r.executeNotNull()}(this._delegate,e,M_))}async reauthenticateWithRedirect(e){return await O_(ty(this.auth)),i=this._delegate,t=e,e=M_,async function(e,t,n){am((e=Qd(i)).auth,t,my);const r=xv(e.auth,n);return await Kv(r,e.auth),n=await Hv(e),r._openRedirect(e.auth,t,"reauthViaRedirect",n)}(0,t,e);var i,t}sendEmailVerification(e){return async function(e,t){var n=Qd(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&qy(n.auth,r,t),(r=(await cy(n.auth,r)).email)!==e.email&&await e.reload()}(this._delegate,e)}async unlink(e){return await async function(e,t){const n=Qd(e);await Py(!0,n,t);const r=Ny((t=(await Tm(e=n.auth,"POST","/v1/accounts:update",t={idToken:await n.getIdToken(),deleteProvider:[t]})).providerUserInfo)||[]);return n.providerData=n.providerData.filter(e=>r.has(e.providerId)),r.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}(this._delegate,e),this}updateEmail(e){return Vy(Qd(this._delegate),e,null)}updatePassword(e){return Vy(Qd(this._delegate),null,e)}updatePhoneNumber(t){return async function(e){await Ry(Qd(e),t)}(this._delegate)}updateProfile(e){return async function(t,{displayName:n,photoURL:r}){if(void 0!==n||void 0!==r){const e=Qd(t);t=await e.getIdToken(),r=await xm(e,async function(e){return Tm(e,"POST","/v1/accounts:update",{idToken:t,displayName:n,photoUrl:r,returnSecureToken:!0})}(e.auth)),e.displayName=r.displayName||null,e.photoURL=r.photoUrl||null;const i=e.providerData.find(({providerId:e})=>"password"===e);i&&(i.displayName=e.displayName,i.photoURL=e.photoURL),await e._updateTokensIfNecessary(r)}}(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return async function(e,t,n){var r=Qd(e),t={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&qy(r.auth,t,n),(t=(await cy(r.auth,t)).email)!==e.email&&await e.reload()}(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}B_.USER_MAP=new WeakMap;const K_=lm;class z_{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();var n=e.options.apiKey;K_(n,"invalid-api-key",{appName:e.name});let r=[jm];if("undefined"!=typeof window){r=function(e,t){const n=D_();if(null===n||void 0===n||!n.sessionStorage)return[];switch(t=Vm(x_,e,t),n.sessionStorage.getItem(t)){case R_.NONE:return[jm];case R_.LOCAL:return[yv,rv];case R_.SESSION:return[rv];default:return[]}}(n,e.name);for(const i of[yv,tv,rv])r.includes(i)||r.push(i)}K_(n,"invalid-api-key",{appName:e.name}),e="undefined"!=typeof window?M_:void 0,this._delegate=t.initialize({options:{persistence:r,popupRedirectResolver:e}}),this._delegate._updateErrorMap(Zg),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?B_.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){!function(e,t,n){const r=ty(e);lm(r._canInitEmulator,r,"emulator-config-failed"),lm(/^https?:\/\//.test(t),r,"invalid-emulator-scheme"),e=!(null==n||!n.disableWarnings);const i=ry(t);var{host:n,port:t}=function(e){const t=ry(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i)return{host:s=i[1],port:iy(r.substr(s.length+1))};var[e,s]=r.split(":");return{host:e,port:iy(s)}}(t);function s(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}r.config.emulator={url:`${i}//${n}${null===t?"":`:${t}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:n,port:t,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:e})}),e||("undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()))}(this._delegate,e,t)}applyActionCode(e){return async function(e,t){await Tm(e=Qd(e),"POST","/v1/accounts:update",Im(e,{oobCode:t}))}(this._delegate,e)}checkActionCode(e){return jy(this._delegate,e)}confirmPasswordReset(t,n){return async function(e){await oy(Qd(e),{oobCode:t,newPassword:n})}(this._delegate)}async createUserWithEmailAndPassword(r,i){return q_(this._delegate,async function(e,t){const n=ty(e);return t=await Ey(n,{returnSecureToken:!0,email:r,password:i}),t=await Sy._fromIdTokenResponse(n,"signIn",t),await n._updateCurrentUser(t.user),t}(this._delegate))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return async function(e,t){var n=gm()?fm():"http://localhost";return(n=(await Tm(e=Qd(e),"POST","/v1/accounts:createAuthUri",Im(e,{identifier:t,continueUri:n}))).signinMethods)||[]}(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,"EMAIL_SIGNIN"===(null==(e=fy.parseLink(e))?void 0:e.operation)}async getRedirectResult(){K_(A_(),this._delegate,"operation-not-supported-in-this-environment");var e,t=(e=this._delegate,t=M_,await ty(e)._initializationPromise,await Wv(e,t,!1));return t?q_(this._delegate,Promise.resolve(t)):{credential:null,user:null}}addFrameworkForLogging(e){ty(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){var{next:e,error:t,complete:n}=$_(e,t,n);return this._delegate.onAuthStateChanged(e,t,n)}onIdTokenChanged(e,t,n){var{next:e,error:t,complete:n}=$_(e,t,n);return this._delegate.onIdTokenChanged(e,t,n)}sendSignInLinkToEmail(e,t){return async function(e,t,n){e=Qd(e),t={requestType:"EMAIL_SIGNIN",email:t},lm(n.handleCodeInApp,e,"argument-error"),n&&qy(e,t,n),await cy(e,t)}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){e=Qd(e),t={requestType:"PASSWORD_RESET",email:t},n&&qy(e,t,n),await cy(e,t)}(this._delegate,e,t||void 0)}async setPersistence(e){var t=this._delegate,n=e;P_(Object.values(R_).includes(n),t,"invalid-persistence-type"),vd()?P_(n!==R_.SESSION,t,"unsupported-persistence-type"):md()?P_(n===R_.NONE,t,"unsupported-persistence-type"):C_()?P_(n===R_.NONE||n===R_.LOCAL&&bd(),t,"unsupported-persistence-type"):P_(n===R_.NONE||k_(),t,"unsupported-persistence-type");let r;switch(e){case R_.SESSION:r=rv;break;case R_.LOCAL:var i=await pm(yv)._isAvailable();r=i?yv:tv;break;case R_.NONE:r=jm;break;default:return im("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return q_(this._delegate,async function(e){const t=ty(e);return await t._initializationPromise,null!==(e=t.currentUser)&&void 0!==e&&e.isAnonymous?new Sy({user:t.currentUser,providerId:null,operationType:"signIn"}):(e=await Ey(t,{returnSecureToken:!0}),e=await Sy._fromIdTokenResponse(t,"signIn",e,!0),await t._updateCurrentUser(e.user),e)}(this._delegate))}signInWithCredential(e){return q_(this._delegate,Dy(this._delegate,e))}signInWithCustomToken(e){return q_(this._delegate,async function(e,t){const n=ty(e);return t=await Sm(n,"POST","/v1/accounts:signInWithCustomToken",Im(n,{token:t,returnSecureToken:!0})),t=await Sy._fromIdTokenResponse(n,"signIn",t),await n._updateCurrentUser(t.user),t}(this._delegate,e))}signInWithEmailAndPassword(e,t){return q_(this._delegate,Dy(Qd(this._delegate),gy.credential(e,t)))}signInWithEmailLink(e,t){return q_(this._delegate,async function(e,t,n){return e=Qd(e),lm((n=gy.credentialWithLink(t,n||fm()))._tenantId===(e.tenantId||null),e,"tenant-id-mismatch"),Dy(e,n)}(this._delegate,e,t))}signInWithPhoneNumber(r,i){return j_(this._delegate,async function(e,t){const n=ty(e);return t=await Rv(n,r,Qd(i)),new Nv(t,e=>Dy(n,e))}(this._delegate))}async signInWithPopup(e){return K_(A_(),this._delegate,"operation-not-supported-in-this-environment"),q_(this._delegate,async function(e,t,n){var r=ty(e);am(e,t,my),n=xv(r,n);const i=new qv(r,"signInViaPopup",t,n);return i.executeNotNull()}(this._delegate,e,M_))}async signInWithRedirect(e){return K_(A_(),this._delegate,"operation-not-supported-in-this-environment"),await O_(this._delegate),i=this._delegate,t=e,e=M_,async function(e,t){var n=ty(i);am(i,e,my);const r=xv(n,t);return await Kv(r,n),r._openRedirect(n,e,"signInViaRedirect")}(t,e);var i,t}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(t){return async function(e){return(await jy(Qd(e),t)).data.email}(this._delegate)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function $_(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&B_.getOrCreate(e)),error:t,complete:n}}z_.Persistence=R_;class W_{constructor(){this.providerId="phone",this._delegate=new Pv(F_(Fp.auth()))}static credential(e,t){return Pv.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}W_.PHONE_SIGN_IN_METHOD=Pv.PHONE_SIGN_IN_METHOD,W_.PROVIDER_ID=Pv.PROVIDER_ID;const H_=lm;(Vt=Fp).INTERNAL.registerComponent(new ep("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("auth");return new z_(t,e)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Wg,PASSWORD_RESET:Hg,RECOVER_EMAIL:Gg,REVERT_SECOND_FACTOR_ADDITION:Qg,VERIFY_AND_CHANGE_EMAIL:Yg,VERIFY_EMAIL:Jg}},EmailAuthProvider:gy,FacebookAuthProvider:_y,GithubAuthProvider:by,GoogleAuthProvider:wy,OAuthProvider:vy,PhoneAuthProvider:W_,PhoneMultiFactorGenerator:f_,RecaptchaVerifier:class{constructor(e,t,n=Fp.app()){var r;H_(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new Av(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:Ty,Auth:z_,AuthCredential:sy,Error:Ed}).setInstantiationMode("LAZY").setMultipleInstances(!1)),Vt.registerVersion("@firebase/auth-compat","0.1.5");let G_="";function Q_(e){G_=e}class Y_{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ad(t))}get(e){return null==(e=this.domStorage_.getItem(this.prefixedName_(e)))?null:Cd(e)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class J_{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return Rd(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}function X_(e){e=function(n){const r=[];let i=0;for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);var s,o;55296<=e&&e<=56319&&(s=e-55296,t++,ad(t<n.length,"Surrogate pair missing trail surrogate."),o=n.charCodeAt(t)-56320,e=65536+(s<<10)+o),e<128?r[i++]=e:(e<2048?r[i++]=e>>6|192:(e<65536?r[i++]=e>>12|224:(r[i++]=e>>18|240,r[i++]=e>>12&63|128),r[i++]=e>>6&63|128),r[i++]=63&e|128)}return r}(e);const t=new qd;return t.update(e),e=t.digest(),ld.encodeByteArray(e)}const Z_=(_t=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Y_(t)}}catch(e){}return new J_})("localStorage"),ew=_t("sessionStorage"),tw=new pp("@firebase/database"),nw=function(){let e=1;return function(){return e++}}(),rw=function(...t){let n="";for(let e=0;e<t.length;e++){var r=t[e];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?n+=rw.apply(null,r):n+="object"==typeof r?Ad(r):r,n+=" "}return n};let iw=null,sw=!0;function ow(t){return function(...e){pw(t,...e)}}function aw(...e){e="FIREBASE INTERNAL ERROR: "+rw(...e),tw.error(e)}function cw(e,t){return e===t?0:e<t?-1:1}function lw(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Ad(t))}function uw(t){if("object"!=typeof t||null===t)return Ad(t);const n=[];for(const e in t)n.push(e);n.sort();let r="{";for(let e=0;e<n.length;e++)0!==e&&(r+=","),r+=Ad(n[e]),r+=":",r+=uw(t[n[e]]);return r+="}",r}function hw(t,n){var r=t.length;if(r<=n)return[t];const i=[];for(let e=0;e<r;e+=n)e+n>r?i.push(t.substring(e,r)):i.push(t.substring(e,e+n));return i}function dw(e,t){ad(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(tw.logLevel=sp.VERBOSE,iw=tw.log.bind(tw),t&&ew.set("logging_enabled",!0)):"function"==typeof e?iw=e:(iw=null,ew.remove("logging_enabled"))}const pw=function(...e){!0===sw&&(sw=!1,null===iw&&!0===ew.get("logging_enabled")&&dw(!0)),iw&&(e=rw.apply(null,e),iw(e))},fw=function(...e){throw e=`FIREBASE FATAL ERROR: ${rw(...e)}`,tw.error(e),new Error(e)},gw=function(...e){e="FIREBASE WARNING: "+rw(...e),tw.warn(e)},mw=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&gw("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},yw=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},vw="[MIN_NAME]",_w="[MAX_NAME]",ww=function(e,t){if(e===t)return 0;if(e===vw||t===_w)return-1;if(t===vw||e===_w)return 1;var n=Ew(e),r=Ew(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1};function bw(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}function Iw(e){ad(!yw(e),"Invalid JSON number");let t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),r=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));const o=[];for(s=52;s;--s)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();const a=o.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()}function Tw(e,t){const n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n}function Ew(e){return Sw.test(e)&&(e=Number(e))>=kw&&e<=Cw?e:null}const Sw=new RegExp("^-?(0*)\\d{1,10}$"),kw=-2147483648,Cw=2147483647,Aw=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw gw("Exception was thrown by user callback.",e),t},Math.floor(0))}};class Nw{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(n){return this.appCheck?this.appCheck.getToken(n):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!==(e=this.appCheckProvider)&&void 0!==e&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){gw(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class Rw{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(e=>e&&"auth/token-not-initialized"===e.code?(pw("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',gw(e)}}class Pw{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Pw.OWNER="owner";const xw=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Ow="websocket",Dw="long_polling";class Lw{constructor(e,t,n,r,i=!1,s="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Z_.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Z_.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Mw(e,t,n){ad("string"==typeof t,"typeof type must == string"),ad("object"==typeof n,"typeof params must == object");let r;if(t===Ow)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Dw)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);const i=[];return bw(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class Fw{constructor(){this.counters_={}}incrementCounter(e,t=1){Rd(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return hd(void 0,this.counters_)}}const Uw={},qw={};function jw(e){return e=e.toString(),Uw[e]||(Uw[e]=new Fw),Uw[e]}class Vw{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<n.length;++e)n[e]&&Aw(()=>{this.onMessage_(n[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Bw{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ow(e),this.stats_=jw(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Mw(t,Dw,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Vw(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(!this.isClosed_){this.scriptTagHolder=new Kw((...e)=>{var[t,n,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&xw.test(location.hostname)&&(t.r="f");var e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})}})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Bw.forceAllow_=!0}static forceDisallow(){Bw.forceDisallow_=!0}static isAvailable(){return!!Bw.forceAllow_||!(Bw.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){e=Ad(e),this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var t=hw(e=id(e),1840);for(let e=0;e<t.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,t.length,t[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){e=Ad(e).length,this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class Kw{constructor(t,n,r,e){this.onDisconnect=r,this.urlFn=e,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=nw(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=Kw.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(r){pw("frame writing exception"),r.stack&&pw(r.stack),pw(r)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||pw("No IE domain setting required")}catch(e){var n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;var n=this.urlFn(i);let e="",t=0;for(;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+e.length<=1870;){var r=this.pendingSegs.shift();e=e+"&seg"+t+"="+r.seg+"&ts"+t+"="+r.ts+"&d"+t+"="+r.d,t++}return n+=e,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),n())},t.onerror=()=>{pw("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}catch(e){}},Math.floor(1))}}let zw=null;"undefined"!=typeof MozWebSocket?zw=MozWebSocket:"undefined"!=typeof WebSocket&&(zw=WebSocket);class $w{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ow(this.connId),this.stats_=jw(t),this.connURL=$w.connectionURL_(t,s,o,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r){const i={v:"5"};return"undefined"!=typeof location&&location.hostname&&xw.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),Mw(e,Ow,i)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Z_.set("previous_websocket_failure",!0);try{wd()||(n={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}},this.mySock=new zw(this.connURL,[],n))}catch(e){this.log_("Error instantiating WebSocket.");var n=e.message||e.data;return n&&this.log_(n),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection."),(e=e.message||e.data)&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){$w.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return"undefined"==typeof navigator||!navigator.userAgent||(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4&&(e=!0),!e&&null!==zw&&!$w.forceDisallow_}static previouslyFailed(){return Z_.isInMemoryStorage||!0===Z_.get("previous_websocket_failure")}markConnectionHealthy(){Z_.remove("previous_websocket_failure")}appendFrame_(e){this.frames.push(e),this.frames.length===this.totalFrames&&(e=this.frames.join(""),this.frames=null,e=Cd(e),this.onMessage(e))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ad(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){null!==this.mySock&&(e=e.data,this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null===this.frames&&null===(e=this.extractFrameCount_(e))||this.appendFrame_(e))}send(e){this.resetKeepAlive(),e=Ad(e),this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var t=hw(e,16384);1<t.length&&this.sendString_(String(t.length));for(let e=0;e<t.length;e++)this.sendString_(t[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}$w.responsesRequiredToBeHealthy=2,$w.healthyTimeout=3e4;class Ww{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Bw,$w]}initTransports_(e){var t=$w&&$w.isAvailable();let n=t&&!$w.previouslyFailed();if(e.webSocketOnly&&(t||gw("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[$w];else{const r=this.transports_=[];for(const i of Ww.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i)}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}class Hw{constructor(e,t,n,r,i,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ow("c:"+this.id+":"),this.transportManager_=new Ww(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));var r=e.healthyTimeout||0;0<r&&(this.healthyTimeout_=Tw(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){"t"in e&&("a"===(e=e.t)?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=lw("t",e),e=lw("d",e);if("c"===t)this.onSecondaryControl_(e);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(e)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=lw("t",e),e=lw("d",e);"c"===t?this.onControl_(e):"d"===t&&this.onDataMessage_(e)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=lw("t",e);if("d"in e)if(e=e.d,"h"===t)this.onHandshake_(e);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(e):"r"===t?this.onReset_(e):"e"===t?aw("Server Error: "+e):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):aw("Unknown control packet command: "+t)}onHandshake_(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&gw("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),e=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,e),Tw(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Tw(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Z_.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Gw{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Qw{constructor(e){this.allowedEvents_=e,this.listeners_={},ad(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n}),(e=this.getInitialEvent(e))&&t.apply(n,e)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(t){ad(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class Yw extends Qw{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||gd()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Yw}getInitialEvent(e){return ad("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class Jw{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)0<this.pieces_[e].length&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function Xw(){return new Jw("")}function Zw(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function eb(e){return e.pieces_.length-e.pieceNum_}function tb(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Jw(e.pieces_,t)}function nb(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function rb(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function ib(t){if(t.pieceNum_>=t.pieces_.length)return null;const n=[];for(let e=t.pieceNum_;e<t.pieces_.length-1;e++)n.push(t.pieces_[e]);return new Jw(n,0)}function sb(t,n){const r=[];for(let e=t.pieceNum_;e<t.pieces_.length;e++)r.push(t.pieces_[e]);if(n instanceof Jw)for(let e=n.pieceNum_;e<n.pieces_.length;e++)r.push(n.pieces_[e]);else{var i=n.split("/");for(let e=0;e<i.length;e++)0<i[e].length&&r.push(i[e])}return new Jw(r,0)}function ob(e){return e.pieceNum_>=e.pieces_.length}function ab(e,t){var n=Zw(e),r=Zw(t);if(null===n)return t;if(n===r)return ab(tb(e),tb(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function cb(e,t){var n=rb(e,0),r=rb(t,0);for(let e=0;e<n.length&&e<r.length;e++){var i=ww(n[e],r[e]);if(0!==i)return i}return n.length===r.length?0:n.length<r.length?-1:1}function lb(n,r){if(eb(n)!==eb(r))return!1;for(let e=n.pieceNum_,t=r.pieceNum_;e<=n.pieces_.length;e++,t++)if(n.pieces_[e]!==r.pieces_[t])return!1;return!0}function ub(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(eb(e)>eb(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class hb{constructor(e,t){this.errorPrefix_=t,this.parts_=rb(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=Hd(this.parts_[e]);db(this)}}function db(e){if(768<e.byteLength_)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(32<e.parts_.length)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+pb(e))}function pb(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class fb extends Qw{constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}static getInstance(){return new fb}getInitialEvent(e){return ad("visible"===e,"Unknown event type: "+e),[this.visible_]}}class gb extends Gw{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=gb.nextPersistentConnectionId_++,this.log_=ow("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!wd())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");fb.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Yw.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){var r=++this.requestNumber_,t={r:r,a:e,b:t};this.log_(Ad(t)),ad(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(t),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const n=new dd,r={p:e._path.toString(),q:e._queryObject},t={action:"g",request:r,onComplete:e=>{var t=e.d;"ok"===e.s?(this.onDataUpdate_(r.p,t,!1,null),n.resolve(t)):n.reject(t)}};this.outstandingGets_.push(t),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{var e=this.outstandingGets_[i];void 0!==e&&t===e&&(delete this.outstandingGets_[i],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+i+" timed out on connection"),n.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(i),n.promise}listen(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),ad(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ad(!this.listens.get(s).has(i),"listen() called twice for same path/queryId."),n={onComplete:r,hashFn:t,query:e,tag:n},this.listens.get(s).set(i,n),this.connected_&&this.sendListen_(n)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(e)})}sendListen_(r){const i=r.query,s=i._path.toString(),o=i._queryIdentifier;this.log_("Listen on "+s+" for "+o);const e={p:s};r.tag&&(e.q=i._queryObject,e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,n=e.s;gb.warnOnListenWarnings_(t,i),(this.listens.get(s)&&this.listens.get(s).get(o))===r&&(this.log_("listen response",e),"ok"!==n&&this.removeListen_(s,o),r.onComplete&&r.onComplete(n,t))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&Rd(e,"w")){const n=Pd(e,"w");Array.isArray(n)&&~n.indexOf("no_index")&&(e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',t=t._path.toString(),gw("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${e} at `+`${t} to your security rules for better performance.`))}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||"object"==typeof(e=Nd(e).claims)&&!0===e.admin)&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const n=this.authToken_;var e=function(){const e=Nd(n),t=e.claims;return t&&"object"==typeof t&&t.hasOwnProperty("iat")}()?"auth":"gauth";const t={cred:n};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,e=e.d||"error";this.authToken_===n&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,e))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,e=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,e)})}unlisten(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),ad(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){this.log_("onDisconnect "+e,n={p:t,d:n}),this.sendRequest(e,n,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++,r=this.outstandingPuts_.length-1,this.connected_?this.sendPut_(r):this.log_("Buffering put: "+t)}sendPut_(t){const n=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;const r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,e,e=>{this.log_(n+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(e.s,e.d)})}reportStats(e){this.connected_&&(this.log_("reportStats",e={c:e}),this.sendRequest("s",e,e=>{"ok"!==e.s&&(e=e.d,this.log_("reportStats","Error sending stats: "+e))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+Ad(e));var t=e.r;const n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):aw("Unrecognized action received from server: "+Ad(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ad(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var n=this.onDataMessage_.bind(this),r=this.onReady_.bind(this);const u=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+gb.nextConnectionId_++,s=this.lastSessionId;let e=!1,t=null;var o=function(){t?t.close():(e=!0,u())};this.realtime_={close:o,sendRequest:function(e){ad(t,"sendRequest call when we're not connected not allowed."),t.sendRequest(e)}};var a=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{var[c,l]=await Promise.all([this.authTokenProvider_.getToken(a),this.appCheckTokenProvider_.getToken(a)]);e?pw("getToken() completed but was canceled"):(pw("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=l&&l.token,t=new Hw(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,n,r,u,e=>{gw(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(n){this.log_("Failed to get token: "+n),e||(this.repoInfo_.nodeAdmin&&gw(n),o())}}}interrupt(e){pw("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){pw("Resuming connection for reason: "+e),delete this.interruptReasons_[e],xd(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){e-=(new Date).getTime(),this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){t=t?t.map(e=>uw(e)).join("$"):"default";const n=this.removeListen_(e,t);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(e,t){e=new Jw(e).toString();let n;if(this.listens.has(e)){const r=this.listens.get(e);n=r.get(t),r.delete(t),0===r.size&&this.listens.delete(e)}else n=void 0;return n}onAuthRevoked_(e,t){pw("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){pw("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+G_.replace(/\./g,"-")]=1,gd()?e["framework.cordova"]=1:vd()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=Yw.getInstance().currentlyOnline();return xd(this.interruptReasons_)&&e}}gb.nextPersistentConnectionId_=0,gb.nextConnectionId_=0;class mb{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new mb(e,t)}}class yb{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){return e=new mb(vw,e),t=new mb(vw,t),0!==this.compare(e,t)}minPost(){return mb.MIN}}let vb;class _b extends yb{static get __EMPTY_NODE(){return vb}static set __EMPTY_NODE(e){vb=e}compare(e,t){return ww(e.name,t.name)}isDefinedOn(e){throw cd("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return mb.MIN}maxPost(){return new mb(_w,vb)}makePost(e,t){return ad("string"==typeof e,"KeyIndex indexValue must always be a string."),new mb(e,vb)}toString(){return".key"}}const wb=new _b;class bb{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Ib{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Ib.RED,this.left=null!=r?r:Tb.EMPTY_NODE,this.right=null!=i?i:Tb.EMPTY_NODE}copy(e,t,n,r,i){return new Ib(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Tb.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Tb.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){var e=this.copy(null,null,Ib.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,Ib.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Ib.RED=!0,Ib.BLACK=!1;class Tb{constructor(e,t=Tb.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Tb(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ib.BLACK,null,null))}remove(e){return new Tb(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ib.BLACK,null,null))}get(e){var t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new bb(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new bb(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new bb(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new bb(this.root_,null,this.comparator_,!0,e)}}function Eb(e,t){return ww(e.name,t.name)}function Sb(e,t){return ww(e,t)}Tb.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new Ib(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let kb;function Cb(e){return"number"==typeof e?"number:"+Iw(e):"string:"+e}function Ab(e){var t;e.isLeafNode()?(t=e.val(),ad("string"==typeof t||"number"==typeof t||"object"==typeof t&&Rd(t,".sv"),"Priority must be a string or number.")):ad(e===kb||e.isEmpty(),"priority of unexpected type."),ad(e===kb||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}let Nb;class Rb{constructor(e,t=Rb.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,ad(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Ab(this.priorityNode_)}static set __childrenNodeConstructor(e){Nb=e}static get __childrenNodeConstructor(){return Nb}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Rb(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Rb.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return ob(e)?this:".priority"===Zw(e)?this.priorityNode_:Rb.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Rb.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var n=Zw(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(ad(".priority"!==n||1===eb(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Rb.__childrenNodeConstructor.EMPTY_NODE.updateChild(tb(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Cb(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"==t?Iw(this.value_):this.value_,this.lazyHash_=X_(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Rb.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Rb.__childrenNodeConstructor?-1:(ad(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,n=typeof this.value_,r=Rb.VALUE_TYPE_ORDER.indexOf(t),i=Rb.VALUE_TYPE_ORDER.indexOf(n);return ad(0<=r,"Unknown leaf type: "+t),ad(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}Rb.VALUE_TYPE_ORDER=["object","boolean","number","string"];let Pb,xb;const Ob=new class extends yb{compare(e,t){const n=e.node.getPriority();var r=t.node.getPriority();return 0===(r=n.compareTo(r))?ww(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return mb.MIN}maxPost(){return new mb(_w,new Rb("[PRIORITY-POST]",xb))}makePost(e,t){return e=Pb(e),new mb(t,new Rb("[PRIORITY-POST]",e))}toString(){return".priority"}},Db=Math.log(2);class Lb{constructor(e){this.count=parseInt(Math.log(e+1)/Db,10),this.current_=this.count-1;var t=(t=this.count,parseInt(Array(t+1).join("1"),2));this.bits_=e+1&t}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}function Mb(c,e,l,t){c.sort(e);const u=function(e,t){var n=t-e;let r,i;return 0==n?null:1==n?(r=c[e],i=l?l(r):r,new Ib(i,r.node,Ib.BLACK,null,null)):(n=parseInt(n/2,10)+e,e=u(e,n),t=u(n+1,t),r=c[n],i=l?l(r):r,new Ib(i,r.node,Ib.BLACK,e,t))};var n=function(t){let i=null,s=null,o=c.length;function n(e,t){var n=o-e,r=o;o-=e,e=u(1+n,r),r=c[n],n=l?l(r):r,e=new Ib(n,r.node,t,null,e),i=(i?i.left=e:s=e,e)}for(let e=0;e<t.count;++e){var r=t.nextBitIsOne(),a=Math.pow(2,t.count-(e+1));r?n(a,Ib.BLACK):(n(a,Ib.BLACK),n(a,Ib.RED))}return s}(new Lb(c.length));return new Tb(t||e,n)}let Fb;const Ub={};class qb{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return ad((Ub,Ob),"ChildrenNode.ts has not been loaded"),Fb=Fb||new qb({".priority":Ub},{".priority":Ob}),Fb}get(e){var t=Pd(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Tb?t:null}hasIndex(e){return Rd(this.indexSet_,e.toString())}addIndex(e,t){ad(e!==wb,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(mb.Wrap);let s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();var o=r?Mb(n,e.getCompare()):Ub;t=e.toString();const a=Object.assign({},this.indexSet_);a[t]=e;const c=Object.assign({},this.indexes_);return c[t]=o,new qb(c,a)}addToIndexes(o,a){var e=Od(this.indexes_,(t,n)=>{const r=Pd(this.indexSet_,n);if(ad(r,"Missing index implementation for "+n),t===Ub){if(r.isDefinedOn(o.node)){const i=[],s=a.getIterator(mb.Wrap);let e=s.getNext();for(;e;)e.name!==o.name&&i.push(e),e=s.getNext();return i.push(o),Mb(i,r.getCompare())}return Ub}{let e=t;return(n=a.get(o.name))&&(e=e.remove(new mb(o.name,n))),e.insert(o,o.node)}});return new qb(e,this.indexSet_)}removeFromIndexes(n,r){var e=Od(this.indexes_,e=>{if(e===Ub)return e;var t=r.get(n.name);return t?e.remove(new mb(n.name,t)):e});return new qb(e,this.indexSet_)}}let jb;class Vb{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Ab(this.priorityNode_),this.children_.isEmpty()&&ad(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return jb=jb||new Vb(new Tb(Sb),null,qb.Default)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||jb}updatePriority(e){return this.children_.isEmpty()?this:new Vb(this.children_,e,this.indexMap_)}getImmediateChild(e){return".priority"===e?this.getPriority():null===(e=this.children_.get(e))?jb:e}getChild(e){var t=Zw(e);return null===t?this:this.getImmediateChild(t).getChild(tb(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(n,r){if(ad(r,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(r);{var i=new mb(n,r);let e,t;return t=r.isEmpty()?(e=this.children_.remove(n),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,r),this.indexMap_.addToIndexes(i,this.children_)),i=e.isEmpty()?jb:this.priorityNode_,new Vb(e,i,t)}}updateChild(e,t){var n=Zw(e);return null===n?t:(ad(".priority"!==Zw(e)||1===eb(e),".priority must be the last token in a path"),t=this.getImmediateChild(n).updateChild(tb(e),t),this.updateImmediateChild(n,t))}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const r={};let i=0,s=0,o=!0;if(this.forEachChild(Ob,(e,t)=>{r[e]=t.val(n),i++,o&&Vb.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):o=!1}),!n&&o&&s<2*i){const e=[];for(const t in r)e[t]=r[t];return e}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let n="";this.getPriority().isEmpty()||(n+="priority:"+Cb(this.getPriority().val())+":"),this.forEachChild(Ob,(e,t)=>{""!==(t=t.hash())&&(n+=":"+e+":"+t)}),this.lazyHash_=""===n?"":X_(n)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);return r?(t=r.getPredecessorKey(new mb(e,t)))?t.name:null:this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);return t?(e=t.minKey())&&e.name:this.children_.minKey()}getFirstChild(e){return(e=this.getFirstChildName(e))?new mb(e,this.children_.get(e)):null}getLastChildName(e){const t=this.resolveIndex_(e);return t?(e=t.maxKey())&&e.name:this.children_.maxKey()}getLastChild(e){return(e=this.getLastChildName(e))?new mb(e,this.children_.get(e)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getIteratorFrom(t,e=>e);{const r=this.children_.getIteratorFrom(t.name,mb.Wrap);let e=r.peek();for(;null!=e&&n.compare(e,t)<0;)r.getNext(),e=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getReverseIteratorFrom(t,e=>e);{const r=this.children_.getReverseIteratorFrom(t.name,mb.Wrap);let e=r.peek();for(;null!=e&&0<n.compare(e,t);)r.getNext(),e=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Kb?-1:0}withIndex(e){return e===wb||this.indexMap_.hasIndex(e)?this:(e=this.indexMap_.addIndex(e,this.children_),new Vb(this.children_,this.priorityNode_,e))}isIndexed(e){return e===wb||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority())){if(this.children_.count()!==n.children_.count())return!1;{const r=this.getIterator(Ob),i=n.getIterator(Ob);let e=r.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=r.getNext(),t=i.getNext()}return null===e&&null===t}}return!1}}resolveIndex_(e){return e===wb?null:this.indexMap_.get(e.toString())}}Vb.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Bb extends Vb{constructor(){super(new Tb(Sb),Vb.EMPTY_NODE,qb.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Vb.EMPTY_NODE}isEmpty(){return!1}}const Kb=new Bb;Object.defineProperties(mb,{MIN:{value:new mb(vw,Vb.EMPTY_NODE)},MAX:{value:new mb(_w,Kb)}}),_b.__EMPTY_NODE=Vb.EMPTY_NODE,Rb.__childrenNodeConstructor=Vb,N=Kb,kb=N,C=Kb,xb=C;const zb=!0;function $b(i,e=null){if(null===i)return Vb.EMPTY_NODE;if("object"==typeof i&&".priority"in i&&(e=i[".priority"]),ad(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(i="object"==typeof i&&".value"in i&&null!==i[".value"]?i[".value"]:i)||".sv"in i){var t=i;return new Rb(t,$b(e))}if(i instanceof Array||!zb){let r=Vb.EMPTY_NODE;return bw(i,(e,t)=>{if(Rd(i,e)&&"."!==e.substring(0,1)){const n=$b(t);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(e,n))}}),r.updatePriority($b(e))}{const s=[];let r=!1;if(bw(i,(e,t)=>{if("."!==e.substring(0,1)){const n=$b(t);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),s.push(new mb(e,n)))}}),0===s.length)return Vb.EMPTY_NODE;var n=Mb(s,Eb,e=>e.name,Sb);return r?(t=Mb(s,Ob.getCompare()),new Vb(n,$b(e),new qb({".priority":t},{".priority":Ob}))):new Vb(n,$b(e),qb.Default)}}Pb=$b;class Wb extends yb{constructor(e){super(),this.indexPath_=e,ad(!ob(e)&&".priority"!==Zw(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node);var r=this.extractChild(t.node);return 0===(r=n.compareTo(r))?ww(e.name,t.name):r}makePost(e,t){return e=$b(e),e=Vb.EMPTY_NODE.updateChild(this.indexPath_,e),new mb(t,e)}maxPost(){var e=Vb.EMPTY_NODE.updateChild(this.indexPath_,Kb);return new mb(_w,e)}toString(){return rb(this.indexPath_,0).join("/")}}function Hb(t){if(t===""+Cw)return"-";var e=Ew(t);if(null!=e)return""+(e+1);const n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t.charAt(e);if(n.length<786)return n.push("-"),n.join("");let r=n.length-1;for(;0<=r&&"z"===n[r];)r--;return-1===r?_w:(e=n[r],e=Yb.charAt(Yb.indexOf(e)+1),n[r]=e,n.slice(0,r+1).join(""))}function Gb(t){if(t===""+kw)return vw;var e=Ew(t);if(null!=e)return""+(e-1);const n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t.charAt(e);return"-"===n[n.length-1]?1===n.length?""+Cw:(delete n[n.length-1],n.join("")):(n[n.length-1]=Yb.charAt(Yb.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))}const Qb=new class extends yb{compare(e,t){var n=e.node.compareTo(t.node);return 0===n?ww(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return mb.MIN}maxPost(){return mb.MAX}makePost(e,t){return e=$b(e),new mb(t,e)}toString(){return".value"}},Yb="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Jb=function(){let s=0;const o=[];return function(e){var t=e===s;s=e;let n;const r=new Array(8);for(n=7;0<=n;n--)r[n]=Yb.charAt(e%64),e=Math.floor(e/64);ad(0===e,"Cannot push at time == 0");let i=r.join("");if(t){for(n=11;0<=n&&63===o[n];n--)o[n]=0;o[n]++}else for(n=0;n<12;n++)o[n]=Math.floor(64*Math.random());for(n=0;n<12;n++)i+=Yb.charAt(o[n]);return ad(20===i.length,"nextPushId: Length should be 20."),i}}();function Xb(e){return{type:"value",snapshotNode:e}}function Zb(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function eI(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function tI(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class nI{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){ad(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(eI(t,o)):ad(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(Zb(t,n)):s.trackChildChange(tI(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(Ob,(e,t)=>{n.hasChild(e)||i.trackChildChange(eI(e,t))}),n.isLeafNode()||n.forEachChild(Ob,(e,t)=>{if(r.hasChild(e)){const n=r.getImmediateChild(e);n.equals(t)||i.trackChildChange(tI(e,t,n))}else i.trackChildChange(Zb(e,t))})),n.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Vb.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class rI{constructor(e){this.indexedFilter_=new nI(e.getIndex()),this.index_=e.getIndex(),this.startPost_=rI.getStartPost_(e),this.endPost_=rI.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,n,r,i,s){return this.matches(new mb(t,n))||(n=Vb.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){let r=(t=t.isLeafNode()?Vb.EMPTY_NODE:t).withIndex(this.index_);r=r.updatePriority(Vb.EMPTY_NODE);const i=this;return t.forEachChild(Ob,(e,t)=>{i.matches(new mb(e,t))||(r=r.updateImmediateChild(e,Vb.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class iI{constructor(e){this.rangedFilter_=new rI(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new mb(t,n))||(n=Vb.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,o,t){let a;if(o.isLeafNode()||o.isEmpty())a=Vb.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<o.numChildren()&&o.isIndexed(this.index_)){a=Vb.EMPTY_NODE.withIndex(this.index_);let e;e=this.reverse_?o.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let t=0;for(;e.hasNext()&&t<this.limit_;){var n=e.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),n)<=0:this.index_.compare(n,this.rangedFilter_.getEndPost())<=0))break;a=a.updateImmediateChild(n.name,n.node),t++}}else{a=o.withIndex(this.index_),a=a.updatePriority(Vb.EMPTY_NODE);let e,t,n,r;if(this.reverse_){r=a.getReverseIterator(this.index_),e=this.rangedFilter_.getEndPost(),t=this.rangedFilter_.getStartPost();const l=this.index_.getCompare();n=(e,t)=>l(t,e)}else r=a.getIterator(this.index_),e=this.rangedFilter_.getStartPost(),t=this.rangedFilter_.getEndPost(),n=this.index_.getCompare();let i=0,s=!1;for(;r.hasNext();){var c=r.getNext();!s&&n(e,c)<=0&&(s=!0),s&&i<this.limit_&&n(c,t)<=0?i++:a=a.updateImmediateChild(c.name,Vb.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,a,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const d=this.index_.getCompare();s=(e,t)=>d(t,e)}else s=this.index_.getCompare();const o=e;ad(o.numChildren()===this.limit_,"");var a=new mb(t,n),c=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),l=this.rangedFilter_.matches(a);if(o.hasChild(t)){var u=o.getImmediateChild(t);let e=r.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=e&&(e.name===t||o.hasChild(e.name));)e=r.getChildAfterChild(this.index_,e,this.reverse_);var h=null==e?1:s(e,a);if(l&&!n.isEmpty()&&0<=h)return null!=i&&i.trackChildChange(tI(t,n,u)),o.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(eI(t,u));const p=o.updateImmediateChild(t,Vb.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(Zb(e.name,e.node)),p.updateImmediateChild(e.name,e.node)):p}}return!n.isEmpty()&&l&&0<=s(c,a)?(null!=i&&(i.trackChildChange(eI(c.name,c.node)),i.trackChildChange(Zb(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(c.name,Vb.EMPTY_NODE)):e}}class sI{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ob}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return ad(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ad(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:vw}hasEnd(){return this.endSet_}getIndexEndValue(){return ad(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ad(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:_w}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return ad(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Ob}copy(){const e=new sI;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function oI(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function aI(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function cI(e,t){const n=e.copy();return n.index_=t,n}function lI(e){const t={};return e.isDefault()||(n=e.index_===Ob?"$priority":e.index_===Qb?"$value":e.index_===wb?"$key":(ad(e.index_ instanceof Wb,"Unrecognized index type!"),e.index_.toString()),t.orderBy=Ad(n),e.startSet_&&(t.startAt=Ad(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+Ad(e.indexStartName_))),e.endSet_&&(t.endAt=Ad(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+Ad(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_)),t;var n}function uI(t){const n={};if(t.startSet_&&(n.sp=t.indexStartValue_,t.startNameSet_&&(n.sn=t.indexStartName_)),t.endSet_&&(n.ep=t.indexEndValue_,t.endNameSet_&&(n.en=t.indexEndName_)),t.limitSet_){n.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),n.vf=e}return t.index_!==Ob&&(n.i=t.index_.toString()),n}class hI extends Gw{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=ow("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(ad(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=hI.getListenId_(e,r),a={};this.listens_[o]=a,e=lI(e._queryParams),this.restRequest_(s+".json",e,(e,t)=>{let n=t;null===(e=404===e?n=null:e)&&this.onDataUpdate_(s,n,!1,r),Pd(this.listens_,o)===a&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){t=hI.getListenId_(e,t),delete this.listens_[t]}get(e){var t=lI(e._queryParams);const r=e._path.toString(),i=new dd;return this.restRequest_(r+".json",t,(e,t)=>{let n=t;null===(e=404===e?n=null:e)?(this.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},o){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+Md(s);this.log_("Sending REST request for "+n);const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(o&&4===r.readyState){this.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);let e=null;if(200<=r.status&&r.status<300){try{e=Cd(r.responseText)}catch(e){gw("Failed to parse JSON response for "+n+": "+r.responseText)}o(null,e)}else 401!==r.status&&404!==r.status&&gw("Got unsuccessful REST response for "+n+" Status: "+r.status),o(r.status);o=null}},r.open("GET",n,!0),r.send()})}}class dI{constructor(){this.rootNode_=Vb.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function pI(){return{value:null,children:new Map}}function fI(e,t,n){var r;ob(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=Zw(t),e.children.has(r)||e.children.set(r,pI()),fI(e.children.get(r),t=tb(t),n))}function gI(e,n,r){var i;null!==e.value?r(n,e.value):(i=(e,t)=>{gI(t,new Jw(n.toString()+"/"+e),r)},e.children.forEach((e,t)=>{i(t,e)}))}class mI{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();const n=Object.assign({},e);return this.last_&&bw(this.last_,(e,t)=>{n[e]=n[e]-t}),this.last_=e,n}}class yI{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new mI(e),e=1e4+2e4*Math.random(),Tw(this.reportStats_.bind(this),Math.floor(e))}reportStats_(){var e=this.statsListener_.get();const n={};let r=!1;bw(e,(e,t)=>{0<t&&Rd(this.statsToReport_,e)&&(n[e]=t,r=!0)}),r&&this.server_.reportStats(n),Tw(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function vI(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function _I(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function wI(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(xa=zg=zg||{})[xa.OVERWRITE=0]="OVERWRITE",xa[xa.MERGE=1]="MERGE",xa[xa.ACK_USER_WRITE=2]="ACK_USER_WRITE",xa[xa.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class bI{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=zg.ACK_USER_WRITE,this.source=vI()}operationForChild(e){if(ob(this.path)){if(null!=this.affectedTree.value)return ad(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new Jw(e));return new bI(Xw(),t,this.revert)}return ad(Zw(this.path)===e,"operationForChild called for unrelated child."),new bI(tb(this.path),this.affectedTree,this.revert)}}class II{constructor(e,t){this.source=e,this.path=t,this.type=zg.LISTEN_COMPLETE}operationForChild(e){return ob(this.path)?new II(this.source,Xw()):new II(this.source,tb(this.path))}}class TI{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=zg.OVERWRITE}operationForChild(e){return ob(this.path)?new TI(this.source,Xw(),this.snap.getImmediateChild(e)):new TI(this.source,tb(this.path),this.snap)}}class EI{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=zg.MERGE}operationForChild(e){if(ob(this.path)){const t=this.children.subtree(new Jw(e));return t.isEmpty()?null:t.value?new TI(this.source,Xw(),t.value):new EI(this.source,Xw(),t)}return ad(Zw(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new EI(this.source,tb(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class SI{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){return ob(e)?this.isFullyInitialized()&&!this.filtered_:(e=Zw(e),this.isCompleteForChild(e))}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class kI{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function CI(r,i,t,e,s,o){const n=e.filter(e=>e.type===t);n.sort((e,t)=>function(e,t,n){if(null==t.childName||null==n.childName)throw cd("Should only compare child_ events.");return t=new mb(t.childName,t.snapshotNode),n=new mb(n.childName,n.snapshotNode),e.index_.compare(t,n)}(r,e,t)),n.forEach(t=>{const n=("value"===(e=t).type||"child_removed"===e.type||(e.prevName=o.getPredecessorChildName(e.childName,e.snapshotNode,r.index_)),e);var e;s.forEach(e=>{e.respondsTo(t.type)&&i.push(e.createEvent(n,r.query_))})})}function AI(e,t){return{eventCache:e,serverCache:t}}function NI(e,t,n,r){return AI(new SI(t,n,r),e.serverCache)}function RI(e,t,n,r){return AI(e.eventCache,new SI(t,n,r))}function PI(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function xI(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let OI;class DI{constructor(e,t=(OI=OI||new Tb(cw),OI)){this.value=e,this.children=t}static fromObject(e){let n=new DI(null);return bw(e,(e,t)=>{n=n.set(new Jw(e),t)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Xw(),value:this.value};if(ob(e))return null;{var n=Zw(e);const r=this.children.get(n);return null===r?null:null==(t=r.findRootMostMatchingPathAndValue(tb(e),t))?null:{path:sb(new Jw(n),t.path),value:t.value}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ob(e))return this;{var t=Zw(e);const n=this.children.get(t);return null!==n?n.subtree(tb(e)):new DI(null)}}set(e,t){if(ob(e))return new DI(t,this.children);{var n=Zw(e);const r=this.children.get(n)||new DI(null);return t=r.set(tb(e),t),t=this.children.insert(n,t),new DI(this.value,t)}}remove(t){if(ob(t))return this.children.isEmpty()?new DI(null):new DI(null,this.children);{var n=Zw(t);const r=this.children.get(n);if(r){const i=r.remove(tb(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new DI(null):new DI(this.value,e)}return this}}get(e){if(ob(e))return this.value;{var t=Zw(e);const n=this.children.get(t);return n?n.get(tb(e)):null}}setTree(e,t){if(ob(e))return t;{var n=Zw(e);const r=this.children.get(n)||new DI(null),i=r.setTree(tb(e),t);return n=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new DI(this.value,n)}}fold(e){return this.fold_(Xw(),e)}fold_(n,r){const i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(sb(n,e),r)}),r(n,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,Xw(),t)}findOnPath_(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(ob(e))return null;{r=Zw(e);const i=this.children.get(r);return i?i.findOnPath_(tb(e),sb(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Xw(),t)}foreachOnPath_(e,t,n){if(ob(e))return this;{this.value&&n(t,this.value);var r=Zw(e);const i=this.children.get(r);return i?i.foreachOnPath_(tb(e),sb(t,r),n):new DI(null)}}foreach(e){this.foreach_(Xw(),e)}foreach_(n,r){this.children.inorderTraversal((e,t)=>{t.foreach_(sb(n,e),r)}),this.value&&r(n,this.value)}foreachChild(n){this.children.inorderTraversal((e,t)=>{t.value&&n(e,t.value)})}}class LI{constructor(e){this.writeTree_=e}static empty(){return new LI(new DI(null))}}function MI(t,n,r){if(ob(n))return new LI(new DI(r));var i=t.writeTree_.findRootMostValueAndPath(n);if(null==i)return r=new DI(r),r=t.writeTree_.setTree(n,r),new LI(r);{var s=i.path;let e=i.value;return i=ab(s,n),e=e.updateChild(i,r),new LI(t.writeTree_.set(s,e))}}function FI(e,n,t){let r=e;return bw(t,(e,t)=>{r=MI(r,sb(n,e),t)}),r}function UI(e,t){return ob(t)?LI.empty():(t=e.writeTree_.setTree(t,new DI(null)),new LI(t))}function qI(e,t){return null!=jI(e,t)}function jI(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(ab(n.path,t)):null}function VI(e){const n=[],t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Ob,(e,t)=>{n.push(new mb(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&n.push(new mb(e,t.value))}),n}function BI(e,t){if(ob(t))return e;var n=jI(e,t);return null!=n?new LI(new DI(n)):new LI(e.writeTree_.subtree(t))}function KI(e){return e.writeTree_.isEmpty()}function zI(e,t){return function r(i,e,s){if(null!=e.value)return s.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(ad(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):s=r(sb(i,e),t,s)}),s=s.getChild(i).isEmpty()||null===n?s:s.updateChild(sb(i,".priority"),n)}}(Xw(),e.writeTree_,t)}function $I(e,t){return tT(t,e)}function WI(e){return e.visible}function HI(t,n,r){let i=LI.empty();for(let e=0;e<t.length;++e){const o=t[e];if(n(o)){var s=o.path;let e;if(o.snap)ub(r,s)?(e=ab(r,s),i=MI(i,e,o.snap)):ub(s,r)&&(e=ab(s,r),i=MI(i,Xw(),o.snap.getChild(e)));else{if(!o.children)throw cd("WriteRecord should have .snap or .children");if(ub(r,s))e=ab(r,s),i=FI(i,e,o.children);else if(ub(s,r))if(e=ab(s,r),ob(e))i=FI(i,Xw(),o.children);else{const a=Pd(o.children,Zw(e));a&&(s=a.getChild(tb(e)),i=MI(i,Xw(),s))}}}}return i}function GI(e,t,n,r,i){if(r||i){var s=BI(e.visibleWrites,t);return!i&&KI(s)?n:i||null!=n||qI(s,Xw())?zI(HI(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(ub(e.path,t)||ub(t,e.path))},t),n||Vb.EMPTY_NODE):null}return null!=(s=jI(e.visibleWrites,t))?s:KI(e=BI(e.visibleWrites,t))?n:null!=n||qI(e,Xw())?zI(e,n||Vb.EMPTY_NODE):null}function QI(e,t,n,r){return GI(e.writeTree,e.treePath,t,n,r)}function YI(e,t){return function(e,t,n){let r=Vb.EMPTY_NODE;const i=jI(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Ob,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const s=BI(e.visibleWrites,t);return n.forEachChild(Ob,(e,t)=>{t=zI(BI(s,new Jw(e)),t),r=r.updateImmediateChild(e,t)}),VI(s).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return VI(BI(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function JI(e,t,n,r){return i=e.writeTree,e=e.treePath,ad(n||r,"Either existingEventSnap or existingServerSnap must exist"),e=sb(e,t),qI(i.visibleWrites,e)?null:KI(e=BI(i.visibleWrites,e))?r.getChild(t):zI(e,r.getChild(t));var i}function XI(e,t){return n=e.writeTree,t=sb(e.treePath,t),jI(n.visibleWrites,t);var n}function ZI(e,t,n){return r=e.writeTree,i=e.treePath,e=n,t=sb(i,n=t),null!=(i=jI(r.visibleWrites,t))?i:e.isCompleteForChild(n)?zI(BI(r.visibleWrites,t),e.getNode().getImmediateChild(n)):null;var r,i}function eT(e,t){return tT(sb(e.treePath,t),e.writeTree)}function tT(e,t){return{treePath:e,writeTree:t}}class nT{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,n=e.childName;ad("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),ad(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,tI(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,eI(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Zb(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw cd("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,tI(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const rT=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class iT{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new SI(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ZI(this.writes_,e,n)}getChildAfterChild(e,t,n){var r,i,s=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:xI(this.viewCache_);return 0===(e=(r=this.writes_,i=1,function(e,t,n,r,i,s,o){let a;if(null!=(t=jI(e=BI(e.visibleWrites,t),Xw())))a=t;else{if(null==n)return[];a=zI(e,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const c=[],l=o.getCompare(),u=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let e=u.getNext();for(;e&&c.length<i;)0!==l(e,r)&&c.push(e),e=u.getNext();return c}}(r.writeTree,r.treePath,s,t,i,n,e))).length?null:e[0]}}function sT(e,t,n,r,i){const s=new nT;let o,a;if(n.type===zg.OVERWRITE){var c=n;o=c.source.fromUser?cT(e,t,c.path,c.snap,r,i,s):(ad(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!ob(c.path),aT(e,t,c.path,c.snap,r,i,a,s))}else if(n.type===zg.MERGE){var l=n;o=l.source.fromUser?function(n,r,i,e,s,o,a){let c=r;return e.foreach((e,t)=>{e=sb(i,e),lT(r,Zw(e))&&(c=cT(n,c,e,t,s,o,a))}),e.foreach((e,t)=>{e=sb(i,e),lT(r,Zw(e))||(c=cT(n,c,e,t,s,o,a))}),c}(e,t,l.path,l.children,r,i,s):(ad(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),hT(e,t,l.path,l.children,r,i,a,s))}else if(n.type===zg.ACK_USER_WRITE)l=n,o=l.revert?function(n,r,i,s,o,a){let c;if(null!=XI(s,i))return r;{o=new iT(s,r,o);const u=r.eventCache.getNode();let t;if(ob(i)||".priority"===Zw(i)){var e=r.serverCache.isFullyInitialized()?QI(s,xI(r)):(l=r.serverCache.getNode(),ad(l instanceof Vb,"serverChildren would be complete if leaf node"),YI(s,l));t=n.filter.updateFullNode(u,e,a)}else{var l=Zw(i);let e=ZI(s,l,r.serverCache);null==e&&r.serverCache.isCompleteForChild(l)&&(e=u.getImmediateChild(l)),t=null!=e?n.filter.updateChild(u,l,e,tb(i),o,a):r.eventCache.getNode().hasChild(l)?n.filter.updateChild(u,l,Vb.EMPTY_NODE,tb(i),o,a):u,t.isEmpty()&&r.serverCache.isFullyInitialized()&&(c=QI(s,xI(r)),c.isLeafNode()&&(t=n.filter.updateFullNode(t,c,a)))}return c=r.serverCache.isFullyInitialized()||null!=XI(s,Xw()),NI(r,t,c,n.filter.filtersNodes())}}(e,t,l.path,r,i,s):function(e,t,i,n,s,o,a){if(null!=XI(s,i))return t;const c=t.serverCache.isFiltered(),l=t.serverCache;if(null!=n.value){if(ob(i)&&l.isFullyInitialized()||l.isCompleteForPath(i))return aT(e,t,i,l.getNode().getChild(i),s,o,c,a);if(ob(i)){let n=new DI(null);return l.getNode().forEachChild(wb,(e,t)=>{n=n.set(new Jw(e),t)}),hT(e,t,i,n,s,o,c,a)}return t}{let r=new DI(null);return n.foreach((e,t)=>{var n=sb(i,e);l.isCompleteForPath(n)&&(r=r.set(e,l.getNode().getChild(n)))}),hT(e,t,i,r,s,o,c,a)}}(e,t,l.path,l.affectedTree,r,i,s);else{if(n.type!==zg.LISTEN_COMPLETE)throw cd("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache,o=RI(t,s.getNode(),s.isFullyInitialized()||ob(n),s.isFiltered());return oT(e,o,n,r,rT,i)}(e,t,n.path,r,s)}return r=s.getChanges(),function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty();const s=PI(e);(0<n.length||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(Xb(PI(t)))}}(t,o,r),{viewCache:o,changes:r}}function oT(n,r,i,s,o,a){const c=r.eventCache;if(null!=XI(s,i))return r;{let e,t;var l,u,h,d;return e=ob(i)?(ad(r.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),r.serverCache.isFiltered()?(l=YI(s,(l=xI(r))instanceof Vb?l:Vb.EMPTY_NODE),n.filter.updateFullNode(r.eventCache.getNode(),l,a)):(u=QI(s,xI(r)),n.filter.updateFullNode(r.eventCache.getNode(),u,a))):".priority"===(u=Zw(i))?(ad(1===eb(i),"Can't have a priority with additional path components"),d=c.getNode(),t=r.serverCache.getNode(),null!=(h=JI(s,i,d,t))?n.filter.updatePriority(d,h):c.getNode()):(d=tb(i),null!=(s=c.isCompleteForChild(u)?(t=r.serverCache.getNode(),null!=(h=JI(s,i,c.getNode(),t))?c.getNode().getImmediateChild(u).updateChild(d,h):c.getNode().getImmediateChild(u)):ZI(s,u,r.serverCache))?n.filter.updateChild(c.getNode(),u,s,d,o,a):c.getNode()),NI(r,e,c.isFullyInitialized()||ob(i),n.filter.filtersNodes())}}function aT(e,t,n,r,i,s,o,a){const c=t.serverCache;let l;const u=o?e.filter:e.filter.getIndexedFilter();if(ob(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),h,null)}else{if(o=Zw(n),!c.isCompleteForPath(n)&&1<eb(n))return t;h=tb(n);const d=c.getNode().getImmediateChild(o);r=d.updateChild(h,r),l=".priority"===o?u.updatePriority(c.getNode(),r):u.updateChild(c.getNode(),o,r,h,rT,null)}return oT(e,t=RI(t,l,c.isFullyInitialized()||ob(n),u.filtersNodes()),n,i,new iT(i,t,s),a)}function cT(t,n,r,i,e,s,o){const a=n.eventCache;let c,l;const u=new iT(e,n,s);if(ob(r))l=t.filter.updateFullNode(n.eventCache.getNode(),i,o),c=NI(n,l,!0,t.filter.filtersNodes());else if(".priority"===(s=Zw(r)))l=t.filter.updatePriority(n.eventCache.getNode(),i),c=NI(n,l,a.isFullyInitialized(),a.isFiltered());else{r=tb(r);const h=a.getNode().getImmediateChild(s);let e;if(ob(r))e=i;else{const d=u.getCompleteChild(s);e=null!=d?".priority"===nb(r)&&d.getChild(ib(r)).isEmpty()?d:d.updateChild(r,i):Vb.EMPTY_NODE}c=h.equals(e)?n:NI(n,t.filter.updateChild(a.getNode(),s,e,r,u,o),a.isFullyInitialized(),t.filter.filtersNodes())}return c}function lT(e,t){return e.eventCache.isCompleteForChild(t)}function uT(e,n,t){return t.foreach((e,t)=>{n=n.updateChild(e,t)}),n}function hT(r,i,e,t,s,o,a,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let l=i,n;n=ob(e)?t:new DI(null).setTree(e,t);const u=i.serverCache.getNode();return n.children.inorderTraversal((e,t)=>{u.hasChild(e)&&(t=uT(0,i.serverCache.getNode().getImmediateChild(e),t),l=aT(r,l,new Jw(e),t,s,o,a,c))}),n.children.inorderTraversal((e,t)=>{var n=!i.serverCache.isCompleteForChild(e)&&void 0===t.value;u.hasChild(e)||n||(t=uT(0,i.serverCache.getNode().getImmediateChild(e),t),l=aT(r,l,new Jw(e),t,s,o,a,c))}),l}class dT{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new nI(n.getIndex()),i=(e=n).loadsAllData()?new nI(e.getIndex()):new(e.hasLimit()?iI:rI)(e);this.processor_={filter:i};const s=t.serverCache,o=t.eventCache;e=r.updateFullNode(Vb.EMPTY_NODE,s.getNode(),null),t=i.updateFullNode(Vb.EMPTY_NODE,o.getNode(),null),e=new SI(e,s.isFullyInitialized(),r.filtersNodes()),t=new SI(t,o.isFullyInitialized(),i.filtersNodes()),this.viewCache_=AI(t,e),this.eventGenerator_=new kI(this.query_)}get query(){return this.query_}}function pT(e){return 0===e.eventRegistrations_.length}function fT(n,r,t){const i=[];if(t){ad(null==r,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(e=>{(e=e.createCancelEvent(t,s))&&i.push(e)})}if(r){let t=[];for(let e=0;e<n.eventRegistrations_.length;++e){const o=n.eventRegistrations_[e];if(o.matches(r)){if(r.hasAnyCallback()){t=t.concat(n.eventRegistrations_.slice(e+1));break}}else t.push(o)}n.eventRegistrations_=t}else n.eventRegistrations_=[];return i}function gT(e,t,n,r){t.type===zg.MERGE&&null!==t.source.queryId&&(ad(xI(e.viewCache_),"We should always have a full cache before handling merges"),ad(PI(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=sT(e.processor_,i,t,n,r);return n=e.processor_,r=s.viewCache,ad(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),ad(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),ad(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,mT(e,s.changes,s.viewCache.eventCache.getNode(),null)}function mT(e,t,n,r){return r=r?[r]:e.eventRegistrations_,function(n,e,t,r){var i=[];const s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),CI(n,i,"child_removed",e,r,t),CI(n,i,"child_added",e,r,t),CI(n,i,"child_moved",s,r,t),CI(n,i,"child_changed",e,r,t),CI(n,i,"value",e,r,t),i}(e.eventGenerator_,t,n,r)}let yT;class vT{constructor(){this.views=new Map}}function _T(t,n,r,i){var e=n.source.queryId;if(null!==e)return e=t.views.get(e),ad(null!=e,"SyncTree gave us an op for an invalid query."),gT(e,n,r,i);{let e=[];for(const s of t.views.values())e=e.concat(gT(s,n,r,i));return e}}function wT(e,n,r,i,s){var t=n._queryIdentifier;if(t=e.views.get(t))return t;{let e=QI(r,s?i:null),t;return t=!!e||(e=i instanceof Vb?YI(r,i):Vb.EMPTY_NODE,!1),s=AI(new SI(e,t,!1),new SI(i,s,!1)),new dT(n,s)}}function bT(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function IT(e,t){let n=null;for(const r of e.views.values())n=n||function(e,t){const n=xI(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!ob(t)&&!n.getImmediateChild(Zw(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function TT(e,t){const n=t._queryParams;return n.loadsAllData()?kT(e):(t=t._queryIdentifier,e.views.get(t))}function ET(e,t){return null!=TT(e,t)}function ST(e){return null!=kT(e)}function kT(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let CT,AT=1;class NT{constructor(e){this.listenProvider_=e,this.syncPointTree_=new DI(null),this.pendingWriteTree_={visibleWrites:LI.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function RT(e,t,n,r,i){var s=e.pendingWriteTree_,o=t,a=n,c=r;return r=i,ad(c>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:o,snap:a,writeId:c,visible:r=void 0===r||r}),r&&(s.visibleWrites=MI(s.visibleWrites,o,a)),s.lastWriteId=c,i?MT(e,new TI(vI(),t,n)):[]}function PT(e,t,n=!1){var r=function(t,n){for(let e=0;e<t.allWrites.length;e++){var r=t.allWrites[e];if(r.writeId===n)return r}return null}(e.pendingWriteTree_,t);if(function(t,n){var e,r=t.allWrites.findIndex(e=>e.writeId===n);ad(0<=r,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,o=!1,a=t.allWrites.length-1;for(;s&&0<=a;){var c=t.allWrites[a];c.visible&&(a>=r&&function(e,t){if(e.snap)return ub(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&ub(sb(e.path,n),t))return 1}(c,i.path)?s=!1:ub(i.path,c.path)&&(o=!0)),a--}return s&&(o?((e=t).visibleWrites=HI(e.allWrites,WI,Xw()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=UI(t.visibleWrites,i.path):bw(i.children,e=>{t.visibleWrites=UI(t.visibleWrites,sb(i.path,e))}),1)}(e.pendingWriteTree_,t)){let t=new DI(null);return null!=r.snap?t=t.set(Xw(),!0):bw(r.children,e=>{t=t.set(new Jw(e),!0)}),MT(e,new bI(r.path,t,n))}return[]}function xT(e,t,n){return MT(e,new TI(_I(),t,n))}function OT(n,e,t,r){var i=e._path,s=n.syncPointTree_.get(i);let o=[];if(s&&("default"===e._queryIdentifier||ET(s,e))){t=function(e,t,n,r){var i=t._queryIdentifier;const s=[];let o=[];var a=ST(e);if("default"===i)for(var[c,l]of e.views.entries())o=o.concat(fT(l,n,r)),pT(l)&&(e.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{const u=e.views.get(i);u&&(o=o.concat(fT(u,n,r)),pT(u)&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return a&&!ST(e)&&s.push((ad(yT,"Reference.ts has not been loaded"),new yT(t._repo,t._path))),{removed:s,events:o}}(s,e,t,r),0===s.views.size&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=t.removed;if(o=t.events,s=-1!==u.findIndex(e=>e._queryParams.loadsAllData()),t=n.syncPointTree_.findOnPath(i,(e,t)=>ST(t)),s&&!t){const h=n.syncPointTree_.subtree(i);if(!h.isEmpty()){var a=h.fold((e,t,r)=>{if(t&&ST(t))return[kT(t)];{let n=[];return t&&(n=bT(t)),bw(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<a.length;++e){var c=(l=a[e]).query,l=FT(n,l);n.listenProvider_.startListening(KT(c),UT(n,c),l.hashFn,l.onComplete)}}}!t&&0<u.length&&!r&&(s?n.listenProvider_.stopListening(KT(e),null):u.forEach(e=>{var t=n.queryToTagMap.get(qT(e));n.listenProvider_.stopListening(KT(e),t)})),function(t,n){for(let e=0;e<n.length;++e){const s=n[e];var r,i;s._queryParams.loadsAllData()||(r=qT(s),i=t.queryToTagMap.get(r),t.queryToTagMap.delete(r),t.tagToQueryMap.delete(i))}}(n,u)}return o}function DT(e,t,n){const r=t._path;let i=null,s=!1;e.syncPointTree_.foreachOnPath(r,(e,t)=>{e=ab(e,r),i=i||IT(t,e),s=s||ST(t)});let o=e.syncPointTree_.get(r);o?(s=s||ST(o),i=i||IT(o,Xw())):(o=new vT,e.syncPointTree_=e.syncPointTree_.set(r,o));let a;if(null!=i)a=!0;else{a=!1,i=Vb.EMPTY_NODE;const g=e.syncPointTree_.subtree(r);g.foreachChild((e,t)=>{(t=IT(t,Xw()))&&(i=i.updateImmediateChild(e,t))})}var c=ET(o,t);c||t._queryParams.loadsAllData()||(p=qT(t),ad(!e.queryToTagMap.has(p),"View does not exist, but we have a tag"),d=AT++,e.queryToTagMap.set(p,d),e.tagToQueryMap.set(d,p));var l,u,h,d,p=$I(e.pendingWriteTree_,r);let f=(l=o,u=t,h=n,d=i,n=a,n=wT(l,u,p,d,n),l.views.has(u._queryIdentifier)||l.views.set(u._queryIdentifier,n),n.eventRegistrations_.push(h),function(e,t){const n=e.viewCache_.eventCache,r=[];if(!n.getNode().isLeafNode()){const i=n.getNode();i.forEachChild(Ob,(e,t)=>{r.push(Zb(e,t))})}return n.isFullyInitialized()&&r.push(Xb(n.getNode())),mT(e,r,n.getNode(),t)}(n,h));return c||s||(c=TT(o,t),f=f.concat(function(t,e,n){const r=e._path,i=UT(t,e),s=FT(t,n),o=t.listenProvider_.startListening(KT(e),i,s.hashFn,s.onComplete),a=t.syncPointTree_.subtree(r);if(i)ad(!ST(a.value),"If we're adding a query, it shouldn't be shadowed");else{var c=a.fold((e,t,r)=>{if(!ob(e)&&t&&ST(t))return[kT(t).query];{let n=[];return t&&(n=n.concat(bT(t).map(e=>e.query))),bw(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<c.length;++e){var l=c[e];t.listenProvider_.stopListening(KT(l),UT(t,l))}}return o}(e,t,c))),f}function LT(e,n,t){var r=e.pendingWriteTree_,e=e.syncPointTree_.findOnPath(n,(e,t)=>{if(e=IT(t,ab(e,n)))return e});return GI(r,n,e,t,!0)}function MT(e,t){return function t(n,r,i,s){if(ob(n.path))return function i(s,e,o,a){var t=e.get(Xw());null==o&&null!=t&&(o=IT(t,Xw()));let c=[];return e.children.inorderTraversal((e,t)=>{var n=o?o.getImmediateChild(e):null,r=eT(a,e);(e=s.operationForChild(e))&&(c=c.concat(i(e,t,n,r)))}),t&&(c=c.concat(_T(t,s,a,o))),c}(n,r,i,s);{var o=r.get(Xw());null==i&&null!=o&&(i=IT(o,Xw()));let e=[];var a=Zw(n.path),c=n.operationForChild(a),l=r.children.get(a);return l&&c&&(r=i?i.getImmediateChild(a):null,a=eT(s,a),e=e.concat(t(c,l,r,a))),o&&(e=e.concat(_T(o,n,s,i))),e}}(t,e.syncPointTree_,null,$I(e.pendingWriteTree_,Xw()))}function FT(s,t){const o=t.query,a=UT(s,o);return{hashFn:()=>{const e=t.viewCache_.serverCache.getNode()||Vb.EMPTY_NODE;return e.hash()},onComplete:e=>{if("ok"===e)return a?(t=s,i=o._path,a,(n=jT(t,a))?(n=(r=VT(n)).path,r=r.queryId,i=ab(n,i),BT(t,n,new II(wI(r),i))):[]):(r=s,i=o._path,MT(r,new II(_I(),i)));var t,n,r,i,e=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,o);return OT(s,o,null,e)}}}function UT(e,t){return t=qT(t),e.queryToTagMap.get(t)}function qT(e){return e._path.toString()+"$"+e._queryIdentifier}function jT(e,t){return e.tagToQueryMap.get(t)}function VT(e){var t=e.indexOf("$");return ad(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Jw(e.substr(0,t))}}function BT(e,t,n){var r=e.syncPointTree_.get(t);return ad(r,"Missing sync point for query tag that we're tracking"),_T(r,n,$I(e.pendingWriteTree_,t),null)}function KT(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(ad(CT,"Reference.ts has not been loaded"),new CT(e._repo,e._path)):e}class zT{constructor(e){this.node_=e}getImmediateChild(e){return e=this.node_.getImmediateChild(e),new zT(e)}node(){return this.node_}}class $T{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){return e=sb(this.path_,e),new $T(this.syncTree_,e)}node(){return LT(this.syncTree_,this.path_)}}function WT(e,t,n){return e&&"object"==typeof e?(ad(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?function(e,t){if("timestamp"===e)return t.timestamp;ad(!1,"Unexpected server value: "+e)}(e[".sv"],n):"object"==typeof e[".sv"]?function(e,t){e.hasOwnProperty("increment")||ad(!1,"Unexpected server value: "+JSON.stringify(e,null,2)),"number"!=typeof(e=e.increment)&&ad(!1,"Unexpected increment value: "+e);const n=t.node();if(ad(null!==n&&void 0!==n,"Expected ChildrenNode.EMPTY_NODE for nulls"),!n.isLeafNode())return e;const r=n;return"number"!=typeof(t=r.getValue())?e:t+e}(e[".sv"],t):void ad(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e}const HT=function(e,t,n,r){return QT(t,new $T(n,e),r)},GT=function(e,t,n){return QT(e,new zT(t),n)};function QT(e,r,i){var t,n=WT(t=e.getPriority().val(),r.getImmediateChild(".priority"),i);let s;if(e.isLeafNode()){const o=e;return(t=WT(o.getValue(),r,i))!==o.getValue()||n!==o.getPriority().val()?new Rb(t,$b(n)):e}{const a=e;return s=a,n!==a.getPriority().val()&&(s=s.updatePriority(new Rb(n))),a.forEachChild(Ob,(e,t)=>{var n=QT(t,r.getImmediateChild(e),i);n!==t&&(s=s.updateImmediateChild(e,n))}),s}}class YT{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function JT(e,t){let n=t instanceof Jw?t:new Jw(t),r=e,i=Zw(n);for(;null!==i;){var s=Pd(r.node.children,i)||{children:{},childCount:0};r=new YT(i,r,s),n=tb(n),i=Zw(n)}return r}function XT(e){return e.node.value}function ZT(e,t){e.node.value=t,function e(t){var n,r,i,s;null!==t.parent&&(n=t.parent,r=t.name,s=function(e){return void 0===XT(e)&&!e0(e)}(i=t),t=Rd(n.node.children,r),s&&t?(delete n.node.children[r],n.node.childCount--,e(n)):s||t||(n.node.children[r]=i.node,n.node.childCount++,e(n)))}(e)}function e0(e){return 0<e.node.childCount}function t0(n,r){bw(n.node.children,(e,t)=>{r(new YT(e,n,t))})}function n0(e){return new Jw(null===e.parent?e.name:n0(e.parent)+"/"+e.name)}function r0(e,t,n,r){r&&void 0===t||y0(zd(e,"value"),t,n)}function i0(e,t,r,n){if(!n||void 0!==t){const i=zd(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];bw(t,(e,t)=>{const n=new Jw(e);if(y0(i,t,sb(r,n)),".priority"===nb(n)&&!l0(t))throw new Error(i+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];var i=rb(r);for(let e=0;e<i.length;e++)if((".priority"!==i[e]||e!==i.length-1)&&!f0(i[e]))throw new Error(t+"contains an invalid key ("+i[e]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}e.sort(cb);let s=null;for(n=0;n<e.length;n++){if(r=e[n],null!==s&&ub(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(i,s)}}function s0(e,t,n){if(!n||void 0!==t){if(yw(t))throw new Error(zd(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!l0(t))throw new Error(zd(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function o0(e,t,n,r){if(!(r&&void 0===n||f0(n)))throw new Error(zd(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function a0(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),v0(e,t,n,r)}function c0(e,t){if(".info"===Zw(t))throw new Error(e+" failed = Can't modify data under /.info/")}function l0(e){return null===e||"string"==typeof e||"number"==typeof e&&!yw(e)||e&&"object"==typeof e&&Rd(e,".sv")}function u0(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!f0(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!m0(n))throw new Error(zd(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}const h0=/[\[\].#$\/\u0000-\u001F\u007F]/,d0=/[\[\].#$\u0000-\u001F\u007F]/,p0=10485760,f0=function(e){return"string"==typeof e&&0!==e.length&&!h0.test(e)},g0=function(e){return"string"==typeof e&&0!==e.length&&!d0.test(e)},m0=function(e){return e=e&&e.replace(/^\/*\.info(\/|$)/,"/"),g0(e)},y0=function(s,e,t){const o=t instanceof Jw?new hb(t,s):t;if(void 0===e)throw new Error(s+"contains undefined "+pb(o));if("function"==typeof e)throw new Error(s+"contains a function "+pb(o)+" with contents = "+e.toString());if(yw(e))throw new Error(s+"contains "+e.toString()+" "+pb(o));if("string"==typeof e&&e.length>p0/3&&Hd(e)>p0)throw new Error(s+"contains a string greater than "+p0+" utf8 bytes "+pb(o)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let r=!1,i=!1;if(bw(e,(e,t)=>{if(".value"===e)r=!0;else if(".priority"!==e&&".sv"!==e&&(i=!0,!f0(e)))throw new Error(s+" contains an invalid key ("+e+") "+pb(o)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var n=o;0<n.parts_.length&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Hd(e),db(n),y0(s,t,o),t=(n=o).parts_.pop(),n.byteLength_-=Hd(t),0<n.parts_.length&&--n.byteLength_}),r&&i)throw new Error(s+' contains ".value" child '+pb(o)+" in addition to actual children.")}},v0=function(e,t,n,r){if(!(r&&void 0===n||g0(n)))throw new Error(zd(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')};class _0{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function w0(t,n){let r=null;for(let e=0;e<n.length;e++){const s=n[e];var i=s.getPath();null===r||lb(i,r.path)||(t.eventLists_.push(r),r=null),null===r&&(r={events:[],path:i}),r.events.push(s)}r&&t.eventLists_.push(r)}function b0(e,t,n){w0(e,n),T0(e,e=>lb(e,t))}function I0(e,t,n){w0(e,n),T0(e,e=>ub(e,t)||ub(t,e))}function T0(t,n){t.recursionDepth_++;let r=!0;for(let e=0;e<t.eventLists_.length;e++){var i=t.eventLists_[e];i&&(n(i.path)?(function(t){for(let e=0;e<t.events.length;e++){const r=t.events[e];var n;null!==r&&(t.events[e]=null,n=r.getEventRunner(),iw&&pw("event: "+r.toString()),Aw(n))}}(t.eventLists_[e]),t.eventLists_[e]=null):r=!1)}r&&(t.eventLists_=[]),t.recursionDepth_--}const E0="repo_interrupt",S0=25;class k0{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new _0,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=pI(),this.transactionQueueTree_=new YT,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function C0(e){const t=e.infoData_.getNode(new Jw(".info/serverTimeOffset"));return e=t.val()||0,(new Date).getTime()+e}function A0(e){return(e=(e={timestamp:C0(e)})||{}).timestamp=e.timestamp||(new Date).getTime(),e}function N0(e,t,n,r,i){e.dataUpdateCount++;var s,o,a,c=new Jw(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;var l,u,h,d,p,f=[];let g=c;0<(f=i?r?(s=Od(n,e=>$b(e)),l=e.serverSyncTree_,u=c,h=s,(p=jT(l,i))?(p=(d=VT(p)).path,d=d.queryId,u=ab(p,u),h=DI.fromObject(h),BT(l,p,new EI(wI(d),u,h))):[]):(t=$b(n),s=e.serverSyncTree_,o=c,a=t,null==(i=jT(s,t=i))?[]:(t=VT(i),i=t.path,t=t.queryId,o=ab(i,o),BT(s,i,new TI(wI(t),o,a)))):r?(o=Od(n,e=>$b(e)),a=e.serverSyncTree_,r=c,o=DI.fromObject(o),MT(a,new EI(_I(),r,o))):(n=$b(n),xT(e.serverSyncTree_,c,n))).length&&(g=V0(e,c)),I0(e.eventQueue_,g,f)}function R0(e,t){P0(e,"connected",t),!1===t&&function(n){F0(n,"onDisconnectEvents");const r=A0(n),i=pI();gI(n.onDisconnect_,Xw(),(e,t)=>{t=HT(e,t,n.serverSyncTree_,r),fI(i,e,t)});let s=[];gI(i,Xw(),(e,t)=>{s=s.concat(xT(n.serverSyncTree_,e,t)),e=$0(n,e),V0(n,e)}),n.onDisconnect_=pI(),I0(n.eventQueue_,Xw(),s)}(e)}function P0(e,t,n){t=new Jw("/.info/"+t),n=$b(n),e.infoData_.updateSnapshot(t,n),n=xT(e.infoSyncTree_,t,n),I0(e.eventQueue_,t,n)}function x0(e){return e.nextWriteId_++}function O0(r,i,e,t,s){F0(r,"set",{path:i.toString(),value:e,priority:t});var n=A0(r);const o=$b(e,t);t=LT(r.serverSyncTree_,i),n=GT(o,t,n);const a=x0(r);n=RT(r.serverSyncTree_,i,n,a,!0),w0(r.eventQueue_,n),r.server_.put(i.toString(),o.val(!0),(e,t)=>{var n="ok"===e;n||gw("set at "+i+" failed: "+e),n=PT(r.serverSyncTree_,a,!n),I0(r.eventQueue_,i,n),U0(0,s,e,t)}),n=$0(r,i),V0(r,n),I0(r.eventQueue_,n,[])}function D0(n,r,e,i){const s=$b(e);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&fI(n.onDisconnect_,r,s),U0(0,i,e,t)})}function L0(e,t,n){n=".info"===Zw(t._path)?OT(e.infoSyncTree_,t,n):OT(e.serverSyncTree_,t,n);b0(e.eventQueue_,t._path,n)}function M0(e){e.persistentConnection_&&e.persistentConnection_.interrupt(E0)}function F0(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),pw(n,...t)}function U0(e,r,i,s){r&&Aw(()=>{if("ok"===i)r(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);const n=new Error(e);n.code=t,r(n)}})}function q0(e,t,n){return LT(e.serverSyncTree_,t,n)||Vb.EMPTY_NODE}function j0(t,e=t.transactionQueueTree_){if(e||z0(t,e),XT(e)){const n=K0(t,e);ad(0<n.length,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(i,s,o){const e=o.map(e=>e.currentWriteId),t=q0(i,s,e);let n=t;var r=t.hash();for(let e=0;e<o.length;e++){const u=o[e];ad(0===u.status,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;var a=ab(s,u.path);n=n.updateChild(a,u.currentOutputSnapshotRaw)}const c=n.val(!0),l=s;i.server_.put(l.toString(),c,t=>{F0(i,"transaction put response",{path:l.toString(),status:t});let n=[];if("ok"===t){const r=[];for(let e=0;e<o.length;e++)o[e].status=2,n=n.concat(PT(i.serverSyncTree_,o[e].currentWriteId)),o[e].onComplete&&r.push(()=>o[e].onComplete(null,!0,o[e].currentOutputSnapshotResolved)),o[e].unwatcher();z0(i,JT(i.transactionQueueTree_,s)),j0(i,i.transactionQueueTree_),I0(i.eventQueue_,s,n);for(let e=0;e<r.length;e++)Aw(r[e])}else{if("datastale"===t)for(let e=0;e<o.length;e++)3===o[e].status?o[e].status=4:o[e].status=0;else{gw("transaction at "+l.toString()+" failed: "+t);for(let e=0;e<o.length;e++)o[e].status=4,o[e].abortReason=t}V0(i,s)}},r)}(t,n0(e),n)}else e0(e)&&t0(e,e=>{j0(t,e)})}function V0(e,t){var n=B0(e,t),t=n0(n);return function(i,s,o){if(0!==s.length){const l=[];let r=[];const e=s.filter(e=>0===e.status),u=e.map(e=>e.currentWriteId);for(let n=0;n<s.length;n++){const h=s[n];var a=ab(o,h.path);let e=!1,t;if(ad(null!==a,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)e=!0,t=h.abortReason,r=r.concat(PT(i.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=S0)e=!0,t="maxretry",r=r.concat(PT(i.serverSyncTree_,h.currentWriteId,!0));else{const d=q0(i,h.path,u);h.currentInputSnapshot=d;var c=s[n].update(d.val());if(void 0!==c){y0("transaction failed: Data returned ",c,h.path);let e=$b(c);"object"==typeof c&&null!=c&&Rd(c,".priority")||(e=e.updatePriority(d.getPriority())),a=h.currentWriteId,c=A0(i),c=GT(e,d,c),h.currentOutputSnapshotRaw=e,h.currentOutputSnapshotResolved=c,h.currentWriteId=x0(i),u.splice(u.indexOf(a),1),r=r.concat(RT(i.serverSyncTree_,h.path,c,h.currentWriteId,h.applyLocally)),r=r.concat(PT(i.serverSyncTree_,a,!0))}else e=!0,t="nodata",r=r.concat(PT(i.serverSyncTree_,h.currentWriteId,!0))}I0(i.eventQueue_,o,r),r=[],e&&(s[n].status=2,a=s[n].unwatcher,setTimeout(a,Math.floor(0)),s[n].onComplete&&("nodata"===t?l.push(()=>s[n].onComplete(null,!1,s[n].currentInputSnapshot)):l.push(()=>s[n].onComplete(new Error(t),!1,null))))}z0(i,i.transactionQueueTree_);for(let e=0;e<l.length;e++)Aw(l[e]);j0(i,i.transactionQueueTree_)}}(e,K0(e,n),t),t}function B0(e,t){let n,r=e.transactionQueueTree_;for(n=Zw(t);null!==n&&void 0===XT(r);)r=JT(r,n),t=tb(t),n=Zw(t);return r}function K0(e,t){const n=[];return function t(n,e,r){var i=XT(e);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);t0(e,e=>{t(n,e,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function z0(t,e){const n=XT(e);if(n){let t=0;for(let e=0;e<n.length;e++)2!==n[e].status&&(n[t]=n[e],t++);n.length=t,ZT(e,0<n.length?n:void 0)}t0(e,e=>{z0(t,e)})}function $0(r,e){var t=n0(B0(r,e));return function(e){let t=e.parent;for(;null!==t;)n=t,W0(r,n),t=t.parent;var n}(e=JT(r.transactionQueueTree_,e)),W0(r,e),function t(e,n,r,i){r&&!i&&n(e),t0(e,e=>{t(e,n,!0,i)}),r&&i&&n(e)}(e,e=>{W0(r,e)}),t}function W0(r,e){const i=XT(e);if(i){const s=[];let t=[],n=-1;for(let e=0;e<i.length;e++)3===i[e].status||(1===i[e].status?(ad(n===e-1,"All SENT items should be at beginning of queue."),n=e,i[e].status=3,i[e].abortReason="set"):(ad(0===i[e].status,"Unexpected transaction status in abort"),i[e].unwatcher(),t=t.concat(PT(r.serverSyncTree_,i[e].currentWriteId,!0)),i[e].onComplete&&s.push(i[e].onComplete.bind(null,new Error("set"),!1,null))));-1===n?ZT(e,void 0):i.length=n+1,I0(r.eventQueue_,n0(e),t);for(let e=0;e<s.length;e++)Aw(s[e])}}function H0(e,t){var n=G0(e),r=n.namespace;return"firebase.com"===n.domain&&fw(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||fw("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||mw(),e="ws"===n.scheme||"wss"===n.scheme,{repoInfo:new Lw(n.host,n.secure,r,t,e,"",r!==n.subdomain),path:new Jw(n.pathString)}}const G0=function(s){let n="",r="",o="",a="",c="",l=!0,u="https",h=443;if("string"==typeof s){let e=s.indexOf("//");0<=e&&(u=s.substring(0,e-1),s=s.substring(e+2));let t=s.indexOf("/");-1===t&&(t=s.length);let i=s.indexOf("?");-1===i&&(i=s.length),n=s.substring(0,Math.min(t,i)),t<i&&(a=function(){let n="";var r=s.substring(t,i).split("/");for(let t=0;t<r.length;t++)if(0<r[t].length){let e=r[t];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}n+="/"+e}return n}());var d=function(e){const t={};for(const r of(e="?"===e.charAt(0)?e.substring(1):e).split("&")){var n;0!==r.length&&(2===(n=r.split("=")).length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):gw(`Invalid query segment '${r}' in query '${e}'`))}return t}(s.substring(Math.min(s.length,i)));e=n.indexOf(":"),0<=e?(l="https"===u||"wss"===u,h=parseInt(n.substring(e+1),10)):e=n.length;const p=n.slice(0,e);"localhost"===p.toLowerCase()?r="localhost":p.split(".").length<=2?r=p:(s=n.indexOf("."),o=n.substring(0,s).toLowerCase(),r=n.substring(s+1),c=o),"ns"in d&&(c=d.ns)}return{host:n,port:h,domain:r,subdomain:o,secure:l,scheme:u,pathString:a,namespace:c}};class Q0{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ad(this.snapshot.exportVal())}}class Y0{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class J0{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return ad(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class X0{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new dd;return n=this._repo,r=this._path,i=e.wrapCallback(()=>{}),n.server_.onDisconnectCancel(r.toString(),(e,t)=>{"ok"===e&&!function e(n,t){if(ob(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const i=n.value;return n.value=null,i.forEachChild(Ob,(e,t)=>{fI(n,new Jw(e),t)}),e(n,t)}}if(0<n.children.size){var r=Zw(t);return t=tb(t),n.children.has(r)&&e(n.children.get(r),t)&&n.children.delete(r),0===n.children.size}return!0}(n.onDisconnect_,r),U0(0,i,e,t)}),e.promise;var n,r,i}remove(){c0("OnDisconnect.remove",this._path);const e=new dd;return D0(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){c0("OnDisconnect.set",this._path),r0("OnDisconnect.set",e,this._path,!1);const t=new dd;return D0(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){c0("OnDisconnect.setWithPriority",this._path),r0("OnDisconnect.setWithPriority",e,this._path,!1),s0("OnDisconnect.setWithPriority",t,!1);const n=new dd;return function(n,r,e,t,i){const s=$b(e,t);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&fI(n.onDisconnect_,r,s),U0(0,i,e,t)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){c0("OnDisconnect.update",this._path),i0("OnDisconnect.update",e,this._path,!1);const t=new dd;return n=this._repo,r=this._path,i=e,s=t.wrapCallback(()=>{}),xd(i)?(pw("onDisconnect().update() called with empty data.  Don't do anything."),U0(0,s,"ok",void 0)):n.server_.onDisconnectMerge(r.toString(),i,(e,t)=>{"ok"===e&&bw(i,(e,t)=>{t=$b(t),fI(n.onDisconnect_,sb(r,e),t)}),U0(0,s,e,t)}),t.promise;var n,r,i,s}}class Z0{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return ob(this._path)?null:nb(this._path)}get ref(){return new rE(this._repo,this._path)}get _queryIdentifier(){var e;return"{}"===(e=uw(e=uI(this._queryParams)))?"default":e}get _queryObject(){return uI(this._queryParams)}isEqual(e){if(!((e=Qd(e))instanceof Z0))return!1;var t=this._repo===e._repo,n=lb(this._path,e._path),e=this._queryIdentifier===e._queryIdentifier;return t&&n&&e}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(t){let n="";for(let e=t.pieceNum_;e<t.pieces_.length;e++)""!==t.pieces_[e]&&(n+="/"+encodeURIComponent(String(t.pieces_[e])));return n||"/"}(this._path)}}function eE(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function tE(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===wb){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==vw)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==_w)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===Ob){if(null!=t&&!l0(t)||null!=n&&!l0(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(ad(e.getIndex()instanceof Wb||e.getIndex()===Qb,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function nE(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class rE extends Z0{constructor(e,t){super(e,t,new sI,!1)}get parent(){var e=ib(this._path);return null===e?null:new rE(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class iE{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new Jw(e),e=aE(this.ref,e);return new iE(this._node.getChild(t),e,Ob)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,(e,t)=>n(new iE(t,aE(this.ref,e),Ob)))}hasChild(e){return e=new Jw(e),!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function sE(e,t){return(e=Qd(e))._checkNotDeleted("ref"),void 0!==t?aE(e._root,t):e._root}function oE(e,t){(e=Qd(e))._checkNotDeleted("refFromURL");const n=H0(t,e._repo.repoInfo_.nodeAdmin);return u0("refFromURL",n),t=n.repoInfo,e._repo.repoInfo_.isCustomHost()||t.host===e._repo.repoInfo_.host||fw("refFromURL: Host name does not match the current database: (found "+t.host+" but expected "+e._repo.repoInfo_.host+")"),sE(e,n.path.toString())}function aE(e,t){return(null===Zw((e=Qd(e))._path)?a0:v0)("child","path",t,!1),new rE(e._repo,sb(e._path,t))}function cE(e,t){c0("set",(e=Qd(e))._path),r0("set",t,e._path,!1);const n=new dd;return O0(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function lE(e,t){i0("update",t,e._path,!1);const n=new dd;return function(i,s,e,o){F0(i,"update",{path:s.toString(),value:e});let n=!0;const r=A0(i),a={};if(bw(e,(e,t)=>{n=!1,a[e]=HT(sb(s,e),$b(t),i.serverSyncTree_,r)}),n)pw("update() called with empty data.  Don't do anything."),U0(0,o,"ok",void 0);else{const f=x0(i);l=(t=i.serverSyncTree_,c=s,l=a,u=f,h=t.pendingWriteTree_,d=c,p=l,ad(u>h.lastWriteId,"Stacking an older merge on top of newer ones"),h.allWrites.push({path:d,children:p,writeId:u,visible:!0}),h.visibleWrites=FI(h.visibleWrites,d,p),h.lastWriteId=u,l=DI.fromObject(l),MT(t,new EI(vI(),c,l)));w0(i.eventQueue_,l),i.server_.merge(s.toString(),e,(e,t)=>{(r="ok"===e)||gw("update at "+s+" failed: "+e);var n=PT(i.serverSyncTree_,f,!r),r=0<n.length?V0(i,s):s;I0(i.eventQueue_,r,n),U0(0,o,e,t)}),bw(e,e=>{e=$0(i,sb(s,e)),V0(i,e)}),I0(i.eventQueue_,s,[])}var t,c,l,u,h,d,p}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}function uE(t){return t=Qd(t),n=t._repo,r=t,(null!=(e=function(e,t){const n=t._path;let r=null;e.syncPointTree_.foreachOnPath(n,(e,t)=>{e=ab(e,n),r=r||IT(t,e)});let i=e.syncPointTree_.get(n);i?r=r||IT(i,Xw()):(i=new vT,e.syncPointTree_=e.syncPointTree_.set(n,i));var s=null!=r;const o=s?new SI(r,!0,!1):null;return e=$I(e.pendingWriteTree_,t._path),PI(wT(i,t,e,s?o.getNode():Vb.EMPTY_NODE,s).viewCache_)}(n.serverSyncTree_,r))?Promise.resolve(e):n.server_.get(r).then(e=>{var t=$b(e).withIndex(r._queryParams.getIndex()),e=xT(n.serverSyncTree_,r._path,t);return b0(n.eventQueue_,r._path,e),Promise.resolve(t)},e=>(F0(n,"get for query "+Ad(r)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new iE(e,new rE(t._repo,t._path),t._queryParams.getIndex()));var n,r,e}class hE{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var n=t._queryParams.getIndex();return new Q0("value",this,new iE(e.snapshotNode,new rE(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Y0(this,e,t):null}matches(e){return e instanceof hE&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class dE{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Y0(this,e,t):null}createEvent(e,t){ad(null!=e.childName,"Child events should have a childName.");var n=aE(new rE(t._repo,t._path),e.childName),t=t._queryParams.getIndex();return new Q0(e.type,this,new iE(e.snapshotNode,n,t),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof dE&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function pE(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const a=t;(i=(e,t)=>{L0(n._repo,n,o),a(e,t)}).userCallback=t.userCallback,i.context=t.context,t=i}t=new J0(t,s||void 0);const o="value"===e?new hE(t):new dE(e,t);return function(e,t,n){n=".info"===Zw(t._path)?DT(e.infoSyncTree_,t,n):DT(e.serverSyncTree_,t,n);b0(e.eventQueue_,t._path,n)}(n._repo,n,o),()=>L0(n._repo,n,o)}function fE(e,t,n,r){return pE(e,"value",t,n,r)}function gE(e,t,n,r){return pE(e,"child_added",t,n,r)}function mE(e,t,n,r){return pE(e,"child_changed",t,n,r)}function yE(e,t,n,r){return pE(e,"child_moved",t,n,r)}function vE(e,t,n,r){return pE(e,"child_removed",t,n,r)}function _E(e,t,n){let r=null;n=n?new J0(n):null,"value"===t?r=new hE(n):t&&(r=new dE(t,n)),L0(e._repo,e,r)}class wE{}class bE extends wE{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){r0("endAt",this._value,e._path,!0);var t=aI(e._queryParams,this._value,this._key);if(nE(t),tE(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Z0(e._repo,e._path,t,e._orderByCalled)}}class IE extends wE{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){r0("endBefore",this._value,e._path,!1);var t=function(e,t,n){let r;return r=e.index_===wb?aI(e,t="string"==typeof t?Gb(t):t,n):aI(e,t,null==n?vw:Gb(n)),r.endBeforeSet_=!0,r}(e._queryParams,this._value,this._key);if(nE(t),tE(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Z0(e._repo,e._path,t,e._orderByCalled)}}class TE extends wE{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){r0("startAt",this._value,e._path,!0);var t=oI(e._queryParams,this._value,this._key);if(nE(t),tE(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Z0(e._repo,e._path,t,e._orderByCalled)}}class EE extends wE{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){r0("startAfter",this._value,e._path,!1);var t=function(e,t,n){let r;return r=e.index_===wb?oI(e,t="string"==typeof t?Hb(t):t,n):oI(e,t,null==n?_w:Hb(n)),r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(nE(t),tE(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Z0(e._repo,e._path,t,e._orderByCalled)}}class SE extends wE{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Z0(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class kE extends wE{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Z0(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class CE extends wE{constructor(e){super(),this._path=e}_apply(e){eE(e,"orderByChild");var t=new Jw(this._path);if(ob(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");return t=new Wb(t),tE(t=cI(e._queryParams,t)),new Z0(e._repo,e._path,t,!0)}}class AE extends wE{_apply(e){eE(e,"orderByKey");var t=cI(e._queryParams,wb);return tE(t),new Z0(e._repo,e._path,t,!0)}}class NE extends wE{_apply(e){eE(e,"orderByPriority");var t=cI(e._queryParams,Ob);return tE(t),new Z0(e._repo,e._path,t,!0)}}class RE extends wE{_apply(e){eE(e,"orderByValue");var t=cI(e._queryParams,Qb);return tE(t),new Z0(e._repo,e._path,t,!0)}}class PE extends wE{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(r0("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new bE(this._value,this._key)._apply(new TE(this._value,this._key)._apply(e))}}function xE(e,...t){let n=Qd(e);for(const r of t)n=r._apply(n);return n}E=rE,ad(!yT,"__referenceConstructor has already been defined"),yT=E,Vt=rE,ad(!CT,"__referenceConstructor has already been defined"),CT=Vt;const OE={};function DE(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||fw("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),pw("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o=H0(s,i),a=o.repoInfo,c,l=void 0;return"undefined"!=typeof process&&(l=process.env.FIREBASE_DATABASE_EMULATOR_HOST),l?(c=!0,s=`http://${l}?ns=${a.namespace}`,o=H0(s,i),a=o.repoInfo):c=!o.repoInfo.secure,t=i&&c?new Pw(Pw.OWNER):new Rw(e.name,e.options,t),u0("Invalid Firebase Database URL",o),ob(o.path)||fw("Database URL must point to the root of a Firebase Database (not including a child path)."),n=function(e,t,n,r){let i=OE[t.name];return i||(i={},OE[t.name]=i),(t=i[e.toURLString()])&&fw("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),t=new k0(e,!1,n,r),i[e.toURLString()]=t}(a,e,t,new Nw(e.name,n)),new LE(n,e)}class LE{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function(o,e,t){if(o.stats_=jw(o.repoInfo_),o.forceRestClient_||function(){const e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return 0<=e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)}())o.server_=new hI(o.repoInfo_,(e,t,n,r)=>{N0(o,e,t,n,r)},o.authTokenProvider_,o.appCheckProvider_),setTimeout(()=>R0(o,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ad(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}o.persistentConnection_=new gb(o.repoInfo_,e,(e,t,n,r)=>{N0(o,e,t,n,r)},e=>{R0(o,e)},e=>{var n=o;bw(e,(e,t)=>{P0(n,e,t)})},o.authTokenProvider_,o.appCheckProvider_,t),o.server_=o.persistentConnection_}o.authTokenProvider_.addTokenChangeListener(e=>{o.server_.refreshAuthToken(e)}),o.appCheckProvider_.addTokenChangeListener(e=>{o.server_.refreshAppCheckToken(e.token)}),o.statsReporter_=(t=()=>new yI(o.stats_,o.server_),e=(e=o.repoInfo_).toString(),qw[e]||(qw[e]=t()),qw[e]),o.infoData_=new dI,o.infoSyncTree_=new NT({startListening:(e,t,n,r)=>{let i=[];const s=o.infoData_.getNode(e._path);return s.isEmpty()||(i=xT(o.infoSyncTree_,e._path,s),setTimeout(()=>{r("ok")},0)),i},stopListening:()=>{}}),P0(o,"connected",!1),o.serverSyncTree_=new NT({startListening:(n,e,t,r)=>(o.server_.listen(n,t,e,(e,t)=>{t=r(e,t),I0(o.eventQueue_,n._path,t)}),[]),stopListening:(e,t)=>{o.server_.unlisten(e,t)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new rE(this._repo,Xw())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=OE[t];n&&n[e.key]===e||fw(`Database ${t}(${e.repoInfo_}) has already been deleted.`),M0(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&fw("Cannot call "+e+" on a deleted database.")}}class ME{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function FE(l,e,t){if(c0("Reference.transaction",(l=Qd(l))._path),".length"===l.key||".keys"===l.key)throw"Reference.transaction failed: "+l.key+" is a read-only object.";t=null===(n=null==t?void 0:t.applyLocally)||void 0===n||n;const u=new dd;var n=fE(l,()=>{});return function(t,n,e,r,i){F0(t,"transaction on "+n);const s={path:n,update:e,onComplete:(e,t,n)=>{var r;e?u.reject(e):(r=new iE(n,new rE(l._repo,l._path),Ob),u.resolve(new ME(t,r)))},status:null,order:nw(),applyLocally:i,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},o=q0(t,n,void 0);if(s.currentInputSnapshot=o,void 0===(i=s.update(o.val())))s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete&&s.onComplete(null,!1,s.currentInputSnapshot);else{y0("transaction failed: Data returned ",i,s.path),s.status=0;const a=XT(r=JT(t.transactionQueueTree_,n))||[];a.push(s),ZT(r,a);let e;if("object"==typeof i&&null!==i&&Rd(i,".priority"))e=Pd(i,".priority"),ad(l0(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const c=LT(t.serverSyncTree_,n)||Vb.EMPTY_NODE;e=c.getPriority().val()}r=A0(t),i=$b(i,e),r=GT(i,o,r),s.currentOutputSnapshotRaw=i,s.currentOutputSnapshotResolved=r,s.currentWriteId=x0(t),r=RT(t.serverSyncTree_,n,r,s.currentWriteId,s.applyLocally),I0(t.eventQueue_,n,r),j0(t,t.transactionQueueTree_)}}(l._repo,l._path,e,n,t),u.promise}function UE(e){e="FIREBASE WARNING: "+e,qE.warn(e)}gb.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},gb.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Q_(kp),Ip(new ep("database",(e,{instanceIdentifier:t})=>DE(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),Rp("@firebase/database","0.12.1",void 0);const qE=new pp("@firebase/database-compat");class jE{constructor(e){this._delegate=e}cancel(t){Kd("OnDisconnect.cancel",0,1,arguments.length),$d("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){Kd("OnDisconnect.remove",0,1,arguments.length),$d("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){Kd("OnDisconnect.set",1,2,arguments.length),$d("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){Kd("OnDisconnect.setWithPriority",2,3,arguments.length),$d("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(t,n){if(Kd("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,UE("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}$d("OnDisconnect.update","onComplete",n,!0);const e=this._delegate.update(t);return n&&e.then(()=>n(null),e=>n(e)),e}}class VE{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Kd("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class BE{constructor(e,t){this._database=e,this._delegate=t}val(){return Kd("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Kd("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Kd("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Kd("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return Kd("DataSnapshot.child",0,1,arguments.length),e=String(e),v0("DataSnapshot.child","path",e,!1),new BE(this._database,this._delegate.child(e))}hasChild(e){return Kd("DataSnapshot.hasChild",1,1,arguments.length),v0("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return Kd("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return Kd("DataSnapshot.forEach",1,1,arguments.length),$d("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new BE(this._database,e)))}hasChildren(){return Kd("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Kd("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Kd("DataSnapshot.ref",0,0,arguments.length),new zE(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class KE{constructor(e,t){this.database=e,this._delegate=t}on(e,n,t,r){Kd("Query.on",2,4,arguments.length),$d("Query.on","callback",n,!1);const i=KE.getCancelAndContextArgs_("Query.on",t,r);var s=(e,t)=>{n.call(i.context,new BE(this.database,e),t)};s.userCallback=n,s.context=i.context;var o=null===(r=i.cancel)||void 0===r?void 0:r.bind(i.context);switch(e){case"value":return fE(this._delegate,s,o),n;case"child_added":return gE(this._delegate,s,o),n;case"child_removed":return vE(this._delegate,s,o),n;case"child_changed":return mE(this._delegate,s,o),n;case"child_moved":return yE(this._delegate,s,o),n;default:throw new Error(zd("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){var r;Kd("Query.off",0,3,arguments.length),function(){if(void 0!==e)switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(zd("Query.off","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}(),$d("Query.off","callback",t,!0),Wd("Query.off","context",n,!0),t?((r=()=>{}).userCallback=t,r.context=n,_E(this._delegate,e,r)):_E(this._delegate,e)}get(){return uE(this._delegate).then(e=>new BE(this.database,e))}once(e,n,t,r){Kd("Query.once",1,4,arguments.length),$d("Query.once","callback",n,!0);const i=KE.getCancelAndContextArgs_("Query.once",t,r),s=new dd;var o=(e,t)=>{e=new BE(this.database,e),n&&n.call(i.context,e,t),s.resolve(e)};o.userCallback=n,o.context=i.context;var a=e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)};switch(e){case"value":fE(this._delegate,o,a,{onlyOnce:!0});break;case"child_added":gE(this._delegate,o,a,{onlyOnce:!0});break;case"child_removed":vE(this._delegate,o,a,{onlyOnce:!0});break;case"child_changed":mE(this._delegate,o,a,{onlyOnce:!0});break;case"child_moved":yE(this._delegate,o,a,{onlyOnce:!0});break;default:throw new Error(zd("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return Kd("Query.limitToFirst",1,1,arguments.length),new KE(this.database,xE(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new SE(e)}(e)))}limitToLast(e){return Kd("Query.limitToLast",1,1,arguments.length),new KE(this.database,xE(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new kE(e)}(e)))}orderByChild(e){return Kd("Query.orderByChild",1,1,arguments.length),new KE(this.database,xE(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return v0("orderByChild","path",e,!1),new CE(e)}(e)))}orderByKey(){return Kd("Query.orderByKey",0,0,arguments.length),new KE(this.database,xE(this._delegate,new AE))}orderByPriority(){return Kd("Query.orderByPriority",0,0,arguments.length),new KE(this.database,xE(this._delegate,new NE))}orderByValue(){return Kd("Query.orderByValue",0,0,arguments.length),new KE(this.database,xE(this._delegate,new RE))}startAt(e=null,t){return Kd("Query.startAt",0,2,arguments.length),new KE(this.database,xE(this._delegate,([e=null,t]=[e,t],o0("startAt","key",t,!0),new TE(e,t))))}startAfter(e=null,t){return Kd("Query.startAfter",0,2,arguments.length),new KE(this.database,xE(this._delegate,(o0("startAfter","key",t,!0),new EE(e,t))))}endAt(e=null,t){return Kd("Query.endAt",0,2,arguments.length),new KE(this.database,xE(this._delegate,(o0("endAt","key",t,!0),new bE(e,t))))}endBefore(e=null,t){return Kd("Query.endBefore",0,2,arguments.length),new KE(this.database,xE(this._delegate,(o0("endBefore","key",t,!0),new IE(e,t))))}equalTo(e,t){return Kd("Query.equalTo",1,2,arguments.length),new KE(this.database,xE(this._delegate,(o0("equalTo","key",t,!0),new PE(e,t))))}toString(){return Kd("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Kd("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Kd("Query.isEqual",1,1,arguments.length),e instanceof KE)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,$d(e,"cancel",r.cancel,!0),r.context=n,Wd(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(zd(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new zE(this.database,new rE(this._delegate._repo,this._delegate._path))}}class zE extends KE{constructor(e,t){super(e,new Z0(t._repo,t._path,new sI,!1)),this.database=e,this._delegate=t}getKey(){return Kd("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Kd("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new zE(this.database,aE(this._delegate,e))}getParent(){Kd("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new zE(this.database,e):null}getRoot(){return Kd("Reference.root",0,0,arguments.length),new zE(this.database,this._delegate.root)}set(e,t){Kd("Reference.set",1,2,arguments.length),$d("Reference.set","onComplete",t,!0);const n=cE(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(t,n){if(Kd("Reference.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,UE("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}c0("Reference.update",this._delegate._path),$d("Reference.update","onComplete",n,!0);const e=lE(this._delegate,t);return n&&e.then(()=>n(null),e=>n(e)),e}setWithPriority(e,t,n){Kd("Reference.setWithPriority",2,3,arguments.length),$d("Reference.setWithPriority","onComplete",n,!0);const r=function(e,t,n){if(c0("setWithPriority",e._path),r0("setWithPriority",t,e._path,!1),s0("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new dd;return O0(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(t){Kd("Reference.remove",0,1,arguments.length),$d("Reference.remove","onComplete",t,!0);const e=(c0("remove",(n=this._delegate)._path),cE(n,null));var n;return t&&e.then(()=>t(null),e=>t(e)),e}transaction(e,t,n){Kd("Reference.transaction",1,3,arguments.length),$d("Reference.transaction","transactionUpdate",e,!1),$d("Reference.transaction","onComplete",t,!0),function(){if(void 0!==n&&"boolean"!=typeof n)throw new Error(zd("Reference.transaction","applyLocally")+"must be a boolean.")}();const r=FE(this._delegate,e,{applyLocally:n}).then(e=>new VE(e.committed,new BE(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){Kd("Reference.setPriority",1,2,arguments.length),$d("Reference.setPriority","onComplete",t,!0);const n=function(e,t){c0("setPriority",(e=Qd(e))._path),s0("setPriority",t,!1);const n=new dd;return O0(e._repo,sb(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){Kd("Reference.push",0,2,arguments.length),$d("Reference.push","onComplete",t,!0);const n=function(e,t){c0("push",(e=Qd(e))._path),r0("push",t,e._path,!0);var n=C0(e._repo);const r=aE(e,n=Jb(n)),i=aE(e,n);let s;return s=null!=t?cE(i,t).then(()=>i):Promise.resolve(i),r.then=s.then.bind(s),r.catch=s.then.bind(s,void 0),r}(this._delegate,e),r=n.then(e=>new zE(this.database,e));t&&r.then(()=>t(null),e=>t(e));const i=new zE(this.database,n);return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return c0("Reference.onDisconnect",this._delegate._path),new jE(new X0(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class $E{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete()}}useEmulator(e,t,n={}){!function(e,t,n,r={}){(e=Qd(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&fw("Cannot call useEmulator() after instance has already been initialized.");var i,s=e._repoInternal;let o=void 0;s.repoInfo_.nodeAdmin?(r.mockUserToken&&fw('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Pw(Pw.OWNER)):r.mockUserToken&&(i="string"==typeof r.mockUserToken?r.mockUserToken:pd(r.mockUserToken,e.app.options.projectId),o=new Pw(i)),i=s,s=t,t=n,n=o,i.repoInfo_=new Lw(`${s}:${t}`,!1,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams),n&&(i.authTokenProvider_=n)}(this._delegate,e,t,n)}ref(e){if(Kd("database.ref",0,1,arguments.length),e instanceof zE){var t=oE(this._delegate,e.toString());return new zE(this,t)}return e=sE(this._delegate,e),new zE(this,e)}refFromURL(e){return Kd("database.refFromURL",1,1,arguments.length),e=oE(this._delegate,e),new zE(this,e)}goOffline(){var e;Kd("database.goOffline",0,0,arguments.length),(e=Qd(e=this._delegate))._checkNotDeleted("goOffline"),M0(e._repo)}goOnline(){return Kd("database.goOnline",0,0,arguments.length),(e=Qd(e=this._delegate))._checkNotDeleted("goOnline"),void((e=e._repo).persistentConnection_&&e.persistentConnection_.resume(E0));var e}}$E.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:e=>({".sv":{increment:e}})};N=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:i,nodeAdmin:s=!1}){Q_(n);const o=new rp("auth-internal",new op("database-standalone"));return o.setComponent(new ep("auth-internal",()=>r,"PRIVATE")),{instance:new $E(DE(e,o,void 0,t,s),e),namespace:i}}}),C=$E.ServerValue;(E=Fp).INTERNAL.registerComponent(new ep("database-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("database").getImmediate({identifier:t});return new $E(t,n)},"PUBLIC").setServiceProps({Reference:zE,Query:KE,Database:$E,DataSnapshot:BE,enableLogging:function(e,t){dw(e,t)},INTERNAL:N,ServerValue:C}).setMultipleInstances(!0)),E.registerVersion("@firebase/database-compat","0.1.1");var WE="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},HE=WE||self;function GE(){}function QE(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function YE(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var JE="closure_uid_"+(1e9*Math.random()>>>0),XE=0;function ZE(e,t,n){return e.call.apply(e.bind,arguments)}function eS(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function tS(e,t,n){return(tS=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ZE:eS).apply(null,arguments)}function nS(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function rS(e,s){function t(){}t.prototype=s.prototype,e.Z=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Vb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function iS(){this.s=this.s,this.o=this.o}var sS={};iS.prototype.s=!1,iS.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,e=Object.prototype.hasOwnProperty.call(e,JE)&&e[JE]||(e[JE]=++XE),delete sS[e])},iS.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const oS=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(t,n){if("string"==typeof t)return"string"!=typeof n||1!=n.length?-1:t.indexOf(n,0);for(let e=0;e<t.length;e++)if(e in t&&t[e]===n)return e;return-1},aS=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(t,n,r){var i=t.length,s="string"==typeof t?t.split(""):t;for(let e=0;e<i;e++)e in s&&n.call(r,s[e],e,t)};function cS(){return Array.prototype.concat.apply([],arguments)}function lS(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function uS(e){return/^[\s\xa0]*$/.test(e)}var hS=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function dS(e,t){return-1!=e.indexOf(t)}function pS(e,t){return e<t?-1:t<e?1:0}Vt=HE.navigator;function fS(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function gS(e){const t={};for(const n in e)t[n]=e[n];return t}ES=(Vt=Vt&&Vt.userAgent)?Vt:"";var mS="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function yS(t){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e])t[n]=r[n];for(let e=0;e<mS.length;e++)n=mS[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function vS(e){return vS[" "](e),e}vS[" "]=GE;var _S,N=dS(ES,"Opera"),wS=dS(ES,"Trident")||dS(ES,"MSIE"),C=dS(ES,"Edge"),bS=C||wS,IS=dS(ES,"Gecko")&&!(dS(ES.toLowerCase(),"webkit")&&!dS(ES,"Edge"))&&!(dS(ES,"Trident")||dS(ES,"MSIE"))&&!dS(ES,"Edge"),E=dS(ES.toLowerCase(),"webkit")&&!dS(ES,"Edge");function TS(){var e=HE.document;return e?e.documentMode:void 0}var Vt="",ES=(ES=ES,IS?/rv:([^\);]+)(\)|;)/.exec(ES):C?/Edge\/([\d\.]+)/.exec(ES):wS?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ES):E?/WebKit\/(\S+)/.exec(ES):N?/(?:Version)[ \/]?(\S+)/.exec(ES):void 0);ES&&(Vt=ES?ES[1]:""),_S=wS&&null!=(ES=TS())&&ES>parseFloat(Vt)?String(ES):Vt;var SS={};var kS=HE.document&&wS&&(TS()||parseInt(_S,10))||void 0,CS=function(){if(!HE.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{HE.addEventListener("test",GE,t),HE.removeEventListener("test",GE,t)}catch(e){}return e}();function AS(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function NS(e,t){if(AS.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(IS){e:{try{vS(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:RS[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&NS.Z.h.call(this)}}AS.prototype.h=function(){this.defaultPrevented=!0},rS(NS,AS);var RS={2:"touch",3:"pen",4:"mouse"};NS.prototype.h=function(){NS.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var PS="closure_listenable_"+(1e6*Math.random()|0),xS=0;function OS(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++xS,this.ca=this.fa=!1}function DS(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function LS(e){this.src=e,this.g={},this.h=0}function MS(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=oS(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(DS(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function FS(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}LS.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=FS(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new OS(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var US="closure_lm_"+(1e6*Math.random()|0),qS={};function jS(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o,a=YE(i)?!!i.capture:!!i,c=zS(e);if(c||(e[US]=c=new LS(e)),(n=c.add(t,n,r,a,s)).proxy)return n;if(o=KS,r=function e(t){return o.call(e.src,e.listener,t)},(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(i=CS?i:a)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(BS(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function VS(e){var t,n,r;"number"!=typeof e&&e&&!e.ca&&((t=e.src)&&t[PS]?MS(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(BS(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=zS(t))?(MS(n,e),0==n.h&&(n.src=null,t[US]=null)):DS(e)))}function BS(e){return e in qS?qS[e]:qS[e]="on"+e}function KS(e,t){var n,r;return!!e.ca||(t=new NS(t,this),n=e.listener,r=e.ia||e.src,e.fa&&VS(e),n.call(r,t))}function zS(e){return(e=e[US])instanceof LS?e:null}var $S="__closure_events_fn_"+(1e9*Math.random()>>>0);function WS(t){return"function"==typeof t?t:(t[$S]||(t[$S]=function(e){return t.handleEvent(e)}),t[$S])}function HS(){iS.call(this),this.i=new LS(this),(this.P=this).I=null}function GS(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new AS(t,e):t instanceof AS?t.target=t.target||e:(o=t,yS(t=new AS(r,e),o)),o=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],o=QS(s,r,!0,t)&&o;if(o=QS(s=t.g=e,r,!0,t)&&o,o=QS(s,r,!1,t)&&o,n)for(i=0;i<n.length;i++)o=QS(s=t.g=n[i],r,!1,t)&&o}function QS(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o,a,c=t[s];c&&!c.ca&&c.capture==n&&(o=c.listener,a=c.ia||c.src,c.fa&&MS(e.i,c),i=!1!==o.call(a,r)&&i)}return i&&!r.defaultPrevented}rS(HS,iS),HS.prototype[PS]=!0,HS.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);else i=YE(i)?!!i.capture:!!i,r=WS(r),t&&t[PS]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=FS(o=t.g[n],r,i,s))&&(DS(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete t.g[n],t.h--))):(t=t&&zS(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?FS(n,r,i,s):t)?n[t]:null)&&VS(r))}(this,e,t,n,r)},HS.prototype.M=function(){if(HS.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)DS(n[r]);delete t.g[e],t.h--}}this.I=null},HS.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},HS.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var YS,JS=HE.JSON.stringify,XS=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new ZS,e=>e.reset());class ZS{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function ek(e,t){var n;YS||(n=HE.Promise.resolve(void 0),YS=function(){n.then(rk)}),tk||(YS(),tk=!0),nk.add(e,t)}var tk=!1,nk=new class{constructor(){this.h=this.g=null}add(e,t){const n=XS.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function rk(){for(var e;e=function(){var e=nk;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){HE.setTimeout(()=>{throw e},0)}(e)}var t=XS;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}tk=!1}function ik(e,t){HS.call(this),this.h=e||1,this.g=t||HE,this.j=tS(this.kb,this),this.l=Date.now()}function sk(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function ok(e,t,n){if("function"==typeof e)n&&(e=tS(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=tS(e.handleEvent,e)}return 2147483647<Number(t)?-1:HE.setTimeout(e,t||0)}rS(ik,HS),(ie=ik.prototype).da=!1,ie.S=null,ie.kb=function(){var e;this.da&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),GS(this,"tick"),this.da&&(sk(this),this.start())))},ie.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},ie.M=function(){ik.Z.M.call(this),sk(this),delete this.g};class ak extends iS{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ok(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(HE.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ck(e){iS.call(this),this.h=e,this.g={}}rS(ck,iS);var lk=[];function uk(e,t,n,r){Array.isArray(n)||(n&&(lk[0]=n.toString()),n=lk);for(var i=0;i<n.length;i++){var s=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=WS(r),t&&t[PS]?t.O(n,r,YE(i)?!!i.capture:!!i,s):jS(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=WS(r),t&&t[PS]?t.N(n,r,YE(i)?!!i.capture:!!i,s):jS(t,n,r,!1,i,s)}(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function hk(e){fS(e.g,function(e,t){this.g.hasOwnProperty(t)&&VS(e)},e),e.g={}}function dk(){this.g=!0}function pk(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return JS(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}ck.prototype.M=function(){ck.Z.M.call(this),hk(this)},ck.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},dk.prototype.Aa=function(){this.g=!1},dk.prototype.info=function(){};var fk={},gk=null;function mk(){return gk=gk||new HS}function yk(e){AS.call(this,fk.Ma,e)}function vk(){var e=mk();GS(e,new yk(e))}function _k(e,t){AS.call(this,fk.STAT_EVENT,e),this.stat=t}function wk(e){var t=mk();GS(t,new _k(t,e))}function bk(e,t){AS.call(this,fk.Na,e),this.size=t}function Ik(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return HE.setTimeout(function(){e()},t)}function Tk(){}function Ek(e){return e.h||(e.h=e.i())}function Sk(){}function kk(){AS.call(this,"d")}function Ck(){AS.call(this,"c")}function Ak(){}function Nk(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new ck(this),this.P=xk,this.W=new ik(e=bS?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Rk}function Rk(){this.i=null,this.g="",this.h=!1}fk.Ma="serverreachability",rS(yk,AS),fk.STAT_EVENT="statevent",rS(_k,AS),fk.Na="timingevent",rS(bk,AS),_t={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},xa={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"},Tk.prototype.h=null,WE={OPEN:"a",pb:"b",Ka:"c",Bb:"d"},rS(kk,AS),rS(Ck,AS),rS(Ak,Tk),Ak.prototype.g=function(){return new XMLHttpRequest},Ak.prototype.i=function(){return{}};var Pk=new Ak,xk=45e3,Ok={},Dk={};function Lk(e,t,n){e.K=1,e.v=rC(Jk(t)),e.s=n,e.U=!0,Mk(e,null)}function Mk(e,t){e.F=Date.now(),qk(e),e.A=Jk(e.v);var o,a,c,l,u,h,n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),mC(n.h,"t",r),e.C=0,n=e.l.H,e.h=new Rk,e.g=mA(e.l,n?t:null,!e.s),0<e.O&&(e.L=new ak(tS(e.Ia,e,e.g),e.O)),uk(e.V,e.g,"readystatechange",e.gb),t=e.H?gS(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),vk(),o=e.j,a=e.u,c=e.A,l=e.m,u=e.X,h=e.s,o.info(function(){if(o.g)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+l+") [attempt "+u+"]: "+a+"\n"+c+"\n"+e})}function Fk(e){return e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function Uk(e,t,n){let r=!0,i;for(;!e.I&&e.C<n.length;){if(i=(c=void 0,a=(s=e).C,-1==(c=(o=n).indexOf("\n",a))?Dk:(a=Number(o.substring(a,c)),isNaN(a)?Ok:(c+=1)+a>o.length?Dk:(o=o.substr(c,a),s.C=c+a,o))),i==Dk){4==t&&(e.o=4,wk(14),r=!1),pk(e.j,e.m,null,"[Incomplete Response]");break}if(i==Ok){e.o=4,wk(15),pk(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}pk(e.j,e.m,i,null),zk(e,i)}var s,o,a,c;Fk(e)&&i!=Dk&&i!=Ok&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,wk(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),cA(t),t.L=!0,wk(11))):(pk(e.j,e.m,n,"[Invalid Chunked Response]"),Kk(e),Bk(e))}function qk(e){e.Y=Date.now()+e.P,jk(e,e.P)}function jk(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ik(tS(e.eb,e),t)}function Vk(e){e.B&&(HE.clearTimeout(e.B),e.B=null)}function Bk(e){0==e.l.G||e.I||hA(e.l,e)}function Kk(e){Vk(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,sk(e.W),hk(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function zk(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||TC(n.i,e)))if(n.I=e.N,!e.J&&TC(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;uA(n),ZC(n)}aA(n),wk(18)}}else n.ta=i[1],0<n.ta-n.U&&i[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=Ik(tS(n.ab,n),6e3));if(IC(n.i)<=1&&n.ka){try{n.ka()}catch(e){}n.ka=void 0}}else pA(n,11)}else if(!e.J&&n.g!=e||uA(n),!uS(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var s=i[t];if(n.U=s[0],s=s[1],2==n.G)if("c"==s[0]){n.J=s[1],n.la=s[2];var o=s[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var a=s[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var c,l,u,h=s[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const g=e.g;g&&(!(c=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(l=r.i).g&&(dS(c,"spdy")||dS(c,"quic")||dS(c,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(EC(l,l.h),l.h=null)),!r.D||(u=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=u,nC(r.F,r.D,u))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d,p,f=e;(r=n).oa=gA(r,r.H?r.la:null,r.W),f.J?(SC(r.i,f),d=f,(p=r.K)&&d.setTimeout(p),d.B&&(Vk(d),qk(d)),r.g=f):oA(r),0<n.l.length&&nA(n)}else"stop"!=s[0]&&"close"!=s[0]||pA(n,7);else 3==n.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?pA(n,7):XC(n):"noop"!=s[0]&&n.j&&n.j.wa(s),n.A=0)}vk()}catch(e){}}function $k(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(QE(e)||"string"==typeof e)aS(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(QE(e)||"string"==typeof e)for(var n=[],r=e.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,e)n[r++]=i;for(var i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(QE(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function Wk(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Wk)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function Hk(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];Gk(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){for(var i={},n=t=0;t<e.g.length;)Gk(i,r=e.g[t])||(i[e.g[n++]=r]=1),t++;e.g.length=n}}function Gk(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(ie=Nk.prototype).setTimeout=function(e){this.P=e},ie.gb=function(e){e=e.target;const t=this.L;t&&3==HC(e)?t.l():this.Ia(e)},ie.Ia=function(e){try{if(e==this.g)e:{var t=HC(this.g),n=this.g.Da();if(this.g.ba(),!(t<3)&&(3!=t||bS||this.g&&(this.h.h||this.g.ga()||GC(this.g)))){this.I||4!=t||7==n||vk(),Vk(this);var r=this.g.ba();this.N=r;t:if(Fk(this)){var i=GC(this.g);e="";var s=i.length,o=4==HC(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Kk(this),Bk(this);var a="";break t}this.h.i=new HE.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:o&&n==s-1});i.splice(0,s),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,h=this.j,d=this.u,p=this.A,f=this.m,g=this.X,m=t,y=r,h.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+g+"]: "+d+"\n"+p+"\n"+m+" "+y}),this.i){if(this.$&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!uS(c)){var u=c;break t}}u=null}if(!(r=u)){this.i=!1,this.o=3,wk(12),Kk(this),Bk(this);break e}pk(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,zk(this,r)}this.U?(Uk(this,t,a),bS&&this.i&&3==t&&(uk(this.V,this.W,"tick",this.fb),this.W.start())):(pk(this.j,this.m,a,null),zk(this,a)),4==t&&Kk(this),this.i&&!this.I&&(4==t?hA(this.l,this):(this.i=!1,qk(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,wk(12)):(this.o=0,wk(13)),Kk(this),Bk(this)}}}catch(e){}var h,d,p,f,g,m,y},ie.fb=function(){var e,t;this.g&&(e=HC(this.g),t=this.g.ga(),this.C<t.length&&(Vk(this),Uk(this,e,t),this.i&&4!=e&&qk(this)))},ie.cancel=function(){this.I=!0,Kk(this)},ie.eb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.Y?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(vk(),wk(17)),Kk(this),this.o=2,Bk(this)):jk(this,this.Y-n)},(ie=Wk.prototype).R=function(){Hk(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},ie.T=function(){return Hk(this),this.g.concat()},ie.get=function(e,t){return Gk(this.h,e)?this.h[e]:t},ie.set=function(e,t){Gk(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},ie.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var Qk=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Yk(e,t){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Yk?(this.g=void 0!==t?t:e.g,Xk(this,e.j),this.s=e.s,Zk(this,e.i),eC(this,e.m),this.l=e.l,t=e.h,(n=new dC).i=t.i,t.g&&(n.g=new Wk(t.g),n.h=t.h),tC(this,n),this.o=e.o):e&&(n=String(e).match(Qk))?(this.g=!!t,Xk(this,n[1]||"",!0),this.s=iC(n[2]||""),Zk(this,n[3]||"",!0),eC(this,n[4]),this.l=iC(n[5]||"",!0),tC(this,n[6]||"",!0),this.o=iC(n[7]||"")):(this.g=!!t,this.h=new dC(null,this.g))}function Jk(e){return new Yk(e)}function Xk(e,t,n){e.j=n?iC(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Zk(e,t,n){e.i=n?iC(t,!0):t}function eC(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function tC(e,t,n){var r,i;t instanceof dC?(e.h=t,r=e.h,(i=e.g)&&!r.j&&(pC(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(fC(this,t),mC(this,n,e))},r)),r.j=i):(n||(t=sC(t,uC)),e.h=new dC(t,e.g))}function nC(e,t,n){e.h.set(t,n)}function rC(e){return nC(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function iC(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function sC(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,oC),n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function oC(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Yk.prototype.toString=function(){var e=[],t=this.j;t&&e.push(sC(t,aC,!0),":");var n=this.i;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(sC(t,aC,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(sC(n,"/"==n.charAt(0)?lC:cC,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",sC(n,hC)),e.join("")};var aC=/[#\/\?@]/g,cC=/[#\?:]/g,lC=/[#\?]/g,uC=/[#\?@]/g,hC=/#/g;function dC(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function pC(s){s.g||(s.g=new Wk,s.h=0,s.i&&function(e){if(e){e=e.split("&");for(var t=0;t<e.length;t++){var n,r=e[t].indexOf("="),i=null;0<=r?(n=e[t].substring(0,r),i=e[t].substring(r+1)):n=e[t],r=n,i=i?decodeURIComponent(i.replace(/\+/g," ")):"",s.add(decodeURIComponent(r.replace(/\+/g," ")),i)}}}(s.i))}function fC(e,t){pC(e),t=yC(e,t),Gk(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Gk((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&Hk(e)))}function gC(e,t){return pC(e),t=yC(e,t),Gk(e.g.h,t)}function mC(e,t,n){fC(e,t),0<n.length&&(e.i=null,e.g.set(yC(e,t),lS(n)),e.h+=n.length)}function yC(e,t){return t=String(t),e.j?t.toLowerCase():t}(ie=dC.prototype).add=function(e,t){pC(this),this.i=null,e=yC(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},ie.forEach=function(n,r){pC(this),this.g.forEach(function(e,t){aS(e,function(e){n.call(r,e,t,this)},this)},this)},ie.T=function(){pC(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},ie.R=function(e){pC(this);var t=[];if("string"==typeof e)gC(this,e)&&(t=cS(t,this.g.get(yC(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=cS(t,e[n])}return t},ie.set=function(e,t){return pC(this),this.i=null,gC(this,e=yC(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},ie.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},ie.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),r=this.R(r),s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}return this.i=e.join("&")};var vC,_C=class{constructor(e,t){this.h=e,this.g=t}};function wC(e){this.l=e||10,e=HE.PerformanceNavigationTiming?0<(e=HE.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(HE.g&&HE.g.Ea&&HE.g.Ea()&&HE.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function bC(e){return e.h||e.g&&e.g.size>=e.j}function IC(e){return e.h?1:e.g?e.g.size:0}function TC(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function EC(e,t){e.g?e.g.add(t):e.h=t}function SC(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function kC(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return lS(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function CC(){}function AC(){this.g=new CC}function NC(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function RC(e){this.l=e.$b||null,this.j=e.ib||!1}function PC(e,t){HS.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=xC,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}wC.prototype.cancel=function(){if(this.i=kC(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},CC.prototype.stringify=function(e){return HE.JSON.stringify(e,void 0)},CC.prototype.parse=function(e){return HE.JSON.parse(e,void 0)},rS(RC,Tk),RC.prototype.g=function(){return new PC(this.l,this.j)},RC.prototype.i=(vC={},function(){return vC}),rS(PC,HS);var xC=0;function OC(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function DC(e){e.readyState=4,e.l=null,e.j=null,e.A=null,LC(e)}function LC(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(ie=PC.prototype).open=function(e,t){if(this.readyState!=xC)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,LC(this)},ie.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||HE).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},ie.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,DC(this)),this.readyState=xC},ie.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,LC(this)),this.g&&(this.readyState=3,LC(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==HE.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;OC(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},ie.Sa=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?DC:LC)(this),3==this.readyState&&OC(this))},ie.Ua=function(e){this.g&&(this.response=this.responseText=e,DC(this))},ie.Ta=function(e){this.g&&(this.response=e,DC(this))},ie.ha=function(){this.g&&DC(this)},ie.setRequestHeader=function(e,t){this.v.append(e,t)},ie.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},ie.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(PC.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var MC=HE.JSON.parse;function FC(e){HS.call(this),this.headers=new Wk,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=UC,this.K=this.L=!1}rS(FC,HS);var UC="",qC=/^https?$/i,jC=["POST","PUT"];function VC(e){return"content-type"==e.toLowerCase()}function BC(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,KC(e),$C(e)}function KC(e){e.D||(e.D=!0,GS(e,"complete"),GS(e,"error"))}function zC(e){if(e.h&&(!e.C[1]||4!=HC(e)||2!=e.ba()))if(e.v&&4==HC(e))ok(e.Fa,0,e);else if(GS(e,"readystatechange"),4==HC(e)){e.h=!1;try{var t,n,r,i,s=e.ba();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break e;default:o=!1}if((t=o)||((n=0===s)&&(!(i=String(e.H).match(Qk)[1]||null)&&HE.self&&HE.self.location&&(i=(r=HE.self.location.protocol).substr(0,r.length-1)),n=!qC.test(i?i.toLowerCase():"")),t=n),t)GS(e,"complete"),GS(e,"success");else{e.m=6;try{var a=2<HC(e)?e.g.statusText:""}catch(e){a=""}e.j=a+" ["+e.ba()+"]",KC(e)}}finally{$C(e)}}}function $C(e,t){if(e.g){WC(e);const n=e.g,r=e.C[0]?GE:null;e.g=null,e.C=null,t||GS(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function WC(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(HE.clearTimeout(e.A),e.A=null)}function HC(e){return e.g?e.g.readyState:0}function GC(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case UC:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function QC(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=function(){let n="";return fS(r,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}(),"string"==typeof e?null!=r&&encodeURIComponent(String(r)):nC(e,t,r))}function YC(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function JC(e){this.za=0,this.l=[],this.h=new dk,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=YC("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=YC("baseRetryDelayMs",5e3,e),this.$a=YC("retryDelaySeedMs",1e4,e),this.Ya=YC("forwardChannelMaxRetries",2,e),this.ra=YC("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new wC(e&&e.concurrentRequestLimit),this.Ca=new AC,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function XC(e){var t,n;eA(e),3==e.G&&(t=e.V++,nC(n=Jk(e.F),"SID",e.J),nC(n,"RID",t),nC(n,"TYPE","terminate"),iA(e,n),(t=new Nk(e,e.h,t,void 0)).K=2,t.v=rC(Jk(n)),n=!1,!(n=HE.navigator&&HE.navigator.sendBeacon?HE.navigator.sendBeacon(t.v.toString(),""):n)&&HE.Image&&((new Image).src=t.v,n=!0),n||(t.g=mA(t.l,null),t.g.ea(t.v)),t.F=Date.now(),qk(t)),fA(e)}function ZC(e){e.g&&(cA(e),e.g.cancel(),e.g=null)}function eA(e){ZC(e),e.u&&(HE.clearTimeout(e.u),e.u=null),uA(e),e.i.cancel(),e.m&&("number"==typeof e.m&&HE.clearTimeout(e.m),e.m=null)}function tA(e,t){e.l.push(new _C(e.Za++,t)),3==e.G&&nA(e)}function nA(e){bC(e.i)||e.m||(e.m=!0,ek(e.Ha,e),e.C=0)}function rA(e,t){var n=t?t.m:e.V++,r=Jk(e.F);nC(r,"SID",e.J),nC(r,"RID",n),nC(r,"AID",e.U),iA(e,r),e.o&&e.s&&QC(r,e.o,e.s),n=new Nk(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=sA(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),EC(e.i,n),Lk(n,r,t)}function iA(e,n){e.j&&$k({},function(e,t){nC(n,t,e)})}function sA(r,e,i){i=Math.min(r.l.length,i);var s=r.j?tS(r.j.Oa,r.j,r):null;e:{var o=r.l;let n=-1;for(;;){const l=["count="+i];-1==n?0<i?(n=o[0].h,l.push("ofs="+n)):n=0:l.push("ofs="+n);let t=!0;for(let e=0;e<i;e++){var a=o[e].h,c=o[e].g;if((a-=n)<0)n=Math.max(0,o[e].h-100),t=!1;else try{!function(e,r){const i="req"+a+"_"||"";try{$k(e,function(e,t){let n=e;YE(e)&&(n=JS(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(c,l)}catch(r){s&&s(c)}}if(t){s=l.join("&");break e}}}return r=r.l.splice(0,i),e.D=r,s}function oA(e){e.g||e.u||(e.Y=1,ek(e.Ga,e),e.A=0)}function aA(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=Ik(tS(e.Ga,e),dA(e,e.A)),e.A++,1)}function cA(e){null!=e.B&&(HE.clearTimeout(e.B),e.B=null)}function lA(e){e.g=new Nk(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Jk(e.oa);nC(t,"RID","rpc"),nC(t,"SID",e.J),nC(t,"CI",e.N?"0":"1"),nC(t,"AID",e.U),iA(e,t),nC(t,"TYPE","xmlhttp"),e.o&&e.s&&QC(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=rC(Jk(t)),n.s=null,n.U=!0,Mk(n,e)}function uA(e){null!=e.v&&(HE.clearTimeout(e.v),e.v=null)}function hA(e,t){var n,r,i,s=null;if(e.g==t){uA(e),cA(e),e.g=null;var o=2}else{if(!TC(e.i,t))return;s=t.D,SC(e.i,t),o=1}if(e.I=t.N,0!=e.G)if(t.i)1==o?(s=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,GS(o=mk(),new bk(o,s)),nA(e)):oA(e);else if(3==(n=t.o)||0==n&&0<e.I||(1!=o||(i=t,IC((r=e).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=i.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=Ik(tS(r.Ha,r,i),dA(r,r.C)),r.C++,0))))&&(2!=o||!aA(e)))switch(s&&0<s.length&&(t=e.i,t.i=t.i.concat(s)),n){case 1:pA(e,5);break;case 4:pA(e,10);break;case 3:pA(e,6);break;default:pA(e,2)}}function dA(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function pA(e,t){var n,r;e.h.info("Error code "+t),2==t?(n=null,e.j&&(n=null),r=tS(e.jb,e),n||(n=new Yk("//www.google.com/images/cleardot.gif"),HE.location&&"http"==HE.location.protocol||Xk(n,"https"),rC(n)),function(e,t){var n=new dk;if(HE.Image){const r=new Image;r.onload=nS(NC,n,r,"TestLoadImage: loaded",!0,t),r.onerror=nS(NC,n,r,"TestLoadImage: error",!1,t),r.onabort=nS(NC,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=nS(NC,n,r,"TestLoadImage: timeout",!1,t),HE.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):wk(2),e.G=0,e.j&&e.j.va(t),fA(e),eA(e)}function fA(e){e.G=0,e.I=-1,e.j&&(0==kC(e.i).length&&0==e.l.length||(e.i.i.length=0,lS(e.l),e.l.length=0),e.j.ua())}function gA(e,t,n){let r=(a=n)instanceof Yk?Jk(a):new Yk(a,void 0);var i,s,o,a,c;return""!=r.i?(t&&Zk(r,t+"."+r.i),eC(r,r.m)):(c=HE.location,r=(i=c.protocol,s=t?t+"."+c.hostname:c.hostname,o=+c.port,a=n,c=new Yk(null,void 0),i&&Xk(c,i),s&&Zk(c,s),o&&eC(c,o),a&&(c.l=a),c)),e.aa&&fS(e.aa,function(e,t){nC(r,t,e)}),t=e.D,n=e.sa,t&&n&&nC(r,t,n),nC(r,"VER",e.ma),iA(e,r),r}function mA(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new FC(new RC({ib:!0})):new FC(e.qa)).L=e.H,t}function yA(){}function vA(){if(wS&&!(10<=Number(kS)))throw Error("Environmental error: no available transport.")}function _A(e,t){HS.call(this),this.g=new JC(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!uS(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!uS(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new IA(this)}function wA(e){kk.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function bA(){Ck.call(this),this.status=1}function IA(e){this.g=e}(ie=FC.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||Pk).g(),this.C=this.u?Ek(this.u):Ek(Pk),this.g.onreadystatechange=tS(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void BC(this,e)}e=n||"";const i=new Wk(this.headers);r&&$k(r,function(e,t){i.set(t,e)}),r=function(t){e:{var n=VC,r=t.length,i="string"==typeof t?t.split(""):t;for(let e=0;e<r;e++)if(e in i&&n.call(void 0,i[e],e,t)){n=e;break e}n=-1}return n<0?null:"string"==typeof t?t.charAt(n):t[n]}(i.T()),n=HE.FormData&&e instanceof HE.FormData,0<=oS(jC,t)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{WC(this),0<this.B&&((this.K=(a=this.g,wS&&(s=function(){let t=0;var n=hS(String(_S)).split("."),r=hS("9").split("."),i=Math.max(n.length,r.length);for(let e=0;0==t&&e<i;e++)for(var s=n[e]||"",o=r[e]||"";s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],(0!=s[0].length||0!=o[0].length)&&(t=pS(0==s[1].length?0:parseInt(s[1],10),0==o[1].length?0:parseInt(o[1],10))||pS(0==s[2].length,0==o[2].length)||pS(s[2],o[2]),s=s[3],o=o[3],0==t););return 0<=t},o=SS,Object.prototype.hasOwnProperty.call(o,9)?o[9]:o[9]=s())&&"number"==typeof a.timeout&&void 0!==a.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=tS(this.pa,this)):this.A=ok(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){BC(this,e)}var s,o,a},ie.pa=function(){this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,GS(this,"timeout"),this.abort(8))},ie.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,GS(this,"complete"),GS(this,"abort"),$C(this))},ie.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),$C(this,!0)),FC.Z.M.call(this)},ie.Fa=function(){this.s||(this.F||this.v||this.l?zC(this):this.cb())},ie.cb=function(){zC(this)},ie.ba=function(){try{return 2<HC(this)?this.g.status:-1}catch(e){return-1}},ie.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},ie.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),MC(t)}},ie.Da=function(){return this.m},ie.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(ie=JC.prototype).ma=8,ie.G=1,ie.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},ie.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const s=new Nk(this,this.h,t,void 0);let e=this.s;if(this.P&&(e?(e=gS(e),yS(e,this.P)):e=this.P),null===this.o&&(s.H=e),this.ja)e:{for(var n=0,r=0;r<this.l.length;r++){var i=this.l[r];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(n+=i)){n=r;break e}if(4096===n||r===this.l.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=sA(this,s,n),nC(r=Jk(this.F),"RID",t),nC(r,"CVER",22),this.D&&nC(r,"X-HTTP-Session-Id",this.D),iA(this,r),this.o&&e&&QC(r,this.o,e),EC(this.i,s),this.Ra&&nC(r,"TYPE","init"),this.ja?(nC(r,"$req",n),nC(r,"SID","null"),s.$=!0,Lk(s,r,null)):Lk(s,r,n),this.G=2}}else 3==this.G&&(t?rA(this,t):0==this.l.length||bC(this.i)||rA(this))},ie.Ga=function(){var e;this.u=null,lA(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(e=2*this.O,this.h.info("BP detection timer enabled: "+e),this.B=Ik(tS(this.bb,this),e))},ie.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,wk(10),ZC(this),lA(this))},ie.ab=function(){null!=this.v&&(this.v=null,ZC(this),aA(this),wk(19))},ie.jb=function(e){e?(this.h.info("Successfully pinged google.com"),wk(2)):(this.h.info("Failed to ping google.com"),wk(1))},(ie=yA.prototype).xa=function(){},ie.wa=function(){},ie.va=function(){},ie.ua=function(){},ie.Oa=function(){},vA.prototype.g=function(e,t){return new _A(e,t)},rS(_A,HS),_A.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),ek(tS(e.hb,e,t))),wk(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=gA(e,null,e.W),nA(e)},_A.prototype.close=function(){XC(this.g)},_A.prototype.u=function(e){var t;"string"==typeof e?((t={}).__data__=e,tA(this.g,t)):this.v?((t={}).__data__=JS(e),tA(this.g,t)):tA(this.g,e)},_A.prototype.M=function(){this.g.j=null,delete this.j,XC(this.g),delete this.g,_A.Z.M.call(this)},rS(wA,kk),rS(bA,Ck),rS(IA,yA),IA.prototype.xa=function(){GS(this.g,"a")},IA.prototype.wa=function(e){GS(this.g,new wA(e))},IA.prototype.va=function(e){GS(this.g,new bA)},IA.prototype.ua=function(){GS(this.g,"b")},vA.prototype.createWebChannel=vA.prototype.g,_A.prototype.send=_A.prototype.u,_A.prototype.open=_A.prototype.m,_t.NO_ERROR=0,_t.TIMEOUT=8,_t.HTTP_ERROR=6,xa.COMPLETE="complete",(Sk.EventType=WE).OPEN="a",WE.CLOSE="b",WE.ERROR="c",WE.MESSAGE="d",HS.prototype.listen=HS.prototype.N,FC.prototype.listenOnce=FC.prototype.O,FC.prototype.getLastError=FC.prototype.La,FC.prototype.getLastErrorCode=FC.prototype.Da,FC.prototype.getStatus=FC.prototype.ba,FC.prototype.getResponseJson=FC.prototype.Qa,FC.prototype.getResponseText=FC.prototype.ga,FC.prototype.send=FC.prototype.ea;var TA,EA,SA=mk,kA=_t,CA=xa,AA=fk,NA=RC,RA=Sk,PA=FC;class xA{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}xA.UNAUTHENTICATED=new xA(null),xA.GOOGLE_CREDENTIALS=new xA("google-credentials-uid"),xA.FIRST_PARTY=new xA("first-party-uid"),xA.MOCK_USER=new xA("mock-user");let OA="9.1.2";const DA=new pp("@firebase/firestore");function LA(){return DA.logLevel}function MA(e,...t){DA.logLevel<=sp.DEBUG&&(t=t.map(qA),DA.debug(`Firestore (${OA}): ${e}`,...t))}function FA(e,...t){DA.logLevel<=sp.ERROR&&(t=t.map(qA),DA.error(`Firestore (${OA}): ${e}`,...t))}function UA(e,...t){DA.logLevel<=sp.WARN&&(t=t.map(qA),DA.warn(`Firestore (${OA}): ${e}`,...t))}function qA(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function jA(e="Unexpected state"){throw FA(e=`FIRESTORE (${OA}) INTERNAL ASSERTION FAILED: `+e),new Error(e)}function VA(e){e||jA()}const BA={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class KA extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class zA{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class $A{constructor(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${e}`}}class WA{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(xA.UNAUTHENTICATED))}shutdown(){}}class HA{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class GA{constructor(e){this.t=e,this.currentUser=xA.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const i=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let s=new zA;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new zA,t.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},a=e=>{MA("FirebaseCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(e=>a(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?a(e):(MA("FirebaseCredentialsProvider","Auth not yet detected"),s.resolve(),s=new zA))},0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(MA("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(VA("string"==typeof e.accessToken),new $A(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return VA(null===e||"string"==typeof e),new xA(e)}}class QA{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=xA.FIRST_PARTY}get authHeaders(){const e={"X-Goog-AuthUser":this.l},t=this.h.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),this.m&&(e["X-Goog-Iam-Authorization-Token"]=this.m),e}}class YA{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new QA(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(xA.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class JA{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.g(e),this.p=e=>t.writeSequenceNumber(e))}g(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.p&&this.p(e),e}}JA.T=-1;class XA{static I(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(40);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let e=0;e<40;e++)t[e]=Math.floor(256*Math.random());return t}();for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function ZA(e,t){return e<t?-1:t<e?1:0}function eN(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function tN(e){return e+"\0"}class nN{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new KA(BA.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new KA(BA.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new KA(BA.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new KA(BA.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return nN.fromMillis(Date.now())}static fromDate(e){return nN.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),e=Math.floor(1e6*(e-1e3*t));return new nN(t,e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ZA(this.nanoseconds,e.nanoseconds):ZA(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class rN{constructor(e){this.timestamp=e}static fromTimestamp(e){return new rN(e)}static min(){return new rN(new nN(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function iN(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function sN(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function oN(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class aN{constructor(e,t,n){void 0===t?t=0:t>e.length&&jA(),void 0===n?n=e.length-t:n>e.length-t&&jA(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===aN.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof aN?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(n){for(let e=this.offset,t=this.limit();e<t;e++)n(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){const r=Math.min(t.length,n.length);for(let e=0;e<r;e++){const r=t.get(e),i=n.get(e);if(r<i)return-1;if(r>i)return 1}return t.length<n.length?-1:t.length>n.length?1:0}}class cN extends aN{construct(e,t,n){return new cN(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new KA(BA.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new cN(t)}static emptyPath(){return new cN([])}}const lN=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class uN extends aN{construct(e,t,n){return new uN(e,t,n)}static isValidIdentifier(e){return lN.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=uN.isValidIdentifier(e)?e:"`"+e+"`")).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new uN(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new KA(BA.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new KA(BA.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new KA(BA.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new KA(BA.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new uN(t)}static emptyPath(){return new uN([])}}class hN{constructor(e){(this.fields=e).sort(uN.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return eN(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class dN{constructor(e){this.binaryString=e}static fromBase64String(e){return e=atob(e),new dN(e)}static fromUint8Array(e){return e=function(t){let n="";for(let e=0;e<t.length;++e)n+=String.fromCharCode(t[e]);return n}(e),new dN(e)}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ZA(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}dN.EMPTY_BYTE_STRING=new dN("");const pN=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function fN(t){if(VA(!!t),"string"!=typeof t)return{seconds:gN(t.seconds),nanos:gN(t.nanos)};{let e=0;var n=pN.exec(t);VA(!!n),n[1]&&(n=(n[1]+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function gN(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function mN(e){return"string"==typeof e?dN.fromBase64String(e):dN.fromUint8Array(e)}function yN(e){return"server_timestamp"===(null===(e=((null===(e=null==e?void 0:e.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===e?void 0:e.stringValue)}function vN(e){return e=fN(e.mapValue.fields.__local_write_time__.timestampValue),new nN(e.seconds,e.nanos)}function _N(e){return null==e}function wN(e){return 0===e&&1/e==-1/0}function bN(e){return"number"==typeof e&&Number.isInteger(e)&&!wN(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class IN{constructor(e){this.path=e}static fromPath(e){return new IN(cN.fromString(e))}static fromName(e){return new IN(cN.fromString(e).popFirst(5))}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===cN.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return cN.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new IN(new cN(e.slice()))}}function TN(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?yN(e)?4:10:jA()}function EN(n,r){var e,t,i=TN(n);if(i!==TN(r))return!1;switch(i){case 0:return!0;case 1:return n.booleanValue===r.booleanValue;case 4:return vN(n).isEqual(vN(r));case 3:return function(e){if("string"==typeof n.timestampValue&&"string"==typeof e.timestampValue&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;var t=fN(n.timestampValue),e=fN(e.timestampValue);return t.seconds===e.seconds&&t.nanos===e.nanos}(r);case 5:return n.stringValue===r.stringValue;case 6:return t=r,mN(n.bytesValue).isEqual(mN(t.bytesValue));case 7:return n.referenceValue===r.referenceValue;case 8:return e=r,gN((t=n).geoPointValue.latitude)===gN(e.geoPointValue.latitude)&&gN(t.geoPointValue.longitude)===gN(e.geoPointValue.longitude);case 2:return t=r,"integerValue"in(e=n)&&"integerValue"in t?gN(e.integerValue)===gN(t.integerValue):"doubleValue"in e&&"doubleValue"in t&&((e=gN(e.doubleValue))===(t=gN(t.doubleValue))?wN(e)===wN(t):isNaN(e)&&isNaN(t));case 9:return eN(n.arrayValue.values||[],r.arrayValue.values||[],EN);case 10:return function(e){const t=e.mapValue.fields||{},n=r.mapValue.fields||{};if(iN(t)!==iN(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!EN(t[e],n[e])))return!1;return!0}(n);default:return jA()}}function SN(e,t){return void 0!==(e.values||[]).find(e=>EN(e,t))}function kN(e,t){var n,r,i,s=TN(e),o=TN(t);if(s!==o)return ZA(s,o);switch(s){case 0:return 0;case 1:return ZA(e.booleanValue,t.booleanValue);case 2:return r=t,(i=gN(e.integerValue||e.doubleValue))<(r=gN(r.integerValue||r.doubleValue))?-1:r<i?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1;case 3:return CN(e.timestampValue,t.timestampValue);case 4:return CN(vN(e),vN(t));case 5:return ZA(e.stringValue,t.stringValue);case 6:return function(e,t){const n=mN(e),r=mN(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=ZA(n[e],r[e]);if(0!==t)return t}return ZA(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,i=t.geoPointValue,0!==(r=ZA(gN(n.latitude),gN(i.latitude)))?r:ZA(gN(n.longitude),gN(i.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=kN(n[e],r[e]);if(t)return t}return ZA(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=ZA(r[e],s[e]);if(0!==t)return t;var o=kN(n[r[e]],i[s[e]]);if(0!==o)return o}return ZA(r.length,s.length)}(e.mapValue,t.mapValue);default:throw jA()}}function CN(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ZA(e,t);var n=fN(e),e=fN(t);return 0!==(t=ZA(n.seconds,e.seconds))?t:ZA(n.nanos,e.nanos)}function AN(e){return function i(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?`time(${(e=fN(r.timestampValue)).seconds},${e.nanos})`:"stringValue"in r?r.stringValue:"bytesValue"in r?mN(r.bytesValue).toBase64():"referenceValue"in r?(t=r.referenceValue,IN.fromName(t).toString()):"geoPointValue"in r?`geo(${(t=r.geoPointValue).latitude},${t.longitude})`:"arrayValue"in r?function(){let e="[",t=!0;for(const n of r.arrayValue.values||[])t?t=!1:e+=",",e+=i(n);return e+"]"}():"mapValue"in r?function(e){let t="{",n=!0;for(const r of Object.keys(e.fields||{}).sort())n?n=!1:t+=",",t+=`${r}:${i(e.fields[r])}`;return t+"}"}(r.mapValue):jA();var e,t}(e)}function NN(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function RN(e){return e&&"integerValue"in e}function PN(e){return!!e&&"arrayValue"in e}function xN(e){return e&&"nullValue"in e}function ON(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function DN(e){return e&&"mapValue"in e}function LN(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return sN(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=LN(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=LN(t.arrayValue.values[e]);return r}return Object.assign({},t)}class MN{constructor(e){this.value=e}static empty(){return new MN({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let t=this.value;for(let e=0;e<n.length-1;++e)if(t=(t.mapValue.fields||{})[n.get(e)],!DN(t))return null;return t=(t.mapValue.fields||{})[n.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=LN(t)}setAll(e){let n=uN.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=LN(e):i.push(t.lastSegment())}),e=this.getFieldsMap(n),this.applyChanges(e,r,i)}delete(e){const t=this.field(e.popLast());DN(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return EN(this.value,e.value)}getFieldsMap(n){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let t=0;t<n.length;++t){let e=r.mapValue.fields[n.get(t)];DN(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},r.mapValue.fields[n.get(t)]=e),r=e}return r.mapValue.fields}applyChanges(n,e,t){sN(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new MN(LN(this.value))}}class FN{constructor(e,t,n,r,i){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(e){return new FN(e,0,rN.min(),MN.empty(),0)}static newFoundDocument(e,t,n){return new FN(e,1,t,n,0)}static newNoDocument(e,t){return new FN(e,2,t,MN.empty(),0)}static newUnknownDocument(e,t){return new FN(e,3,t,MN.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=MN.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=MN.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof FN&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new FN(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class UN{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.A=null}}function qN(e,t=null,n=[],r=[],i=null,s=null,o=null){return new UN(e,t,n,r,i,s,o)}function jN(e){const t=e;if(null===t.A){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function(e){return e.field.canonicalString()+e.op.toString()+AN(e.value)}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),_N(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=ZN(t.startAt)),t.endAt&&(e+="|ub:",e+=ZN(t.endAt)),t.A=e}return t.A}function VN(t,n){if(t.limit!==n.limit)return!1;if(t.orderBy.length!==n.orderBy.length)return!1;for(let e=0;e<t.orderBy.length;e++)if(r=t.orderBy[e],i=n.orderBy[e],r.dir!==i.dir||!r.field.isEqual(i.field))return!1;var r,i,s,o;if(t.filters.length!==n.filters.length)return!1;for(let e=0;e<t.filters.length;e++)if(s=t.filters[e],o=n.filters[e],s.op!==o.op||!s.field.isEqual(o.field)||!EN(s.value,o.value))return!1;return t.collectionGroup===n.collectionGroup&&!!t.path.isEqual(n.path)&&!!nR(t.startAt,n.startAt)&&nR(t.endAt,n.endAt)}function BN(e){return IN.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class KN extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.R(e,t,n):new zN(e,t,n):"array-contains"===t?new GN(e,n):"in"===t?new QN(e,n):"not-in"===t?new YN(e,n):"array-contains-any"===t?new JN(e,n):new KN(e,t,n)}static R(e,t,n){return new("in"===t?$N:WN)(e,n)}matches(e){return e=e.data.field(this.field),"!="===this.op?null!==e&&this.P(kN(e,this.value)):null!==e&&TN(this.value)===TN(e)&&this.P(kN(e,this.value))}P(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return jA()}}v(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}}class zN extends KN{constructor(e,t,n){super(e,t,n),this.key=IN.fromName(n.referenceValue)}matches(e){return e=IN.comparator(e.key,this.key),this.P(e)}}class $N extends KN{constructor(e,t){super(e,"in",t),this.keys=HN(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class WN extends KN{constructor(e,t){super(e,"not-in",t),this.keys=HN(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function HN(e,t){return((null===(t=t.arrayValue)||void 0===t?void 0:t.values)||[]).map(e=>IN.fromName(e.referenceValue))}class GN extends KN{constructor(e,t){super(e,"array-contains",t)}matches(e){return PN(e=e.data.field(this.field))&&SN(e.arrayValue,this.value)}}class QN extends KN{constructor(e,t){super(e,"in",t)}matches(e){return null!==(e=e.data.field(this.field))&&SN(this.value.arrayValue,e)}}class YN extends KN{constructor(e,t){super(e,"not-in",t)}matches(e){return!SN(this.value.arrayValue,{nullValue:"NULL_VALUE"})&&(null!==(e=e.data.field(this.field))&&!SN(this.value.arrayValue,e))}}class JN extends KN{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!PN(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>SN(this.value.arrayValue,e))}}class XN{constructor(e,t){this.position=e,this.before=t}}function ZN(e){return`${e.before?"b":"a"}:${e.position.map(e=>AN(e)).join(",")}`}class eR{constructor(e,t="asc"){this.field=e,this.dir=t}}function tR(t,n,r){let i=0;for(let e=0;e<t.position.length;e++){const s=n[e],o=t.position[e];if(i=s.field.isKeyField()?IN.comparator(IN.fromName(o.referenceValue),r.key):kN(o,r.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return t.before?i<=0:i<0}function nR(t,n){if(null===t)return null===n;if(null===n)return!1;if(t.before!==n.before||t.position.length!==n.position.length)return!1;for(let e=0;e<t.position.length;e++)if(!EN(t.position[e],n.position[e]))return!1;return!0}class rR{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.V=null,this.S=null,this.startAt,this.endAt}}function iR(e,t,n,r,i,s,o,a){return new rR(e,t,n,r,i,s,o,a)}function sR(e){return new rR(e)}function oR(e){return!_N(e.limit)&&"F"===e.limitType}function aR(e){return!_N(e.limit)&&"L"===e.limitType}function cR(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function lR(e){for(const t of e.filters)if(t.v())return t.field;return null}function uR(e){return null!==e.collectionGroup}function hR(t){const n=t;if(null===n.V){n.V=[];const t=lR(n),e=cR(n);if(null!==t&&null===e)t.isKeyField()||n.V.push(new eR(t)),n.V.push(new eR(uN.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.V.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.V.push(new eR(uN.keyField(),t))}}}return n.V}function dR(e){const t=e;if(!t.S)if("F"===t.limitType)t.S=qN(t.path,t.collectionGroup,hR(t),t.filters,t.limit,t.startAt,t.endAt);else{const r=[];for(const i of hR(t)){const t="desc"===i.dir?"asc":"desc";r.push(new eR(i.field,t))}var n=t.endAt?new XN(t.endAt.position,!t.endAt.before):null,e=t.startAt?new XN(t.startAt.position,!t.startAt.before):null;t.S=qN(t.path,t.collectionGroup,r,t.filters,t.limit,n,e)}return t.S}function pR(e,t,n){return new rR(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function fR(e,t){return VN(dR(e),dR(t))&&e.limitType===t.limitType}function gR(e){return`${jN(dR(e))}|lt:${e.limitType}`}function mR(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>`${e.field.canonicalString()} ${e.op} ${AN(e.value)}`).join(", ")}]`),_N(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+ZN(e.startAt)),e.endAt&&(t+=", endAt: "+ZN(e.endAt)),`Target(${t})`}(dR(e))}; limitType=${e.limitType})`}function yR(n,e){return e.isFoundDocument()&&(i=(r=e).key.path,null!==(t=n).collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(i):IN.isDocumentKey(t.path)?t.path.isEqual(i):t.path.isImmediateParentOf(i))&&function(e){for(const t of n.explicitOrderBy)if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(i=e,(!(e=n).startAt||tR(e.startAt,hR(e),i))&&(!e.endAt||!tR(e.endAt,hR(e),i)));var t,r,i}function vR(i){return(e,t)=>{let n=!1;for(const r of hR(i)){const i=function(e,t,n){var r,i=e.field.isKeyField()?IN.comparator(t.key,n.key):(r=e.field,n=n,t=t.data.field(r),r=n.data.field(r),null!==t&&null!==r?kN(t,r):jA());switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return jA()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}function _R(e,t){if(e.D){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wN(t)?"-0":t}}function wR(e){return{integerValue:""+e}}function bR(e,t){return bN(t)?wR(t):_R(e,t)}class IR{constructor(){this._=void 0}}function TR(e,t){return e instanceof NR?RN(e=t)||e&&"doubleValue"in e?t:{integerValue:0}:null}class ER extends IR{}class SR extends IR{constructor(e){super(),this.elements=e}}function kR(e,t){const n=PR(t);for(const t of e.elements)n.some(e=>EN(e,t))||n.push(t);return{arrayValue:{values:n}}}class CR extends IR{constructor(e){super(),this.elements=e}}function AR(e,t){let n=PR(t);for(const t of e.elements)n=n.filter(e=>!EN(e,t));return{arrayValue:{values:n}}}class NR extends IR{constructor(e,t){super(),this.N=e,this.C=t}}function RR(e){return gN(e.integerValue||e.doubleValue)}function PR(e){return PN(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class xR{constructor(e,t){this.field=e,this.transform=t}}class OR{constructor(e,t){this.version=e,this.transformResults=t}}class DR{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new DR}static exists(e){return new DR(void 0,e)}static updateTime(e){return new DR(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function LR(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class MR{}function FR(e,t,n){e instanceof VR?function(e,t,n){const r=e.value.clone(),i=zR(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof BR?function(e,t,n){if(!LR(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=zR(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(KR(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function UR(e,t,n){e instanceof VR?function(e,t,n){if(LR(e.precondition,t)){const r=e.value.clone(),i=$R(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(jR(t),r).setHasLocalMutations()}}(e,t,n):e instanceof BR?function(e,t,n){if(LR(e.precondition,t)){const r=$R(e.fieldTransforms,n,t),i=t.data;i.setAll(KR(e)),i.setAll(r),t.convertToFoundDocument(jR(t),i).setHasLocalMutations()}}(e,t,n):LR(e.precondition,t)&&t.convertToNoDocument(rN.min())}function qR(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&eN(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof SR&&t instanceof SR||e instanceof CR&&t instanceof CR?eN(e.elements,t.elements,EN):e instanceof NR&&t instanceof NR?EN(e.C,t.C):e instanceof ER&&t instanceof ER)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}function jR(e){return e.isFoundDocument()?e.version:rN.min()}class VR extends MR{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class BR extends MR{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function KR(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function zR(t,n,r){const i=new Map;VA(t.length===r.length);for(let e=0;e<r.length;e++){var s=t[e],o=s.transform,a=n.data.field(s.field);i.set(s.field,(s=o,o=a,a=r[e],s instanceof SR?kR(s,o):s instanceof CR?AR(s,o):a))}return i}function $R(e,t,n){const r=new Map;for(const l of e){const e=l.transform,u=n.data.field(l.field);r.set(l.field,(i=e,s=u,o=t,0,i instanceof ER?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return s&&(e.fields.__previous_value__=s),{mapValue:e}}():i instanceof SR?kR(i,s):i instanceof CR?AR(i,s):(i=RR(c=TR(a=i,s))+RR(a.C),RN(c)&&RN(a.C)?wR(i):_R(a.N,i))))}var i,s,o,a,c;return r}class WR extends MR{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class HR extends MR{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class GR{constructor(e){this.count=e}}function QR(e){switch(e){default:return jA(),0;case BA.CANCELLED:case BA.UNKNOWN:case BA.DEADLINE_EXCEEDED:case BA.RESOURCE_EXHAUSTED:case BA.INTERNAL:case BA.UNAVAILABLE:case BA.UNAUTHENTICATED:return;case BA.INVALID_ARGUMENT:case BA.NOT_FOUND:case BA.ALREADY_EXISTS:case BA.PERMISSION_DENIED:case BA.FAILED_PRECONDITION:case BA.ABORTED:case BA.OUT_OF_RANGE:case BA.UNIMPLEMENTED:case BA.DATA_LOSS:return 1}}function YR(e){if(void 0===e)return FA("GRPC error has no .code"),BA.UNKNOWN;switch(e){case TA.OK:return BA.OK;case TA.CANCELLED:return BA.CANCELLED;case TA.UNKNOWN:return BA.UNKNOWN;case TA.DEADLINE_EXCEEDED:return BA.DEADLINE_EXCEEDED;case TA.RESOURCE_EXHAUSTED:return BA.RESOURCE_EXHAUSTED;case TA.INTERNAL:return BA.INTERNAL;case TA.UNAVAILABLE:return BA.UNAVAILABLE;case TA.UNAUTHENTICATED:return BA.UNAUTHENTICATED;case TA.INVALID_ARGUMENT:return BA.INVALID_ARGUMENT;case TA.NOT_FOUND:return BA.NOT_FOUND;case TA.ALREADY_EXISTS:return BA.ALREADY_EXISTS;case TA.PERMISSION_DENIED:return BA.PERMISSION_DENIED;case TA.FAILED_PRECONDITION:return BA.FAILED_PRECONDITION;case TA.ABORTED:return BA.ABORTED;case TA.OUT_OF_RANGE:return BA.OUT_OF_RANGE;case TA.UNIMPLEMENTED:return BA.UNIMPLEMENTED;case TA.DATA_LOSS:return BA.DATA_LOSS;default:return jA()}}(xa=TA={})[xa.OK=0]="OK",xa[xa.CANCELLED=1]="CANCELLED",xa[xa.UNKNOWN=2]="UNKNOWN",xa[xa.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",xa[xa.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",xa[xa.NOT_FOUND=5]="NOT_FOUND",xa[xa.ALREADY_EXISTS=6]="ALREADY_EXISTS",xa[xa.PERMISSION_DENIED=7]="PERMISSION_DENIED",xa[xa.UNAUTHENTICATED=16]="UNAUTHENTICATED",xa[xa.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",xa[xa.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",xa[xa.ABORTED=10]="ABORTED",xa[xa.OUT_OF_RANGE=11]="OUT_OF_RANGE",xa[xa.UNIMPLEMENTED=12]="UNIMPLEMENTED",xa[xa.INTERNAL=13]="INTERNAL",xa[xa.UNAVAILABLE=14]="UNAVAILABLE",xa[xa.DATA_LOSS=15]="DATA_LOSS";class JR{constructor(e,t){this.comparator=e,this.root=t||ZR.EMPTY}insert(e,t){return new JR(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ZR.BLACK,null,null))}remove(e){return new JR(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ZR.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new XR(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new XR(this.root,e,this.comparator,!1)}getReverseIterator(){return new XR(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new XR(this.root,e,this.comparator,!0)}}class XR{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ZR{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ZR.RED,this.left=null!=r?r:ZR.EMPTY,this.right=null!=i?i:ZR.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new ZR(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ZR.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return ZR.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,ZR.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,ZR.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw jA();if(this.right.isRed())throw jA();var e=this.left.check();if(e!==this.right.check())throw jA();return e+(this.isRed()?0:1)}}ZR.EMPTY=null,ZR.RED=!0,ZR.BLACK=!1,ZR.EMPTY=new class{constructor(){this.size=0}get key(){throw jA()}get value(){throw jA()}get color(){throw jA()}get left(){throw jA()}get right(){throw jA()}copy(e,t,n,r,i){return this}insert(e,t,n){return new ZR(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class eP{constructor(e){this.comparator=e,this.data=new JR(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tP(this.data.getIterator())}getIteratorFrom(e){return new tP(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof eP))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new eP(this.comparator);return t.data=e,t}}class tP{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const nP=new JR(IN.comparator),rP=new JR(IN.comparator),iP=new JR(IN.comparator),sP=new eP(IN.comparator);function oP(...e){let t=sP;for(const n of e)t=t.add(n);return t}const aP=new eP(ZA);class cP{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,lP.createSynthesizedTargetChangeForCurrentChange(e,t)),new cP(rN.min(),n,aP,nP,oP())}}class lP{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new lP(dN.EMPTY_BYTE_STRING,t,oP(),oP(),oP())}}class uP{constructor(e,t,n,r){this.k=e,this.removedTargetIds=t,this.key=n,this.$=r}}class hP{constructor(e,t){this.targetId=e,this.O=t}}class dP{constructor(e,t,n=dN.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class pP{constructor(){this.F=0,this.M=mP(),this.L=dN.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return 0!==this.F}get K(){return this.U}j(e){0<e.approximateByteSize()&&(this.U=!0,this.L=e)}W(){let n=oP(),r=oP(),i=oP();return this.M.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:jA()}}),new lP(this.L,this.B,n,r,i)}G(){this.U=!1,this.M=mP()}H(e,t){this.U=!0,this.M=this.M.insert(e,t)}J(e){this.U=!0,this.M=this.M.remove(e)}Y(){this.F+=1}X(){--this.F}Z(){this.U=!0,this.B=!0}}class fP{constructor(e){this.tt=e,this.et=new Map,this.nt=nP,this.st=gP(),this.it=new eP(ZA)}rt(e){for(const t of e.k)e.$&&e.$.isFoundDocument()?this.ot(t,e.$):this.at(t,e.key,e.$);for(const n of e.removedTargetIds)this.at(n,e.key,e.$)}ct(n){this.forEachTarget(n,e=>{const t=this.ut(e);switch(n.state){case 0:this.ht(e)&&t.j(n.resumeToken);break;case 1:t.X(),t.q||t.G(),t.j(n.resumeToken);break;case 2:t.X(),t.q||this.removeTarget(e);break;case 3:this.ht(e)&&(t.Z(),t.j(n.resumeToken));break;case 4:this.ht(e)&&(this.lt(e),t.j(n.resumeToken));break;default:jA()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.et.forEach((e,t)=>{this.ht(t)&&n(t)})}ft(e){const t=e.targetId,n=e.O.count,r=this.dt(t);if(r){const e=r.target;if(BN(e))if(0===n){const n=new IN(e.path);this.at(t,n,FN.newNoDocument(n,rN.min()))}else VA(1===n);else this.wt(t)!==n&&(this.lt(t),this.it=this.it.add(t))}}_t(r){const i=new Map;this.et.forEach((e,t)=>{var n=this.dt(t);if(n){if(e.current&&BN(n.target)){const i=new IN(n.target.path);null!==this.nt.get(i)||this.gt(t,i)||this.at(t,i,FN.newNoDocument(i,r))}e.K&&(i.set(t,e.W()),e.G())}});let s=oP();this.st.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>!(e=this.dt(e))||2===e.purpose||(n=!1)),n&&(s=s.add(e))});var e=new cP(r,i,this.it,this.nt,s);return this.nt=nP,this.st=gP(),this.it=new eP(ZA),e}ot(e,t){var n;this.ht(e)&&(n=this.gt(e,t.key)?2:0,this.ut(e).H(t.key,n),this.nt=this.nt.insert(t.key,t),this.st=this.st.insert(t.key,this.yt(t.key).add(e)))}at(e,t,n){if(this.ht(e)){const r=this.ut(e);this.gt(e,t)?r.H(t,1):r.J(t),this.st=this.st.insert(t,this.yt(t).delete(e)),n&&(this.nt=this.nt.insert(t,n))}}removeTarget(e){this.et.delete(e)}wt(e){var t=this.ut(e).W();return this.tt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Y(e){this.ut(e).Y()}ut(e){let t=this.et.get(e);return t||(t=new pP,this.et.set(e,t)),t}yt(e){let t=this.st.get(e);return t||(t=new eP(ZA),this.st=this.st.insert(e,t)),t}ht(e){var t=null!==this.dt(e);return t||MA("WatchChangeAggregator","Detected inactive target",e),t}dt(e){var t=this.et.get(e);return t&&t.q?null:this.tt.Tt(e)}lt(t){this.et.set(t,new pP),this.tt.getRemoteKeysForTarget(t).forEach(e=>{this.at(t,e,null)})}gt(e,t){return this.tt.getRemoteKeysForTarget(e).has(t)}}function gP(){return new JR(IN.comparator)}function mP(){return new JR(IN.comparator)}const yP={asc:"ASCENDING",desc:"DESCENDING"},vP={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class _P{constructor(e,t){this.databaseId=e,this.D=t}}function wP(e,t){return e.D?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function bP(e,t){return e.D?t.toBase64():t.toUint8Array()}function IP(e){return VA(!!e),rN.fromTimestamp((e=fN(e),new nN(e.seconds,e.nanos)))}function TP(e,t){return new cN(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function EP(e){return VA(BP(e=cN.fromString(e))),e}function SP(e,t){return TP(e.databaseId,t.path)}function kP(e,t){const n=EP(t);if(n.get(1)!==e.databaseId.projectId)throw new KA(BA.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new KA(BA.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new IN(RP(n))}function CP(e,t){return TP(e.databaseId,t)}function AP(e){return 4===(e=EP(e)).length?cN.emptyPath():RP(e)}function NP(e){return new cN(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function RP(e){return VA(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function PP(e,t,n){return{name:SP(e,t),fields:n.value.mapValue.fields}}function xP(e,t,n){const r=kP(e,t.name),i=IP(t.updateTime),s=new MN({mapValue:{fields:t.fields}}),o=FN.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function OP(e,t){let n;if(t instanceof VR)n={update:PP(e,t.key,t.value)};else if(t instanceof WR)n={delete:SP(e,t.key)};else if(t instanceof BR)n={update:PP(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof HR))return jA();n={verify:SP(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof ER)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof SR)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof CR)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof NR)return{fieldPath:e.field.canonicalString(),increment:t.C};throw jA()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:wP(e,(t=r.updateTime).toTimestamp())}:void 0!==r.exists?{exists:r.exists}:jA()),n;var r}function DP(t,n){const e=n.currentDocument?void 0!==(s=n.currentDocument).updateTime?DR.updateTime(IP(s.updateTime)):void 0!==s.exists?DR.exists(s.exists):DR.none():DR.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)VA("REQUEST_TIME"===t.setToServerValue),n=new ER;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new SR(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new CR(e)}else"increment"in t?n=new NR(e,t.increment):jA();return t=uN.fromServerFormat(t.fieldPath),new xR(t,n)}(t,e)):[];if(n.update){n.update.name;var i=kP(t,n.update.name),s=new MN({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new hN(e.map(e=>uN.fromServerFormat(e)))}();return new BR(i,s,t,e,r)}return new VR(i,s,e,r)}if(n.delete){const r=kP(t,n.delete);return new WR(r,e)}if(n.verify){const r=kP(t,n.verify);return new HR(r,e)}return jA()}function LP(e,t){return{documents:[CP(e,t.path)]}}function MP(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=CP(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=CP(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length)return 1===(e=e.map(e=>function(e){if("=="===e.op){if(ON(e.value))return{unaryFilter:{field:jP(e.field),op:"IS_NAN"}};if(xN(e.value))return{unaryFilter:{field:jP(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ON(e.value))return{unaryFilter:{field:jP(e.field),op:"IS_NOT_NAN"}};if(xN(e.value))return{unaryFilter:{field:jP(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:jP(e.field),op:(t=e.op,vP[t]),value:e.value}};var t}(e))).length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(t.filters);return i&&(n.structuredQuery.where=i),(i=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:jP(e.field),direction:(e=e.dir,yP[e])}}(e))}(t.orderBy))&&(n.structuredQuery.orderBy=i),i=t.limit,null!==(i=e.D||_N(i)?i:{value:i})&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt=UP(t.startAt)),t.endAt&&(n.structuredQuery.endAt=UP(t.endAt)),n}function FP(e){let t=AP(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(0<r){VA(1===r);const u=n.from[0];u.allDescendants?i=u.collectionId:t=t.child(u.collectionId)}let s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=VP(e.unaryFilter.field);return KN.create(t,"==",{doubleValue:NaN});case"IS_NULL":return t=VP(e.unaryFilter.field),KN.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=VP(e.unaryFilter.field);return KN.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return n=VP(e.unaryFilter.field),KN.create(n,"!=",{nullValue:"NULL_VALUE"});default:return jA()}}(e)]:void 0!==e.fieldFilter?[(n=e,KN.create(VP(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return jA()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((e,t)=>e.concat(t)):jA():[];var n}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>function(e){return new eR(VP(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let a=null;n.limit&&(a=_N(e="object"==typeof(e=n.limit)?e.value:e)?null:e);let c=null;n.startAt&&(c=qP(n.startAt));let l=null;return n.endAt&&(l=qP(n.endAt)),iR(t,i,o,s,a,"F",c,l)}function UP(e){return{before:e.before,values:e.position}}function qP(e){var t=!!e.before,e=e.values||[];return new XN(e,t)}function jP(e){return{fieldPath:e.canonicalString()}}function VP(e){return uN.fromServerFormat(e.fieldPath)}function BP(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function KP(t){let i="";for(let e=0;e<t.length;e++)0<i.length&&(i=zP(i)),i=function(t){let n=i;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(t.get(e));return zP(i)}function zP(e){return e+""}function $P(n){const r=n.length;if(VA(2<=r),2===r)return VA(""===n.charAt(0)&&""===n.charAt(1)),cN.emptyPath();r;const i=[];let s="";for(let t=0;t<r;){const r=n.indexOf("",t);switch((r<0||r>o)&&jA(),n.charAt(r+1)){case"":const o=n.substring(t,r);let e;0===s.length?e=o:(s+=o,e=s,s=""),i.push(e);break;case"":s+=n.substring(t,r),s+="\0";break;case"":s+=n.substring(t,r+1);break;default:jA()}t=r+2}return new cN(i)}class WP{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class HP{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}HP.store="owner",HP.key="owner";class GP{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}GP.store="mutationQueues",GP.keyPath="userId";class QP{constructor(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}QP.store="mutations",QP.keyPath="batchId",QP.userMutationsIndex="userMutationsIndex",QP.userMutationsKeyPath=["userId","batchId"];class YP{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,KP(t)]}static key(e,t,n){return[e,KP(t),n]}}YP.store="documentMutations",YP.PLACEHOLDER=new YP;class JP{constructor(e,t){this.path=e,this.readTime=t}}class XP{constructor(e,t){this.path=e,this.version=t}}class ZP{constructor(e,t,n,r,i,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}ZP.store="remoteDocuments",ZP.readTimeIndex="readTimeIndex",ZP.readTimeIndexPath="readTime",ZP.collectionReadTimeIndex="collectionReadTimeIndex",ZP.collectionReadTimeIndexPath=["parentPath","readTime"];class ex{constructor(e){this.byteSize=e}}ex.store="remoteDocumentGlobal",ex.key="remoteDocumentGlobalKey";class tx{constructor(e,t,n,r,i,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}tx.store="targets",tx.keyPath="targetId",tx.queryTargetsIndexName="queryTargetsIndex",tx.queryTargetsKeyPath=["canonicalId","targetId"];class nx{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}nx.store="targetDocuments",nx.keyPath=["targetId","path"],nx.documentTargetsIndex="documentTargetsIndex",nx.documentTargetsKeyPath=["path","targetId"];class rx{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}rx.key="targetGlobalKey",rx.store="targetGlobal";class ix{constructor(e,t){this.collectionId=e,this.parent=t}}ix.store="collectionParents",ix.keyPath=["collectionId","parent"];class sx{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}sx.store="clientMetadata",sx.keyPath="clientId";class ox{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}ox.store="bundles",ox.keyPath="bundleId";class ax{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}ax.store="namedQueries",ax.keyPath="name";const cx=[GP.store,QP.store,YP.store,ZP.store,tx.store,HP.store,rx.store,nx.store,sx.store,ex.store,ix.store,ox.store,ax.store],lx="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ux{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class hx{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&jA(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new hx((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof hx?t:hx.resolve(t)}catch(e){return hx.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):hx.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):hx.reject(t)}static resolve(n){return new hx((e,t)=>{e(n)})}static reject(n){return new hx((e,t)=>{t(n)})}static waitFor(e){return new hx((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=hx.resolve(!1);for(const n of e)t=t.next(e=>e?hx.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}}class dx{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.Et=new zA,this.transaction.oncomplete=()=>{this.Et.resolve()},this.transaction.onabort=()=>{e.error?this.Et.reject(new gx(t,e.error)):this.Et.resolve()},this.transaction.onerror=e=>{e=wx(e.target.error),this.Et.reject(new gx(t,e))}}static open(e,t,n,r){try{return new dx(t,e.transaction(r,n))}catch(e){throw new gx(t,e)}}get It(){return this.Et.promise}abort(e){e&&this.Et.reject(e),this.aborted||(MA("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){return e=this.transaction.objectStore(e),new yx(e)}}class px{constructor(e,t,n){this.name=e,this.version=t,this.At=n,12.2===px.Rt(fd())&&FA("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return MA("SimpleDb","Removing database:",e),vx(window.indexedDB.deleteDatabase(e)).toPromise()}static bt(){if(!bd())return!1;if(px.Pt())return!0;const e=fd(),t=px.Rt(e),n=0<t&&t<10,r=px.vt(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static Pt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Vt)}static St(e,t){return e.store(t)}static Rt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static vt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Dt(i){return this.db||(MA("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{e=e.target.result,t(e)},r.onblocked=()=>{n(new gx(i,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{"VersionError"===(e=e.target.error).name?n(new KA(BA.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===e.name?n(new KA(BA.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+e)):n(new gx(i,e))},r.onupgradeneeded=e=>{MA("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.At.Ct(t,r.transaction,e.oldVersion,this.version).next(()=>{MA("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.Nt&&(this.db.onversionchange=e=>this.Nt(e)),this.db}xt(t){this.Nt=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.Dt(e);const t=dx.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).catch(e=>(t.abort(e),hx.reject(e))).toPromise();return s.catch(()=>{}),await t.It,s}catch(e){const t="FirebaseError"!==e.name&&s<3;if(MA("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class fx{constructor(e){this.kt=e,this.$t=!1,this.Ot=null}get isDone(){return this.$t}get Ft(){return this.Ot}set cursor(e){this.kt=e}done(){this.$t=!0}Mt(e){this.Ot=e}delete(){return vx(this.kt.delete())}}class gx extends KA{constructor(e,t){super(BA.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function mx(e){return"IndexedDbTransactionError"===e.name}class yx{constructor(e){this.store=e}put(e,t){return vx(void 0!==t?(MA("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(MA("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)))}add(e){return MA("SimpleDb","ADD",this.store.name,e,e),vx(this.store.add(e))}get(t){return vx(this.store.get(t)).next(e=>(MA("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return MA("SimpleDb","DELETE",this.store.name,e),vx(this.store.delete(e))}count(){return MA("SimpleDb","COUNT",this.store.name),vx(this.store.count())}Lt(e,t){const n=this.cursor(this.options(e,t)),r=[];return this.Bt(n,(e,t)=>{r.push(t)}).next(()=>r)}Ut(e,t){MA("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);return n.qt=!1,t=this.cursor(n),this.Bt(t,(e,t,n)=>n.delete())}Kt(e,t){let n;return t?n=e:(n={},t=e),e=this.cursor(n),this.Bt(e,t)}jt(r){const e=this.cursor({});return new hx((n,t)=>{e.onerror=e=>{e=wx(e.target.error),t(e)},e.onsuccess=e=>{const t=e.target.result;t?r(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}Bt(e,s){const o=[];return new hx((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new fx(t),r=s(t.primaryKey,t.value,n);if(r instanceof hx){const e=r.catch(e=>(n.done(),hx.reject(e)));o.push(e)}n.isDone?i():null===n.Ft?t.continue():t.continue(n.Ft)}else i()}}).next(()=>hx.waitFor(o))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.qt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function vx(e){return new hx((t,n)=>{e.onsuccess=e=>{e=e.target.result,t(e)},e.onerror=e=>{e=wx(e.target.error),n(e)}})}let _x=!1;function wx(e){const t=px.Rt(fd());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new KA("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return _x||(_x=!0,setTimeout(()=>{throw e},0)),e}}return e}class bx extends ux{constructor(e,t){super(),this.Qt=e,this.currentSequenceNumber=t}}function Ix(e,t){return px.St(e.Qt,t)}class Tx{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){var n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&FR(r,t,n[e])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&UR(t,e,this.localWriteTime);for(const n of this.mutations)n.key.isEqual(e.key)&&UR(n,e,this.localWriteTime)}applyToLocalDocumentSet(r){this.mutations.forEach(e=>{const t=r.get(e.key),n=t;this.applyToLocalView(n),t.isValidDocument()||n.convertToNoDocument(rN.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oP())}isEqual(e){return this.batchId===e.batchId&&eN(this.mutations,e.mutations,(e,t)=>qR(e,t))&&eN(this.baseMutations,e.baseMutations,(e,t)=>qR(e,t))}}class Ex{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){VA(e.mutations.length===n.length);let r=iP;var i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Ex(e,t,n,r)}}class Sx{constructor(e,t,n,r,i=rN.min(),s=rN.min(),o=dN.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new Sx(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Sx(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Sx(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class kx{constructor(e){this.Wt=e}}function Cx(e,t){if(t.document)return xP(e.Wt,t.document,!!t.hasCommittedMutations);if(t.noDocument){const e=IN.fromSegments(t.noDocument.path),n=xx(t.noDocument.readTime),r=FN.newNoDocument(e,n);return t.hasCommittedMutations?r.setHasCommittedMutations():r}if(t.unknownDocument){const e=IN.fromSegments(t.unknownDocument.path),i=xx(t.unknownDocument.version);return FN.newUnknownDocument(e,i)}return jA()}function Ax(e,t,n){var r=Nx(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){var s={name:SP(n=e.Wt,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:wP(n,e.version.toTimestamp())},o=t.hasCommittedMutations;return new ZP(null,null,s,o,r,i)}if(t.isNoDocument()){var s=t.key.path.toArray(),o=Px(t.version),a=t.hasCommittedMutations;return new ZP(null,new JP(s,o),null,a,r,i)}if(t.isUnknownDocument()){a=t.key.path.toArray(),t=Px(t.version);return new ZP(new XP(a,t),null,null,!0,r,i)}return jA()}function Nx(e){return[(e=e.toTimestamp()).seconds,e.nanoseconds]}function Rx(e){return e=new nN(e[0],e[1]),rN.fromTimestamp(e)}function Px(e){return e=e.toTimestamp(),new WP(e.seconds,e.nanoseconds)}function xx(e){return e=new nN(e.seconds,e.nanoseconds),rN.fromTimestamp(e)}function Ox(t,n){const r=(n.baseMutations||[]).map(e=>DP(t.Wt,e));for(let e=0;e<n.mutations.length-1;++e){const r=n.mutations[e];if(e+1<n.mutations.length&&void 0!==n.mutations[e+1].transform){const i=n.mutations[e+1];r.updateTransforms=i.transform.fieldTransforms,n.mutations.splice(e+1,1),++e}}const i=n.mutations.map(e=>DP(t.Wt,e)),e=nN.fromMillis(n.localWriteTimeMs);return new Tx(n.batchId,e,r,i)}function Dx(e){var t=xx(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?xx(e.lastLimboFreeSnapshotVersion):rN.min(),r=void 0!==e.query.documents?(VA(1===(r=e.query).documents.length),dR(sR(AP(r.documents[0])))):dR(FP(e.query));return new Sx(r,e.targetId,0,e.lastListenSequenceNumber,t,n,dN.fromBase64String(e.resumeToken))}function Lx(e,t){var n=Px(t.snapshotVersion),r=Px(t.lastLimboFreeSnapshotVersion),i=(BN(t.target)?LP:MP)(e.Wt,t.target),e=t.resumeToken.toBase64();return new tx(t.targetId,jN(t.target),n,e,t.sequenceNumber,r,i)}function Mx(e){var t=FP({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?pR(t,t.limit,"L"):t}class Fx{getBundleMetadata(e,t){return Ux(e).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:xx(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return Ux(e).put({bundleId:t.id,createTime:Px(IP(t.createTime)),version:t.version})}getNamedQuery(e,t){return qx(e).get(t).next(e=>{if(e)return{name:e.name,query:Mx(e.bundledQuery),readTime:xx(e.readTime)}})}saveNamedQuery(e,t){return qx(e).put({name:t.name,readTime:Px(IP(t.readTime)),bundledQuery:t.bundledQuery})}}function Ux(e){return Ix(e,ox.store)}function qx(e){return Ix(e,ax.store)}class jx{constructor(){this.Gt=new Vx}addToCollectionParentIndex(e,t){return this.Gt.add(t),hx.resolve()}getCollectionParents(e,t){return hx.resolve(this.Gt.getEntries(t))}}class Vx{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new eP(cN.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new eP(cN.comparator)).toArray()}}class Bx{constructor(){this.zt=new Vx}addToCollectionParentIndex(e,t){if(this.zt.has(t))return hx.resolve();var n=t.lastSegment(),r=t.popLast();return e.addOnCommittedListener(()=>{this.zt.add(t)}),r={collectionId:n,parent:KP(r)},Kx(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[tN(n),""],!1,!0);return Kx(e).Lt(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push($P(t.parent))}return r})}}function Kx(e){return Ix(e,ix.store)}const zx={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class $x{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new $x(e,$x.DEFAULT_COLLECTION_PERCENTILE,$x.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Wx(e,t,n){const r=e.store(QP.store),i=e.store(YP.store),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Kt({range:o},(e,t,n)=>(a++,n.delete()));s.push(c.next(()=>{VA(1===a)}));const l=[];for(const e of n.mutations){const r=YP.key(t,e.key.path,n.batchId);s.push(i.delete(r)),l.push(e.key)}return hx.waitFor(s).next(()=>l)}function Hx(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw jA();t=e.noDocument}return JSON.stringify(t).length}$x.DEFAULT_COLLECTION_PERCENTILE=10,$x.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,$x.DEFAULT=new $x(41943040,$x.DEFAULT_COLLECTION_PERCENTILE,$x.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),$x.DISABLED=new $x(-1,0,0);class Gx{constructor(e,t,n,r){this.userId=e,this.N=t,this.Ht=n,this.referenceDelegate=r,this.Jt={}}static Yt(e,t,n,r){return VA(""!==e.uid),e=e.isAuthenticated()?e.uid:"",new Gx(e,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Yx(e).Kt({index:QP.userMutationsIndex,range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(u,h,d,p){const f=Jx(u),g=Yx(u);return g.add({}).next(e=>{VA("number"==typeof e);const t=new Tx(e,h,d,p),n=(i=this.N,s=this.userId,a=(o=t).baseMutations.map(e=>OP(i.Wt,e)),c=o.mutations.map(e=>OP(i.Wt,e)),new QP(s,o.batchId,o.localWriteTime.toMillis(),a,c)),r=[];var i,s,o,a,c;let l=new eP((e,t)=>ZA(e.canonicalString(),t.canonicalString()));for(const u of p){const h=YP.key(this.userId,u.key.path,e);l=l.add(u.key.path.popLast()),r.push(g.put(n)),r.push(f.put(h,YP.PLACEHOLDER))}return l.forEach(e=>{r.push(this.Ht.addToCollectionParentIndex(u,e))}),u.addOnCommittedListener(()=>{this.Jt[e]=t.keys()}),hx.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return Yx(e).get(t).next(e=>e?(VA(e.userId===this.userId),Ox(this.N,e)):null)}Xt(e,t){return this.Jt[t]?hx.resolve(this.Jt[t]):this.lookupMutationBatch(e,t).next(e=>e?(e=e.keys(),this.Jt[t]=e):null)}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Yx(e).Kt({index:QP.userMutationsIndex,range:n},(e,t,n)=>{t.userId===this.userId&&(VA(t.batchId>=r),i=Ox(this.N,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Yx(e).Kt({index:QP.userMutationsIndex,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Yx(e).Lt(QP.userMutationsIndex,t).next(e=>e.map(e=>Ox(this.N,e)))}getAllMutationBatchesAffectingDocumentKey(s,o){const e=YP.prefixForPath(this.userId,o.path),t=IDBKeyRange.lowerBound(e),a=[];return Jx(s).Kt({range:t},(e,t,n)=>{var[r,i,e]=e,i=$P(i);if(r===this.userId&&o.path.isEqual(i))return Yx(s).get(e).next(e=>{if(!e)throw jA();VA(e.userId===this.userId),a.push(Ox(this.N,e))});n.done()}).next(()=>a)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new eP(ZA);const n=[];return e.forEach(s=>{var e=YP.prefixForPath(this.userId,s.path),e=IDBKeyRange.lowerBound(e),e=Jx(t).Kt({range:e},(e,t,n)=>{var[r,i,e]=e,i=$P(i);r===this.userId&&s.path.isEqual(i)?o=o.add(e):n.done()});n.push(e)}),hx.waitFor(n).next(()=>this.Zt(t,o))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,o=s.length+1,n=YP.prefixForPath(this.userId,s),r=IDBKeyRange.lowerBound(n);let a=new eP(ZA);return Jx(e).Kt({range:r},(e,t,n)=>{var[r,i,e]=e,i=$P(i);r===this.userId&&s.isPrefixOf(i)?i.length===o&&(a=a.add(e)):n.done()}).next(()=>this.Zt(e,a))}Zt(t,e){const n=[],r=[];return e.forEach(e=>{r.push(Yx(t).get(e).next(e=>{if(null===e)throw jA();VA(e.userId===this.userId),n.push(Ox(this.N,e))}))}),hx.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return Wx(t.Qt,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.te(n.batchId)}),hx.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}te(e){delete this.Jt[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return hx.resolve();const t=IDBKeyRange.lowerBound(YP.prefixForUser(this.userId)),r=[];return Jx(n).Kt({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=$P(e[1]);r.push(t)}else n.done()}).next(()=>{VA(0===r.length)})})}containsKey(e,t){return Qx(e,this.userId,t)}ee(e){return Xx(e).get(this.userId).next(e=>e||new GP(this.userId,-1,""))}}function Qx(e,i,t){const n=YP.prefixForPath(i,t.path),s=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return Jx(e).Kt({range:r,qt:!0},(e,t,n)=>{var[r,e]=e;r===i&&e===s&&(o=!0),n.done()}).next(()=>o)}function Yx(e){return Ix(e,QP.store)}function Jx(e){return Ix(e,YP.store)}function Xx(e){return Ix(e,GP.store)}class Zx{constructor(e){this.ne=e}next(){return this.ne+=2,this.ne}static se(){return new Zx(0)}static ie(){return new Zx(-1)}}class eO{constructor(e,t){this.referenceDelegate=e,this.N=t}allocateTargetId(n){return this.re(n).next(e=>{const t=new Zx(e.highestTargetId);return e.highestTargetId=t.next(),this.oe(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.re(e).next(e=>rN.fromTimestamp(new nN(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.re(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.re(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.oe(t,e)))}addTargetData(t,n){return this.ae(t,n).next(()=>this.re(t).next(e=>(e.targetCount+=1,this.ce(n,e),this.oe(t,e))))}updateTargetData(e,t){return this.ae(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>tO(t).delete(e.targetId)).next(()=>this.re(t)).next(e=>(VA(0<e.targetCount),--e.targetCount,this.oe(t,e)))}removeTargets(n,r,i){let s=0;const o=[];return tO(n).Kt((e,t)=>{(t=Dx(t)).sequenceNumber<=r&&null===i.get(t.targetId)&&(s++,o.push(this.removeTargetData(n,t)))}).next(()=>hx.waitFor(o)).next(()=>s)}forEachTarget(e,n){return tO(e).Kt((e,t)=>{t=Dx(t),n(t)})}re(e){return nO(e).get(rx.key).next(e=>(VA(null!==e),e))}oe(e,t){return nO(e).put(rx.key,t)}ae(e,t){return tO(e).put(Lx(this.N,t))}ce(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.re(e).next(e=>e.targetCount)}getTargetData(e,r){var t=jN(r),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let i=null;return tO(e).Kt({range:t,index:tx.queryTargetsIndexName},(e,t,n)=>{t=Dx(t),VN(r,t.target)&&(i=t,n.done())}).next(()=>i)}addMatchingKeys(n,e,r){const i=[],s=rO(n);return e.forEach(e=>{var t=KP(e.path);i.push(s.put(new nx(r,t))),i.push(this.referenceDelegate.addReference(n,r,e))}),hx.waitFor(i)}removeMatchingKeys(n,e,r){const i=rO(n);return hx.forEach(e,e=>{var t=KP(e.path);return hx.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=rO(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=rO(e);let i=oP();return r.Kt({range:n,qt:!0},(e,t,n)=>{e=$P(e[1]),e=new IN(e),i=i.add(e)}).next(()=>i)}containsKey(e,t){t=KP(t.path),t=IDBKeyRange.bound([t],[tN(t)],!1,!0);let r=0;return rO(e).Kt({index:nx.documentTargetsIndex,qt:!0,range:t},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}Tt(e,t){return tO(e).get(t).next(e=>e?Dx(e):null)}}function tO(e){return Ix(e,tx.store)}function nO(e){return Ix(e,rx.store)}function rO(e){return Ix(e,nx.store)}async function iO(e){if(e.code!==BA.FAILED_PRECONDITION||e.message!==lx)throw e;MA("LocalStore","Unexpectedly lost primary lease")}function sO([e,t],[n,r]){return 0===(n=ZA(e,n))?ZA(t,r):n}class oO{constructor(e){this.ue=e,this.buffer=new eP(sO),this.he=0}le(){return++this.he}fe(e){var t;e=[e,this.le()],this.buffer.size<this.ue?this.buffer=this.buffer.add(e):sO(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))}get maxValue(){return this.buffer.last()[0]}}class aO{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.de=!1,this.we=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this._e(e)}stop(){this.we&&(this.we.cancel(),this.we=null)}get started(){return null!==this.we}_e(e){var t=this.de?3e5:6e4;MA("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.we=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.we=null,this.de=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){mx(e)?MA("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await iO(e)}await this._e(e)})}}class cO{constructor(e,t){this.me=e,this.params=t}calculateTargetCount(e,t){return this.me.ge(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return hx.resolve(JA.T);const n=new oO(t);return this.me.forEachTarget(e,e=>n.fe(e.sequenceNumber)).next(()=>this.me.ye(e,e=>n.fe(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.me.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.me.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(MA("LruGarbageCollector","Garbage collection skipped; disabled"),hx.resolve(zx)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(MA("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),zx):this.pe(t,n))}getCacheSize(e){return this.me.getCacheSize(e)}pe(t,n){let r,i,s,o,a,c,l;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(MA("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,o=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,a=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(l=Date.now(),LA()<=sp.DEBUG&&MA("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-u}ms\n\tDetermined least recently used ${i} in `+(a-o)+"ms\n"+`\tRemoved ${s} targets in `+(c-a)+"ms\n"+`\tRemoved ${e} documents in `+(l-c)+"ms\n"+`Total Duration: ${l-u}ms`),hx.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class lO{constructor(e,t){this.db=e,this.garbageCollector=(e=this,new cO(e,t))}ge(e){const n=this.Te(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Te(e){let t=0;return this.ye(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}ye(e,n){return this.Ee(e,(e,t)=>n(t))}addReference(e,t,n){return uO(e,n)}removeReference(e,t,n){return uO(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return uO(e,t)}Ie(t,n){let r=!1;return Xx(t).jt(e=>Qx(t,e,n).next(e=>(e&&(r=!0),hx.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let o=0;return this.Ee(n,(t,e)=>{if(e<=r){const r=this.Ie(n,t).next(e=>{if(!e)return o++,i.getEntry(n,t).next(()=>(i.removeEntry(t),rO(n).delete([0,KP(t.path)])))});s.push(r)}}).next(()=>hx.waitFor(s)).next(()=>i.apply(n)).next(()=>o)}removeTarget(e,t){return t=t.withSequenceNumber(e.currentSequenceNumber),this.db.getTargetCache().updateTargetData(e,t)}updateLimboDocument(e,t){return uO(e,t)}Ee(e,r){const t=rO(e);let i,s=JA.T;return t.Kt({index:nx.documentTargetsIndex},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==JA.T&&r(new IN($P(i)),s),s=n,i=t):s=JA.T}).next(()=>{s!==JA.T&&r(new IN($P(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function uO(e,t){return rO(e).put((e=e.currentSequenceNumber,new nx(0,KP(t.path),e)))}class hO{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(t,n){const e=this.mapKeyFn(t),r=this.inner[e];if(void 0!==r){for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return void(r[e]=[t,n]);r.push([t,n])}else this.inner[e]=[[t,n]]}delete(t){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return!1;for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return 1===r.length?delete this.inner[n]:r.splice(e,1),!0;return!1}forEach(r){sN(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return oN(this.inner)}}class dO{constructor(){this.changes=new hO(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){return(e=this.changes.get(e))?e.readTime:rN.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:FN.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?hx.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class pO{constructor(e,t){this.N=e,this.Ht=t}addEntry(e,t,n){return mO(e).put(yO(t),n)}removeEntry(e,t){const n=mO(e),r=yO(t);return n.delete(r)}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.Ae(t,e)))}getEntry(e,t){return mO(e).get(yO(t)).next(e=>this.Re(t,e))}be(e,t){return mO(e).get(yO(t)).next(e=>({document:this.Re(t,e),size:Hx(e)}))}getEntries(e,t){let n=nP;return this.Pe(e,t,(e,t)=>{t=this.Re(e,t),n=n.insert(e,t)}).next(()=>n)}ve(e,t){let r=nP,i=new JR(IN.comparator);return this.Pe(e,t,(e,t)=>{var n=this.Re(e,t);r=r.insert(e,n),i=i.insert(e,Hx(t))}).next(()=>({documents:r,Ve:i}))}Pe(e,t,i){if(t.isEmpty())return hx.resolve();const n=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),s=t.getIterator();let o=s.getNext();return mO(e).Kt({range:n},(e,t,n)=>{for(var r=IN.fromSegments(e);o&&IN.comparator(o,r)<0;)i(o,null),o=s.getNext();o&&o.isEqual(r)&&(i(o,t),o=s.hasNext()?s.getNext():null),o?n.Mt(o.path.toArray()):n.done()}).next(()=>{for(;o;)i(o,null),o=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,r,t){let i=nP;const s=r.path.length+1,n={};if(t.isEqual(rN.min())){const e=r.path.toArray();n.range=IDBKeyRange.lowerBound(e)}else{const e=r.path.toArray(),i=Nx(t);n.range=IDBKeyRange.lowerBound([e,i],!0),n.index=ZP.collectionReadTimeIndex}return mO(e).Kt(n,(e,t,n)=>{e.length===s&&(t=Cx(this.N,t),r.path.isPrefixOf(t.key.path)?yR(r,t)&&(i=i.insert(t.key,t)):n.done())}).next(()=>i)}newChangeBuffer(e){return new fO(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return gO(e).get(ex.key).next(e=>(VA(!!e),e))}Ae(e,t){return gO(e).put(ex.key,t)}Re(e,t){if(t){const e=Cx(this.N,t);if(!e.isNoDocument()||!e.version.isEqual(rN.min()))return e}return FN.newInvalidDocument(e)}}class fO extends dO{constructor(e,t){super(),this.Se=e,this.trackRemovals=t,this.De=new hO(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(i){const s=[];let o=0,a=new eP((e,t)=>ZA(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.De.get(e);if(t.document.isValidDocument()){var r=Ax(this.Se.N,t.document,this.getReadTime(e));a=a.add(e.path.popLast()),t=Hx(r),o+=t-n,s.push(this.Se.addEntry(i,e,r))}else if(o-=n,this.trackRemovals){const o=Ax(this.Se.N,FN.newNoDocument(e,rN.min()),this.getReadTime(e));s.push(this.Se.addEntry(i,e,o))}else s.push(this.Se.removeEntry(i,e))}),a.forEach(e=>{s.push(this.Se.Ht.addToCollectionParentIndex(i,e))}),s.push(this.Se.updateMetadata(i,o)),hx.waitFor(s)}getFromCache(e,t){return this.Se.be(e,t).next(e=>(this.De.set(t,e.size),e.document))}getAllFromCache(e,t){return this.Se.ve(e,t).next(({documents:e,Ve:t})=>(t.forEach((e,t)=>{this.De.set(e,t)}),e))}}function gO(e){return Ix(e,ex.store)}function mO(e){return Ix(e,ZP.store)}function yO(e){return e.path.toArray()}class vO{constructor(e){this.N=e}Ct(t,n,e,r){VA(e<r&&0<=e&&r<=11);const i=new dx("createOrUpgrade",n);var s;e<1&&1<=r&&(t.createObjectStore(HP.store),(s=t).createObjectStore(GP.store,{keyPath:GP.keyPath}),s.createObjectStore(QP.store,{keyPath:QP.keyPath,autoIncrement:!0}).createIndex(QP.userMutationsIndex,QP.userMutationsKeyPath,{unique:!0}),s.createObjectStore(YP.store),_O(t),t.createObjectStore(ZP.store));let o=hx.resolve();return e<3&&3<=r&&(0!==e&&((s=t).deleteObjectStore(nx.store),s.deleteObjectStore(tx.store),s.deleteObjectStore(rx.store),_O(t)),o=o.next(()=>function(){const e=i.store(rx.store),t=new rx(0,0,rN.min().toTimestamp(),0);return e.put(rx.key,t)}())),e<4&&4<=r&&(0!==e&&(o=o.next(()=>function(r,i){return i.store(QP.store).Lt().next(e=>{r.deleteObjectStore(QP.store),r.createObjectStore(QP.store,{keyPath:QP.keyPath,autoIncrement:!0}).createIndex(QP.userMutationsIndex,QP.userMutationsKeyPath,{unique:!0});const t=i.store(QP.store),n=e.map(e=>t.put(e));return hx.waitFor(n)})}(t,i))),o=o.next(()=>{t.createObjectStore(sx.store,{keyPath:sx.keyPath})})),e<5&&5<=r&&(o=o.next(()=>this.Ce(i))),e<6&&6<=r&&(o=o.next(()=>(t.createObjectStore(ex.store),this.Ne(i)))),e<7&&7<=r&&(o=o.next(()=>this.xe(i))),e<8&&8<=r&&(o=o.next(()=>this.ke(t,i))),e<9&&9<=r&&(o=o.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),function(){const e=n.objectStore(ZP.store);e.createIndex(ZP.readTimeIndex,ZP.readTimeIndexPath,{unique:!1}),e.createIndex(ZP.collectionReadTimeIndex,ZP.collectionReadTimeIndexPath,{unique:!1})}()})),e<10&&10<=r&&(o=o.next(()=>this.$e(i))),e<11&&11<=r&&(o=o.next(()=>{t.createObjectStore(ox.store,{keyPath:ox.keyPath}),t.createObjectStore(ax.store,{keyPath:ax.keyPath})})),o}Ne(t){let n=0;return t.store(ZP.store).Kt((e,t)=>{n+=Hx(t)}).next(()=>{var e=new ex(n);return t.store(ex.store).put(ex.key,e)})}Ce(n){const e=n.store(GP.store),r=n.store(QP.store);return e.Lt().next(e=>hx.forEach(e,t=>{var e=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.Lt(QP.userMutationsIndex,e).next(e=>hx.forEach(e,e=>(VA(e.userId===t.userId),e=Ox(this.N,e),Wx(n,t.userId,e).next(()=>{}))))}))}xe(e){const o=e.store(nx.store),t=e.store(ZP.store);return e.store(rx.store).get(rx.key).next(i=>{const s=[];return t.Kt((e,t)=>{const n=new cN(e),r=[0,KP(n)];s.push(o.get(r).next(e=>e?hx.resolve():(e=>o.put(new nx(0,KP(e),i.highestListenSequenceNumber)))(n)))}).next(()=>hx.waitFor(s))})}ke(e,t){e.createObjectStore(ix.store,{keyPath:ix.keyPath});const n=t.store(ix.store),r=new Vx,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:KP(r)})}};return t.store(ZP.store).Kt({qt:!0},(e,t)=>{const n=new cN(e);return i(n.popLast())}).next(()=>t.store(YP.store).Kt({qt:!0},([,e],t)=>{const n=$P(e);return i(n.popLast())}))}$e(e){const n=e.store(tx.store);return n.Kt((e,t)=>(t=Dx(t),t=Lx(this.N,t),n.put(t)))}}function _O(e){e.createObjectStore(nx.store,{keyPath:nx.keyPath}).createIndex(nx.documentTargetsIndex,nx.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(tx.store,{keyPath:tx.keyPath}).createIndex(tx.queryTargetsIndexName,tx.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(rx.store)}const wO="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class bO{constructor(e,t,n,r,i,s,o,a,c,l){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Oe=i,this.window=s,this.document=o,this.Fe=c,this.Me=l,this.Le=null,this.Be=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ue=null,this.inForeground=!1,this.qe=null,this.Ke=null,this.je=Number.NEGATIVE_INFINITY,this.Qe=e=>Promise.resolve(),!bO.bt())throw new KA(BA.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new lO(this,r),this.We=t+"main",this.N=new kx(a),this.Ge=new px(this.We,11,new vO(this.N)),this.ze=new eO(this.referenceDelegate,this.N),this.Ht=new Bx,this.He=(t=this.N,a=this.Ht,new pO(t,a)),this.Je=new Fx,this.window&&this.window.localStorage?this.Ye=this.window.localStorage:(this.Ye=null,!1===l&&FA("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Xe().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new KA(BA.FAILED_PRECONDITION,wO);return this.Ze(),this.tn(),this.en(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.ze.getHighestSequenceNumber(e))}).then(e=>{this.Le=new JA(e,this.Fe)}).then(()=>{this.Be=!0}).catch(e=>(this.Ge&&this.Ge.close(),Promise.reject(e)))}nn(t){return this.Qe=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ge.xt(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget(async()=>{this.started&&await this.Xe()}))}Xe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>TO(t).put(new sx(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.sn(t).next(e=>{e||(this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)))})}).next(()=>this.rn(t)).next(e=>this.isPrimary&&!e?this.on(t).next(()=>!1):!!e&&this.an(t).next(()=>!0))).catch(e=>{if(mx(e))return MA("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return MA("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Oe.enqueueRetryable(()=>this.Qe(e)),this.isPrimary=e})}sn(e){return IO(e).get(HP.key).next(e=>hx.resolve(this.cn(e)))}un(e){return TO(e).delete(this.clientId)}async hn(){if(this.isPrimary&&!this.ln(this.je,18e5)){this.je=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=Ix(e,sx.store);return r.Lt().next(e=>{const t=this.fn(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return hx.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ye)for(const t of e)this.Ye.removeItem(this.dn(t.clientId))}}en(){this.Ke=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Xe().then(()=>this.hn()).then(()=>this.en()))}cn(e){return!!e&&e.ownerId===this.clientId}rn(t){return this.Me?hx.resolve(!0):IO(t).get(HP.key).next(e=>{if(null!==e&&this.ln(e.leaseTimestampMs,5e3)&&!this.wn(e.ownerId)){if(this.cn(e)&&this.networkEnabled)return!0;if(!this.cn(e)){if(!e.allowTabSynchronization)throw new KA(BA.FAILED_PRECONDITION,wO);return!1}}return!(!this.networkEnabled||!this.inForeground)||TO(t).Lt().next(e=>void 0===this.fn(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,e=this.networkEnabled===e.networkEnabled;if(t||n&&e)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&MA("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Be=!1,this._n(),this.Ke&&(this.Ke.cancel(),this.Ke=null),this.mn(),this.gn(),await this.Ge.runTransaction("shutdown","readwrite",[HP.store,sx.store],e=>{const t=new bx(e,JA.T);return this.on(t).next(()=>this.un(t))}),this.Ge.close(),this.yn()}fn(e,t){return e.filter(e=>this.ln(e.updateTimeMs,t)&&!this.wn(e.clientId))}pn(){return this.runTransaction("getActiveClients","readonly",e=>TO(e).Lt().next(e=>this.fn(e,18e5).map(e=>e.clientId)))}get started(){return this.Be}getMutationQueue(e){return Gx.Yt(e,this.N,this.Ht,this.referenceDelegate)}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getIndexManager(){return this.Ht}getBundleCache(){return this.Je}runTransaction(t,n,r){MA("IndexedDbPersistence","Starting transaction:",t);let i;return this.Ge.runTransaction(t,"readonly"===n?"readonly":"readwrite",cx,e=>(i=new bx(e,this.Le?this.Le.next():JA.T),"readwrite-primary"===n?this.sn(i).next(e=>!!e||this.rn(i)).next(e=>{if(!e)throw FA(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)),new KA(BA.FAILED_PRECONDITION,lx);return r(i)}).next(e=>this.an(i).next(()=>e)):this.Tn(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Tn(e){return IO(e).get(HP.key).next(e=>{if(null!==e&&this.ln(e.leaseTimestampMs,5e3)&&!this.wn(e.ownerId)&&!this.cn(e)&&!(this.Me||this.allowTabSynchronization&&e.allowTabSynchronization))throw new KA(BA.FAILED_PRECONDITION,wO)})}an(e){var t=new HP(this.clientId,this.allowTabSynchronization,Date.now());return IO(e).put(HP.key,t)}static bt(){return px.bt()}on(e){const t=IO(e);return t.get(HP.key).next(e=>this.cn(e)?(MA("IndexedDbPersistence","Releasing primary lease."),t.delete(HP.key)):hx.resolve())}ln(e,t){var n=Date.now();return!(e<n-t||n<e&&(FA(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ze(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=()=>{this.Oe.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Xe()))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)}mn(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)}tn(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ue=()=>{this._n(),!md()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match("Version/14")&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ue))}gn(){this.Ue&&(this.window.removeEventListener("pagehide",this.Ue),this.Ue=null)}wn(e){var t;try{var n=null!==(null===(t=this.Ye)||void 0===t?void 0:t.getItem(this.dn(e)));return MA("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return FA("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}_n(){if(this.Ye)try{this.Ye.setItem(this.dn(this.clientId),String(Date.now()))}catch(e){FA("Failed to set zombie client id.",e)}}yn(){if(this.Ye)try{this.Ye.removeItem(this.dn(this.clientId))}catch(e){}}dn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function IO(e){return Ix(e,HP.store)}function TO(e){return Ix(e,sx.store)}function EO(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class SO{constructor(e,t){this.progress=e,this.En=t}}class kO{constructor(e,t,n){this.He=e,this.In=t,this.Ht=n}An(t,n){return this.In.getAllMutationBatchesAffectingDocumentKey(t,n).next(e=>this.Rn(t,n,e))}Rn(e,t,n){return this.He.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}bn(e,n){e.forEach((e,t)=>{for(const e of n)e.applyToLocalView(t)})}Pn(t,e){return this.He.getEntries(t,e).next(e=>this.vn(t,e).next(()=>e))}vn(e,t){return this.In.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.bn(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,IN.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Vn(e,t.path):uR(t)?this.Sn(e,t,n):this.Dn(e,t,n);var r}Vn(e,t){return this.An(e,new IN(t)).next(e=>{let t=rP;return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Sn(n,r,i){const s=r.collectionGroup;let o=rP;return this.Ht.getCollectionParents(n,s).next(e=>hx.forEach(e,e=>{var t=(t=r,e=e.child(s),new rR(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.Dn(n,t,i).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}Dn(t,n,e){let i,s;return this.He.getDocumentsMatchingQuery(t,n,e).next(e=>(i=e,this.In.getAllMutationBatchesAffectingQuery(t,n))).next(e=>(s=e,this.Cn(t,s,i).next(t=>{i=t;for(const t of s)for(const r of t.mutations){var n=r.key;let e=i.get(n);null==e&&(e=FN.newInvalidDocument(n),i=i.insert(n,e)),UR(r,e,t.localWriteTime),e.isFoundDocument()||(i=i.remove(n))}}))).next(()=>(i.forEach((e,t)=>{yR(n,t)||(i=i.remove(e))}),i))}Cn(e,t,n){let r=oP();for(const e of t)for(const t of e.mutations)t instanceof BR&&null===n.get(t.key)&&(r=r.add(t.key));let i=n;return this.He.getEntries(e,r).next(e=>(e.forEach((e,t)=>{t.isFoundDocument()&&(i=i.insert(e,t))}),i))}}class CO{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Nn=n,this.xn=r}static kn(e,t){let n=oP(),r=oP();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new CO(e,t.fromCache,n,r)}}class AO{$n(e){this.On=e}getDocumentsMatchingQuery(t,r,i,s){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(rN.min())?this.Fn(t,r):this.On.Pn(t,s).next(e=>{const n=this.Mn(r,e);return(oR(r)||aR(r))&&this.Ln(r.limitType,n,s,i)?this.Fn(t,r):(LA()<=sp.DEBUG&&MA("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),mR(r)),this.On.getDocumentsMatchingQuery(t,r,i).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t)))})}Mn(n,e){let r=new eP(vR(n));return e.forEach((e,t)=>{yR(n,t)&&(r=r.add(t))}),r}Ln(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Fn(e,t){return LA()<=sp.DEBUG&&MA("QueryEngine","Using full collection scan to execute query:",mR(t)),this.On.getDocumentsMatchingQuery(e,t,rN.min())}}class NO{constructor(e,t,n,r){this.persistence=e,this.Bn=t,this.N=r,this.Un=new JR(ZA),this.qn=new hO(e=>jN(e),VN),this.Kn=rN.min(),this.In=e.getMutationQueue(n),this.jn=e.getRemoteDocumentCache(),this.ze=e.getTargetCache(),this.Qn=new kO(this.jn,this.In,this.persistence.getIndexManager()),this.Je=e.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Un))}}function RO(e,t,n,r){return new NO(e,t,n,r)}async function PO(e,t){const n=e;let r=n.In,o=n.Qn;return e=await n.persistence.runTransaction("Handle user change","readonly",i=>{let s;return n.In.getAllMutationBatches(i).next(e=>(s=e,r=n.persistence.getMutationQueue(t),o=new kO(n.jn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=oP();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return o.Pn(i,r).next(e=>({Wn:e,removedBatchIds:t,addedBatchIds:n}))})}),n.In=r,n.Qn=o,n.Bn.$n(n.Qn),e}function xO(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.ze.getLastRemoteSnapshotVersion(e))}function OO(e,o,t,a,c){let n=oP();return t.forEach(e=>n=n.add(e)),o.getEntries(e,n).next(i=>{let s=nP;return t.forEach((e,t)=>{const n=i.get(e),r=(null==c?void 0:c.get(e))||a;t.isNoDocument()&&t.version.isEqual(rN.min())?(o.removeEntry(e,r),s=s.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(o.addEntry(t,r),s=s.insert(e,t)):MA("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),s})}function DO(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.ze.getTargetData(t,r).next(e=>e?(n=e,hx.resolve(n)):i.ze.allocateTargetId(t).next(e=>(n=new Sx(r,e,0,t.currentSequenceNumber),i.ze.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.Un.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.Un=i.Un.insert(e.targetId,e),i.qn.set(r,e.targetId)),e})}async function LO(e,t,n){const r=e,i=r.Un.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!mx(e))throw e;MA("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Un=r.Un.remove(t),r.qn.delete(i.target)}function MO(e,n,r){const i=e;let s=rN.min(),o=oP();return i.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,i=r.qn.get(n);return void 0!==i?hx.resolve(r.Un.get(i)):r.ze.getTargetData(t,n)}(i,t,dR(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.ze.getMatchingKeysForTargetId(t,e.targetId).next(e=>{o=e})}).next(()=>i.Bn.getDocumentsMatchingQuery(t,n,r?s:rN.min(),r?o:oP())).next(e=>({documents:e,Gn:o})))}function FO(e,t){const n=e,r=n.ze,i=n.Un.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.Tt(e,t).next(e=>e?e.target:null))}function UO(e){const n=e;return n.persistence.runTransaction("Get new document changes","readonly",e=>function(e,t,n){const r=e;let i=nP,s=Nx(n);const o=mO(t),a=IDBKeyRange.lowerBound(s,!0);return o.Kt({index:ZP.readTimeIndex,range:a},(e,t)=>{var n=Cx(r.N,t);i=i.insert(n.key,n),s=t.readTime}).next(()=>({En:i,readTime:Rx(s)}))}(n.jn,e,n.Kn)).then(({En:e,readTime:t})=>(n.Kn=t,e))}class qO{constructor(e){this.N=e,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(e,t){return hx.resolve(this.Yn.get(t))}saveBundleMetadata(e,t){return this.Yn.set(t.id,{id:t.id,version:t.version,createTime:IP(t.createTime)}),hx.resolve()}getNamedQuery(e,t){return hx.resolve(this.Xn.get(t))}saveNamedQuery(e,t){return this.Xn.set(t.name,{name:t.name,query:Mx(t.bundledQuery),readTime:IP(t.readTime)}),hx.resolve()}}class jO{constructor(){this.Zn=new eP(VO.ts),this.es=new eP(VO.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,t){t=new VO(e,t),this.Zn=this.Zn.add(t),this.es=this.es.add(t)}ss(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.rs(new VO(e,t))}os(e,t){e.forEach(e=>this.removeReference(e,t))}cs(e){const t=new IN(new cN([])),n=new VO(t,e),r=new VO(t,e+1),i=[];return this.es.forEachInRange([n,r],e=>{this.rs(e),i.push(e.key)}),i}us(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){var t=new IN(new cN([])),n=new VO(t,e),e=new VO(t,e+1);let r=oP();return this.es.forEachInRange([n,e],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new VO(e,0);return null!==(t=this.Zn.firstAfterOrEqual(t))&&e.isEqual(t.key)}}class VO{constructor(e,t){this.key=e,this.ls=t}static ts(e,t){return IN.comparator(e.key,t.key)||ZA(e.ls,t.ls)}static ns(e,t){return ZA(e.ls,t.ls)||IN.comparator(e.key,t.key)}}class BO{constructor(e,t){this.Ht=e,this.referenceDelegate=t,this.In=[],this.fs=1,this.ds=new eP(VO.ts)}checkEmpty(e){return hx.resolve(0===this.In.length)}addMutationBatch(e,t,n,r){var i=this.fs;this.fs++,0<this.In.length&&this.In[this.In.length-1],n=new Tx(i,t,n,r),this.In.push(n);for(const t of r)this.ds=this.ds.add(new VO(t.key,i)),this.Ht.addToCollectionParentIndex(e,t.key.path.popLast());return hx.resolve(n)}lookupMutationBatch(e,t){return hx.resolve(this.ws(t))}getNextMutationBatchAfterBatchId(e,t){return t=(t=this._s(t+1))<0?0:t,hx.resolve(this.In.length>t?this.In[t]:null)}getHighestUnacknowledgedBatchId(){return hx.resolve(0===this.In.length?-1:this.fs-1)}getAllMutationBatches(e){return hx.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new VO(t,0),r=new VO(t,Number.POSITIVE_INFINITY),i=[];return this.ds.forEachInRange([n,r],e=>{e=this.ws(e.ls),i.push(e)}),hx.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new eP(ZA);return t.forEach(e=>{var t=new VO(e,0),e=new VO(e,Number.POSITIVE_INFINITY);this.ds.forEachInRange([t,e],e=>{n=n.add(e.ls)})}),hx.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;IN.isDocumentKey(i)||(i=i.child("")),t=new VO(new IN(i),0);let s=new eP(ZA);return this.ds.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(s=s.add(e.ls)),!0)},t),hx.resolve(this.gs(s))}gs(e){const t=[];return e.forEach(e=>{null!==(e=this.ws(e))&&t.push(e)}),t}removeMutationBatch(n,r){VA(0===this.ys(r.batchId,"removed")),this.In.shift();let i=this.ds;return hx.forEach(r.mutations,e=>{var t=new VO(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.ds=i})}te(e){}containsKey(e,t){var n=new VO(t,0),n=this.ds.firstAfterOrEqual(n);return hx.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.In.length,hx.resolve()}ys(e,t){return this._s(e)}_s(e){return 0===this.In.length?0:e-this.In[0].batchId}ws(e){return(e=this._s(e))<0||e>=this.In.length?null:this.In[e]}}class KO{constructor(e,t){this.Ht=e,this.ps=t,this.docs=new JR(IN.comparator),this.size=0}addEntry(e,t,n){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ps(t);return this.docs=this.docs.insert(r,{document:t.clone(),size:o,readTime:n}),this.size+=o-s,this.Ht.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return hx.resolve(n?n.document.clone():FN.newInvalidDocument(t))}getEntries(e,t){let n=nP;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.clone():FN.newInvalidDocument(e))}),hx.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=nP;const i=new IN(t.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i,readTime:o}}=s.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||yR(t,i)&&(r=r.insert(i.key,i.clone()))}return hx.resolve(r)}Ts(e,t){return hx.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new zO(this)}getSize(e){return hx.resolve(this.size)}}class zO extends dO{constructor(e){super(),this.Se=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.document.isValidDocument()?r.push(this.Se.addEntry(n,t.document,this.getReadTime(e))):this.Se.removeEntry(e)}),hx.waitFor(r)}getFromCache(e,t){return this.Se.getEntry(e,t)}getAllFromCache(e,t){return this.Se.getEntries(e,t)}}class $O{constructor(e){this.persistence=e,this.Es=new hO(e=>jN(e),VN),this.lastRemoteSnapshotVersion=rN.min(),this.highestTargetId=0,this.Is=0,this.As=new jO,this.targetCount=0,this.Rs=Zx.se()}forEachTarget(e,n){return this.Es.forEach((e,t)=>n(t)),hx.resolve()}getLastRemoteSnapshotVersion(e){return hx.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return hx.resolve(this.Is)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),hx.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Is&&(this.Is=t),hx.resolve()}ae(e){this.Es.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Rs=new Zx(t),this.highestTargetId=t),e.sequenceNumber>this.Is&&(this.Is=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,hx.resolve()}updateTargetData(e,t){return this.ae(t),hx.resolve()}removeTargetData(e,t){return this.Es.delete(t.target),this.As.cs(t.targetId),--this.targetCount,hx.resolve()}removeTargets(n,r,i){let s=0;const o=[];return this.Es.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.Es.delete(e),o.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),hx.waitFor(o).next(()=>s)}getTargetCount(e){return hx.resolve(this.targetCount)}getTargetData(e,t){return t=this.Es.get(t)||null,hx.resolve(t)}addMatchingKeys(e,t,n){return this.As.ss(t,n),hx.resolve()}removeMatchingKeys(t,e,n){this.As.os(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),hx.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.As.cs(t),hx.resolve()}getMatchingKeysForTargetId(e,t){return t=this.As.hs(t),hx.resolve(t)}containsKey(e,t){return hx.resolve(this.As.containsKey(t))}}class WO{constructor(e,t){var n;this.bs={},this.Le=new JA(0),this.Be=!1,this.Be=!0,this.referenceDelegate=e(this),this.ze=new $O(this),this.Ht=new jx,this.He=(n=this.Ht,e=e=>this.referenceDelegate.Ps(e),new KO(n,e)),this.N=new kx(t),this.Je=new qO(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(e){let t=this.bs[e.toKey()];return t||(t=new BO(this.Ht,this.referenceDelegate),this.bs[e.toKey()]=t),t}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(e,t,n){MA("MemoryPersistence","Starting transaction:",e);const r=new HO(this.Le.next());return this.referenceDelegate.vs(),n(r).next(e=>this.referenceDelegate.Vs(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ss(t,n){return hx.or(Object.values(this.bs).map(e=>()=>e.containsKey(t,n)))}}class HO extends ux{constructor(e){super(),this.currentSequenceNumber=e}}class GO{constructor(e){this.persistence=e,this.Ds=new jO,this.Cs=null}static Ns(e){return new GO(e)}get xs(){if(this.Cs)return this.Cs;throw jA()}addReference(e,t,n){return this.Ds.addReference(n,t),this.xs.delete(n.toString()),hx.resolve()}removeReference(e,t,n){return this.Ds.removeReference(n,t),this.xs.add(n.toString()),hx.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),hx.resolve()}removeTarget(e,t){this.Ds.cs(t.targetId).forEach(e=>this.xs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.xs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}vs(){this.Cs=new Set}Vs(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return hx.forEach(this.xs,e=>{const t=IN.fromPath(e);return this.ks(n,t).next(e=>{e||r.removeEntry(t)})}).next(()=>(this.Cs=null,r.apply(n)))}updateLimboDocument(e,t){return this.ks(e,t).next(e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())})}Ps(e){return 0}ks(e,t){return hx.or([()=>hx.resolve(this.Ds.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ss(e,t)])}}function QO(e,t){return`firestore_clients_${e}_${t}`}function YO(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function JO(e,t){return`firestore_targets_${e}_${t}`}class XO{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static $s(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new KA(r.error.code,r.error.message))),s?new XO(e,t,r.state,i):(FA("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ZO{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static $s(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new KA(n.error.code,n.error.message))),i?new ZO(e,n.state,r):(FA("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class eD{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=aP;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=bN(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new eD(e,i):(FA("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class tD{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new tD(t.clientId,t.onlineState):(FA("SharedClientState",`Failed to parse online state: ${e}`),null)}}class nD{constructor(){this.activeTargetIds=aP}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ms(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class rD{constructor(e,t,n,r,i){this.window=e,this.Oe=t,this.persistenceKey=n,this.Ls=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Bs=this.Us.bind(this),this.qs=new JR(ZA),this.started=!1,this.Ks=[],n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),this.storage=this.window.localStorage,this.currentUser=i,this.js=QO(this.persistenceKey,this.Ls),this.Qs=`firestore_sequence_number_${this.persistenceKey}`,this.qs=this.qs.insert(this.Ls,new nD),this.Ws=new RegExp(`^firestore_clients_${n}_([^_]*)$`),this.Gs=new RegExp(`^firestore_mutations_${n}_(\\d+)(?:_(.*))?$`),this.zs=new RegExp(`^firestore_targets_${n}_(\\d+)$`),this.Hs=`firestore_online_state_${this.persistenceKey}`,this.Js=`firestore_bundle_loaded_${this.persistenceKey}`,this.window.addEventListener("storage",this.Bs)}static bt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.pn();for(const n of e)if(n!==this.Ls){const e=this.getItem(QO(this.persistenceKey,n));var t;!e||(t=eD.$s(n,e))&&(this.qs=this.qs.insert(t.clientId,t))}this.Ys();const n=this.storage.getItem(this.Hs);if(n){const e=this.Xs(n);e&&this.Zs(e)}for(const e of this.Ks)this.Us(e);this.Ks=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Qs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ti(this.qs)}isActiveQueryTarget(n){let r=!1;return this.qs.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.ei(e,"pending")}updateMutationState(e,t,n){this.ei(e,t,n),this.ni(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(JO(this.persistenceKey,e)))||(n=ZO.$s(e,n))&&(t=n.state)),this.si.Fs(e),this.Ys(),t}removeLocalQueryTarget(e){this.si.Ms(e),this.Ys()}isLocalQueryTarget(e){return this.si.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(JO(this.persistenceKey,e))}updateQueryState(e,t,n){this.ii(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.ni(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.ri(e)}notifyBundleLoaded(){this.oi()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Bs),this.removeItem(this.js),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return MA("SharedClientState","READ",e,t),t}setItem(e,t){MA("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){MA("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Us(e){const r=e;r.storageArea===this.storage&&(MA("SharedClientState","EVENT",r.key,r.newValue),r.key!==this.js?this.Oe.enqueueRetryable(async()=>{if(this.started){if(null!==r.key)if(this.Ws.test(r.key)){if(null==r.newValue){var e=this.ai(r.key);return this.ci(e,null)}if(e=this.ui(r.key,r.newValue))return this.ci(e.clientId,e)}else if(this.Gs.test(r.key)){if(null!==r.newValue){var t=this.hi(r.key,r.newValue);if(t)return this.li(t)}}else if(this.zs.test(r.key)){if(null!==r.newValue&&(t=this.fi(r.key,r.newValue)))return this.di(t)}else if(r.key===this.Hs){if(null!==r.newValue){var n=this.Xs(r.newValue);if(n)return this.Zs(n)}}else if(r.key===this.Qs)(n=function(e){let t=JA.T;if(null!=e)try{var n=JSON.parse(e);VA("number"==typeof n),t=n}catch(e){FA("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(r.newValue))!==JA.T&&this.sequenceNumberHandler(n);else if(r.key===this.Js)return this.syncEngine.wi()}else this.Ks.push(r)}):FA("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get si(){return this.qs.get(this.Ls)}Ys(){this.setItem(this.js,this.si.Os())}ei(e,t,n){const r=new XO(this.currentUser,e,t,n),i=YO(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Os())}ni(e){e=YO(this.persistenceKey,this.currentUser,e),this.removeItem(e)}ri(e){e={clientId:this.Ls,onlineState:e},this.storage.setItem(this.Hs,JSON.stringify(e))}ii(e,t,n){const r=JO(this.persistenceKey,e),i=new ZO(e,t,n);this.setItem(r,i.Os())}oi(){this.setItem(this.Js,"value-not-used")}ai(e){return(e=this.Ws.exec(e))?e[1]:null}ui(e,t){return e=this.ai(e),eD.$s(e,t)}hi(e,t){var n=this.Gs.exec(e),e=Number(n[1]),n=void 0!==n[2]?n[2]:null;return XO.$s(new xA(n),e,t)}fi(e,t){return e=this.zs.exec(e),e=Number(e[1]),ZO.$s(e,t)}Xs(e){return tD.$s(e)}async li(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine._i(e.batchId,e.state,e.error);MA("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}di(e){return this.syncEngine.mi(e.targetId,e.state,e.error)}ci(e,t){const n=t?this.qs.insert(e,t):this.qs.remove(e),r=this.ti(this.qs),i=this.ti(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.gi(s,o).then(()=>{this.qs=n})}Zs(e){this.qs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ti(e){let n=aP;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class iD{constructor(){this.yi=new nD,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.yi.Fs(e),this.pi[e]||"not-current"}updateQueryState(e,t,n){this.pi[e]=t}removeLocalQueryTarget(e){this.yi.Ms(e)}isLocalQueryTarget(e){return this.yi.activeTargetIds.has(e)}clearQueryState(e){delete this.pi[e]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(e){return this.yi.activeTargetIds.has(e)}start(){return this.yi=new nD,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class sD{Ti(e){}shutdown(){}}class oD{constructor(){this.Ei=()=>this.Ii(),this.Ai=()=>this.Ri(),this.bi=[],this.Pi()}Ti(e){this.bi.push(e)}shutdown(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ai)}Pi(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ai)}Ii(){MA("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.bi)e(0)}Ri(){MA("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.bi)e(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const aD={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class cD{constructor(e){this.vi=e.vi,this.Vi=e.Vi}Si(e){this.Di=e}Ci(e){this.Ni=e}onMessage(e){this.xi=e}close(){this.Vi()}send(e){this.vi(e)}ki(){this.Di()}$i(e){this.Ni(e)}Oi(e){this.xi(e)}}class lD extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.Fi=t+"://"+e.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(t,e,n,r){const i=this.Bi(t,e);return MA("RestConnection","Sending: ",i,n),this.Ui(e={},r),this.qi(t,i,e,n).then(e=>(MA("RestConnection","Received: ",e),e),e=>{throw UA("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e})}Ki(e,t,n,r){return this.Li(e,t,n,r)}Ui(e,t){if(e["X-Goog-Api-Client"]="gl-js/ fire/"+OA,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t)for(const n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n])}Bi(e,t){return e=aD[e],`${this.Fi}/v1/${t}:${e}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}qi(a,t,n,r){return new Promise((i,s)=>{const o=new PA;o.listenOnce(CA.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case kA.NO_ERROR:var e=o.getResponseJson();MA("Connection","XHR received:",JSON.stringify(e)),i(e);break;case kA.TIMEOUT:MA("Connection",'RPC "'+a+'" timed out'),s(new KA(BA.DEADLINE_EXCEEDED,"Request time out"));break;case kA.HTTP_ERROR:var t,n=o.getStatus();if(MA("Connection",'RPC "'+a+'" failed with status:',n,"response text:",o.getResponseText()),0<n){const a=o.getResponseJson().error;a&&a.status&&a.message?(r=a.status.toLowerCase().replace(/_/g,"-"),t=0<=Object.values(BA).indexOf(r)?r:BA.UNKNOWN,s(new KA(t,a.message))):s(new KA(BA.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new KA(BA.UNAVAILABLE,"Connection failed."));break;default:jA()}}finally{MA("Connection",'RPC "'+a+'" completed.')}var r});var e=JSON.stringify(r);o.send(t,"POST",e,n,15)})}ji(e,t){const n=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=new vA,i=SA(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new NA({})),this.Ui(s.initMessageHeaders,t),gd()||vd()||0<=fd().indexOf("Electron/")||_d()||0<=fd().indexOf("MSAppHost/")||yd()||(s.httpHeadersOverwriteParam="$httpHeaders"),MA("Connection","Creating WebChannel: "+(t=n.join("")),s);const o=r.createWebChannel(t,s);let a=!1,c=!1;const l=new cD({vi:e=>{c?MA("Connection","Not sending because WebChannel is closed:",e):(a||(MA("Connection","Opening WebChannel transport."),o.open(),a=!0),MA("Connection","WebChannel sending:",e),o.send(e))},Vi:()=>o.close()}),u=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return u(o,RA.EventType.OPEN,()=>{c||MA("Connection","WebChannel transport opened.")}),u(o,RA.EventType.CLOSE,()=>{c||(c=!0,MA("Connection","WebChannel transport closed"),l.$i())}),u(o,RA.EventType.ERROR,e=>{c||(c=!0,UA("Connection","WebChannel transport errored:",e),l.$i(new KA(BA.UNAVAILABLE,"The operation could not be completed")))}),u(o,RA.EventType.MESSAGE,e=>{if(!c){VA(!!(e=e.data[0]));var n=e.error||(null===(n=e[0])||void 0===n?void 0:n.error);if(n){MA("Connection","WebChannel received error:",n);var r=n.status;let e=function(e){if(void 0!==(e=TA[r]))return YR(e)}(),t=n.message;void 0===e&&(e=BA.INTERNAL,t="Unknown error status: "+r+" with message "+n.message),c=!0,l.$i(new KA(e,t)),o.close()}else MA("Connection","WebChannel received:",e),l.Oi(e)}}),u(i,AA.STAT_EVENT,e=>{10===e.stat?MA("Connection","Detected buffering proxy"):11===e.stat&&MA("Connection","Detected no buffering proxy")}),setTimeout(()=>{l.ki()},0),l}}function uD(){return"undefined"!=typeof window?window:null}function hD(){return"undefined"!=typeof document?document:null}function dD(e){return new _P(e,!0)}class pD{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Oe=e,this.timerId=t,this.Qi=n,this.Wi=r,this.Gi=i,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(e){this.cancel();var t=Math.floor(this.zi+this.Zi()),n=Math.max(0,Date.now()-this.Ji),r=Math.max(0,t-n);0<r&&MA("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.zi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,r,()=>(this.Ji=Date.now(),e())),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}}class fD{constructor(e,t,n,r,i,s){this.Oe=e,this.er=n,this.nr=r,this.credentialsProvider=i,this.listener=s,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new pD(e,t)}ar(){return 1===this.state||2===this.state||4===this.state}cr(){return 2===this.state}start(){3!==this.state?this.auth():this.ur()}async stop(){this.ar()&&await this.close(0)}hr(){this.state=0,this.rr.reset()}lr(){this.cr()&&null===this.ir&&(this.ir=this.Oe.enqueueAfterDelay(this.er,6e4,()=>this.dr()))}wr(e){this._r(),this.stream.send(e)}async dr(){if(this.cr())return this.close(0)}_r(){this.ir&&(this.ir.cancel(),this.ir=null)}async close(e,t){this._r(),this.rr.cancel(),this.sr++,3!==e?this.rr.reset():t&&t.code===BA.RESOURCE_EXHAUSTED?(FA(t.toString()),FA("Using maximum backoff delay to prevent overloading the backend."),this.rr.Yi()):t&&t.code===BA.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ci(t)}mr(){}auth(){this.state=1;const e=this.gr(this.sr),t=this.sr;this.credentialsProvider.getToken().then(e=>{this.sr===t&&this.yr(e)},t=>{e(()=>{var e=new KA(BA.UNKNOWN,"Fetching auth token failed: "+t.message);return this.pr(e)})})}yr(e){const t=this.gr(this.sr);this.stream=this.Tr(e),this.stream.Si(()=>{t(()=>(this.state=2,this.listener.Si()))}),this.stream.Ci(e=>{t(()=>this.pr(e))}),this.stream.onMessage(e=>{t(()=>this.onMessage(e))})}ur(){this.state=4,this.rr.Xi(async()=>{this.state=0,this.start()})}pr(e){return MA("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(3,e)}gr(t){return e=>{this.Oe.enqueueAndForget(()=>this.sr===t?e():(MA("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class gD extends fD{constructor(e,t,n,r,i){super(e,"listen_stream_connection_backoff","listen_stream_idle",t,n,i),this.N=r}Tr(e){return this.nr.ji("Listen",e)}onMessage(e){this.rr.reset();var t,n=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(s=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===s?1:"REMOVE"===s?2:"CURRENT"===s?3:"RESET"===s?4:jA(),i=t.targetChange.targetIds||[],s=(o=t.targetChange.resumeToken,e.D?(VA(void 0===o||"string"==typeof o),dN.fromBase64String(o||"")):(VA(void 0===o||o instanceof Uint8Array),dN.fromUint8Array(o||new Uint8Array))),o=t.targetChange.cause,a=o&&(o=void 0===(a=o).code?BA.UNKNOWN:YR(a.code),new KA(o,a.message||""));n=new dP(r,i,s,a||null)}else if("documentChange"in t){t.documentChange,(l=t.documentChange).document,l.document.name,l.document.updateTime;var s=kP(e,l.document.name),c=IP(l.document.updateTime),a=new MN({mapValue:{fields:l.document.fields}}),c=FN.newFoundDocument(s,c,a),a=l.targetIds||[],l=l.removedTargetIds||[];n=new uP(a,l,c.key,c)}else if("documentDelete"in t){t.documentDelete,(l=t.documentDelete).document;var c=kP(e,l.document),u=l.readTime?IP(l.readTime):rN.min(),u=FN.newNoDocument(c,u),l=l.removedTargetIds||[];n=new uP([],l,u.key,u)}else if("documentRemove"in t){t.documentRemove,(u=t.documentRemove).document;var h=kP(e,u.document),u=u.removedTargetIds||[];n=new uP([],u,h,null)}else{if(!("filter"in t))return jA();{t.filter;const e=t.filter;e.targetId,h=e.count||0,t=new GR(h),h=e.targetId,n=new hP(h,t)}}return n}(this.N,e),e=!("targetChange"in(t=e))||(t=t.targetChange).targetIds&&t.targetIds.length||!t.readTime?rN.min():IP(t.readTime);return this.listener.Er(n,e)}Ir(e){const t={};var n;t.database=NP(this.N),t.addTarget=function(e,t){let n;var r=t.target;return n=BN(r)?{documents:LP(e,r)}:{query:MP(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=bP(e,t.resumeToken):0<t.snapshotVersion.compareTo(rN.min())&&(n.readTime=wP(e,t.snapshotVersion.toTimestamp())),n}(this.N,e),(e=(this.N,n=e,null==(e=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return jA()}}())?null:{"goog-listen-tags":e}))&&(t.labels=e),this.wr(t)}Ar(e){const t={};t.database=NP(this.N),t.removeTarget=e,this.wr(t)}}class mD extends fD{constructor(e,t,n,r,i){super(e,"write_stream_connection_backoff","write_stream_idle",t,n,i),this.N=r,this.Rr=!1}get br(){return this.Rr}start(){this.Rr=!1,this.lastStreamToken=void 0,super.start()}mr(){this.Rr&&this.Pr([])}Tr(e){return this.nr.ji("Write",e)}onMessage(e){if(VA(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Rr){this.rr.reset();var t=(n=e.writeResults,r=e.commitTime,n&&0<n.length?(VA(void 0!==r),n.map(e=>function(e,t){let n=e.updateTime?IP(e.updateTime):IP(t);return n.isEqual(rN.min())&&(n=IP(t)),new OR(n,e.transformResults||[])}(e,r))):[]),n=IP(e.commitTime);return this.listener.vr(n,t)}var r;return VA(!e.writeResults||0===e.writeResults.length),this.Rr=!0,this.listener.Vr()}Sr(){const e={};e.database=NP(this.N),this.wr(e)}Pr(e){e={streamToken:this.lastStreamToken,writes:e.map(e=>OP(this.N,e))},this.wr(e)}}class yD extends class{}{constructor(e,t,n){super(),this.credentials=e,this.nr=t,this.N=n,this.Dr=!1}Cr(){if(this.Dr)throw new KA(BA.FAILED_PRECONDITION,"The client has already been terminated.")}Li(t,n,r){return this.Cr(),this.credentials.getToken().then(e=>this.nr.Li(t,n,r,e)).catch(e=>{throw"FirebaseError"===e.name?(e.code===BA.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new KA(BA.UNKNOWN,e.toString())})}Ki(t,n,r){return this.Cr(),this.credentials.getToken().then(e=>this.nr.Ki(t,n,r,e)).catch(e=>{throw"FirebaseError"===e.name?(e.code===BA.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new KA(BA.UNKNOWN,e.toString())})}terminate(){this.Dr=!0}}class vD{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Nr=0,this.kr=null,this.$r=!0}Or(){0===this.Nr&&(this.Fr("Unknown"),this.kr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.kr=null,this.Mr("Backend didn't respond within 10 seconds."),this.Fr("Offline"),Promise.resolve())))}Lr(e){"Online"===this.state?this.Fr("Unknown"):(this.Nr++,1<=this.Nr&&(this.Br(),this.Mr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Fr("Offline")))}set(e){this.Br(),this.Nr=0,"Online"===e&&(this.$r=!1),this.Fr(e)}Fr(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Mr(e){e=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`,this.$r?(FA(e),this.$r=!1):MA("OnlineStateTracker",e)}Br(){null!==this.kr&&(this.kr.cancel(),this.kr=null)}}class _D{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ur=[],this.qr=new Map,this.Kr=new Set,this.jr=[],this.Qr=i,this.Qr.Ti(e=>{n.enqueueAndForget(async()=>{AD(this)&&(MA("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.Kr.add(4),await bD(t),t.Wr.set("Unknown"),t.Kr.delete(4),await wD(t)}(this))})}),this.Wr=new vD(n,r)}}async function wD(e){if(AD(e))for(const t of e.jr)await t(!0)}async function bD(e){for(const t of e.jr)await t(!1)}function ID(e,t){const n=e;n.qr.has(t.targetId)||(n.qr.set(t.targetId,t),CD(n)?kD(n):MD(n).cr()&&ED(n,t))}function TD(e,t){const n=e,r=MD(n);n.qr.delete(t),r.cr()&&SD(n,t),0===n.qr.size&&(r.cr()?r.lr():AD(n)&&n.Wr.set("Unknown"))}function ED(e,t){e.Gr.Y(t.targetId),MD(e).Ir(t)}function SD(e,t){e.Gr.Y(t),MD(e).Ar(t)}function kD(t){t.Gr=new fP({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>t.qr.get(e)||null}),MD(t).start(),t.Wr.Or()}function CD(e){return AD(e)&&!MD(e).ar()&&0<e.qr.size}function AD(e){return 0===e.Kr.size}function ND(e){e.Gr=void 0}async function RD(e,t,n){if(!mx(t))throw t;e.Kr.add(1),await bD(e),e.Wr.set("Offline"),n=n||(()=>xO(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{MA("RemoteStore","Retrying IndexedDB access"),await n(),e.Kr.delete(1),await wD(e)})}function PD(t,n){return n().catch(e=>RD(t,e,n))}async function xD(e){const t=e,n=FD(t);let r=0<t.Ur.length?t.Ur[t.Ur.length-1].batchId:-1;for(;AD(i=t)&&i.Ur.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.In.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.Ur.length&&n.lr();break}r=e.batchId,function(e,t){e.Ur.push(t);const n=FD(e);n.cr()&&n.br&&n.Pr(t.mutations)}(t,e)}catch(e){await RD(t,e)}var i;OD(t)&&DD(t)}function OD(e){return AD(e)&&!FD(e).ar()&&0<e.Ur.length}function DD(e){FD(e).start()}async function LD(e,t){const n=e;t?(n.Kr.delete(2),await wD(n)):(n.Kr.add(2),await bD(n),n.Wr.set("Unknown"))}function MD(t){return t.zr||(t.zr=function(e,t,n){const r=e;return r.Cr(),new gD(t,r.nr,r.credentials,r.N,n)}(t.datastore,t.asyncQueue,{Si:async function(n){n.qr.forEach((e,t)=>{ED(n,e)})}.bind(null,t),Ci:async function(e,t){ND(e),CD(e)?(e.Wr.Lr(t),kD(e)):e.Wr.set("Unknown")}.bind(null,t),Er:async function(e,r,t){if(e.Wr.set("Online"),r instanceof dP&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.qr.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.qr.delete(n),e.Gr.removeTarget(n))}(e)}catch(t){MA("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await RD(e,t)}else if(r instanceof uP?e.Gr.rt(r):r instanceof hP?e.Gr.ft(r):e.Gr.ct(r),!t.isEqual(rN.min()))try{const r=await xO(e.localStore);0<=t.compareTo(r)&&await function(r,i){const e=r.Gr._t(i);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.qr.get(t);n&&r.qr.set(t,n.withResumeToken(e.resumeToken,i))}}),e.targetMismatches.forEach(e=>{const t=r.qr.get(e);t&&(r.qr.set(e,t.withResumeToken(dN.EMPTY_BYTE_STRING,t.snapshotVersion)),SD(r,e),e=new Sx(t.target,e,1,t.sequenceNumber),ED(r,e))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){MA("RemoteStore","Failed to raise snapshot:",r),await RD(e,r)}}.bind(null,t)}),t.jr.push(async e=>{e?(t.zr.hr(),CD(t)?kD(t):t.Wr.set("Unknown")):(await t.zr.stop(),ND(t))})),t.zr}function FD(t){return t.Hr||(t.Hr=function(e,t,n){const r=e;return r.Cr(),new mD(t,r.nr,r.credentials,r.N,n)}(t.datastore,t.asyncQueue,{Si:async function(e){FD(e).Sr()}.bind(null,t),Ci:async function(e,t){t&&FD(e).br&&await async function(e,t){if(QR(n=t.code)&&n!==BA.ABORTED){const n=e.Ur.shift();FD(e).hr(),await PD(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await xD(e)}var n}(e,t),OD(e)&&DD(e)}.bind(null,t),Vr:async function(e){const t=FD(e);for(const n of e.Ur)t.Pr(n.mutations)}.bind(null,t),vr:async function(e,t,n){const r=e.Ur.shift(),i=Ex.from(r,t,n);await PD(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await xD(e)}.bind(null,t)}),t.jr.push(async e=>{e?(t.Hr.hr(),await xD(t)):(await t.Hr.stop(),0<t.Ur.length&&(MA("RemoteStore",`Stopping write stream with ${t.Ur.length} pending writes`),t.Ur=[]))})),t.Hr}class UD{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new zA,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new UD(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new KA(BA.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function qD(e,t){if(FA("AsyncQueue",`${t}: ${e}`),mx(e))return new KA(BA.UNAVAILABLE,`${t}: ${e}`);throw e}class jD{constructor(n){this.comparator=n?(e,t)=>n(e,t)||IN.comparator(e.key,t.key):(e,t)=>IN.comparator(e.key,t.key),this.keyedMap=rP,this.sortedSet=new JR(this.comparator)}static emptySet(e){return new jD(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){return(e=this.keyedMap.get(e))?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof jD))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new jD;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class VD{constructor(){this.Jr=new JR(IN.comparator)}track(e){var t=e.doc.key,n=this.Jr.get(t);!n||0!==e.type&&3===n.type?this.Jr=this.Jr.insert(t,e):3===e.type&&1!==n.type?this.Jr=this.Jr.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Jr=this.Jr.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Jr=this.Jr.remove(t):1===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):jA()}Yr(){const n=[];return this.Jr.inorderTraversal((e,t)=>{n.push(t)}),n}}class BD{constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new BD(e,t,jD.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&fR(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class KD{constructor(){this.Xr=void 0,this.listeners=[]}}class zD{constructor(){this.queries=new hO(e=>gR(e),fR),this.onlineState="Unknown",this.Zr=new Set}}async function $D(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new KD),i)try{s.Xr=await n.onListen(r)}catch(e){const n=qD(e,`Initialization of query '${mR(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.eo(n.onlineState),!s.Xr||t.no(s.Xr)&&HD(n)}async function WD(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function HD(e){e.Zr.forEach(e=>{e.next()})}class GD{constructor(e,t,n){this.query=e,this.so=t,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}no(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new BD(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.io?this.oo(e)&&(this.so.next(e),t=!0):this.ao(e,this.onlineState)&&(this.co(e),t=!0),this.ro=e,t}onError(e){this.so.error(e)}eo(e){this.onlineState=e;let t=!1;return this.ro&&!this.io&&this.ao(this.ro,e)&&(this.co(this.ro),t=!0),t}ao(e,t){return!e.fromCache||!(this.options.uo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}oo(e){if(0<e.docChanges.length)return!0;var t=this.ro&&this.ro.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}co(e){e=BD.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.io=!0,this.so.next(e)}}class QD{constructor(e,t){this.payload=e,this.byteLength=t}ho(){return"metadata"in this.payload}}class YD{constructor(e){this.N=e}zn(e){return kP(this.N,e)}Hn(e){return e.metadata.exists?xP(this.N,e.document,!1):FN.newNoDocument(this.zn(e.metadata.name),this.Jn(e.metadata.readTime))}Jn(e){return IP(e)}}class JD{constructor(e,t,n){this.lo=e,this.localStore=t,this.N=n,this.queries=[],this.documents=[],this.progress=XD(e)}fo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}wo(e){const t=new Map,n=new YD(this.N);for(const i of e)if(i.metadata.queries){const e=n.zn(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||oP()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=oP(),o=nP,a=iP;for(const e of n){const n=t.zn(e.metadata.name);e.document&&(s=s.add(n)),o=o.insert(n,t.Hn(e)),a=a.insert(n,t.Jn(e.metadata.readTime))}const c=i.jn.newChangeBuffer({trackRemovals:!0}),l=await DO(i,dR(sR(cN.fromString(`__bundle__/docs/${r}`))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>OO(t,c,o,rN.min(),a).next(e=>(c.apply(t),e)).next(e=>i.ze.removeMatchingKeysForTargetId(t,l.targetId).next(()=>i.ze.addMatchingKeys(t,s,l.targetId)).next(()=>i.Qn.vn(t,e)).next(()=>e)))}(this.localStore,new YD(this.N),this.documents,this.lo.id),t=this.wo(this.documents);for(const e of this.queries)await async function(e,n,r=oP()){const i=await DO(e,dR(Mx(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=IP(n.readTime);return 0<=i.snapshotVersion.compareTo(t)?s.Je.saveNamedQuery(e,n):(t=i.withResumeToken(dN.EMPTY_BYTE_STRING,t),s.Un=s.Un.insert(t.targetId,t),s.ze.updateTargetData(e,t).next(()=>s.ze.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.ze.addMatchingKeys(e,r,i.targetId)).next(()=>s.Je.saveNamedQuery(e,n)))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",new SO(Object.assign({},this.progress),e)}}function XD(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class ZD{constructor(e){this.key=e}}class e1{constructor(e){this.key=e}}class t1{constructor(e,t){this.query=e,this._o=t,this.mo=null,this.current=!1,this.yo=oP(),this.mutatedKeys=oP(),this.po=vR(e),this.To=new jD(this.po)}get Eo(){return this._o}Io(e,t){const a=t?t.Ao:new VD,c=(t||this).To;let l=(t||this).mutatedKeys,u=c,h=!1;const d=oR(this.query)&&c.size===this.query.limit?c.last():null,p=aR(this.query)&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((e,t)=>{const n=c.get(e),r=yR(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let o=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(a.track({type:3,doc:r}),o=!0):this.Ro(n,r)||(a.track({type:2,doc:r}),o=!0,(d&&0<this.po(r,d)||p&&this.po(r,p)<0)&&(h=!0)):!n&&r?(a.track({type:0,doc:r}),o=!0):n&&!r&&(a.track({type:1,doc:n}),o=!0,(d||p)&&(h=!0)),o&&(l=r?(u=u.add(r),s?l.add(e):l.delete(e)):(u=u.delete(e),l.delete(e)))}),oR(this.query)||aR(this.query))for(;u.size>this.query.limit;){const e=oR(this.query)?u.last():u.first();u=u.delete(e.key),l=l.delete(e.key),a.track({type:1,doc:e})}return{To:u,Ao:a,Ln:h,mutatedKeys:l}}Ro(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.To;this.To=e.To,this.mutatedKeys=e.mutatedKeys;const i=e.Ao.Yr();i.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return jA()}};return n(e)-n(t)}(e.type,t.type)||this.po(e.doc,t.doc)),this.bo(n);var s=t?this.Po():[],t=(n=0===this.yo.size&&this.current?1:0)!==this.mo;return this.mo=n,0!==i.length||t?{snapshot:new BD(this.query,e.To,r,i,e.mutatedKeys,0==n,t,!1),vo:s}:{vo:s}}eo(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({To:this.To,Ao:new VD,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{vo:[]}}Vo(e){return!this._o.has(e)&&!!this.To.has(e)&&!this.To.get(e).hasLocalMutations}bo(e){e&&(e.addedDocuments.forEach(e=>this._o=this._o.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._o=this._o.delete(e)),this.current=e.current)}Po(){if(!this.current)return[];const t=this.yo;this.yo=oP(),this.To.forEach(e=>{this.Vo(e.key)&&(this.yo=this.yo.add(e.key))});const n=[];return t.forEach(e=>{this.yo.has(e)||n.push(new e1(e))}),this.yo.forEach(e=>{t.has(e)||n.push(new ZD(e))}),n}So(e){return this._o=e.Gn,this.yo=oP(),e=this.Io(e.documents),this.applyChanges(e,!0)}Do(){return BD.fromInitialDocuments(this.query,this.To,this.mutatedKeys,0===this.mo)}}class n1{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class r1{constructor(e){this.key=e,this.Co=!1}}class i1{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.No={},this.xo=new hO(e=>gR(e),fR),this.ko=new Map,this.$o=new Set,this.Oo=new JR(IN.comparator),this.Fo=new Map,this.Mo=new jO,this.Lo={},this.Bo=new Map,this.Uo=Zx.ie(),this.onlineState="Unknown",this.qo=void 0}get isPrimaryClient(){return!0===this.qo}}async function s1(n,e,t,r){n.Ko=(e,i,t)=>async function(e,t,n){let r=t.view.Io(i);return r.Ln&&(r=await MO(e.localStore,t.query,!1).then(({documents:e})=>t.view.Io(e,r))),n=n&&n.targetChanges.get(t.targetId),n=t.view.applyChanges(r,e.isPrimaryClient,n),p1(e,t.targetId,n.vo),n.snapshot}(n,e,t);const i=await MO(n.localStore,e,!0),s=new t1(e,i.Gn),o=s.Io(i.documents),a=lP.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),c=s.applyChanges(o,n.isPrimaryClient,a);return p1(n,t,c.vo),r=new n1(e,t,s),n.xo.set(e,r),n.ko.has(t)?n.ko.get(t).push(e):n.ko.set(t,[e]),c.snapshot}async function o1(e,t,n){const r=w1(e);try{const e=await function(e,r){const i=e,s=nN.now(),t=r.reduce((e,t)=>e.add(t.key),oP());let o;return i.persistence.runTransaction("Locally write mutations","readwrite",n=>i.Qn.Pn(n,t).next(e=>{o=e;const t=[];for(const n of r){const r=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=TR(r.transform,e||null);null!=i&&(null==n&&(n=MN.empty()),n.set(r.field,i))}return n||null}(n,o.get(n.key));null!=r&&t.push(new BR(n.key,r,function r(e){const i=[];return sN(e.fields,(e,t)=>{const n=new uN([e]);if(DN(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new hN(i)}(r.value.mapValue),DR.exists(!0)))}return i.In.addMutationBatch(n,s,t,r)})).then(e=>(e.applyToLocalDocumentSet(o),{batchId:e.batchId,changes:o}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Lo[e.currentUser.toKey()];r=r||new JR(ZA),r=r.insert(t,n),e.Lo[e.currentUser.toKey()]=r}(r,e.batchId,n),await g1(r,e.changes),await xD(r.remoteStore)}catch(e){const t=qD(e,"Failed to persist write");n.reject(t)}}async function a1(e,t){const r=e;try{const e=await function(e,n){const u=e,h=n.snapshotVersion;let d=u.Un;return u.persistence.runTransaction("Apply remote event","readwrite-primary",c=>{const e=u.jn.newChangeBuffer({trackRemovals:!0});d=u.Un;const l=[];n.targetChanges.forEach((e,t)=>{const n=d.get(t);if(n){l.push(u.ze.removeMatchingKeys(c,e.removedDocuments,t).next(()=>u.ze.addMatchingKeys(c,e.addedDocuments,t)));const a=e.resumeToken;var r,i,s,o;0<a.approximateByteSize()&&(r=n.withResumeToken(a,h).withSequenceNumber(c.currentSequenceNumber),d=d.insert(t,r),i=n,o=e,VA(0<(s=r).resumeToken.approximateByteSize()),0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size)||l.push(u.ze.updateTargetData(c,r)))}});let t=nP;if(n.documentUpdates.forEach((e,t)=>{n.resolvedLimboDocuments.has(e)&&l.push(u.persistence.referenceDelegate.updateLimboDocument(c,e))}),l.push(OO(c,e,n.documentUpdates,h,void 0).next(e=>{t=e})),!h.isEqual(rN.min())){const n=u.ze.getLastRemoteSnapshotVersion(c).next(e=>u.ze.setTargetsMetadata(c,c.currentSequenceNumber,h));l.push(n)}return hx.waitFor(l).next(()=>e.apply(c)).next(()=>u.Qn.vn(c,t)).next(()=>t)}).then(e=>(u.Un=d,e))}(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.Fo.get(t);n&&(VA(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.Co=!0:0<e.modifiedDocuments.size?VA(n.Co):0<e.removedDocuments.size&&(VA(n.Co),n.Co=!1))}),await g1(r,e,t)}catch(e){await iO(e)}}function c1(n,r,e){const t=n;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const n=[];t.xo.forEach((e,t)=>{(t=t.view.eo(r)).snapshot&&n.push(t.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.eo(n)&&(r=!0)}),r&&HD(t)}(t.eventManager,r),n.length&&t.No.Er(n),t.onlineState=r,t.isPrimaryClient&&t.sharedClientState.setOnlineState(r)}}function l1(e,t){(e.Bo.get(t)||[]).forEach(e=>{e.resolve()}),e.Bo.delete(t)}function u1(e,t,n){const r=e;let i=r.Lo[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Lo[r.currentUser.toKey()]=i}}function h1(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.ko.get(e))t.xo.delete(r),n&&t.No.jo(r,n);t.ko.delete(e),t.isPrimaryClient&&t.Mo.cs(e).forEach(e=>{t.Mo.containsKey(e)||d1(t,e)})}function d1(e,t){e.$o.delete(t.path.canonicalString());var n=e.Oo.get(t);null!==n&&(TD(e.remoteStore,n),e.Oo=e.Oo.remove(t),e.Fo.delete(n),f1(e))}function p1(e,t,n){for(const r of n)r instanceof ZD?(e.Mo.addReference(r.key,t),function(e){const t=r.key,n=t.path.canonicalString();e.Oo.get(t)||e.$o.has(n)||(MA("SyncEngine","New document in limbo: "+t),e.$o.add(n),f1(e))}(e)):r instanceof e1?(MA("SyncEngine","Document no longer in limbo: "+r.key),e.Mo.removeReference(r.key,t),e.Mo.containsKey(r.key)||d1(e,r.key)):jA()}function f1(e){for(;0<e.$o.size&&e.Oo.size<e.maxConcurrentLimboResolutions;){var t=e.$o.values().next().value;e.$o.delete(t);var n=new IN(cN.fromString(t)),t=e.Uo.next();e.Fo.set(t,new r1(n)),e.Oo=e.Oo.insert(n,t),ID(e.remoteStore,new Sx(dR(sR(n.path)),t,2,JA.T))}}async function g1(e,n,r){const i=e,s=[],o=[],a=[];i.xo.isEmpty()||(i.xo.forEach((e,t)=>{a.push(i.Ko(t,n,r).then(e=>{e&&(i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),s.push(e),e=CO.kn(t.targetId,e),o.push(e))}))}),await Promise.all(a),i.No.Er(s),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>hx.forEach(t,t=>hx.forEach(t.Nn,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>hx.forEach(t.xn,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!mx(e))throw e;MA("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Un.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.Un=r.Un.insert(t,i)}}}(i.localStore,o))}async function m1(r,e){const i=r;if(_1(i),w1(i),!0===e&&!0!==i.qo){const r=i.sharedClientState.getAllActiveQueryTargets(),e=await y1(i,r.toArray());i.qo=!0,await LD(i.remoteStore,!0);for(const r of e)ID(i.remoteStore,r)}else if(!1===e&&!1!==i.qo){const r=[];let n=Promise.resolve();i.ko.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(h1(i,t),LO(i.localStore,t,!0))),TD(i.remoteStore,t)}),await n,await y1(i,r),function(){const n=i;n.Fo.forEach((e,t)=>{TD(n.remoteStore,t)}),n.Mo.us(),n.Fo=new Map,n.Oo=new JR(IN.comparator)}(),i.qo=!1,await LD(i.remoteStore,!1)}}async function y1(t,n){const r=t,i=[],s=[];for(const t of n){let e;var o=r.ko.get(t);if(o&&0!==o.length){e=await DO(r.localStore,dR(o[0]));for(const t of o){const n=r.xo.get(t),u=(r,c=n,a=await MO((l=r).localStore,c.query,!0),a=c.view.So(a),l.isPrimaryClient&&p1(l,c.targetId,a.vo),await a);u.snapshot&&s.push(u.snapshot)}}else{o=await FO(r.localStore,t);e=await DO(r.localStore,o),await s1(r,v1(o),t,!1)}i.push(e)}var a,c,l;return r.No.Er(s),i}function v1(e){return iR(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function _1(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=a1.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,t){const n=e,r=n.Fo.get(t);if(r&&r.Co)return oP().add(r.key);{let e=oP();const r=n.ko.get(t);if(!r)return e;for(const t of r){const r=n.xo.get(t);e=e.unionWith(r.view.Eo)}return e}}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Fo.get(t),s=i&&i.key;if(s){let e=new JR(IN.comparator);e=e.insert(s,FN.newNoDocument(s,rN.min()));const n=oP().add(s),i=new cP(rN.min(),new Map,new eP(ZA),e,n);await a1(r,i),r.Oo=r.Oo.remove(s),r.Fo.delete(t),f1(r)}else await LO(r.localStore,t,!1).then(()=>h1(r,t,n)).catch(iO)}.bind(null,t),t.No.Er=function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.no(e)&&(r=!0);i.Xr=e}}r&&HD(n)}.bind(null,t.eventManager),t.No.jo=function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}.bind(null,t.eventManager),t}function w1(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=async function(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.jn.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let o=hx.resolve();return n.forEach(n=>{o=o.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);VA(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&i.addEntry(e,r.commitVersion))})}),o.next(()=>e.In.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i.In.performConsistencyCheck(e)).next(()=>i.Qn.Pn(e,t))})}(n.localStore,t);u1(n,r,null),l1(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await g1(n,e)}catch(e){await iO(e)}}.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i.In.lookupMutationBatch(t,r).next(e=>(VA(null!==e),n=e.keys(),i.In.removeMutationBatch(t,e))).next(()=>i.In.performConsistencyCheck(t)).next(()=>i.Qn.Pn(t,n))})}(r.localStore,t);u1(r,t,n),l1(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await g1(r,e)}catch(n){await iO(n)}}.bind(null,t),t}class b1{constructor(){this.synchronizeTabs=!1}async initialize(e){this.N=dD(e.databaseInfo.databaseId),this.sharedClientState=this.Wo(e),this.persistence=this.Go(e),await this.persistence.start(),this.gcScheduler=this.zo(e),this.localStore=this.Ho(e)}zo(e){return null}Ho(e){return RO(this.persistence,new AO,e.initialUser,this.N)}Go(e){return new WO(GO.Ns,this.N)}Wo(e){return new iD}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class I1 extends b1{constructor(e,t,n){super(),this.Jo=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await async function(e){const t=e;return t.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(){const e=mO(t);let r=rN.min();return e.Kt({index:ZP.readTimeIndex,reverse:!0},(e,t,n)=>{t.readTime&&(r=Rx(t.readTime)),n.done()}).next(()=>r)}()).then(e=>{t.Kn=e})}(this.localStore),await this.Jo.initialize(this,e),await w1(this.Jo.syncEngine),await xD(this.Jo.remoteStore),await this.persistence.nn(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Ho(e){return RO(this.persistence,new AO,e.initialUser,this.N)}zo(e){var t=this.persistence.referenceDelegate.garbageCollector;return new aO(t,e.asyncQueue)}Go(e){var t=EO(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?$x.withCacheSize(this.cacheSizeBytes):$x.DEFAULT;return new bO(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,uD(),hD(),this.N,this.sharedClientState,!!this.forceOwnership)}Wo(e){return new iD}}class T1 extends I1{constructor(e,t){super(e,t,!1),this.Jo=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e),e=this.Jo.syncEngine,this.sharedClientState instanceof rD&&(this.sharedClientState.syncEngine={_i:async function(e,t,n,r){var i=e;null!==(e=await function(e,n){const r=e,i=r.In;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.Xt(t,n).next(e=>e?r.Qn.Pn(t,e):hx.resolve(null)))}(i.localStore,t))?("pending"===n?await xD(i.remoteStore):"acknowledged"===n||"rejected"===n?(u1(i,t,r||null),l1(i,t),i.localStore.In.te(t)):jA(),await g1(i,e)):MA("SyncEngine","Cannot apply mutation batch with id: "+t)}.bind(null,e),mi:async function(e,t,n,r){const i=e;if(i.qo)MA("SyncEngine","Ignoring unexpected query state notification.");else if(i.ko.has(t))switch(n){case"current":case"not-current":{const e=await UO(i.localStore),r=cP.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await g1(i,e,r);break}case"rejected":await LO(i.localStore,t,!0),h1(i,t,r);break;default:jA()}}.bind(null,e),gi:async function(e,t,n){const r=_1(e);if(r.qo){for(const e of t)if(r.ko.has(e))MA("SyncEngine","Adding an already active target "+e);else{const t=await FO(r.localStore,e),n=await DO(r.localStore,t);await s1(r,v1(t),n.targetId,!1),ID(r.remoteStore,n)}for(const e of n)r.ko.has(e)&&await LO(r.localStore,e,!1).then(()=>{TD(r.remoteStore,e),h1(r,e)}).catch(iO)}}.bind(null,e),pn:function(e){return e.localStore.persistence.pn()}.bind(null,e),wi:async function(e){const t=e;return UO(t.localStore).then(e=>g1(t,e))}.bind(null,e)},await this.sharedClientState.start()),await this.persistence.nn(async e=>{await m1(this.Jo.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())})}Wo(e){var t=uD();if(!rD.bt(t))throw new KA(BA.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=EO(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new rD(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class E1{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>c1(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=async function(e,t){const n=e;var r;n.currentUser.isEqual(t)||(MA("SyncEngine","User change. New user:",t.toKey()),r=await PO(n.localStore,t),n.currentUser=t,(e=n).Bo.forEach(e=>{e.forEach(e=>{e.reject(new KA(BA.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Bo.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await g1(n,r.Wn))}.bind(null,this.syncEngine),await LD(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new zD}createDatastore(e){var t=dD(e.databaseInfo.databaseId),n=(n=e.databaseInfo,new lD(n));return e=e.credentials,new yD(e,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>c1(this.syncEngine,e,0),e=new(oD.bt()?oD:sD),new _D(t,n,r,i,e);var t,n,r,i}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new i1(e,t,n,r,i,s);return o&&(a.qo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;MA("RemoteStore","RemoteStore shutting down."),t.Kr.add(5),await bD(t),t.Qr.shutdown(),t.Wr.set("Unknown")}(this.remoteStore)}}function S1(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class k1{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Yo(this.observer.next,e)}error(e){this.observer.error?this.Yo(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Xo(){this.muted=!0}Yo(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class C1{constructor(e,t){this.Zo=e,this.N=t,this.metadata=new zA,this.buffer=new Uint8Array,this.ta=new TextDecoder("utf-8"),this.ea().then(e=>{e&&e.ho()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.Zo.cancel()}async getMetadata(){return this.metadata.promise}async Qo(){return await this.getMetadata(),this.ea()}async ea(){var e=await this.na();if(null===e)return null;var t=this.ta.decode(e),n=Number(t);return isNaN(n)&&this.sa(`length string (${t}) is not valid number`),t=await this.ia(n),new QD(JSON.parse(t),e.length+n)}ra(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async na(){for(;this.ra()<0&&!await this.oa(););if(0===this.buffer.length)return null;var e=this.ra();e<0&&this.sa("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async ia(e){for(;this.buffer.length<e;)await this.oa()&&this.sa("Reached the end of bundle when more is expected.");var t=this.ta.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}sa(e){throw this.Zo.cancel(),new Error(`Invalid bundle format: ${e}`)}async oa(){var e=await this.Zo.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class A1{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new KA(BA.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=NP(r.N)+"/documents",i={documents:t.map(e=>SP(r.N,e))},s=await r.Ki("BatchGetDocuments",n,i),o=new Map;s.forEach(e=>{const t=(n=r.N,"found"in e?function(e,t){VA(!!t.found),t.found.name,t.found.updateTime;var n=kP(e,t.found.name),e=IP(t.found.updateTime),t=new MN({mapValue:{fields:t.found.fields}});return FN.newFoundDocument(n,e,t)}(n,e):"missing"in e?(n=n,VA(!!(e=e).missing),VA(!!e.readTime),n=kP(n,e.missing),e=IP(e.readTime),FN.newNoDocument(n,e)):jA());var n;o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{VA(!!(e=o.get(e.toString()))),a.push(e)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new WR(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{t=IN.fromPath(t),this.mutations.push(new HR(t,this.precondition(t)))}),await async function(e,t){const n=e,r=NP(n.N)+"/documents",i={writes:t.map(e=>OP(n.N,e))};await n.Li("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw jA();t=rN.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new KA(BA.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?DR.updateTime(t):DR.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return DR.exists(!0);if(t.isEqual(rN.min()))throw new KA(BA.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return DR.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class N1{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.aa=5,this.rr=new pD(this.asyncQueue,"transaction_retry")}run(){--this.aa,this.ca()}ca(){this.rr.Xi(async()=>{const t=new A1(this.datastore),e=this.ua(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.ha(e)}))}).catch(e=>{this.ha(e)})})}ua(e){try{var t=this.updateFunction(e);return!_N(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ha(e){0<this.aa&&this.la(e)?(--this.aa,this.asyncQueue.enqueueAndForget(()=>(this.ca(),Promise.resolve()))):this.deferred.reject(e)}la(e){return"FirebaseError"===e.name&&("aborted"===(e=e.code)||"failed-precondition"===e||!QR(e))}}class R1{constructor(e,t,n){this.credentials=e,this.asyncQueue=t,this.databaseInfo=n,this.user=xA.UNAUTHENTICATED,this.clientId=XA.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(t,async e=>{MA("FirestoreClient","Received user=",e.uid),await this.credentialListener(e),this.user=e})}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.credentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new KA(BA.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new zA;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.shutdown(),n.resolve()}catch(e){var t=qD(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function P1(e,t){e.asyncQueue.verifyOperationInProgress(),MA("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await PO(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function x1(e,t){e.asyncQueue.verifyOperationInProgress();var n=await O1(e);MA("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>async function(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),MA("RemoteStore","RemoteStore received new credentials"),e=AD(n),n.Kr.add(3),await bD(n),e&&n.Wr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Kr.delete(3),await wD(n)}(t.remoteStore,e)),e.onlineComponents=t}async function O1(e){return e.offlineComponents||(MA("FirestoreClient","Using default OfflineComponentProvider"),await P1(e,new b1)),e.offlineComponents}async function D1(e){return e.onlineComponents||(MA("FirestoreClient","Using default OnlineComponentProvider"),await x1(e,new E1)),e.onlineComponents}function L1(e){return O1(e).then(e=>e.persistence)}function M1(e){return O1(e).then(e=>e.localStore)}function F1(e){return D1(e).then(e=>e.remoteStore)}function U1(e){return D1(e).then(e=>e.syncEngine)}async function q1(e){const t=await D1(e),n=t.eventManager;return n.onListen=async function(e,t){const n=_1(e);let r,i;const s=n.xo.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Do();else{const e=await DO(n.localStore,dR(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await s1(n,t,r,"current"===s),n.isPrimaryClient&&ID(n.remoteStore,e)}return i}.bind(null,t.syncEngine),n.onUnlisten=async function(e,t){const n=e,r=n.xo.get(t),i=n.ko.get(r.targetId);if(1<i.length)return n.ko.set(r.targetId,i.filter(e=>!fR(e,t))),void n.xo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await LO(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),TD(n.remoteStore,r.targetId),h1(n,r.targetId)}).catch(iO)):(h1(n,r.targetId),await LO(n.localStore,r.targetId,!0))}.bind(null,t.syncEngine),n}function j1(e,t,n={}){const r=new zA;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,i,s,o){const e=new k1({next:e=>{r.enqueueAndForget(()=>WD(n,a));var t=e.docs.has(i);!t&&e.fromCache?o.reject(new KA(BA.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?o.reject(new KA(BA.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):o.resolve(e)},error:e=>o.reject(e)}),a=new GD(sR(i.path),e,{includeMetadataChanges:!0,uo:!0});return $D(n,a)}(await q1(e),e.asyncQueue,t,n,r)),r.promise}function V1(e,t,n={}){const r=new zA;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,i){const s=new k1({next:e=>{n.enqueueAndForget(()=>WD(t,o)),e.fromCache&&"server"===r.source?i.reject(new KA(BA.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),o=new GD(e,s,{includeMetadataChanges:!0,uo:!0});return $D(t,o)}(await q1(e),e.asyncQueue,t,n,r)),r.promise}function B1(e,t,n,r){const i=(n=n,t=dD(t),n=function(e){if(e instanceof Uint8Array)return S1(e,void 0);if(e instanceof ArrayBuffer)return S1(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n="string"==typeof n?(new TextEncoder).encode(n):n),new C1(n,t));e.asyncQueue.enqueueAndForget(async()=>{!function(e,t){const n=e;!async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=IP(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Je.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),void r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes});r._updateProgress(XD(i));const o=new JD(i,t.localStore,n.N);let e=await n.Qo();for(;e;){const t=await o.fo(e);t&&r._updateProgress(t),e=await n.Qo()}var s=await o.complete();await g1(t,s.En,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Je.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress)}catch(t){UA("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t)}}(n,t,r).then(()=>{n.sharedClientState.notifyBundleLoaded()})}(await U1(e),i)})}class K1{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class z1{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof z1&&e.projectId===this.projectId&&e.database===this.database}}const $1=new Map;function W1(e,t,n){if(!n)throw new KA(BA.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function H1(e,t,n,r){if(!0===t&&!0===r)throw new KA(BA.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function G1(e){if(!IN.isDocumentKey(e))throw new KA(BA.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Q1(e){if(IN.isDocumentKey(e))throw new KA(BA.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Y1(e){return void 0===e?"undefined":null===e?"null":"string"==typeof e?(20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e)):"number"==typeof e||"boolean"==typeof e?""+e:"object"!=typeof e?"function"==typeof e?"a function":jA():e instanceof Array?"an array":(e=e.constructor?e.constructor.name:null)?`a custom ${e} object`:"an object"}function J1(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new KA(BA.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");throw e=Y1(e),new KA(BA.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}function X1(e,t){if(t<=0)throw new KA(BA.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class Z1{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new KA(BA.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new KA(BA.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,H1("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class eL{constructor(e,t){this._credentials=t,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Z1({}),this._settingsFrozen=!1,e instanceof z1?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new KA(BA.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new z1(e.options.projectId)}(e))}get app(){if(!this._app)throw new KA(BA.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new KA(BA.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Z1(e),void 0!==e.credentials&&(this._credentials=function(e){if(!e)return new WA;switch(e.type){case"gapi":var t=e.client;return VA(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new YA(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new KA(BA.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=$1.get(e);t&&(MA("ComponentProvider","Removing Datastore"),$1.delete(e),t.terminate())}(this),Promise.resolve()}}class tL{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new rL(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new tL(this.firestore,e,this._key)}}class nL{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new nL(this.firestore,e,this._query)}}class rL extends nL{constructor(e,t,n){super(e,t,sR(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new tL(this.firestore,null,new IN(e))}withConverter(e){return new rL(this.firestore,e,this._path)}}function iL(e,t,...n){if(e=Qd(e),W1("collection","path",t),e instanceof eL){var r=cN.fromString(t,...n);return Q1(r),new rL(e,null,r)}if(!(e instanceof tL||e instanceof rL))throw new KA(BA.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Q1(n=e._path.child(cN.fromString(t,...n))),new rL(e.firestore,null,n)}function sL(e,t,...n){if(e=Qd(e),W1("doc","path",t=1===arguments.length?XA.I():t),e instanceof eL){var r=cN.fromString(t,...n);return G1(r),new tL(e,null,new IN(r))}if(!(e instanceof tL||e instanceof rL))throw new KA(BA.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return G1(n=e._path.child(cN.fromString(t,...n))),new tL(e.firestore,e instanceof rL?e.converter:null,new IN(n))}function oL(e,t){return e=Qd(e),t=Qd(t),(e instanceof tL||e instanceof rL)&&(t instanceof tL||t instanceof rL)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function aL(e,t){return e=Qd(e),t=Qd(t),e instanceof nL&&t instanceof nL&&e.firestore===t.firestore&&fR(e._query,t._query)&&e.converter===t.converter}class cL{constructor(){this.fa=Promise.resolve(),this.da=[],this.wa=!1,this._a=[],this.ma=null,this.ga=!1,this.ya=!1,this.pa=[],this.rr=new pD(this,"async_queue_retry"),this.Ta=()=>{var e=hD();e&&MA("AsyncQueue","Visibility state changed to "+e.visibilityState),this.rr.tr()};const e=hD();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ta)}get isShuttingDown(){return this.wa}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ea(),this.Ia(e)}enterRestrictedMode(e){if(!this.wa){this.wa=!0,this.ya=e||!1;const t=hD();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ta)}}enqueue(e){if(this.Ea(),this.wa)return new Promise(()=>{});const t=new zA;return this.Ia(()=>this.wa&&this.ya?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.da.push(e),this.Aa()))}async Aa(){if(0!==this.da.length){try{await this.da[0](),this.da.shift(),this.rr.reset()}catch(e){if(!mx(e))throw e;MA("AsyncQueue","Operation failed with retryable error: "+e)}0<this.da.length&&this.rr.Xi(()=>this.Aa())}}Ia(e){var t=this.fa.then(()=>(this.ga=!0,e().catch(e=>{throw this.ma=e,this.ga=!1,FA("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.ga=!1,e))));return this.fa=t}enqueueAfterDelay(e,t,n){return this.Ea(),-1<this.pa.indexOf(e)&&(t=0),n=UD.createAndSchedule(this,e,t,n,e=>this.Ra(e)),this._a.push(n),n}Ea(){this.ma&&jA()}verifyOperationInProgress(){}async ba(){for(var e;await(e=this.fa),e!==this.fa;);}Pa(e){for(const t of this._a)if(t.timerId===e)return!0;return!1}va(t){return this.ba().then(()=>{this._a.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this._a)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.ba()})}Va(e){this.pa.push(e)}Ra(e){e=this._a.indexOf(e),this._a.splice(e,1)}}function lL(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class uL{constructor(){this._progressObserver={},this._taskCompletionResolver=new zA,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class hL extends eL{constructor(e,t){super(e,t),this.type="firestore",this._queue=new cL,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||pL(this),this._firestoreClient.terminate()}}function dL(e){return e._firestoreClient||pL(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function pL(e){var t,n,r,i=e._freezeSettings(),i=(t=e._databaseId,n=(null===(r=e._app)||void 0===r?void 0:r.options.appId)||"",r=e._persistenceKey,new K1(t,n,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));e._firestoreClient=new R1(e._credentials,e._queue,i)}function fL(e,n,r){const i=new zA;return e.asyncQueue.enqueue(async()=>{try{await P1(e,r),await x1(e,n),i.resolve()}catch(e){if(!("FirebaseError"===(t=e).name?t.code===BA.FAILED_PRECONDITION||t.code===BA.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),i.reject(e)}var t}).then(()=>i.promise)}function gL(e){if(e._initialized||e._terminated)throw new KA(BA.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class mL{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new KA(BA.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new uN(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class yL{constructor(e){this._byteString=e}static fromBase64String(e){try{return new yL(dN.fromBase64String(e))}catch(e){throw new KA(BA.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new yL(dN.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class vL{constructor(e){this._methodName=e}}class _L{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new KA(BA.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new KA(BA.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ZA(this._lat,e._lat)||ZA(this._long,e._long)}}const wL=/^__.*__$/;class bL{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new BR(e,this.data,this.fieldMask,t,this.fieldTransforms):new VR(e,this.data,t,this.fieldTransforms)}}class IL{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new BR(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function TL(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw jA()}}class EL{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.N=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sa(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Da(){return this.settings.Da}Ca(e){return new EL(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Na(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Ca({path:n,xa:!1});return r.ka(e),r}$a(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Ca({path:n,xa:!1});return r.Sa(),r}Oa(e){return this.Ca({path:void 0,xa:!0})}Fa(e){return zL(e,this.settings.methodName,this.settings.Ma||!1,this.path,this.settings.La)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Sa(){if(this.path)for(let e=0;e<this.path.length;e++)this.ka(this.path.get(e))}ka(e){if(0===e.length)throw this.Fa("Document fields must not be empty");if(TL(this.Da)&&wL.test(e))throw this.Fa('Document fields cannot begin and end with "__"')}}class SL{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.N=n||dD(e)}Ba(e,t,n,r=!1){return new EL({Da:e,methodName:t,La:n,path:uN.emptyPath(),xa:!1,Ma:r},this.databaseId,this.N,this.ignoreUndefinedProperties)}}function kL(e){var t=e._freezeSettings(),n=dD(e._databaseId);return new SL(e._databaseId,!!t.ignoreUndefinedProperties,n)}function CL(e,t,n,r,i,s={}){const o=e.Ba(s.merge||s.mergeFields?2:0,t,n,i);jL("Data must be an object, but it was:",o,r),r=UL(r,o);let a,c;if(s.merge)a=new hN(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const l of s.mergeFields){const i=VL(t,l,n);if(!o.contains(i))throw new KA(BA.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);$L(e,i)||e.push(i)}a=new hN(e),c=o.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,c=o.fieldTransforms;return new bL(new MN(r),a,c)}class AL extends vL{_toFieldTransform(e){if(2!==e.Da)throw 1===e.Da?e.Fa(`${this._methodName}() can only appear at the top level of your update data`):e.Fa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof AL}}function NL(e,t,n){return new EL({Da:3,La:t.settings.La,methodName:e._methodName,xa:n},t.databaseId,t.N,t.ignoreUndefinedProperties)}class RL extends vL{_toFieldTransform(e){return new xR(e.path,new ER)}isEqual(e){return e instanceof RL}}class PL extends vL{constructor(e,t){super(e),this.Ua=t}_toFieldTransform(e){const t=NL(this,e,!0),n=this.Ua.map(e=>FL(e,t)),r=new SR(n);return new xR(e.path,r)}isEqual(e){return this===e}}class xL extends vL{constructor(e,t){super(e),this.Ua=t}_toFieldTransform(e){const t=NL(this,e,!0),n=this.Ua.map(e=>FL(e,t)),r=new CR(n);return new xR(e.path,r)}isEqual(e){return this===e}}class OL extends vL{constructor(e,t){super(e),this.qa=t}_toFieldTransform(e){var t=new NR(e.N,bR(e.N,this.qa));return new xR(e.path,t)}isEqual(e){return this===e}}function DL(e,r,i,t){const s=e.Ba(1,r,i);jL("Data must be an object, but it was:",s,t);const o=[],a=MN.empty();return sN(t,(e,t)=>{var n=KL(r,e,i);t=Qd(t),e=s.$a(n),t instanceof AL?o.push(n):null!=(e=FL(t,e))&&(o.push(n),a.set(n,e))}),t=new hN(o),new IL(a,t,s.fieldTransforms)}function LL(t,n,e,r,i,s){const o=t.Ba(1,n,e),a=[VL(n,r,e)],c=[i];if(s.length%2!=0)throw new KA(BA.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(VL(n,s[e])),c.push(s[e+1]);const l=[],u=MN.empty();for(let e=a.length-1;0<=e;--e)if(!$L(l,a[e])){const n=a[e];var h=Qd(c[e]);const r=o.$a(n);if(h instanceof AL)l.push(n);else{const t=FL(h,r);null!=t&&(l.push(n),u.set(n,t))}}return i=new hN(l),new IL(u,i,o.fieldTransforms)}function ML(e,t,n,r=!1){return FL(n,e.Ba(r?4:3,t))}function FL(s,e){if(qL(s=Qd(s)))return jL("Unsupported field value:",e,s),UL(s,e);if(s instanceof vL)return function(e,t){if(!TL(t.Da))throw t.Fa(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Fa(`${e._methodName}() is not currently supported inside arrays`);(e=e._toFieldTransform(t))&&t.fieldTransforms.push(e)}(s,e),null;if(void 0===s&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.xa&&4!==e.Da)throw e.Fa("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const i of s){let e=FL(i,t.Oa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=Qd(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return bR(t.N,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=nN.fromDate(e);return{timestampValue:wP(t.N,n)}}if(e instanceof nN)return n=new nN(e.seconds,1e3*Math.floor(e.nanoseconds/1e3)),{timestampValue:wP(t.N,n)};if(e instanceof _L)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof yL)return{bytesValue:bP(t.N,e._byteString)};if(e instanceof tL){const r=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(r))throw t.Fa(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:TP(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Fa(`Unsupported field value: ${Y1(e)}`)}(0,e)}function UL(e,n){const r={};return oN(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):sN(e,(e,t)=>{null!=(t=FL(t,n.Na(e)))&&(r[e]=t)}),{mapValue:{fields:r}}}function qL(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof nN||e instanceof _L||e instanceof yL||e instanceof tL||e instanceof vL)}function jL(e,t,n){if(!qL(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))throw"an object"===(n=Y1(n))?t.Fa(e+" a custom object"):t.Fa(e+" "+n);var r}function VL(e,t,n){if((t=Qd(t))instanceof mL)return t._internalPath;if("string"==typeof t)return KL(e,t);throw zL("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}const BL=new RegExp("[~\\*/\\[\\]]");function KL(t,n,r){if(0<=n.search(BL))throw zL(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new mL(...n.split("."))._internalPath}catch(e){throw zL(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function zL(e,t,n,r,i){var s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new KA(BA.INVALID_ARGUMENT,a+e+c)}function $L(e,t){return e.some(e=>e.isEqual(t))}class WL{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new tL(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new HL(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document&&null!==(e=this._document.data.field(GL("DocumentSnapshot.get",e))))return this._userDataWriter.convertValue(e)}}class HL extends WL{data(){return super.data()}}function GL(e,t){return"string"==typeof t?KL(e,t):(t instanceof mL?t:t._delegate)._internalPath}class QL{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class YL extends WL{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new JL(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document&&null!==(e=this._document.data.field(GL("DocumentSnapshot.get",e))))return this._userDataWriter.convertValue(e,t.serverTimestamps)}}class JL extends YL{data(e={}){return super.data(e)}}class XL{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new QL(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new JL(this._firestore,this._userDataWriter,e.key,e,new QL(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){if((e=!!e.includeMetadataChanges)&&this._snapshot.excludesMetadataChanges)throw new KA(BA.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let t=0;return s._snapshot.docChanges.map(e=>({type:"added",doc:new JL(s._firestore,s._userDataWriter,e.doc.key,e.doc,new QL(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:t++}))}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new JL(s._firestore,s._userDataWriter,e.doc.key,e.doc,new QL(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(){switch(e.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return jA()}}(),doc:t,oldIndex:n,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function ZL(e,t){return e instanceof YL&&t instanceof YL?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof XL&&t instanceof XL&&e._firestore===t._firestore&&aL(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function eM(e){if(aR(e)&&0===e.explicitOrderBy.length)throw new KA(BA.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class tM{}function nM(e,...t){for(const n of t)e=n._apply(e);return e}class rM extends tM{constructor(e,t,n){super(),this.Ka=e,this.ja=t,this.Qa=n,this.type="where"}_apply(e){var t=kL(e.firestore),t=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new KA(BA.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on FieldPath.documentId().`);if("in"===s||"not-in"===s){uM(o,s);const t=[];for(const n of o)t.push(lM(r,e,n));a={arrayValue:{values:t}}}else a=lM(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||uM(o,s),a=ML(n,t,o,"in"===s||"not-in"===s);return function(e,t){if(t.v()){const r=lR(e);if(null!==r&&!r.isEqual(t.field))throw new KA(BA.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${t.field.toString()}'`);var n=cR(e);null!==n&&hM(0,t.field,n)}const r=function(e,t){for(const n of e.filters)if(0<=t.indexOf(n.op))return n.op;return null}(e,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new KA(BA.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new KA(BA.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}(e,s=KN.create(i,s,a)),s}(e._query,"where",t,e.firestore._databaseId,this.Ka,this.ja,this.Qa);return new nL(e.firestore,e.converter,(t=(e=e._query).filters.concat([t]),new rR(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))}}class iM extends tM{constructor(e,t){super(),this.Ka=e,this.Wa=t,this.type="orderBy"}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new KA(BA.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new KA(BA.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new eR(t,n);return t=r,null!==cR(n=e)||null!==(e=lR(n))&&hM(0,e,t.field),r}(e._query,this.Ka,this.Wa);return new nL(e.firestore,e.converter,(t=(e=e._query).explicitOrderBy.concat([t]),new rR(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class sM extends tM{constructor(e,t,n){super(),this.type=e,this.Ga=t,this.za=n}_apply(e){return new nL(e.firestore,e.converter,pR(e._query,this.Ga,this.za))}}class oM extends tM{constructor(e,t,n){super(),this.type=e,this.Ha=t,this.Ja=n}_apply(e){var t=cM(e,this.type,this.Ha,this.Ja);return new nL(e.firestore,e.converter,(e=e._query,new rR(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)))}}class aM extends tM{constructor(e,t,n){super(),this.type=e,this.Ha=t,this.Ja=n}_apply(e){var t=cM(e,this.type,this.Ha,this.Ja);return new nL(e.firestore,e.converter,(e=e._query,new rR(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)))}}function cM(e,t,n,r){if(n[0]=Qd(n[0]),n[0]instanceof WL)return function(e,t,n,r,i){if(!r)throw new KA(BA.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of hR(e))if(n.field.isKeyField())s.push(NN(t,r.key));else{const e=r.data.field(n.field);if(yN(e))throw new KA(BA.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new KA(BA.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new XN(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=kL(e.firestore);return function(t,n,r,i,s,e){const o=t.explicitOrderBy;if(s.length>o.length)throw new KA(BA.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let e=0;e<s.length;e++){const c=s[e];if(o[e].field.isKeyField()){if("string"!=typeof c)throw new KA(BA.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof c}`);if(!uR(t)&&-1!==c.indexOf("/"))throw new KA(BA.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${i}() must be a plain document ID, but '${c}' contains a slash.`);const r=t.path.child(cN.fromString(c));if(!IN.isDocumentKey(r))throw new KA(BA.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${i}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);const s=new IN(r);a.push(NN(n,s))}else{const t=ML(r,i,c);a.push(t)}}return new XN(a,e)}(e._query,e.firestore._databaseId,i,t,n,r)}function lM(e,t,n){if("string"==typeof(n=Qd(n))){if(""===n)throw new KA(BA.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!uR(t)&&-1!==n.indexOf("/"))throw new KA(BA.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);if(t=t.path.child(cN.fromString(n)),!IN.isDocumentKey(t))throw new KA(BA.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${t}' is not because it has an odd number of segments (${t.length}).`);return NN(e,new IN(t))}if(n instanceof tL)return NN(e,n._key);throw new KA(BA.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${Y1(n)}.`)}function uM(e,t){if(!Array.isArray(e)||0===e.length)throw new KA(BA.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new KA(BA.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function hM(e,t,n){if(!n.isEqual(t))throw new KA(BA.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class dM{convertValue(e,t="none"){switch(TN(e)){case 0:return null;case 1:return e.booleanValue;case 2:return gN(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(mN(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw jA()}}convertObject(e,n){const r={};return sN(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new _L(gN(e.latitude),gN(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){return yN(t=t.mapValue.fields.__previous_value__)?e(t):t}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(vN(e));default:return null}}convertTimestamp(e){return e=fN(e),new nN(e.seconds,e.nanos)}convertDocumentKey(e,t){const n=cN.fromString(e);VA(BP(n));const r=new z1(n.get(1),n.get(3)),i=new IN(n.popFirst(5));return r.isEqual(t)||FA(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function pM(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class fM extends dM{constructor(e){super(),this.firestore=e}convertBytes(e){return new yL(e)}convertReference(e){return e=this.convertDocumentKey(e,this.firestore._databaseId),new tL(this.firestore,null,e)}}class gM{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=kL(e)}set(e,t,n){this._verifyNotCommitted();const r=mM(e,this._firestore),i=pM(r.converter,t,n),s=CL(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,DR.none())),this}update(e,t,n,...r){this._verifyNotCommitted(),e=mM(e,this._firestore);let i;return i="string"==typeof(t=Qd(t))||t instanceof mL?LL(this._dataReader,"WriteBatch.update",e._key,t,n,r):DL(this._dataReader,"WriteBatch.update",e._key,t),this._mutations.push(i.toMutation(e._key,DR.exists(!0))),this}delete(e){return this._verifyNotCommitted(),e=mM(e,this._firestore),this._mutations=this._mutations.concat(new WR(e._key,DR.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new KA(BA.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function mM(e,t){if((e=Qd(e)).firestore!==t)throw new KA(BA.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class yM extends dM{constructor(e){super(),this.firestore=e}convertBytes(e){return new yL(e)}convertReference(e){return e=this.convertDocumentKey(e,this.firestore._databaseId),new tL(this.firestore,null,e)}}function vM(e,t,n){e=J1(e,tL);var r=J1(e.firestore,hL),t=pM(e.converter,t,n);return bM(r,[CL(kL(r),"setDoc",e._key,t,null!==e.converter,n).toMutation(e._key,DR.none())])}function _M(e,t,n,...r){e=J1(e,tL);var i=J1(e.firestore,hL),s=kL(i);let o;return o="string"==typeof(t=Qd(t))||t instanceof mL?LL(s,"updateDoc",e._key,t,n,r):DL(s,"updateDoc",e._key,t),bM(i,[o.toMutation(e._key,DR.exists(!0))])}function wM(t,...n){var e;t=Qd(t);let r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||lL(n[i])||(r=n[i],i++);var s={includeMetadataChanges:r.includeMetadataChanges};if(lL(n[i])){const t=n[i];n[i]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[i+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[i+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let o,a,c;if(t instanceof tL)a=J1(t.firestore,hL),c=sR(t._key.path),o={next:e=>{n[i]&&n[i](IM(a,t,e))},error:n[i+1],complete:n[i+2]};else{const l=J1(t,nL);a=J1(l.firestore,hL),c=l._query;const u=new yM(a);o={next:e=>{n[i]&&n[i](new XL(a,u,l,e))},error:n[i+1],complete:n[i+2]},eM(t._query)}return function(e,t,n,r){const i=new k1(r),s=new GD(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>$D(await q1(e),s)),()=>{i.Xo(),e.asyncQueue.enqueueAndForget(async()=>WD(await q1(e),s))}}(dL(a),c,s,o)}function bM(e,t){return function(e,t){const n=new zA;return e.asyncQueue.enqueueAndForget(async()=>o1(await U1(e),t,n)),n.promise}(dL(e),t)}function IM(e,t,n){var r=n.docs.get(t._key),i=new yM(e);return new YL(e,i,t._key,r,new QL(n.hasPendingWrites,n.fromCache),t.converter)}class TM extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=kL(e)}get(e){const n=mM(e,this._firestore),r=new fM(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return jA();const t=e[0];if(t.isFoundDocument())return new WL(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new WL(this._firestore,r,n._key,null,n.converter);throw jA()})}set(e,t,n){return t=pM((e=mM(e,this._firestore)).converter,t,n),n=CL(this._dataReader,"Transaction.set",e._key,t,null!==e.converter,n),this._transaction.set(e._key,n),this}update(e,t,n,...r){return e=mM(e,this._firestore),t="string"==typeof(t=Qd(t))||t instanceof mL?LL(this._dataReader,"Transaction.update",e._key,t,n,r):DL(this._dataReader,"Transaction.update",e._key,t),this._transaction.update(e._key,t),this}delete(e){return e=mM(e,this._firestore),this._transaction.delete(e._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=mM(e,this._firestore),n=new yM(this._firestore);return super.get(e).then(e=>new YL(this._firestore,n,t._key,e._document,new QL(!1,!1),t.converter))}}function EM(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new KA("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function SM(){if("undefined"==typeof Uint8Array)throw new KA("unimplemented","Uint8Arrays are not available in this environment.")}function kM(){if("undefined"==typeof atob)throw new KA("unimplemented","Blobs are unavailable in Firestore in this environment.")}xa=kp,OA=xa,Ip(new ep("firestore",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=new hL(n,new GA(e.getProvider("auth-internal")));return t=Object.assign({useFetchStreams:!0},t),r._setSettings(t),r},"PUBLIC")),Rp("@firebase/firestore","3.1.0",void 0);class CM{constructor(e){this._delegate=e}static fromBase64String(e){return kM(),new CM(yL.fromBase64String(e))}static fromUint8Array(e){return SM(),new CM(yL.fromUint8Array(e))}toBase64(){return kM(),this._delegate.toBase64()}toUint8Array(){return SM(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function AM(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const n of["next","error","complete"])if(n in t&&"function"==typeof t[n])return 1}}(e)}class NM{enableIndexedDbPersistence(e,t){return function(e,t){gL(e=J1(e,hL));var n=dL(e),r=e._freezeSettings();return fL(n,e=new E1,new I1(e,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){gL(e=J1(e,hL));var t=dL(e),n=e._freezeSettings();return fL(t,e=new E1,new T1(e,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(t){if(t._initialized&&!t._terminated)throw new KA(BA.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const n=new zA;return t._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{e=EO(t._databaseId,t._persistenceKey),await(px.bt()?(e+="main",void await px.delete(e)):Promise.resolve()),n.resolve()}catch(e){n.reject(e)}var e}),n.promise}(e._delegate)}}class RM{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof z1||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||UA("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(n,e,r,i={}){const s=(n=J1(n,eL))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&UA("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${r}`,ssl:!1})),i.mockUserToken){let e,t;if("string"==typeof i.mockUserToken)e=i.mockUserToken,t=xA.MOCK_USER;else{e=pd(i.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new KA(BA.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new xA(s)}n._credentials=new HA(new $A(e,t))}}(this._delegate,e,t,n)}enableNetwork(){return e=this._delegate,(n=dL(e=J1(e,hL))).asyncQueue.enqueue(async()=>{const e=await L1(n),t=await F1(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.Kr.delete(0),wD(e)}()});var e,n}disableNetwork(){return e=this._delegate,(n=dL(e=J1(e,hL))).asyncQueue.enqueue(async()=>{const e=await L1(n),t=await F1(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.Kr.add(0),await bD(e),e.Wr.set("Offline")}()});var e,n}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,H1("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(e){const t=new zA;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;AD(n.remoteStore)||MA("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.In.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.Bo.get(e)||[];r.push(t),n.Bo.set(e,r)}catch(e){const n=qD(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await U1(e),t)),t.promise}(dL(J1(this._delegate,hL)))}onSnapshotsInSync(e){return t=this._delegate,e=e,function(e,t){const n=new k1(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Zr.add(t),t.next()}(await q1(e),n)),()=>{n.Xo(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Zr.delete(t)}(await q1(e),n))}}(dL(t=J1(t,hL)),lL(e)?e:{next:e});var t}get app(){if(!this._appCompat)throw new KA("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new zM(this,iL(this._delegate,e))}catch(e){throw MM(e,"collection()","Firestore.collection()")}}doc(e){try{return new LM(this,sL(this._delegate,e))}catch(e){throw MM(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new VM(this,function(e,t){if(e=J1(e,eL),W1("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new KA(BA.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new nL(e,null,new rR(cN.emptyPath(),t))}(this._delegate,e))}catch(e){throw MM(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return n=this._delegate,r=e=>t(new xM(this,e)),function(t,n){const r=new zA;return t.asyncQueue.enqueueAndForget(async()=>{var e=await D1(t).then(e=>e.datastore);new N1(t.asyncQueue,e,n,r).run()}),r.promise}(dL(n),e=>r(new TM(n,e)));var n,r}batch(){return dL(this._delegate),new OM(new gM(this._delegate,e=>bM(this._delegate,e)))}loadBundle(e){return n=e,r=dL(t=J1(this._delegate,hL)),e=new uL,B1(r,t._databaseId,n,e),e;var t,n,r}namedQuery(e){return t=this._delegate,e=e,n=dL(t=J1(t,hL)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Je.getNamedQuery(e,t))}(await M1(n),r)).then(e=>e?new nL(t,null,e.query):null).then(e=>e?new VM(this,e):null);var t,n,r}}class PM extends dM{constructor(e){super(),this.firestore=e}convertBytes(e){return new CM(new yL(e))}convertReference(e){return e=this.convertDocumentKey(e,this.firestore._databaseId),LM.forKey(e,this.firestore,null)}}class xM{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new PM(e)}get(e){const t=$M(e);return this._delegate.get(t).then(e=>new qM(this._firestore,new YL(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){return e=$M(e),n?(EM("Transaction.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){return e=$M(e),2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){return e=$M(e),this._delegate.delete(e),this}}class OM{constructor(e){this._delegate=e}set(e,t,n){return e=$M(e),n?(EM("WriteBatch.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){return e=$M(e),2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){return e=$M(e),this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class DM{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){return e=new JL(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null),this._delegate.fromFirestore(new jM(this._firestore,e),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=DM.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new DM(e,new PM(e),t),r.set(t,i)),i}}DM.INSTANCES=new WeakMap;class LM{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new PM(e)}static forPath(e,t,n){if(e.length%2!=0)throw new KA("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new LM(t,new tL(t._delegate,n,new IN(e)))}static forKey(e,t,n){return new LM(t,new tL(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new zM(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new zM(this.firestore,iL(this._delegate,e))}catch(e){throw MM(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=Qd(e))instanceof tL&&oL(this._delegate,e)}set(e,t){t=EM("DocumentReference.set",t);try{return t?vM(this._delegate,e,t):vM(this._delegate,e)}catch(e){throw MM(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?_M(this._delegate,e):_M(this._delegate,e,t,...n)}catch(e){throw MM(e,"updateDoc()","DocumentReference.update()")}}delete(){return bM(J1((e=this._delegate).firestore,hL),[new WR(e._key,DR.none())]);var e}onSnapshot(...e){var t=FM(e),e=UM(e,e=>new qM(this.firestore,new YL(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return wM(this._delegate,t,e)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?function(t){t=J1(t,tL);const n=J1(t.firestore,hL),e=dL(n),r=new yM(n);return function(e,t){const n=new zA;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.Qn.An(e,t))}(t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new KA(BA.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){t=qD(e,`Failed to get document '${t} from cache`),n.reject(t)}}(await M1(e),t,n)),n.promise}(e,t._key).then(e=>new YL(n,r,t._key,e,new QL(null!==e&&e.hasLocalMutations,!0),t.converter))}:"server"===(null==e?void 0:e.source)?function(t){t=J1(t,tL);const n=J1(t.firestore,hL);return j1(dL(n),t._key,{source:"server"}).then(e=>IM(n,t,e))}:function(t){t=J1(t,tL);const n=J1(t.firestore,hL);return j1(dL(n),t._key).then(e=>IM(n,t,e))})(this._delegate),t.then(e=>new qM(this.firestore,new YL(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new LM(this.firestore,e?this._delegate.withConverter(DM.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function MM(e,t,n){return e.message=e.message.replace(t,n),e}function FM(e){for(const t of e)if("object"==typeof t&&!AM(t))return t;return{}}function UM(e,t){let n;return n=AM(e[0])?e[0]:AM(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{n.next&&n.next(t(e))},error:null===(e=n.error)||void 0===e?void 0:e.bind(n),complete:null===(e=n.complete)||void 0===e?void 0:e.bind(n)}}class qM{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new LM(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return ZL(this._delegate,e._delegate)}}class jM extends qM{data(e){return void 0!==(e=this._delegate.data(e))||jA(),e}}class VM{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new PM(e)}where(e,t,n){try{return new VM(this.firestore,nM(this._delegate,(i=t,s=n,r=GL("where",e),new rM(r,i,s))))}catch(e){throw MM(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new VM(this.firestore,nM(this._delegate,([n,r="asc"]=[e,t],n=GL("orderBy",n),new iM(n,r))))}catch(e){throw MM(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r}limit(e){try{return new VM(this.firestore,nM(this._delegate,(X1("limit",t=e),new sM("limit",t,"F"))))}catch(e){throw MM(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new VM(this.firestore,nM(this._delegate,(X1("limitToLast",t=e),new sM("limitToLast",t,"L"))))}catch(e){throw MM(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new VM(this.firestore,nM(this._delegate,function(...e){return new oM("startAt",e,!0)}(...e)))}catch(e){throw MM(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new VM(this.firestore,nM(this._delegate,function(...e){return new oM("startAfter",e,!1)}(...e)))}catch(e){throw MM(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new VM(this.firestore,nM(this._delegate,function(...e){return new aM("endBefore",e,!0)}(...e)))}catch(e){throw MM(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new VM(this.firestore,nM(this._delegate,function(...e){return new aM("endAt",e,!1)}(...e)))}catch(e){throw MM(e,"endAt()","Query.endAt()")}}isEqual(e){return aL(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?function(t){t=J1(t,nL);const n=J1(t.firestore,hL),e=dL(n),r=new yM(n);return function(e,t){const n=new zA;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await MO(e,t,!0),i=new t1(t,r.Gn),s=i.Io(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){t=qD(e,`Failed to execute query '${t} against cache`),n.reject(t)}}(await M1(e),t,n)),n.promise}(e,t._query).then(e=>new XL(n,r,t,e))}:"server"===(null==e?void 0:e.source)?function(t){t=J1(t,nL);const n=J1(t.firestore,hL),e=dL(n),r=new yM(n);return V1(e,t._query,{source:"server"}).then(e=>new XL(n,r,t,e))}:function(t){t=J1(t,nL);const n=J1(t.firestore,hL),e=dL(n),r=new yM(n);return eM(t._query),V1(e,t._query).then(e=>new XL(n,r,t,e))})(this._delegate),t.then(e=>new KM(this.firestore,new XL(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=FM(e),e=UM(e,e=>new KM(this.firestore,new XL(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return wM(this._delegate,t,e)}withConverter(e){return new VM(this.firestore,e?this._delegate.withConverter(DM.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class BM{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new jM(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class KM{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new VM(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new jM(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new BM(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new jM(this._firestore,e))})}isEqual(e){return ZL(this._delegate,e._delegate)}}class zM extends VM{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new LM(this.firestore,e):null}doc(e){try{return void 0===e?new LM(this.firestore,sL(this._delegate)):new LM(this.firestore,sL(this._delegate,e))}catch(e){throw MM(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=J1(e.firestore,hL),r=sL(e),i=pM(e.converter,t);return bM(n,[CL(kL(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,DR.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new LM(this.firestore,e))}isEqual(e){return oL(this._delegate,e._delegate)}withConverter(e){return new zM(this.firestore,e?this._delegate.withConverter(DM.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function $M(e){return J1(e,tL)}var WM,HM,GM,QM,_t={Firestore:RM,GeoPoint:_L,Timestamp:nN,Blob:CM,Transaction:xM,WriteBatch:OM,DocumentReference:LM,DocumentSnapshot:qM,Query:VM,QueryDocumentSnapshot:jM,QuerySnapshot:KM,CollectionReference:zM,FieldPath:class Bj{constructor(...e){this._delegate=new mL(...e)}static documentId(){return new Bj(uN.keyField().canonicalString())}isEqual(e){return(e=Qd(e))instanceof mL&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class Kj{constructor(e){this._delegate=e}static serverTimestamp(){const e=new RL("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Kj(e)}static delete(){const e=new AL("deleteField");return e._methodName="FieldValue.delete",new Kj(e)}static arrayUnion(...e){const t=function(...e){return new PL("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new Kj(t)}static arrayRemove(...e){const t=function(...e){return new xL("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new Kj(t)}static increment(e){const t=new OL("increment",e);return t._methodName="FieldValue.increment",new Kj(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){DA.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};function YM(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function JM(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>JM(e)):"function"==typeof e||"object"==typeof e?YM(e,e=>JM(e)):e}xa=Fp,EA=(e,t)=>new RM(e,t,new NM),xa.INTERNAL.registerComponent(new ep("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("firestore").getImmediate();return EA(t,e)},"PUBLIC").setServiceProps(Object.assign({},_t))),xa.registerVersion("@firebase/firestore-compat","0.1.3");const XM="functions",ZM={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class eF extends Ed{constructor(e,t,n){super(`${XM}/${e}`,t||""),this.details=n}}class tF{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return this.messaging.getToken()}catch(e){return}}async getAppCheckToken(){if(this.appCheck){var e=await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken()}}}const nF="us-central1";class rF{constructor(e,t,n,r,i=nF,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new tF(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var o=new URL(i);this.customDomain=o.origin,this.region=nF}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null===this.emulatorOrigin?null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`:`${this.emulatorOrigin}/${t}/${this.region}/${e}`}}function iF(t,l,n){return e=>async function(e,t,n){const r=e._url(l),i={data:function t(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>t(e));if("function"==typeof e||"object"==typeof e)return YM(e,e=>t(e));throw new Error("Data cannot be encoded in JSON: "+e)}(t)},s={},o=await e.contextProvider.getContext();var a;if(o.authToken&&(s.Authorization="Bearer "+o.authToken),o.messagingToken&&(s["Firebase-Instance-ID-Token"]=o.messagingToken),null!==o.appCheckToken&&(s["X-Firebase-AppCheck"]=o.appCheckToken),n=n.timeout||7e4,!(n=await Promise.race([async function(e,t,n,r){n["Content-Type"]="application/json";let i;try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}(r,i,s,e.fetchImpl),(a=n,new Promise((e,t)=>{setTimeout(()=>{t(new eF("deadline-exceeded","deadline-exceeded"))},a)})),e.cancelAllRequests])))throw new eF("cancelled","Firebase Functions instance was deleted.");if(e=function(e,t){let n=function(){if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(),r=n,i=void 0;try{var s=t&&t.error;if(s){const e=s.status;if("string"==typeof e){if(!ZM[e])return new eF("internal","internal");n=ZM[e],r=e}var o=s.message;"string"==typeof o&&(r=o),i=s.details,void 0!==i&&(i=JM(i))}}catch(e){}return"ok"===n?null:new eF(n,r,i)}(n.status,n.json))throw e;if(!n.json)throw new eF("internal","Response is not valid JSON object.");let c=n.json.data;if(void 0===c&&(c=n.json.result),void 0===c)throw new eF("internal","Response is missing data field.");return{data:n=JM(c)}}(t,e,n||{})}function sF(e,t,n){Qd(e).emulatorOrigin=`http://${t}:${n}`}WM=fetch.bind(self),Ip(new ep(XM,(e,{instanceIdentifier:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),e=e.getProvider("app-check-internal");return new rF(n,r,i,e,t,WM)},"PUBLIC").setMultipleInstances(!0)),Rp("@firebase/functions","0.7.2");class oF{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return iF(Qd(this._delegate),e,t)}useFunctionsEmulator(e){if(null==(e=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?")))throw new Ed("functions","No origin provided to useFunctionsEmulator()");if(null==e[2])throw new Ed("functions","Port missing in origin provided to useFunctionsEmulator()");return sF(this._delegate,e[1],Number(e[2]))}useEmulator(e,t){return sF(this._delegate,e,t)}}_t={Functions:oF},Fp.INTERNAL.registerComponent(new ep("functions-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("functions").getImmediate({identifier:null!=t?t:"us-central1"});return new oF(n,t)},"PUBLIC").setServiceProps(_t).setMultipleInstances(!0)),Fp.registerVersion("@firebase/functions-compat","0.1.3");const aF="/firebase-messaging-sw.js",cF="/firebase-cloud-messaging-push-scope",lF="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",uF="https://fcmregistrations.googleapis.com/v1",hF="google.c.a.c_id",dF="google.c.a.e";function pF(e){e=new Uint8Array(e);const t=btoa(String.fromCharCode(...e));return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(Lq=Lq||{})[Lq.DATA_MESSAGE=1]="DATA_MESSAGE",Lq[Lq.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(Lq=HM=HM||{}).PUSH_RECEIVED="push-received",Lq.NOTIFICATION_CLICKED="notification-clicked";const fF="fcm_token_details_db",gF="fcm_token_object_Store";const mF="firebase-messaging-database",yF=1,vF="firebase-messaging-store";let _F=null;function wF(){return _F=_F||Yp(mF,yF,e=>{0===e.oldVersion&&e.createObjectStore(vF)}),_F}async function bF(e){var t=TF(e);const n=await wF();return(t=await n.transaction(vF).objectStore(vF).get(t))?t:(t=await async function(s){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(fF))return null}let o=null;const e=await Yp(fF,5,async e=>{var t;if(!(e.oldVersion<2)&&e.objectStoreNames.contains(gF)){const i=e.transaction.objectStore(gF);var n,r=await i.index("fcmSenderId").get(s);await i.clear(),r&&(2===e.oldVersion?(n=r).auth&&n.p256dh&&n.endpoint&&(o={token:n.fcmToken,createTime:null!==(t=n.createTime)&&void 0!==t?t:Date.now(),subscriptionOptions:{auth:n.auth,p256dh:n.p256dh,endpoint:n.endpoint,swScope:n.swScope,vapidKey:"string"==typeof n.vapidKey?n.vapidKey:pF(n.vapidKey)}}):3===e.oldVersion?(n=r,o={token:n.fcmToken,createTime:n.createTime,subscriptionOptions:{auth:pF(n.auth),p256dh:pF(n.p256dh),endpoint:n.endpoint,swScope:n.swScope,vapidKey:pF(n.vapidKey)}}):4===e.oldVersion&&(o={token:r.fcmToken,createTime:r.createTime,subscriptionOptions:{auth:pF(r.auth),p256dh:pF(r.p256dh),endpoint:r.endpoint,swScope:r.swScope,vapidKey:pF(r.vapidKey)}}))}});return e.close(),await Jp(fF),await Jp("fcm_vapid_details_db"),await Jp("undefined"),function(e){if(e&&e.subscriptionOptions){var t=e.subscriptionOptions;return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}}(o)?o:null}(e.appConfig.senderId))?(await IF(e,t),t):void 0}async function IF(e,t){e=TF(e);const n=await wF(),r=n.transaction(vF,"readwrite");return await r.objectStore(vF).put(t,e),await r.complete,t}function TF({appConfig:e}){return e.appId}const EF=new Sd("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function SF(e,t){var n={method:"DELETE",headers:await CF(e)};try{const s=await fetch(`${kF(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw EF.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw EF.create("token-unsubscribe-failed",{errorInfo:e})}}function kF({projectId:e}){return`${uF}/projects/${e}/registrations`}async function CF({appConfig:e,installations:t}){return t=await t.getToken(),new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function AF({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==lF&&(i.web.applicationPubKey=r),i}const NF=6048e5;async function RF(e){var t=await bF(e.firebaseDependencies);t&&(await SF(e.firebaseDependencies,t.token),await async function(e){e=TF(e);const t=await wF(),n=t.transaction(vF,"readwrite");await n.objectStore(vF).delete(e),await n.complete}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function PF(e,t){return await IF(e,t={token:await async function(e,t){var n=await CF(e),t=AF(t),t={method:"POST",headers:n,body:JSON.stringify(t)};let r;try{const i=await fetch(kF(e.appConfig),t);r=await i.json()}catch(e){throw EF.create("token-subscribe-failed",{errorInfo:e})}if(r.error)throw t=r.error.message,EF.create("token-subscribe-failed",{errorInfo:t});if(!r.token)throw EF.create("token-subscribe-no-token");return r.token}(e,t),createTime:Date.now(),subscriptionOptions:t}),t.token}function xF(e){var t,n,r={from:e.from,collapseKey:e.collapse_key,messageId:e.fcm_message_id},i=r;return(n=e).notification&&(i.notification={},(t=n.notification.title)&&(i.notification.title=t),(t=n.notification.body)&&(i.notification.body=t),(n=n.notification.image)&&(i.notification.image=n)),i=r,(n=e).data&&(i.data=n.data),i=r,(n=e).fcmOptions&&(i.fcmOptions={},(e=n.fcmOptions.link)&&(i.fcmOptions.link=e),(n=n.fcmOptions.analytics_label)&&(i.fcmOptions.analyticsLabel=n)),r}function OF(t,n){const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),e<n.length&&r.push(n.charAt(e));return r.join("")}function DF(e){return EF.create("missing-app-config-values",{valueName:e})}OF("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),OF("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class LF{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw DF("App Configuration Object");if(!e.name)throw DF("App Name");var t=e.options;for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw DF(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function MF(e){try{e.swRegistration=await navigator.serviceWorker.register(aF,{scope:cF}),e.swRegistration.update().catch(()=>{})}catch(e){throw EF.create("failed-service-worker-registration",{browserErrorMessage:e.message})}}async function FF(e,t){if(!navigator)throw EF.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw EF.create("permission-blocked");var n,r=e;return await((n=null==t?void 0:t.vapidKey)?r.vapidKey=n:r.vapidKey||(r.vapidKey=lF)),await async function(e,t){if(t||e.swRegistration||await MF(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw EF.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),async function(e){const t=(o=e.swRegistration,r=e.vapidKey,await(await o.pushManager.getSubscription()||o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){e=(r+"=".repeat((4-r.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}()})));var r,n,i,s,o,a={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:pF(t.getKey("auth")),p256dh:pF(t.getKey("p256dh"))},c=await bF(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,i=a.vapidKey===n.vapidKey,s=a.endpoint===n.endpoint,o=a.auth===n.auth,n=a.p256dh===n.p256dh,i&&s&&o&&n)return Date.now()>=c.createTime+NF?async function(e,t){try{var n=await async function(e,t){var n=await CF(e),r=AF(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${kF(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw EF.create("token-update-failed",{errorInfo:e})}if(i.error)throw r=i.error.message,EF.create("token-update-failed",{errorInfo:r});if(!i.token)throw EF.create("token-update-no-token");return i.token}(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await IF(e.firebaseDependencies,r),n}catch(t){throw await RF(e),t}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:a}):c.token;try{await SF(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return PF(e.firebaseDependencies,a)}return PF(e.firebaseDependencies,a)}(e)}async function UF(e,t){var n,r=t.data;r.isFirebaseMessaging&&(e.onMessageHandler&&r.messageType===HM.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(xF(r)):e.onMessageHandler.next(xF(r))),"object"==typeof(t=n=r.data)&&t&&hF in t&&"1"===n[dF]&&await async function(e,t,n){t=function(){switch(t){case HM.NOTIFICATION_CLICKED:return"notification_open";case HM.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}();const r=await e.firebaseDependencies.analyticsProvider.get();r.logEvent(t,{message_id:n[hF],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}(e,r.messageType,n))}Ip(new ep("messaging",e=>{const t=new LF(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>UF(t,e)),t},"PUBLIC")),Ip(new ep("messaging-internal",e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>FF(t,e)}},"PRIVATE"));const qF="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",jF="https://fcmregistrations.googleapis.com/v1",VF="FCM_MSG",BF="google.c.a.c_id",KF=3,zF=1;function $F(e){e=new Uint8Array(e);const t=btoa(String.fromCharCode(...e));return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(Lq=GM=GM||{})[Lq.DATA_MESSAGE=1]="DATA_MESSAGE",Lq[Lq.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(Lq=QM=QM||{}).PUSH_RECEIVED="push-received",Lq.NOTIFICATION_CLICKED="notification-clicked";const WF="fcm_token_details_db",HF="fcm_token_object_Store";const GF="firebase-messaging-database",QF=1,YF="firebase-messaging-store";let JF=null;function XF(){return JF=JF||Yp(GF,QF,e=>{0===e.oldVersion&&e.createObjectStore(YF)}),JF}async function ZF(e){var t=tU(e);const n=await XF();return(t=await n.transaction(YF).objectStore(YF).get(t))?t:(t=await async function(s){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(WF))return null}let o=null;const e=await Yp(WF,5,async e=>{var t;if(!(e.oldVersion<2)&&e.objectStoreNames.contains(HF)){const i=e.transaction.objectStore(HF);var n,r=await i.index("fcmSenderId").get(s);await i.clear(),r&&(2===e.oldVersion?(n=r).auth&&n.p256dh&&n.endpoint&&(o={token:n.fcmToken,createTime:null!==(t=n.createTime)&&void 0!==t?t:Date.now(),subscriptionOptions:{auth:n.auth,p256dh:n.p256dh,endpoint:n.endpoint,swScope:n.swScope,vapidKey:"string"==typeof n.vapidKey?n.vapidKey:$F(n.vapidKey)}}):3===e.oldVersion?(n=r,o={token:n.fcmToken,createTime:n.createTime,subscriptionOptions:{auth:$F(n.auth),p256dh:$F(n.p256dh),endpoint:n.endpoint,swScope:n.swScope,vapidKey:$F(n.vapidKey)}}):4===e.oldVersion&&(o={token:r.fcmToken,createTime:r.createTime,subscriptionOptions:{auth:$F(r.auth),p256dh:$F(r.p256dh),endpoint:r.endpoint,swScope:r.swScope,vapidKey:$F(r.vapidKey)}}))}});return e.close(),await Jp(WF),await Jp("fcm_vapid_details_db"),await Jp("undefined"),function(e){if(e&&e.subscriptionOptions){var t=e.subscriptionOptions;return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}}(o)?o:null}(e.appConfig.senderId))?(await eU(e,t),t):void 0}async function eU(e,t){e=tU(e);const n=await XF(),r=n.transaction(YF,"readwrite");return await r.objectStore(YF).put(t,e),await r.complete,t}function tU({appConfig:e}){return e.appId}const nU=new Sd("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function rU(e,t){var n={method:"DELETE",headers:await sU(e)};try{const s=await fetch(`${iU(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw nU.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw nU.create("token-unsubscribe-failed",{errorInfo:e})}}function iU({projectId:e}){return`${jF}/projects/${e}/registrations`}async function sU({appConfig:e,installations:t}){return t=await t.getToken(),new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function oU({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==qF&&(i.web.applicationPubKey=r),i}async function aU(e){var t=await ZF(e.firebaseDependencies);t&&(await rU(e.firebaseDependencies,t.token),await async function(e){e=tU(e);const t=await XF(),n=t.transaction(YF,"readwrite");await n.objectStore(YF).delete(e),await n.complete}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function cU(e,t){return await eU(e,t={token:await async function(e,t){var n=await sU(e),t=oU(t),t={method:"POST",headers:n,body:JSON.stringify(t)};let r;try{const i=await fetch(iU(e.appConfig),t);r=await i.json()}catch(e){throw nU.create("token-subscribe-failed",{errorInfo:e})}if(r.error)throw t=r.error.message,nU.create("token-subscribe-failed",{errorInfo:t});if(!r.token)throw nU.create("token-subscribe-no-token");return r.token}(e,t),createTime:Date.now(),subscriptionOptions:t}),t.token}async function lU(e,t){t=function(e,t){const n={};return e.from&&(n.project_number=e.from),e.fcm_message_id&&(n.message_id=e.fcm_message_id),n.instance_id=t,e.notification?n.message_type=GM.DISPLAY_NOTIFICATION.toString():n.message_type=GM.DATA_MESSAGE.toString(),n.sdk_platform=KF.toString(),n.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(n.collapse_key=e.collapse_key),n.event=zF.toString(),null!==(t=e.fcmOptions)&&void 0!==t&&t.analytics_label&&(n.analytics_label=null===(e=e.fcmOptions)||void 0===e?void 0:e.analytics_label),n}(t,await e.firebaseDependencies.installations.getId()),function(e,t){const n={};n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),e.logEvents.push(n)}(e,t)}function uU(t,n){const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),e<n.length&&r.push(n.charAt(e));return r.join("")}function hU(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function dU(e){return nU.create("missing-app-config-values",{valueName:e})}uU("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),uU("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class pU{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw dU("App Configuration Object");if(!e.name)throw dU("App Name");var t=e.options;for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw dU(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}var fU;Ip(new ep("messaging-sw",e=>{const t=new pU(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(async function(e,t){var n,r=function({data:e}){if(!e)return null;try{return e.json()}catch(e){return null}}(e);if(r){t.deliveryMetricsExportedToBigQueryEnabled&&await lU(t,r);var i,s,o=await hU();if(o.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")))return function(e,t){t.isFirebaseMessaging=!0,t.messageType=QM.PUSH_RECEIVED;for(const n of e)n.postMessage(t)}(o,r);r.notification&&(s=function(e){const t=Object.assign({},e.notification);return t.data={[VF]:e},t}(r),n=s.actions,i=Notification.maxActions,n&&i&&n.length>i&&console.warn(`This browser only supports ${i} actions. The remaining actions will not be displayed.`),await self.registration.showNotification(null!==(i=s.title)&&void 0!==i?i:"",s)),t&&t.onBackgroundMessageHandler&&(e=s={from:(i=r).from,collapseKey:i.collapse_key,messageId:i.fcm_message_id},(o=i).notification&&(e.notification={},(r=o.notification.title)&&(e.notification.title=r),(r=o.notification.body)&&(e.notification.body=r),(o=o.notification.image)&&(e.notification.image=o)),e=s,(o=i).data&&(e.data=o.data),e=s,(o=i).fcmOptions&&(e.fcmOptions={},(i=o.fcmOptions.link)&&(e.fcmOptions.link=i),(o=o.fcmOptions.analytics_label)&&(e.fcmOptions.analyticsLabel=o)),"function"==typeof t.onBackgroundMessageHandler?t.onBackgroundMessageHandler(s):t.onBackgroundMessageHandler.next(s))}}(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(async function(e,t){(e=e.newSubscription)?(e=await ZF(t.firebaseDependencies),await aU(t),t.vapidKey=null!==(e=null===(e=null==e?void 0:e.subscriptionOptions)||void 0===e?void 0:e.vapidKey)&&void 0!==e?e:qF,await async function(e){const t=(o=e.swRegistration,r=e.vapidKey,await(await o.pushManager.getSubscription()||o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){e=(r+"=".repeat((4-r.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}()})));var r,n,i,s,o,a={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:$F(t.getKey("auth")),p256dh:$F(t.getKey("p256dh"))},c=await ZF(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,i=a.vapidKey===n.vapidKey,s=a.endpoint===n.endpoint,o=a.auth===n.auth,n=a.p256dh===n.p256dh,i&&s&&o&&n)return Date.now()>=c.createTime+6048e5?async function(e,t){try{var n=await async function(e,t){var n=await sU(e),r=oU(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${iU(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw nU.create("token-update-failed",{errorInfo:e})}if(i.error)throw r=i.error.message,nU.create("token-update-failed",{errorInfo:r});if(!i.token)throw nU.create("token-update-no-token");return i.token}(e.firebaseDependencies,t),r=Object.assign(Object.assign({},t),{token:n,createTime:Date.now()});return await eU(e.firebaseDependencies,r),n}catch(t){throw await aU(e),t}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:a}):c.token;try{await rU(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return cU(e.firebaseDependencies,a)}return cU(e.firebaseDependencies,a)}(t)):await aU(t)}(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(async function(e){const t=null===(r=null===(n=e.notification)||void 0===n?void 0:n.data)||void 0===r?void 0:r[VF];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();var n=(i=t,(o=null!==(s=null===(s=i.fcmOptions)||void 0===s?void 0:s.link)&&void 0!==s?s:null===(o=i.notification)||void 0===o?void 0:o.click_action)||("object"==typeof(i=i.data)&&i&&BF in i?self.location.origin:null));if(n){var r=new URL(n,self.location.href),e=new URL(self.location.origin);if(r.host===e.host){let e=await async function(e){for(const n of await hU()){var t=new URL(n.url,self.location.href);if(e.host===t.host)return n}return null}(r);if(e?e=await e.focus():(e=await self.clients.openWindow(n),await new Promise(e=>{setTimeout(e,3e3)})),e)return t.messageType=QM.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}var i,s,o}(e))}),t},"PUBLIC"));class gU{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(t){return async function(e){return FF(Qd(e),t)}(this._delegate)}async deleteToken(){return async function(e){if(!navigator)throw EF.create("only-available-in-window");return e.swRegistration||await MF(e),RF(e)}(Qd(this._delegate))}onMessage(e){return function(e,t){if(!navigator)throw EF.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(Qd(this._delegate),e)}onBackgroundMessage(e){return function(e,t){if(void 0!==self.document)throw nU.create("only-available-in-sw");return e.onBackgroundMessageHandler=t,()=>{e.onBackgroundMessageHandler=null}}(Qd(this._delegate),e)}}xa={isSupported:function(){return self&&"ServiceWorkerGlobalScope"in self?bd()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"undefined"!=typeof window&&bd()&&Td()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}};Fp.INTERNAL.registerComponent(new ep("messaging-compat",e=>self&&"ServiceWorkerGlobalScope"in self?new gU(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new gU(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),"PUBLIC").setServiceProps(xa)),Fp.registerVersion("@firebase/messaging-compat","0.1.1"),(Lq=fU={})[Lq.NO_ERROR=0]="NO_ERROR",Lq[Lq.NETWORK_ERROR=1]="NETWORK_ERROR",Lq[Lq.ABORT=2]="ABORT";const mU="firebasestorage.googleapis.com",yU="storageBucket";class vU extends Ed{constructor(e,t){super(_U(e),`Firebase Storage: ${t} (${_U(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,vU.prototype)}_codeEquals(e){return _U(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function _U(e){return"storage/"+e}function wU(){return new vU("unknown","An unknown error occurred, please check the error payload for server response.")}function bU(){return new vU("canceled","User canceled the upload/download.")}function IU(){return new vU("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function TU(e){return new vU("invalid-argument",e)}function EU(){return new vU("app-deleted","The Firebase app was deleted.")}function SU(e){return new vU("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function kU(e,t){return new vU("invalid-format","String does not match format '"+e+"': "+t)}function CU(e){throw new vU("internal-error","Internal error: "+e)}class AU{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=fU.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=fU.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=fU.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw CU("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw CU("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw CU("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponseText(){if(!this.sent_)throw CU("cannot .getResponseText() before sending");return this.xhr_.responseText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class NU{createConnection(){return new AU}}class RU{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=RU.makeFromUrl(e,t)}catch(t){return new RU(e,"")}if(""===n.path)return n;throw new vU("invalid-default-bucket","Invalid default bucket '"+e+"'.")}static makeFromUrl(t,e){let n=null;var r,i=new RegExp("^gs://([A-Za-z0-9.\\-_]+)(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var o=e.replace(/[.]/g,"\\."),o=new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$`,"i"),e=e===mU?"(?:storage.googleapis.com|storage.cloud.google.com)":e,a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${e}/([A-Za-z0-9.\\-_]+)/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let e=0;e<a.length;e++){const u=a[e];var c=u.regex.exec(t);if(c){var l=c[u.indices.bucket],c=(c=c[u.indices.path])||"";n=new RU(l,c),u.postModify(n);break}}if(null==n)throw r=t,new vU("invalid-url","Invalid URL '"+r+"'.");return n}}class PU{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function xU(e){return"string"==typeof e||e instanceof String}function OU(e){return DU()&&e instanceof Blob}function DU(){return"undefined"!=typeof Blob}function LU(e,t,n,r){if(r<t)throw TU(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n<r)throw TU(`Invalid value for '${e}'. Expected ${n} or less.`)}function MU(e,t,n){return`${n}://${null==n?`https://${t}`:t}/v0${e}`}function FU(e){const t=encodeURIComponent;let n="?";for(const i in e){var r;e.hasOwnProperty(i)&&(r=t(i)+"="+t(e[i]),n=n+r+"&")}return n=n.slice(0,-1),n}class UU{constructor(e,t,n,r,i,s,o,a,c,l,u){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=l,this.pool_=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){var e=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=this.callback_(i,i.getResponseText());void 0!==s?n(s):n()}catch(e){r(e)}else if(null!==i){const o=wU();o.serverResponse=i.getResponseText(),this.errorCallback_?r(this.errorCallback_(i,o)):r(o)}else{t=t.canceled?(this.appDelete_?EU:bU)():new vU("retry-limit-exceeded","Max retry time for operation exceeded, please try again.");r(t)}};this.canceled_?e(0,new qU(!1,null,!0)):this.backoffId_=function(t,n,e){let r=1,i=null,s=!1,o=0;function a(){return 2===o}let c=!1;function l(...e){c||(c=!0,n.apply(null,e))}function u(e){i=setTimeout(()=>{i=null,t(h,a())},e)}function h(e,...t){c||(e||a()||s?l.call(null,e,...t):(r<64&&(r*=2),u(1===o?(o=2,0):1e3*(r+Math.random()))))}let d=!1;function p(e){d||(d=!0,c||(null!==i?(e||(o=2),clearTimeout(i),u(0)):e||(o=1)))}return u(0),setTimeout(()=>{p(s=!0)},e),p}((r,e)=>{if(e)r(!1,new qU(!1,null,!0));else{const i=this.pool_.createConnection();this.pendingConnection_=i;const s=e=>{var t=e.loaded,e=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,e)};null!==this.progressCallback_&&i.addUploadProgressListener(s),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&i.removeUploadProgressListener(s),this.pendingConnection_=null;var e,t=i.getErrorCode()===fU.NO_ERROR,n=i.getStatus();t&&!this.isRetryStatusCode_(n)?(e=-1!==this.successCodes_.indexOf(n),r(!0,new qU(e,i))):(e=i.getErrorCode()===fU.ABORT,r(!1,new qU(!1,null,e)))})}},e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(e){var t=500<=e&&e<600,n=-1!==[408,429].indexOf(e),e=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||e}}class qU{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}const jU={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class VU{constructor(e,t){this.data=e,this.contentType=t||null}}function BU(e,t){switch(e){case jU.RAW:return new VU(KU(t));case jU.BASE64:case jU.BASE64URL:return new VU(zU(e,t));case jU.DATA_URL:return new VU((n=t,(n=new $U(n)).base64?zU(jU.BASE64,n.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw kU(jU.DATA_URL,"Malformed data URL.")}return KU(t)}(n.rest)),(n=t,new $U(n).contentType))}var n;throw wU()}function KU(n){const r=[];for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);var i,s;e<=127?r.push(e):e<=2047?r.push(192|e>>6,128|63&e):55296==(64512&e)?t<n.length-1&&56320==(64512&n.charCodeAt(t+1))?(i=e,s=n.charCodeAt(++t),e=65536|(1023&i)<<10|1023&s,r.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):r.push(239,191,189):56320==(64512&e)?r.push(239,191,189):r.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(r)}function zU(e,t){switch(e){case jU.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw kU(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case jU.BASE64URL:if(r=-1!==t.indexOf("+"),n=-1!==t.indexOf("/"),r||n)throw kU(e,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=atob(t)}catch(t){throw kU(e,"Invalid character found")}const s=new Uint8Array(i.length);for(let e=0;e<i.length;e++)s[e]=i.charCodeAt(e);return s}class $U{constructor(e){this.base64=!1,this.contentType=null;var t,n=e.match(/^data:([^,]+)?,/);if(null===n)throw kU(jU.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;null!=r&&(this.base64=(t=r).length>=(n=";base64").length&&t.substring(t.length-n.length)===n,this.contentType=this.base64?r.substring(0,r.length-";base64".length):r),this.rest=e.substring(e.indexOf(",")+1)}}class WU{constructor(e,t){let n=0,r="";OU(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(OU(this.data_)){var n=this.data_;return null===(i=(r=e,i=t,n.webkitSlice?n.webkitSlice(r,i):n.mozSlice?n.mozSlice(r,i):n.slice?n.slice(r,i):null))?null:new WU(i)}var r,i,e=new Uint8Array(this.data_.buffer,e,t-e);return new WU(e,!0)}static getBlob(...e){if(DU()){var t=e.map(e=>e instanceof WU?e.data_:e);return new WU(function(...t){const e="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==e){const n=new e;for(let e=0;e<t.length;e++)n.append(t[e]);return n.getBlob()}if(DU())return new Blob(t);throw new vU("unsupported-environment","This browser doesn't seem to support creating Blobs")}.apply(null,t))}{const r=e.map(e=>xU(e)?BU(jU.RAW,e).data:e.data_);let t=0;r.forEach(e=>{t+=e.byteLength});const i=new Uint8Array(t);let n=0;return r.forEach(t=>{for(let e=0;e<t.length;e++)i[n++]=t[e]}),new WU(i,!0)}}uploadData(){return this.data_}}function HU(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function GU(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function QU(e,t){return t}class YU{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||QU}}let JU=null;function XU(){if(JU)return JU;const e=[];e.push(new YU("bucket")),e.push(new YU("generation")),e.push(new YU("metageneration")),e.push(new YU("name","fullPath",!0));const t=new YU("name");t.xform=function(e,t){return!xU(t)||t.length<2?t:GU(t)},e.push(t);const n=new YU("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new YU("timeCreated")),e.push(new YU("updated")),e.push(new YU("md5Hash",null,!0)),e.push(new YU("cacheControl",null,!0)),e.push(new YU("contentDisposition",null,!0)),e.push(new YU("contentEncoding",null,!0)),e.push(new YU("contentLanguage",null,!0)),e.push(new YU("contentType",null,!0)),e.push(new YU("metadata","customMetadata",!0)),JU=e,JU}function ZU(e,t,n){return null===(t=HU(t))?null:function(e,t,n){const r={type:"file"};var i,s,o=n.length;for(let e=0;e<o;e++){const a=n[e];r[a.local]=a.xform(r,t[a.server])}return i=r,s=e,Object.defineProperty(i,"ref",{get:function(){var e=i.bucket,t=i.fullPath,t=new RU(e,t);return s._makeStorageReference(t)}}),r}(e,t,n)}function eq(t,n){const r={};var i=n.length;for(let e=0;e<i;e++){var s=n[e];s.writable&&(r[s.server]=t[s.local])}return JSON.stringify(r)}class tq{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function nq(e){if(!e)throw wU()}function rq(n,r){return function(e,t){return nq(null!==(t=ZU(n,t,r))),t}}function iq(s,o){return function(e,t){return nq(null!==(n=s,r=o,t=null===(i=HU(i=t))?null:function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(const o of n.prefixes){var i=o.replace(/\/$/,""),i=e._makeStorageReference(new RU(t,i));r.prefixes.push(i)}if(n.items)for(const a of n.items){var s=e._makeStorageReference(new RU(t,a.name));r.items.push(s)}return r}(n,r,i))),t;var n,r,i}}function sq(i){return function(e,t){let n;var r;return n=401===e.getStatus()?e.getResponseText().includes("Firebase App Check token is invalid")?new vU("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new vU("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=i.bucket,new vU("quota-exceeded","Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(e=i.path,new vU("unauthorized","User does not have permission to access '"+e+"'.")):t,n.serverResponse=t.serverResponse,n}}function oq(r){const i=sq(r);return function(e,t){let n=i(e,t);return 404===e.getStatus()&&(n=(e=r.path,new vU("object-not-found","Object '"+e+"' does not exist."))),n.serverResponse=t.serverResponse,n}}function aq(e,t,n){var r=MU(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new tq(r,"GET",rq(e,n),i);return s.errorHandler=oq(t),s}function cq(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=(e=t,(t=null)&&t.contentType||e&&e.type()||"application/octet-stream")),r}class lq{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function uq(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){nq(!1)}const r=t||["active"];return nq(!!n&&-1!==r.indexOf(n)),n}const hq={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function dq(e){switch(e){case"running":case"pausing":case"canceling":return hq.RUNNING;case"paused":return hq.PAUSED;case"success":return hq.SUCCESS;case"canceled":return hq.CANCELED;default:return hq.ERROR}}class pq{constructor(e,t,n){"function"==typeof e||null!=t||null!=n?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0):(this.next=e.next,this.error=e.error,this.complete=e.complete)}}function fq(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class gq{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=XU(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=e,this._transition("error"))},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(n){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":n(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var n=function(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),o=cq(t,r,i),i={name:o.fullPath},s=MU(s,e.host,e._protocol),r={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},n=eq(o,n),e=e.maxUploadRetryTime;const a=new tq(s,"POST",function(e){uq(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){nq(!1)}return nq(xU(t)),t},e);return a.urlParams=i,a.headers=r,a.body=n,a.errorHandler=sq(t),a}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const i=this._uploadUrl;this._resolveToken((e,t)=>{var n=function(e,t,n,r){e=e.maxUploadRetryTime;const i=new tq(n,"POST",function(e){var t=uq(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){nq(!1)}return n||nq(!1),e=Number(n),nq(!isNaN(e)),new lq(e,r.size(),"final"===t)},e);return i.headers={"X-Goog-Upload-Command":"query"},i.errorHandler=sq(t),i}(this._ref.storage,this._ref._location,i,this._blob);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const i=262144*this._chunkMultiplier,s=new lq(this._transferred,this._blob.size()),o=this._uploadUrl;this._resolveToken((e,t)=>{let n;try{n=function(e,s,t,o,n,a,r,i){const c=new lq(0,0);if(r?(c.current=r.current,c.total=r.total):(c.current=0,c.total=o.size()),o.size()!==c.total)throw new vU("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var l=c.total-c.current;let u=l;0<n&&(u=Math.min(u,n)),n=(r=c.current)+u,l={"X-Goog-Upload-Command":u===l?"upload, finalize":"upload","X-Goog-Upload-Offset":`${c.current}`};const h=o.slice(r,n);if(null===h)throw IU();n=s.maxUploadRetryTime;const d=new tq(t,"POST",function(e,t){var n=uq(e,["active","final"]),r=c.current+u,i=o.size(),t="final"===n?rq(s,a)(e,t):null;return new lq(r,i,"final"===n,t)},n);return d.headers=l,d.body=h.uploadData(),d.progressCallback=i||null,d.errorHandler=sq(e),d}(this._ref._location,this._ref.storage,o,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var n=aq(this._ref.storage,this._ref._location,this._mappings);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var n=function(e,t,n,r,i){var s=t.bucketOnlyServerUrl();const o={"X-Goog-Upload-Protocol":"multipart"};var a=function(){let t="";for(let e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();o["Content-Type"]="multipart/related; boundary="+a;var c=cq(t,r,i),i="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+eq(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",a="\r\n--"+a+"--";const l=WU.getBlob(i,r,a);if(null===l)throw IU();a={name:c.fullPath},c=MU(s,e.host,e._protocol),s=e.maxUploadRetryTime;const u=new tq(c,"POST",rq(e,n),s);return u.urlParams=a,u.headers=o,u.body=l.uploadData(),u.errorHandler=sq(t),u}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request&&this._request.cancel();break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=bU(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=dq(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new pq(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){-1!==(e=this._observers.indexOf(e))&&this._observers.splice(e,1)}_notifyObservers(){this._finishPromise();const e=this._observers.slice();e.forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(dq(this._state)){case hq.SUCCESS:fq(this._resolve.bind(null,this.snapshot))();break;case hq.CANCELED:case hq.ERROR:const t=this._reject;fq(t.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(dq(this._state)){case hq.RUNNING:case hq.PAUSED:e.next&&fq(e.next.bind(e,this.snapshot))();break;case hq.SUCCESS:e.complete&&fq(e.complete.bind(e))();break;case hq.CANCELED:case hq.ERROR:default:e.error&&fq(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class mq{constructor(e,t){this._service=e,t instanceof RU?this._location=t:this._location=RU.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new mq(e,t)}get root(){var e=new RU(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return GU(this._location.path)}get storage(){return this._service}get parent(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);return null===e?null:(e=new RU(this._location.bucket,e),new mq(this._service,e))}_throwIfRoot(e){if(""===this._location.path)throw SU(e)}}async function yq(e,t){return null!=t&&"number"==typeof t.maxResults&&LU("options.maxResults",1,1e3,t.maxResults),t=function(e,t,n,r){const i={};t.isRoot?i.prefix="":i.prefix=t.path+"/",0<"/".length&&(i.delimiter="/"),n&&(i.pageToken=n),r&&(i.maxResults=r),n=MU(t.bucketOnlyServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime;const s=new tq(n,"GET",iq(e,t.bucket),r);return s.urlParams=i,s.errorHandler=sq(t),s}(e.storage,e._location,(t=t||{}).pageToken,t.maxResults),(await e.storage.makeRequestWithTokens(t)).getPromise()}async function vq(e){e._throwIfRoot("getDownloadURL");var t=function(e,t,n){var r,i,s=MU(t.fullServerUrl(),e.host,e._protocol),o=e.maxOperationRetryTime;const a=new tq(s,"GET",(r=e,i=n,function(e,a){var t=ZU(r,a,i);return nq(null!==t),function(r,e,i,s){if(null===(e=HU(a)))return null;if(!xU(e.downloadTokens))return null;const t=e.downloadTokens;if(0===t.length)return null;const o=encodeURIComponent,n=t.split(",");return n.map(e=>{var t=r.bucket,n=r.fullPath;return MU("/b/"+o(t)+"/o/"+o(n),i,s)+FU({alt:"media",token:e})})[0]}(t,0,r.host,r._protocol)}),o);return a.errorHandler=oq(t),a}(e.storage,e._location,XU());return(await e.storage.makeRequestWithTokens(t)).getPromise().then(e=>{if(null===e)throw new vU("no-download-url","The given file does not have any download URLs.");return e})}function _q(e,t){var n,t=(n=e._location.path,t=t.split("/").filter(e=>0<e.length).join("/"),0===n.length?t:n+"/"+t),t=new RU(e._location.bucket,t);return new mq(e.storage,t)}function wq(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof Iq)return n=e,r=t,new mq(n,r);throw TU("To use ref(service, url), the first argument must be a Storage instance.")}return function e(t,n){if(t instanceof Iq){var r=t;if(null==r._bucket)throw new vU("no-default-bucket","No default bucket found. Did you set the '"+yU+"' property when initializing the app?");return r=new mq(r,r._bucket),null!=n?e(r,n):r}return void 0!==n?_q(t,n):t}(e,t);var n,r}function bq(e,t){return null==(t=null==t?void 0:t[yU])?null:RU.makeFromBucketSpec(t,e)}class Iq{constructor(e,t,n,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._pool=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=mU,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?RU.makeFromBucketSpec(i,this._host):bq(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=RU.makeFromBucketSpec(this._url,e):this._bucket=bq(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){LU("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){LU("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){var t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new mq(this,e)}_makeRequest(e,t,n){if(this._deleted)return new PU(EU());{const l=(r=e,i=this._appId,s=t,o=n,a=this._pool,c=this._firebaseVersion,e=FU(r.urlParams),t=r.url+e,e=n=Object.assign({},r.headers),i&&(e["X-Firebase-GMPID"]=i),i=n,null!==s&&0<s.length&&(i.Authorization="Firebase "+s),n["X-Firebase-Storage-Version"]="webjs/"+(null!=c?c:"AppManager"),c=n,null!==o&&(c["X-Firebase-AppCheck"]=o),new UU(t,r.method,n,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,a));return this._requests.add(l),l.getPromise().then(()=>this._requests.delete(l),()=>this._requests.delete(l)),l}var r,i,s,o,a,c}async makeRequestWithTokens(e){var[t,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n)}}function Tq(e,t){return wq(e=Qd(e),t)}Ip(new ep("storage",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),e=e.getProvider("app-check-internal");return new Iq(n,r,e,new NU,t,kp)},"PUBLIC").setMultipleInstances(!0)),Rp("@firebase/storage","0.8.3");class Eq{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class Sq{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new Eq(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new Eq(e,this,this._ref))},e)}on(e,t,n,r){let i=void 0;return t&&(i="function"==typeof t?e=>t(new Eq(e,this,this._ref)):{next:t.next?e=>t.next(new Eq(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class kq{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new Cq(e,this._service))}get items(){return this._delegate.items.map(e=>new Cq(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class Cq{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){return e=_q(this._delegate,e),new Cq(e,this.storage)}get root(){return new Cq(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new Cq(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new Sq((n=this._delegate,e=e,t=t,(n=Qd(n))._throwIfRoot("uploadBytesResumable"),new gq(n,new WU(e),t)),this);var n}putString(e,t=jU.RAW,n){this._throwIfRoot("putString"),e=BU(t,e);const r=Object.assign({},n);return null==r.contentType&&null!=e.contentType&&(r.contentType=e.contentType),new Sq(new gq(this._delegate,new WU(e.data,!0),r),this)}listAll(){return function(e){const t={prefixes:[],items:[]};return async function e(t,n,r){r=await yq(t,{pageToken:r});n.prefixes.push(...r.prefixes),n.items.push(...r.items),null!=r.nextPageToken&&await e(t,n,r.nextPageToken)}(e,t).then(()=>t)}(Qd(this._delegate)).then(e=>new kq(e,this.storage))}list(e){return yq(Qd(this._delegate),e=e||void 0).then(e=>new kq(e,this.storage))}getMetadata(){return async function(e){e._throwIfRoot("getMetadata");var t=aq(e.storage,e._location,XU());return(await e.storage.makeRequestWithTokens(t)).getPromise()}(Qd(this._delegate))}updateMetadata(e){return async function(e,t){return e._throwIfRoot("updateMetadata"),t=function(e,t,n,r){var i=MU(t.fullServerUrl(),e.host,e._protocol),s=eq(n,r),n=e.maxOperationRetryTime;const o=new tq(i,"PATCH",rq(e,r),n);return o.headers={"Content-Type":"application/json; charset=utf-8"},o.body=s,o.errorHandler=oq(t),o}(e.storage,e._location,t,XU()),(await e.storage.makeRequestWithTokens(t)).getPromise()}(Qd(this._delegate),e)}getDownloadURL(){return vq(Qd(this._delegate))}delete(){return this._throwIfRoot("delete"),async function(e){e._throwIfRoot("deleteObject");var t=function(e,t){var n=MU(t.fullServerUrl(),e.host,e._protocol),e=e.maxOperationRetryTime;const r=new tq(n,"DELETE",function(e,t){},e);return r.successCodes=[200,204],r.errorHandler=oq(t),r}(e.storage,e._location);return(await e.storage.makeRequestWithTokens(t)).getPromise()}(Qd(this._delegate))}_throwIfRoot(e){if(""===this._delegate._location.path)throw SU(e)}}class Aq{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(Nq(e))throw TU("ref() expected a child path but got a URL, use refFromURL instead.");return new Cq(Tq(this._delegate,e),this)}refFromURL(e){if(!Nq(e))throw TU("refFromURL() expected a full URL but got a child path, use ref() instead.");try{RU.makeFromUrl(e,this._delegate.host)}catch(e){throw TU("refFromUrl() expected a valid full URL but got an invalid one.")}return new Cq(Tq(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){var r;[r,e,t,n={}]=[this._delegate,e,t,n],[r,e,t,n={}]=[r,e,t,n],r.host=`${e}:${t}`,r._protocol="http",(n=n.mockUserToken)&&(r._overrideAuthToken="string"==typeof n?n:pd(n,r.app.options.projectId))}}function Nq(e){return/^[A-Za-z]+:\/\//.test(e)}_t=Fp,xa={TaskState:hq,TaskEvent:{STATE_CHANGED:"state_changed"},StringFormat:jU,Storage:Aq,Reference:Cq},_t.INTERNAL.registerComponent(new ep("storage-compat",function(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("storage").getImmediate({identifier:t});return new Aq(n,t)},"PUBLIC").setServiceProps(xa).setMultipleInstances(!0)),_t.registerVersion("@firebase/storage-compat","0.1.3");const Rq="0.5.1",Pq="FB-PERF-TRACE-MEASURE",xq="@firebase/performance/config",Oq="@firebase/performance/configexpire";var Dq,Lq="Performance";const Mq=new Sd("performance",Lq,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),Fq=new pp(Lq);Fq.logLevel=sp.INFO;let Uq,qq;class jq{constructor(e){if(!(this.window=e))throw Mq.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&Td()?!!bd()||(Fq.info("IndexedDB is not supported by current browswer"),!1):(Fq.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,n){if(this.PerformanceObserver){const t=new this.PerformanceObserver(e=>{for(const t of e.getEntries())n(t)});t.observe({entryTypes:[e]})}}static getInstance(){return void 0===Uq&&(Uq=new jq(qq)),Uq}}let Vq;function Bq(t,n){var e=t.length-n.length;if(e<0||1<e)throw Mq.create("invalid String merger input");const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),n.length>e&&r.push(n.charAt(e));return r.join("")}let Kq;class zq{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=Bq("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=Bq("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===Kq&&(Kq=new zq),Kq}}(Lq=Dq=Dq||{})[Lq.UNKNOWN=0]="UNKNOWN",Lq[Lq.VISIBLE=1]="VISIBLE",Lq[Lq.HIDDEN=2]="HIDDEN";const $q=["firebase_","google_","ga_"],Wq=new RegExp("^[a-zA-Z]\\w*$");function Hq(){switch(jq.getInstance().document.visibilityState){case"visible":return Dq.VISIBLE;case"hidden":return Dq.HIDDEN;default:return Dq.UNKNOWN}}function Gq(e){if(!(e=null===(e=e.options)||void 0===e?void 0:e.appId))throw Mq.create("no app id");return e}const Qq="0.0.1",Yq={loggingEnabled:!0},Jq="FIREBASE_INSTALLATIONS_AUTH";const Xq="Could not fetch config, will use default configs";function Zq(e){if(!e)return e;const t=zq.getInstance();var n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=Yq.loggingEnabled,n.fpr_log_source&&(t.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(t.logEndPointUrl=n.fpr_log_endpoint_url),n.fpr_log_transport_key&&(t.transportKey=n.fpr_log_transport_key),void 0!==n.fpr_vc_network_request_sampling_rate&&(t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),t.logTraceAfterSampling=ej(t.tracesSamplingRate),t.logNetworkAfterSampling=ej(t.networkRequestsSamplingRate),e}function ej(e){return Math.random()<=e}let tj=1,nj;function rj(e){var t;return tj=2,nj=nj||(t=e,function(){const n=jq.getInstance().document;return new Promise(e=>{if(n&&"complete"!==n.readyState){const t=()=>{"complete"===n.readyState&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}().then(()=>function(){const e=t.installations.getId();return e.then(e=>{Vq=e}),e}()).then(e=>function(t,e){var r,i,n=function(){const e=jq.getInstance().localStorage;if(e){var t=e.getItem(Oq);if(t&&Number(t)>Date.now()&&(t=e.getItem(xq)))try{return JSON.parse(t)}catch(e){return}}}();return n?(Zq(n),Promise.resolve()):(i=e,function(){const e=(r=t).installations.getToken();return e.then(e=>{}),e}().then(e=>{var t=function(e){if(!(e=null===(e=e.options)||void 0===e?void 0:e.projectId))throw Mq.create("no project id");return e}(r.app),n=function(e){if(!(e=null===(e=e.options)||void 0===e?void 0:e.apiKey))throw Mq.create("no api key");return e}(r.app),e=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=${n}`,{method:"POST",headers:{Authorization:`${Jq} ${e}`},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:Gq(r.app),app_version:Rq,sdk_version:Qq})});return fetch(e).then(e=>{if(e.ok)return e.json();throw Mq.create("RC response not ok")})}).catch(()=>{Fq.info(Xq)}).then(Zq).then(e=>function(e){const t=jq.getInstance().localStorage;e&&t&&(t.setItem(xq,JSON.stringify(e)),t.setItem(Oq,String(Date.now()+60*zq.getInstance().configTimeToLive*60*1e3)))}(e),()=>{}))}(t,e)).then(()=>ij(),()=>ij())),nj}function ij(){tj=3}let sj=3,oj=[],aj=!1;function cj(e){setTimeout(()=>{if(0!==sj)return oj.length?void function(){const e=oj.splice(0,1e3),t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:zq.getInstance().logSource,log_event:t};var r,i,s;r=n,i=e,s=n,r=zq.getInstance().getFlTransportFullUrl(),fetch(r,{method:"POST",body:JSON.stringify(s)}).then(e=>(e.ok||Fq.info("Call to Firebase backend failed."),e.json())).then(e=>{var t=Number(e.nextRequestWaitMillis);let n=1e4;isNaN(t)||(n=Math.max(t,n)),e=e.logResponseDetails,Array.isArray(e)&&0<e.length&&"RETRY_REQUEST_LATER"===e[0].responseAction&&(oj=[...i,...oj],Fq.info("Retry transport request later.")),sj=3,cj(n)}).catch(()=>{oj=[...e,...oj],sj--,Fq.info(`Tries left: ${sj}.`),cj(1e4)})}():cj(1e4)},e)}function lj(t){return(...e)=>{!function(e){if(!e.eventTime||!e.message)throw Mq.create("invalid cc log");oj=[...oj,e]}({message:t(...e),eventTime:Date.now()})}}let uj;function hj(e,t){uj=uj||lj(fj),uj(e,t)}function dj(e){var t=zq.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&jq.getInstance().requiredApisAvailable()&&(e.isAuto&&Hq()!==Dq.VISIBLE||(3===tj?pj(e):rj(e.performanceController).then(()=>pj(e),()=>pj(e))))}function pj(e){var t;!Vq||(t=zq.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>hj(e,1),0)}function fj(e,t){return 0===t?(t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},t={application_info:gj(e.performanceController.app),network_request_metric:t},JSON.stringify(t)):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);var n=e.getAttributes();return 0!==Object.keys(n).length&&(t.custom_attributes=n),e={application_info:gj(e.performanceController.app),trace_metric:t},JSON.stringify(e)}(e)}function gj(e){return{google_app_id:Gq(e),app_instance_id:Vq,web_app_info:{sdk_version:Rq,page_url:jq.getInstance().getUrl(),service_worker_status:"serviceWorker"in(e=jq.getInstance().navigator)?e.serviceWorker.controller?2:3:1,visibility_state:Hq(),effective_connection_type:function(){var e=jq.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}const mj=["_fp","_fcp","_fid"];class yj{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=jq.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=r||`${Pq}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw Mq.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw Mq.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),dj(this)}record(e,t,n){if(e<=0)throw Mq.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw Mq.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const r of Object.keys(n.metrics))isNaN(Number(n.metrics[r]))||(this.counters[r]=Number(Math.floor(n.metrics[r])));dj(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(n=e,r=this.name,0===n.length||100<n.length||!(r&&r.startsWith("_wt_")&&-1<mj.indexOf(n))&&n.startsWith("_"))throw Mq.create("invalid custom metric name",{customMetricName:e});var n,r;this.counters[e]=(e=t,(t=Math.floor(e))<e&&Fq.info(`Metric value should be an Integer, setting the value as : ${t}.`),t)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var n,r=!(0===(n=e).length||40<n.length||$q.some(e=>n.startsWith(e))||!n.match(Wq)),i=0!==(i=t).length&&i.length<=100;if(r&&i)this.customAttributes[e]=t;else{if(!r)throw Mq.create("invalid attribute name",{attributeName:e});if(!i)throw Mq.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure);(e=e&&e[0])&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){var i=jq.getInstance().getUrl();if(i){const s=new yj(e,"_wt_"+i,!0);i=Math.floor(1e3*jq.getInstance().getTimeOrigin()),s.setStartTime(i),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),n&&((t=n.find(e=>"first-paint"===e.name))&&t.startTime&&s.putMetric("_fp",Math.floor(1e3*t.startTime)),(n=n.find(e=>"first-contentful-paint"===e.name))&&n.startTime&&s.putMetric("_fcp",Math.floor(1e3*n.startTime)),r&&s.putMetric("_fid",Math.floor(1e3*r))),dj(s)}}static createUserTimingTrace(e,t){dj(new yj(e,t,!1,t))}}function vj(e,t){const n=t;var r,i;n&&void 0!==n.responseStart&&(i=jq.getInstance().getTimeOrigin(),r=Math.floor(1e3*(n.startTime+i)),t=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,i=Math.floor(1e3*(n.responseEnd-n.startTime)),function(e){const t=zq.getInstance();var n,r,i;t.instrumentationEnabled&&(n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0],n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout(()=>hj(e,0),0))}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:r,timeToResponseInitiatedUs:t,timeToResponseCompletedUs:i}))}function _j(e){Vq&&(setTimeout(()=>function(n){const e=jq.getInstance(),r=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let t=setTimeout(()=>{yj.createOobTrace(n,r,i),t=void 0},5e3);e.onFirstInputDelay(e=>{t&&(clearTimeout(t),yj.createOobTrace(n,r,i,e))})}else yj.createOobTrace(n,r,i)}(e),0),setTimeout(()=>function(t){const e=jq.getInstance(),n=e.getEntriesByType("resource");for(const r of n)vj(t,r);e.setupObserver("resource",e=>vj(t,e))}(e),0),setTimeout(()=>function(t){const e=jq.getInstance(),n=e.getEntriesByType("measure");for(const r of n)wj(t,r);e.setupObserver("measure",e=>wj(t,e))}(e),0))}function wj(e,t){const n=t.name;n.substring(0,Pq.length)!==Pq&&yj.createUserTimingTrace(e,n)}class bj{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),jq.getInstance().requiredApisAvailable()?Id().then(e=>{e&&(aj||(cj(5500),aj=!0),rj(this).then(()=>_j(this),()=>_j(this)),this.initialized=!0)}).catch(e=>{Fq.info(`Environment doesn't support IndexedDB: ${e}`)}):Fq.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){zq.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return zq.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){zq.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return zq.getInstance().dataCollectionEnabled}}Ip(new ep("performance",(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("[DEFAULT]"!==n.name)throw Mq.create("FB not default");if("undefined"==typeof window)throw Mq.create("no window");e=window,qq=e;const i=new bj(n,r);return i._init(t),i},"PUBLIC")),Rp("@firebase/performance","0.5.1");class Ij{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=Qd(this._delegate),new yj(t,e);var t}}(Lq=Fp).INTERNAL.registerComponent(new ep("performance-compat",function(e){var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("performance").getImmediate();return new Ij(t,e)},"PUBLIC")),Lq.registerVersion("@firebase/performance-compat","0.1.1");const Tj="@firebase/remote-config";class Ej{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const Sj=new Sd("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"}),kj=["1","true","t","yes","y","on"];class Cj{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=kj.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return isNaN(e)&&(e=0),e}getSource(){return this._source}}async function Aj(e){const t=Qd(e);var[n,e]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(n&&n.config&&n.eTag&&n.eTag!==e)&&(await Promise.all([t._storageCache.setActiveConfig(n.config),t._storage.setActiveConfigEtag(n.eTag)]),!0)}function Nj(e){const t=Qd(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function Rj(e){const t=Qd(e),n=new Ej;setTimeout(async()=>{n.abort()},t.settings.fetchTimeoutMillis);try{await t._client.fetch({cacheMaxAgeMillis:t.settings.minimumFetchIntervalMillis,signal:n}),await t._storageCache.setLastFetchStatus("success")}catch(n){throw r="fetch-throttle",r=(e=n)instanceof Ed&&-1!==e.code.indexOf(r)?"throttle":"failure",await t._storageCache.setLastFetchStatus(r),n}var r}function Pj(e,t){const n=Qd(e);return n._isInitializationComplete||n._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value."),(e=n._storageCache.getActiveConfig())&&void 0!==e[t]?new Cj("remote",e[t]):n.defaultConfig&&void 0!==n.defaultConfig[t]?new Cj("default",String(n.defaultConfig[t])):(n._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new Cj("static"))}class xj{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-t,t=n<=e;return this.logger.debug("Config fetch cache check."+` Cache age millis: ${n}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${t}.`),t}async fetch(e){var[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag,e=await this.client.fetch(e);const r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===e.status&&r.push(this.storage.setLastSuccessfulFetchResponse(e)),await Promise.all(r),e}}class Oj{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(n){var[t,e]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),r=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,i={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":n.eTag||"*"},e={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:e,app_id:this.appId,language_code:(e=navigator).languages&&e.languages[0]||e.language},e={method:"POST",headers:i,body:JSON.stringify(e)},r=fetch(r,e),e=new Promise((e,t)=>{n.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let s;try{await Promise.race([r,e]),s=await r}catch(t){let e="fetch-client-network";throw"AbortError"===t.name&&(e="fetch-timeout"),Sj.create(e,{originalErrorMessage:t.message})}let o=s.status;r=s.headers.get("ETag")||void 0;let a,c;if(200===s.status){let e;try{e=await s.json()}catch(t){throw Sj.create("fetch-client-parse",{originalErrorMessage:t.message})}a=e.entries,c=e.state}if("INSTANCE_STATE_UNSPECIFIED"===c?o=500:"NO_CHANGE"===c?o=304:"NO_TEMPLATE"!==c&&"EMPTY_CONFIG"!==c||(a={}),304!==o&&200!==o)throw Sj.create("fetch-status",{httpStatus:o});return{status:o,eTag:r,config:a}}}class Dj{constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:n}){var i=e.signal,s=t;await new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(Sj.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var r=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),r}catch(t){if(!((r=t)instanceof Ed&&r.customData)||429!==(r=Number(r.customData.httpStatus))&&500!==r&&503!==r&&504!==r)throw t;return n={throttleEndTimeMillis:Date.now()+Gd(n),backoffCount:n+1},await this.storage.setThrottleMetadata(n),this.attemptFetch(e,n)}}}class Lj{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function Mj(e,t){return e=e.target.error||void 0,Sj.create(t,{originalErrorMessage:e&&e.message})}const Fj="app_namespace_store";class Uj{constructor(e,t,n,r=function(){return new Promise((t,n)=>{try{const e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{n(Mj(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(Fj,{keyPath:"compositeKey"})}}catch(e){n(Sj.create("storage-open",{originalErrorMessage:e}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(o){const a=await this.openDbPromise;return new Promise((t,n)=>{const e=a.transaction([Fj],"readonly"),r=e.objectStore(Fj);var i=this.createCompositeKey(o);try{const s=r.get(i);s.onerror=e=>{n(Mj(e,"storage-get"))},s.onsuccess=e=>{e=e.target.result,t(e?e.value:void 0)}}catch(e){n(Sj.create("storage-get",{originalErrorMessage:e&&e.message}))}})}async set(o,a){const c=await this.openDbPromise;return new Promise((e,t)=>{const n=c.transaction([Fj],"readwrite"),r=n.objectStore(Fj);var i=this.createCompositeKey(o);try{const s=r.put({compositeKey:i,value:a});s.onerror=e=>{t(Mj(e,"storage-set"))},s.onsuccess=()=>{e()}}catch(e){t(Sj.create("storage-set",{originalErrorMessage:e&&e.message}))}})}async delete(o){const a=await this.openDbPromise;return new Promise((e,t)=>{const n=a.transaction([Fj],"readwrite"),r=n.objectStore(Fj);var i=this.createCompositeKey(o);try{const s=r.delete(i);s.onerror=e=>{t(Mj(e,"storage-delete"))},s.onsuccess=()=>{e()}}catch(e){t(Sj.create("storage-delete",{originalErrorMessage:e&&e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class qj{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig();(e=await e)&&(this.lastFetchStatus=e),(t=await t)&&(this.lastSuccessfulFetchTimestampMillis=t),(n=await n)&&(this.activeConfig=n)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}Ip(new ep("remote-config",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw Sj.create("registration-window");if(!bd())throw Sj.create("indexed-db-unavailable");var{projectId:i,apiKey:s,appId:e}=n.options;if(!i)throw Sj.create("registration-project-id");if(!s)throw Sj.create("registration-api-key");if(!e)throw Sj.create("registration-app-id");t=t||"firebase";const o=new Uj(e,n.name,t),a=new qj(o),c=new pp(Tj);return c.logLevel=sp.ERROR,e=new Oj(r,kp,t,i,s,e),e=new Dj(e,o),e=new xj(e,o,a,c),Nj(e=new Lj(n,e,a,o,c)),e},"PUBLIC").setMultipleInstances(!0)),Rp(Tj,"0.3.0");class jj{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return Aj(this._delegate)}ensureInitialized(){return Nj(this._delegate)}fetch(){return Rj(this._delegate)}fetchAndActivate(){return async function(e){return await Rj(e=Qd(e)),Aj(e)}(this._delegate)}getAll(){return function(n){const e=Qd(n);return[t={},r={}]=[e._storageCache.getActiveConfig(),e.defaultConfig],Object.keys(Object.assign(Object.assign({},t),r)).reduce((e,t)=>(e[t]=Pj(n,t),e),{});var t,r}(this._delegate)}getBoolean(e){return Pj(Qd(this._delegate),e).asBoolean()}getNumber(e){return Pj(Qd(this._delegate),e).asNumber()}getString(e){return Pj(Qd(this._delegate),e).asString()}getValue(e){return Pj(this._delegate,e)}setLogLevel(n){!function(e){const t=Qd(e);switch(n){case"debug":t._logger.logLevel=sp.DEBUG;break;case"silent":t._logger.logLevel=sp.SILENT;break;default:t._logger.logLevel=sp.ERROR}}(this._delegate)}}return(Lq=Fp).INTERNAL.registerComponent(new ep("remoteConfig-compat",function(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("remote-config").getImmediate({identifier:t});return new jj(n,t)},"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:async function(){if(!bd())return!1;try{return Id()}catch(e){return!1}}})),Lq.registerVersion("@firebase/remote-config-compat","0.1.1"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),Fp.registerVersion("firebase","9.1.2","compat-cdn"),Fp});